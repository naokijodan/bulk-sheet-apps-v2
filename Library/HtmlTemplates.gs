/******************************************************
 * HtmlTemplates.gs - HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ–‡å­—åˆ—
 *
 * ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå†…ã§HTMLã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€æ–‡å­—åˆ—ã¨ã—ã¦åŸ‹ã‚è¾¼ã¿
 ******************************************************/

var HTML_TEMPLATES = {};


HTML_TEMPLATES['SimpleSetup'] = '<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset="UTF-8">\n    <style>\n      body { font-family: Arial, sans-serif; padding: 14px; }\n      label { display:block; margin-bottom:6px; }\n      input[type="password"], input[type="text"] { width:100%; padding:8px; box-sizing:border-box; }\n      .row { margin: 10px 0; }\n      .hint { font-size: 12px; color: #666; margin-top: 6px; }\n      .actions { margin-top: 16px; display:flex; gap:8px; }\n      button { padding:8px 14px; cursor:pointer; }\n      .ok { background:#1976d2; color:white; border:none; }\n      .cancel { background:#eee; border:1px solid #ccc; }\n      .msg { margin-top:10px; font-size: 12px; }\n    </style>\n  </head>\n  <body>\n    <h3>ğŸ”‘ ç°¡æ˜“ç‰ˆ åˆæœŸè¨­å®šï¼ˆAPIã‚­ãƒ¼ã®ã¿ï¼‰</h3>\n    <div class="row">\n      <label for="apiKey">OpenAI APIã‚­ãƒ¼</label>\n      <input id="apiKey" type="password" placeholder="sk-..." />\n      <div class="hint">\n        â€» ã“ã®ã‚­ãƒ¼ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®è¨­å®šï¼ˆUserPropertiesï¼‰ã«ä¿å­˜ã•ã‚Œã€ãƒ•ãƒ«ç‰ˆè¨­å®šã¨ã¯ç‹¬ç«‹ã§ã™ã€‚<br>\n        â€» ç°¡æ˜“ç‰ˆã§ã¯ <b>GPT-5-nano</b> / <b>EBAY_FULL_LISTING_PROMPT</b> / <b>Profit-Amounts</b> å›ºå®šã§å‹•ä½œã—ã¾ã™ã€‚\n      </div>\n    </div>\n    <div class="actions">\n      <button class="ok" onclick="save()">ä¿å­˜</button>\n      <button class="cancel" onclick="google.script.host.close()">é–‰ã˜ã‚‹</button>\n    </div>\n    <div id="msg" class="msg"></div>\n\n    <script>\n      // æ—¢å­˜å€¤ã®èª­ã¿è¾¼ã¿ï¼ˆåˆæœŸè¡¨ç¤ºï¼‰\n      google.script.run.withSuccessHandler(function(s){\n        if (s && s.apiKey) document.getElementById(\'apiKey\').value = s.apiKey;\n      }).getSimpleSettings();\n\n      function save(){\n        const el = document.getElementById(\'apiKey\');\n        const key = (el.value || \'\').trim();\n        const msg = document.getElementById(\'msg\');\n        msg.textContent = \'ä¿å­˜ä¸­â€¦\';\n        google.script.run.withSuccessHandler(function(res){\n          if (res && res.ok) {\n            msg.textContent = \'âœ… ä¿å­˜ã—ã¾ã—ãŸã€‚\';\n            setTimeout(()=> google.script.host.close(), 600);\n          } else {\n            msg.textContent = \'âš ï¸ ã‚¨ãƒ©ãƒ¼: \' + (res && res.error ? res.error : \'ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ\');\n          }\n        }).saveSimpleSettings(key);\n      }\n    </script>\n  </body>\n</html>\n';

HTML_TEMPLATES['PromptEditor'] = '<!DOCTYPE html>\n<html>\n<head>\n  <base target="_top">\n  <style>\n    * { box-sizing: border-box; }\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n      margin: 0;\n      padding: 0;\n      background-color: #f8f9fa;\n      font-size: 13px;\n    }\n\n    /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */\n    .tab-nav {\n      display: flex;\n      background: #fff;\n      border-bottom: 1px solid #dadce0;\n      position: sticky;\n      top: 0;\n      z-index: 100;\n    }\n    .tab-btn {\n      flex: 1;\n      padding: 12px 8px;\n      border: none;\n      background: transparent;\n      cursor: pointer;\n      font-size: 13px;\n      font-weight: 500;\n      color: #5f6368;\n      transition: all 0.2s;\n      border-bottom: 2px solid transparent;\n    }\n    .tab-btn:hover {\n      background: #f1f3f4;\n    }\n    .tab-btn.active {\n      color: #1a73e8;\n      border-bottom-color: #1a73e8;\n    }\n\n    /* ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */\n    .tab-content {\n      display: none;\n      padding: 12px;\n    }\n    .tab-content.active {\n      display: block;\n    }\n\n    /* å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */\n    h3 {\n      color: #1a73e8;\n      margin: 0 0 12px 0;\n      font-size: 15px;\n    }\n    label {\n      display: block;\n      margin-bottom: 4px;\n      font-weight: 500;\n      color: #3c4043;\n    }\n    textarea {\n      width: 100%;\n      height: 200px;\n      margin-bottom: 12px;\n      padding: 10px;\n      font-size: 13px;\n      border: 1px solid #dadce0;\n      border-radius: 4px;\n      resize: vertical;\n    }\n    select {\n      width: 100%;\n      margin-bottom: 12px;\n      padding: 8px;\n      font-size: 13px;\n      border: 1px solid #dadce0;\n      border-radius: 4px;\n      background-color: #fff;\n    }\n    button {\n      padding: 8px 16px;\n      font-size: 13px;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n      margin-right: 8px;\n      margin-bottom: 8px;\n      transition: all 0.2s;\n    }\n    button.primary {\n      background-color: #1a73e8;\n      color: white;\n    }\n    button.primary:hover {\n      background-color: #1557b0;\n    }\n    button.secondary {\n      background-color: #e8eaed;\n      color: #3c4043;\n    }\n    button.secondary:hover {\n      background-color: #dadce0;\n    }\n    button:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n\n    /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ */\n    .message {\n      margin-top: 12px;\n      padding: 10px;\n      border-radius: 4px;\n      font-weight: 500;\n      display: none;\n    }\n    .message.success {\n      background-color: #e6ffe6;\n      color: #188038;\n      border: 1px solid #188038;\n    }\n    .message.error {\n      background-color: #ffe6e6;\n      color: #d93025;\n      border: 1px solid #d93025;\n    }\n    .message.info {\n      background-color: #e8f0fe;\n      color: #1a73e8;\n      border: 1px solid #1a73e8;\n    }\n\n    /* ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ: ã‚»ãƒ«æƒ…å ±ã‚«ãƒ¼ãƒ‰ */\n    .cell-info-card {\n      background: #fff;\n      border: 1px solid #dadce0;\n      border-radius: 8px;\n      padding: 12px;\n      margin-bottom: 12px;\n    }\n    .cell-info-card h4 {\n      margin: 0 0 8px 0;\n      font-size: 13px;\n      color: #5f6368;\n    }\n    .cell-info-row {\n      display: flex;\n      justify-content: space-between;\n      padding: 4px 0;\n      border-bottom: 1px solid #f1f3f4;\n    }\n    .cell-info-row:last-child {\n      border-bottom: none;\n    }\n    .cell-info-label {\n      color: #5f6368;\n    }\n    .cell-info-value {\n      font-weight: 500;\n      color: #202124;\n      max-width: 60%;\n      word-break: break-all;\n    }\n    .cell-info-value.error {\n      color: #d93025;\n    }\n\n    /* ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */\n    .action-buttons {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 8px;\n      margin-bottom: 12px;\n    }\n    .action-btn {\n      flex: 1;\n      min-width: 100px;\n      padding: 10px;\n      background: #fff;\n      border: 1px solid #dadce0;\n      border-radius: 8px;\n      cursor: pointer;\n      text-align: center;\n      transition: all 0.2s;\n    }\n    .action-btn:hover {\n      background: #f1f3f4;\n      border-color: #1a73e8;\n    }\n    .action-btn-icon {\n      font-size: 20px;\n      margin-bottom: 4px;\n    }\n    .action-btn-label {\n      font-size: 12px;\n      color: #3c4043;\n    }\n\n    /* ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ: çµæœè¡¨ç¤º */\n    .result-box {\n      background: #fff;\n      border: 1px solid #dadce0;\n      border-radius: 8px;\n      padding: 12px;\n      margin-bottom: 12px;\n      white-space: pre-wrap;\n      line-height: 1.5;\n    }\n    .result-box.loading {\n      color: #5f6368;\n      text-align: center;\n    }\n\n    /* ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ: FAQ */\n    .faq-item {\n      background: #fff;\n      border: 1px solid #dadce0;\n      border-radius: 8px;\n      margin-bottom: 8px;\n      overflow: hidden;\n    }\n    .faq-question {\n      padding: 10px 12px;\n      cursor: pointer;\n      font-weight: 500;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n    .faq-question:hover {\n      background: #f1f3f4;\n    }\n    .faq-answer {\n      padding: 0 12px;\n      max-height: 0;\n      overflow: hidden;\n      transition: all 0.2s;\n      border-top: 1px solid #dadce0;\n      background: #f8f9fa;\n    }\n    .faq-answer.open {\n      padding: 10px 12px;\n      max-height: 200px;\n    }\n\n    /* ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ */\n    .feedback-form {\n      background: #fff;\n      border: 1px solid #dadce0;\n      border-radius: 8px;\n      padding: 12px;\n    }\n  </style>\n</head>\n<body>\n\n  <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->\n  <div class="tab-nav">\n    <button class="tab-btn active" onclick="switchTab(\'prompt\')">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</button>\n    <button class="tab-btn" onclick="switchTab(\'assistant\')">ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</button>\n  </div>\n\n  <!-- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¿ãƒ– -->\n  <div id="tab-prompt" class="tab-content active">\n    <h3>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†</h3>\n    <label for="promptSelect">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆID:</label>\n    <select id="promptSelect" onchange="loadPrompt()">\n    </select>\n    <label for="promptContent">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹:</label>\n    <textarea id="promptContent"></textarea>\n    <button class="primary" onclick="savePrompt()">ä¿å­˜</button>\n    <button class="secondary" onclick="google.script.host.close()">é–‰ã˜ã‚‹</button>\n    <div id="promptMessageBox" class="message"></div>\n  </div>\n\n  <!-- ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚¿ãƒ– -->\n  <div id="tab-assistant" class="tab-content">\n    <h3>ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</h3>\n\n    <!-- ã‚»ãƒ«æƒ…å ±ã‚«ãƒ¼ãƒ‰ -->\n    <div class="cell-info-card" id="cellInfoCard">\n      <h4>é¸æŠä¸­ã®ã‚»ãƒ«</h4>\n      <div id="cellInfoContent">\n        <p style="color: #5f6368; text-align: center;">ã‚»ãƒ«ã‚’é¸æŠã—ã¦ã€Œæ›´æ–°ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>\n      </div>\n      <button class="secondary" onclick="refreshCellInfo()" style="width: 100%; margin-top: 8px;">\n        ã‚»ãƒ«æƒ…å ±ã‚’æ›´æ–°\n      </button>\n    </div>\n\n    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->\n    <div class="action-buttons">\n      <div class="action-btn" onclick="analyzeCell()">\n        <div class="action-btn-icon">ğŸ”</div>\n        <div class="action-btn-label">è¨ºæ–­ã™ã‚‹</div>\n      </div>\n      <div class="action-btn" onclick="getColumnInfo()">\n        <div class="action-btn-icon">ğŸ“–</div>\n        <div class="action-btn-label">è©³ç´°ã‚’è¡¨ç¤º</div>\n      </div>\n    </div>\n\n    <!-- çµæœè¡¨ç¤º -->\n    <div class="result-box" id="resultBox" style="display: none;"></div>\n\n    <!-- FAQ -->\n    <h4 style="margin: 16px 0 8px 0; color: #5f6368;">ã‚ˆãã‚ã‚‹è³ªå•</h4>\n    <div id="faqList"></div>\n\n    <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ -->\n    <h4 style="margin: 16px 0 8px 0; color: #5f6368;">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</h4>\n    <div class="feedback-form" style="text-align: center;">\n      <p style="color: #5f6368; margin-bottom: 12px;">ãƒã‚°å ±å‘Šãƒ»æ©Ÿèƒ½è¦æœ›ãƒ»ã”è³ªå•ã¯ã“ã¡ã‚‰ã‹ã‚‰</p>\n      <a href="https://docs.google.com/forms/d/e/1FAIpQLSdhsa_rx3HXRSkSgkp0IVLpcVSqjCa1ksYy2_TT_B6tuJMO2A/viewform" target="_blank" class="primary" style="display: inline-block; text-decoration: none; padding: 10px 20px;">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’é€ã‚‹</a>\n      <p style="color: #9aa0a6; font-size: 11px; margin-top: 8px;">â€»ã€Œä¸€æ‹¬ã‚·ãƒ¼ãƒˆV3ã€ã‚’é¸æŠã—ã¦ãã ã•ã„</p>\n    </div>\n    <div id="assistantMessageBox" class="message"></div>\n  </div>\n\n  <script>\n    // ç¾åœ¨ã®ã‚¿ãƒ–\n    let currentTab = \'prompt\';\n    // ç¾åœ¨ã®ã‚»ãƒ«æƒ…å ±\n    let currentCellInfo = null;\n\n    // ========== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ ==========\n    function switchTab(tabName) {\n      currentTab = tabName;\n\n      // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°\n      document.querySelectorAll(\'.tab-btn\').forEach(btn => btn.classList.remove(\'active\'));\n      event.target.classList.add(\'active\');\n\n      // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ\n      document.querySelectorAll(\'.tab-content\').forEach(content => content.classList.remove(\'active\'));\n      document.getElementById(\'tab-\' + tabName).classList.add(\'active\');\n\n      // ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆãŸæ™‚ã€ã‚»ãƒ«æƒ…å ±ã‚’å–å¾—\n      if (tabName === \'assistant\' && !currentCellInfo) {\n        refreshCellInfo();\n        loadFaqList();\n      }\n    }\n\n    // ========== ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†æ©Ÿèƒ½ ==========\n    function showPromptMessage(msg, type) {\n      const msgBox = document.getElementById(\'promptMessageBox\');\n      msgBox.textContent = msg;\n      msgBox.className = \'message \' + type;\n      msgBox.style.display = \'block\';\n      setTimeout(() => { msgBox.style.display = \'none\'; }, 3000);\n    }\n\n    function populatePromptSelect(promptIds) {\n      const select = document.getElementById(\'promptSelect\');\n      select.innerHTML = \'<option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>\';\n      promptIds.forEach(id => {\n        const option = document.createElement(\'option\');\n        option.value = id;\n        option.textContent = id;\n        select.appendChild(option);\n      });\n    }\n\n    function loadPrompt() {\n      const promptId = document.getElementById(\'promptSelect\').value;\n      if (promptId) {\n        google.script.run\n          .withSuccessHandler(function(content) {\n            document.getElementById(\'promptContent\').value = content;\n          })\n          .withFailureHandler(function(error) {\n            showPromptMessage(\'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: \' + error.message, \'error\');\n            document.getElementById(\'promptContent\').value = \'\';\n          })\n          .getPromptContent(promptId);\n      } else {\n        document.getElementById(\'promptContent\').value = \'\';\n      }\n    }\n\n    function savePrompt() {\n      const promptId = document.getElementById(\'promptSelect\').value;\n      const promptContent = document.getElementById(\'promptContent\').value;\n      if (!promptId) {\n        showPromptMessage(\'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆIDã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚\', \'error\');\n        return;\n      }\n      if (!promptContent.trim()) {\n        showPromptMessage(\'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\', \'error\');\n        return;\n      }\n\n      google.script.run\n        .withSuccessHandler(function() {\n          showPromptMessage(\'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸï¼\', \'success\');\n        })\n        .withFailureHandler(function(error) {\n          showPromptMessage(\'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: \' + error.message, \'error\');\n        })\n        .savePromptContent(promptId, promptContent);\n    }\n\n    // ========== ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆæ©Ÿèƒ½ ==========\n    function showAssistantMessage(msg, type) {\n      const msgBox = document.getElementById(\'assistantMessageBox\');\n      msgBox.textContent = msg;\n      msgBox.className = \'message \' + type;\n      msgBox.style.display = \'block\';\n      setTimeout(() => { msgBox.style.display = \'none\'; }, 3000);\n    }\n\n    function callAssistant(action, data, callback) {\n      const request = JSON.stringify({ action: action, data: data || {} });\n      google.script.run\n        .withSuccessHandler(function(response) {\n          if (typeof response === \'string\') {\n            try { response = JSON.parse(response); } catch (e) {}\n          }\n          callback(response);\n        })\n        .withFailureHandler(function(error) {\n          callback({ success: false, error: error.message });\n        })\n        .savePromptContent(\'__ASSISTANT__\', request);\n    }\n\n    function refreshCellInfo() {\n      const contentDiv = document.getElementById(\'cellInfoContent\');\n      contentDiv.innerHTML = \'<p style="color: #5f6368; text-align: center;">èª­ã¿è¾¼ã¿ä¸­...</p>\';\n\n      callAssistant(\'GET_SELECTED_CELL_INFO\', {}, function(response) {\n        if (response.success) {\n          currentCellInfo = response.data;\n          renderCellInfo(response.data);\n        } else {\n          contentDiv.innerHTML = \'<p style="color: #d93025;">ã‚¨ãƒ©ãƒ¼: \' + response.error + \'</p>\';\n        }\n      });\n    }\n\n    function renderCellInfo(info) {\n      const contentDiv = document.getElementById(\'cellInfoContent\');\n      let html = \'\';\n      html += \'<div class="cell-info-row"><span class="cell-info-label">ä½ç½®</span><span class="cell-info-value">\' + info.colLetter + info.row + \'</span></div>\';\n      html += \'<div class="cell-info-row"><span class="cell-info-label">ã‚·ãƒ¼ãƒˆ</span><span class="cell-info-value">\' + info.sheetName + \'</span></div>\';\n      html += \'<div class="cell-info-row"><span class="cell-info-label">åˆ—å</span><span class="cell-info-value">\' + (info.headerName || \'(ãªã—)\') + \'</span></div>\';\n      html += \'<div class="cell-info-row"><span class="cell-info-label">å€¤</span><span class="cell-info-value">\' + (info.displayValue || \'(ç©º)\') + \'</span></div>\';\n      if (info.hasError) {\n        html += \'<div class="cell-info-row"><span class="cell-info-label">ã‚¨ãƒ©ãƒ¼</span><span class="cell-info-value error">\' + info.errorType + \'</span></div>\';\n      }\n      contentDiv.innerHTML = html;\n    }\n\n    function analyzeCell() {\n      const resultBox = document.getElementById(\'resultBox\');\n      resultBox.style.display = \'block\';\n      resultBox.className = \'result-box loading\';\n      resultBox.textContent = \'è¨ºæ–­ä¸­...\';\n\n      callAssistant(\'ANALYZE_CELL\', {}, function(response) {\n        resultBox.className = \'result-box\';\n        if (response.success) {\n          resultBox.textContent = response.data.diagnosis;\n        } else {\n          resultBox.textContent = \'ã‚¨ãƒ©ãƒ¼: \' + response.error;\n        }\n      });\n    }\n\n    function getColumnInfo() {\n      const resultBox = document.getElementById(\'resultBox\');\n      resultBox.style.display = \'block\';\n      resultBox.className = \'result-box loading\';\n      resultBox.textContent = \'å–å¾—ä¸­...\';\n\n      callAssistant(\'GET_COLUMN_INFO\', {}, function(response) {\n        resultBox.className = \'result-box\';\n        if (response.success) {\n          const data = response.data;\n          let sections = [];\n\n          // 1. å›ºå®šã‚»ãƒ«èª¬æ˜ï¼ˆ1è¡Œç›®ï¼šèª¬æ˜ãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤ºï¼‰\n          if (data.cell1Description) {\n            sections.push(\'ğŸ“ ã‚»ãƒ«ã€Œ\' + data.cell1Address + \'ã€\\n\' + data.cell1Description);\n          }\n\n          // 2. å›ºå®šã‚»ãƒ«èª¬æ˜ï¼ˆ2è¡Œç›®ï¼šèª¬æ˜ãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤ºï¼‰\n          if (data.cell2Description) {\n            sections.push(\'ğŸ“ ã‚»ãƒ«ã€Œ\' + data.cell2Address + \'ã€\\n\' + data.cell2Description);\n          }\n\n          // 3. å›ºå®šã‚»ãƒ«èª¬æ˜ï¼ˆ3è¡Œç›®ï¼šèª¬æ˜ãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤ºï¼‰\n          if (data.cell3Description) {\n            sections.push(\'ğŸ“ ã‚»ãƒ«ã€Œ\' + data.cell3Address + \'ã€\\n\' + data.cell3Description);\n          }\n\n          // 4. åˆ—èª¬æ˜ï¼ˆå¸¸ã«è¡¨ç¤ºï¼‰\n          if (data.columnDescription) {\n            sections.push(\'ğŸ“Š åˆ—ã€Œ\' + (data.headerName || \'åç§°æœªè¨­å®š\') + \'ã€ï¼ˆ\' + data.colLetter + \'åˆ—ï¼‰\\n\' + data.columnDescription);\n          } else {\n            sections.push(\'ğŸ“Š åˆ—ã€Œ\' + (data.headerName || \'åç§°æœªè¨­å®š\') + \'ã€ï¼ˆ\' + data.colLetter + \'åˆ—ï¼‰\\nèª¬æ˜ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\');\n          }\n\n          // 5. ã‚·ãƒ¼ãƒˆèª¬æ˜ï¼ˆèª¬æ˜ãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤ºï¼‰\n          if (data.sheetDescription) {\n            sections.push(\'ğŸ“‹ ã‚·ãƒ¼ãƒˆã€Œ\' + data.sheetName + \'ã€\\n\' + data.sheetDescription);\n          }\n\n          // åŒºåˆ‡ã‚Šç·šã§çµåˆã—ã¦è¡¨ç¤º\n          resultBox.textContent = sections.join(\'\\n\\n----------------\\n\');\n\n        } else {\n          resultBox.textContent = \'ã‚¨ãƒ©ãƒ¼: \' + response.error;\n        }\n      });\n    }\n\n    function loadFaqList() {\n      callAssistant(\'GET_FAQ_LIST\', {}, function(response) {\n        if (response.success) {\n          renderFaqList(response.data);\n        }\n      });\n    }\n\n    function renderFaqList(faqList) {\n      const container = document.getElementById(\'faqList\');\n      let html = \'\';\n      faqList.forEach((faq, index) => {\n        html += \'<div class="faq-item">\';\n        html += \'<div class="faq-question" onclick="toggleFaq(\' + index + \')">\' + faq.question + \' <span id="faq-icon-\' + index + \'">+</span></div>\';\n        html += \'<div class="faq-answer" id="faq-answer-\' + index + \'">\' + faq.answer + \'</div>\';\n        html += \'</div>\';\n      });\n      container.innerHTML = html;\n    }\n\n    function toggleFaq(index) {\n      const answer = document.getElementById(\'faq-answer-\' + index);\n      const icon = document.getElementById(\'faq-icon-\' + index);\n      if (answer.classList.contains(\'open\')) {\n        answer.classList.remove(\'open\');\n        icon.textContent = \'+\';\n      } else {\n        answer.classList.add(\'open\');\n        icon.textContent = \'-\';\n      }\n    }\n\n    // ========== åˆæœŸåŒ– ==========\n    google.script.run.withSuccessHandler(populatePromptSelect).getAllPromptIds();\n  </script>\n</body>\n</html>\n';

HTML_TEMPLATES['ProgressSidebar'] = '<!DOCTYPE html>\n<html>\n<head>\n  <base target="_top">\n  <style>\n    body {\n      font-family: Arial, sans-serif;\n      margin: 0;\n      padding: 16px;\n      background-color: #f5f5f5;\n    }\n\n    .header {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 16px;\n      margin: -16px -16px 16px -16px;\n      border-radius: 0 0 8px 8px;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n    }\n\n    .header h2 {\n      margin: 0;\n      font-size: 18px;\n      font-weight: 600;\n    }\n\n    .status-card {\n      background: white;\n      border-radius: 8px;\n      padding: 16px;\n      margin-bottom: 12px;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n    }\n\n    .status-label {\n      font-size: 12px;\n      color: #666;\n      text-transform: uppercase;\n      letter-spacing: 0.5px;\n      margin-bottom: 8px;\n      font-weight: 600;\n    }\n\n    .status-value {\n      font-size: 24px;\n      font-weight: bold;\n      color: #333;\n    }\n\n    .status-value.success {\n      color: #10b981;\n    }\n\n    .status-value.error {\n      color: #ef4444;\n    }\n\n    .status-value.batch {\n      color: #3b82f6;\n    }\n\n    .progress-bar {\n      width: 100%;\n      height: 8px;\n      background-color: #e5e7eb;\n      border-radius: 4px;\n      overflow: hidden;\n      margin-top: 8px;\n    }\n\n    .progress-fill {\n      height: 100%;\n      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);\n      transition: width 0.3s ease;\n      border-radius: 4px;\n    }\n\n    .log-container {\n      background: white;\n      border-radius: 8px;\n      padding: 12px;\n      max-height: 300px;\n      overflow-y: auto;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n    }\n\n    .log-title {\n      font-size: 14px;\n      font-weight: 600;\n      color: #333;\n      margin-bottom: 8px;\n    }\n\n    .log-entry {\n      font-size: 12px;\n      padding: 6px 8px;\n      margin-bottom: 4px;\n      border-radius: 4px;\n      border-left: 3px solid #e5e7eb;\n      background-color: #f9fafb;\n    }\n\n    .log-entry.success {\n      border-left-color: #10b981;\n      background-color: #f0fdf4;\n    }\n\n    .log-entry.error {\n      border-left-color: #ef4444;\n      background-color: #fef2f2;\n    }\n\n    .log-entry.info {\n      border-left-color: #3b82f6;\n      background-color: #eff6ff;\n    }\n\n    .log-entry.warning {\n      border-left-color: #f59e0b;\n      background-color: #fffbeb;\n    }\n\n    .timestamp {\n      color: #9ca3af;\n      font-size: 10px;\n      margin-right: 6px;\n    }\n\n    .stats-grid {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 12px;\n      margin-bottom: 12px;\n    }\n\n    .stat-mini {\n      background: white;\n      border-radius: 6px;\n      padding: 12px;\n      box-shadow: 0 1px 3px rgba(0,0,0,0.05);\n    }\n\n    .stat-mini-label {\n      font-size: 11px;\n      color: #666;\n      margin-bottom: 4px;\n    }\n\n    .stat-mini-value {\n      font-size: 18px;\n      font-weight: bold;\n      color: #333;\n    }\n\n    .completion-banner {\n      display: none;\n      background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n      color: white;\n      padding: 20px;\n      margin-bottom: 16px;\n      border-radius: 8px;\n      box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n      text-align: center;\n    }\n\n    .completion-banner.show {\n      display: block;\n      animation: slideDown 0.3s ease-out;\n    }\n\n    @keyframes slideDown {\n      from {\n        opacity: 0;\n        transform: translateY(-10px);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0);\n      }\n    }\n\n    .completion-title {\n      font-size: 20px;\n      font-weight: bold;\n      margin-bottom: 8px;\n    }\n\n    .completion-message {\n      font-size: 14px;\n      margin-bottom: 16px;\n      opacity: 0.95;\n    }\n\n    .close-button {\n      background: white;\n      color: #10b981;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      font-size: 14px;\n      font-weight: 600;\n      cursor: pointer;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n      transition: all 0.2s ease;\n    }\n\n    .close-button:hover {\n      background: #f0fdf4;\n      transform: translateY(-1px);\n      box-shadow: 0 4px 6px rgba(0,0,0,0.15);\n    }\n\n    .close-button:active {\n      transform: translateY(0);\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n    }\n  </style>\n</head>\n<body>\n  <div class="header">\n    <h2 id="headerTitle">ğŸ”„ ç¿»è¨³å‡¦ç†ã®é€²æ—</h2>\n  </div>\n\n  <div class="completion-banner" id="completionBanner">\n    <div class="completion-title">âœ… å‡¦ç†å®Œäº†ï¼</div>\n    <div class="completion-message">ã™ã¹ã¦ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸã€‚<br>ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‰ã˜ã¦ãã ã•ã„ã€‚</div>\n    <button class="close-button" onclick="closeSidebar()">ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‰ã˜ã‚‹</button>\n  </div>\n\n  <div class="status-card">\n    <div class="status-label">ç¾åœ¨ã®ãƒãƒƒãƒ</div>\n    <div class="status-value batch" id="currentBatch">-</div>\n    <div class="progress-bar">\n      <div class="progress-fill" id="progressBar" style="width: 0%"></div>\n    </div>\n  </div>\n\n  <div class="stats-grid">\n    <div class="stat-mini">\n      <div class="stat-mini-label">âœ… æˆåŠŸ</div>\n      <div class="stat-mini-value" style="color: #10b981;" id="successCount">0</div>\n    </div>\n    <div class="stat-mini">\n      <div class="stat-mini-label">âŒ ã‚¨ãƒ©ãƒ¼</div>\n      <div class="stat-mini-value" style="color: #ef4444;" id="errorCount">0</div>\n    </div>\n  </div>\n\n  <div class="log-container">\n    <div class="log-title">ğŸ“‹ å‡¦ç†ãƒ­ã‚°</div>\n    <div id="logEntries"></div>\n  </div>\n\n  <script>\n    var pollingInterval = null;\n    var isCompleted = false;\n\n    function updateProgress(data) {\n      // ãƒãƒƒãƒé€²æ—\n      if (data.currentBatch !== undefined && data.totalBatches !== undefined) {\n        document.getElementById(\'currentBatch\').textContent =\n          data.currentBatch + \' / \' + data.totalBatches;\n\n        var progress = (data.currentBatch / data.totalBatches) * 100;\n        document.getElementById(\'progressBar\').style.width = progress + \'%\';\n      }\n\n      // å®Œäº†æ¤œçŸ¥ï¼ˆæ˜ç¤ºçš„ãªãƒ•ãƒ©ã‚°ã§åˆ¤å®šï¼‰\n      if (!isCompleted && data.isCompleted === true) {\n        showCompletionBanner();\n      }\n\n      // æˆåŠŸãƒ»ã‚¨ãƒ©ãƒ¼ã‚«ã‚¦ãƒ³ãƒˆ\n      if (data.successCount !== undefined) {\n        document.getElementById(\'successCount\').textContent = data.successCount;\n      }\n      if (data.errorCount !== undefined) {\n        document.getElementById(\'errorCount\').textContent = data.errorCount;\n      }\n\n      // ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n      if (data.message) {\n        addLogEntry(data.message, data.logType || \'info\');\n      }\n    }\n\n    function showCompletionBanner() {\n      isCompleted = true;\n\n      // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã‚’å¤‰æ›´\n      document.getElementById(\'headerTitle\').textContent = \'âœ… ç¿»è¨³å‡¦ç†ã®é€²æ—\';\n\n      // å®Œäº†ãƒãƒŠãƒ¼ã‚’è¡¨ç¤º\n      var banner = document.getElementById(\'completionBanner\');\n      banner.classList.add(\'show\');\n\n      // ãƒãƒ¼ãƒªãƒ³ã‚°ã‚’åœæ­¢\n      if (pollingInterval) {\n        clearInterval(pollingInterval);\n        pollingInterval = null;\n        console.log(\'âœ… ãƒãƒ¼ãƒªãƒ³ã‚°åœæ­¢ï¼ˆå‡¦ç†å®Œäº†ï¼‰\');\n      }\n\n      // å®Œäº†ãƒ­ã‚°ã‚’è¿½åŠ \n      addLogEntry(\'âœ… ã™ã¹ã¦ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸï¼\', \'success\');\n    }\n\n    function closeSidebar() {\n      // Google Apps Scriptã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‰ã˜ã‚‹\n      google.script.host.close();\n    }\n\n    var lastMessage = \'\';  // æœ€å¾Œã«è¿½åŠ ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨˜éŒ²\n\n    function addLogEntry(message, type) {\n      // åŒã˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€£ç¶šã™ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—\n      if (message === lastMessage) {\n        return;\n      }\n\n      lastMessage = message;\n\n      var logContainer = document.getElementById(\'logEntries\');\n      var entry = document.createElement(\'div\');\n      entry.className = \'log-entry \' + type;\n\n      var timestamp = new Date().toLocaleTimeString(\'ja-JP\');\n      entry.innerHTML = \'<span class="timestamp">\' + timestamp + \'</span>\' + message;\n\n      logContainer.insertBefore(entry, logContainer.firstChild);\n\n      // æœ€å¤§50ä»¶ã¾ã§ã®ãƒ­ã‚°ã‚’ä¿æŒ\n      while (logContainer.children.length > 50) {\n        logContainer.removeChild(logContainer.lastChild);\n      }\n    }\n\n    // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n    addLogEntry(\'ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ\', \'info\');\n\n    // å®šæœŸçš„ã«ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰é€²æ—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\n    function pollProgress() {\n      google.script.run\n        .withSuccessHandler(function(data) {\n          if (data) {\n            updateProgress(data);\n          }\n        })\n        .withFailureHandler(function(error) {\n          console.error(\'é€²æ—å–å¾—ã‚¨ãƒ©ãƒ¼:\', error);\n        })\n        .getProgressData();\n    }\n\n    // 5ç§’ã”ã¨ã«ãƒãƒ¼ãƒªãƒ³ã‚°\n    pollingInterval = setInterval(pollProgress, 5000);\n\n    // åˆå›å®Ÿè¡Œ\n    pollProgress();\n  </script>\n</body>\n</html>\n';

HTML_TEMPLATES['CategorySelectionDialog'] = '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">\n<html>\n<head>\n  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">\n  <meta http-equiv="Content-Style-Type" content="text/css">\n  <title></title>\n  <meta name="Generator" content="Cocoa HTML Writer">\n  <meta name="CocoaVersion" content="2575.7">\n  <style type="text/css">\n    body {background-color: #f7f7f7}\n    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px \'Hiragino Sans\'; color: #175ae2; -webkit-text-stroke: #175ae2}\n    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px \'Hiragino Sans\'; color: #4d5055; -webkit-text-stroke: #4d5055}\n    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px \'Hiragino Sans\'; color: #202326; -webkit-text-stroke: #202326; background-color: #ffffff}\n    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px \'Helvetica Neue\'; -webkit-text-stroke: #000000; background-color: #ffffff}\n    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px \'Helvetica Neue\'; -webkit-text-stroke: #000000; background-color: #ffffff; min-height: 17.0px}\n    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px \'Hiragino Sans\'; color: #175ae2; -webkit-text-stroke: #175ae2}\n    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px \'Hiragino Sans\'; color: #4d5055; -webkit-text-stroke: #4d5055}\n    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Arial; color: #4d5055; -webkit-text-stroke: #4d5055; min-height: 14.0px}\n    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 14.0px \'Hiragino Sans\'; color: #2e3133; -webkit-text-stroke: #2e3133; background-color: #eef0f1}\n    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 14.0px \'Hiragino Sans\'; color: #ffffff; -webkit-text-stroke: #ffffff; background-color: #175ae2}\n    span.s1 {font: 18.0px \'Apple Color Emoji\'; font-kerning: none; background-color: #ffffff}\n    span.s2 {font: 18.0px Arial; font-kerning: none; background-color: #ffffff}\n    span.s3 {font-kerning: none; background-color: #ffffff}\n    span.s4 {font: 14.0px Arial; font-kerning: none; background-color: #ffffff}\n    span.s5 {font-kerning: none}\n    span.s6 {font: 12.0px Arial; font-kerning: none}\n    span.s7 {font: 14.0px \'Hiragino Mincho ProN\'; font-kerning: none}\n    span.s8 {font: 14.0px Times; font-kerning: none}\n    span.s9 {font: 13.0px \'Apple Color Emoji\'; font-kerning: none; background-color: #e3ecfe}\n    span.s10 {font: 13.0px Arial; font-kerning: none; background-color: #e3ecfe}\n    span.s11 {font-kerning: none; background-color: #e3ecfe}\n    span.s12 {font: 12.0px Arial; font-kerning: none; background-color: #e3ecfe}\n  </style>\n</head>\n<body>\n<p class="p1"><span class="s1">ğŸ“‚</span><span class="s2"><b> </b></span><span class="s3"><b>ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠ</b><b></b></span></p>\n<p class="p2"><span class="s3">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–°ã§ä½¿ç”¨ã™ã‚‹å•†å“ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</span></p>\n<p class="p2"><span class="s3">é¸æŠå¾Œã€å„è¡Œã®</span><span class="s4">Q</span><span class="s3">åˆ—ï¼ˆä¾¡æ ¼ï¼‰ã€</span><span class="s4">AB</span><span class="s3">åˆ—ï¼ˆå•†å“çŠ¶æ…‹ï¼‰ã€</span><span class="s4">W</span><span class="s3">åˆ—ï¼ˆé…é€æ–¹æ³•ï¼‰ã‹ã‚‰è‡ªå‹•çš„ã«æ¡ä»¶ã‚’èª­ã¿å–ã‚Šã€</span><span class="s4">4</span><span class="s3">æ¬¡å…ƒæ¤œç´¢ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</span></p>\n<p class="p3"><span class="s5"><b>å•†å“ã‚«ãƒ†ã‚´ãƒªãƒ¼</b></span><span class="s6"><b> *</b><b></b></span></p>\n<p class="p4"><span class="s5"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s7">èª­ã¿è¾¼ã¿ä¸­</span><span class="s8">...</span></p>\n<p class="p5"><span class="s5"><span class="Apple-converted-space">Â Â  Â  Â </span></span></p>\n<p class="p6"><span class="s9">ğŸ’¡</span><span class="s10"><b> 4</b></span><span class="s11"><b>æ¬¡å…ƒæ¤œç´¢ã«ã¤ã„ã¦</b><b></b></span></p>\n<p class="p7"><span class="s11"><b>æ¤œç´¢æ¡ä»¶ï¼š</b><b></b></span></p>\n<p class="p7"><span class="s12">1. </span><span class="s11">ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆã“ã“ã§é¸æŠï¼‰</span></p>\n<p class="p7"><span class="s12">2. </span><span class="s11">å•†å“çŠ¶æ…‹ï¼ˆ</span><span class="s12">AB</span><span class="s11">åˆ—ã‹ã‚‰è‡ªå‹•å–å¾—ï¼‰</span></p>\n<p class="p7"><span class="s12">3. </span><span class="s11">é…é€æ–¹æ³•ï¼ˆ</span><span class="s12">W</span><span class="s11">åˆ—ã‹ã‚‰è‡ªå‹•å–å¾—ï¼‰</span></p>\n<p class="p7"><span class="s12">4. </span><span class="s11">è²©å£²ä¾¡æ ¼ï¼ˆ</span><span class="s12">Q</span><span class="s11">åˆ—ã‹ã‚‰è‡ªå‹•å–å¾—ï¼‰</span></p>\n<p class="p8"><span class="s5"></span><br></p>\n<p class="p7"><span class="s11">å‚ç…§ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆã‹ã‚‰è©²å½“ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ¤œç´¢ã—ã€</span><span class="s12">E</span><span class="s11">åˆ—ã«è¨­å®šã—ã¾ã™ã€‚</span></p>\n<p class="p9"><span class="s5">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</span></p>\n<p class="p10"><span class="s5">é¸æŠã—ã¦æ›´æ–°é–‹å§‹</span></p>\n</body>\n</html>\n';

HTML_TEMPLATES['SetupDialog'] = '<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="utf-8">\n  <title>åˆæœŸè¨­å®šï¼ˆçµ±åˆç‰ˆï¼‰</title>\n  <style>\n    :root {\n      --brand: #1a73e8;\n      --brand-600: #1557b0;\n      --text: #3c4043;\n      --muted: #5f6368;\n      --line: #e0e0e0;\n      --bg: #f9f9f9;\n      --card: #fff;\n      --required: #dc2626;\n      --recommended: #16a34a;\n      --optional: #2563eb;\n    }\n\n    * { box-sizing: border-box; }\n    \n    body {\n      font-family: \'Segoe UI\', Arial, sans-serif;\n      margin: 20px;\n      background-color: var(--bg);\n      color: var(--text);\n      max-height: 80vh;\n      overflow-y: auto;\n    }\n\n    .container {\n      background: var(--card);\n      padding: 20px;\n      border-radius: 12px;\n      box-shadow: 0 2px 12px rgba(0,0,0,0.08);\n    }\n\n    h2 {\n      color: var(--brand);\n      margin-bottom: 20px;\n      font-size: 18px;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */\n    .section {\n      margin-bottom: 16px;\n      border: 1px solid var(--line);\n      border-radius: 12px;\n      background: var(--card);\n      overflow: hidden;\n    }\n\n    .section-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 16px 20px;\n      background: #fafbfc;\n      border-bottom: 1px solid var(--line);\n      cursor: pointer;\n      user-select: none;\n    }\n\n    .section-header:hover {\n      background: #f1f3f4;\n    }\n\n    .section-title {\n      display: flex;\n      align-items: center;\n      gap: 12px;\n      font-weight: 600;\n      font-size: 16px;\n    }\n\n    .priority-badge {\n      padding: 4px 8px;\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 700;\n      color: white;\n    }\n\n    .priority-required { background-color: var(--required); }\n    .priority-recommended { background-color: var(--recommended); }\n    .priority-optional { background-color: var(--optional); }\n\n    .section-description {\n      font-size: 14px;\n      color: var(--muted);\n      margin-top: 4px;\n    }\n\n    .section-controls {\n      display: flex;\n      align-items: center;\n      gap: 16px;\n    }\n\n    .edit-toggle {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      font-size: 14px;\n    }\n\n    .edit-toggle input[type="radio"] {\n      width: auto;\n      margin: 0;\n    }\n\n    .collapse-btn {\n      background: none;\n      border: none;\n      font-size: 20px;\n      cursor: pointer;\n      transition: transform 0.2s ease;\n    }\n\n    .collapse-btn.collapsed {\n      transform: rotate(-90deg);\n    }\n\n    .section-content {\n      padding: 20px;\n      display: none;\n    }\n\n    .section-content.expanded {\n      display: block;\n    }\n\n    /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  */\n    label {\n      display: block;\n      margin-top: 15px;\n      margin-bottom: 6px;\n      font-weight: 600;\n      color: #2b2f33;\n    }\n\n    input[type="text"], input[type="number"], select {\n      width: 100%;\n      padding: 10px 12px;\n      border: 1px solid #dadce0;\n      border-radius: 8px;\n      font-size: 14px;\n      transition: box-shadow .15s ease, border-color .15s ease;\n      background: #fff;\n    }\n\n    input[type="text"]:focus, input[type="number"]:focus, select:focus {\n      outline: none;\n      border-color: var(--brand);\n      box-shadow: 0 0 0 3px rgba(26,115,232,.18);\n    }\n\n    .radio-group {\n      margin: 8px 0 0;\n      display: flex;\n      flex-wrap: wrap;\n      gap: 12px;\n    }\n\n    .radio-group label {\n      display: inline-flex;\n      align-items: center;\n      gap: 6px;\n      margin: 0;\n      font-weight: 500;\n      color: #333;\n      cursor: pointer;\n    }\n\n    .radio-group input[type="radio"] {\n      width: auto;\n      margin: 0;\n    }\n\n    .checkbox-group {\n      margin: 10px 0;\n    }\n\n    .checkbox-label {\n      display: flex;\n      align-items: center;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n    }\n\n    .checkbox-label input[type="checkbox"] {\n      margin-right: 8px;\n      width: auto;\n      transform: scale(1.1);\n    }\n\n    /* ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚¿ãƒ– */\n    .api-platform-section {\n      background-color: #fafafa;\n      border: 1px solid var(--line);\n      border-radius: 12px;\n      padding: 14px;\n      margin-top: 10px;\n    }\n\n    .platform-tabs {\n      display: flex;\n      margin-bottom: 14px;\n      border-bottom: 1px solid var(--line);\n      gap: 2px;\n    }\n\n    .platform-tab {\n      padding: 8px 14px;\n      cursor: pointer;\n      border: none;\n      background: none;\n      font-size: 14px;\n      border-bottom: 2px solid transparent;\n      border-radius: 8px 8px 0 0;\n      transition: background .15s ease, color .15s ease, border-color .15s ease;\n    }\n\n    .platform-tab:hover { background-color: #f1f3f4; }\n\n    .platform-tab.active {\n      color: var(--brand);\n      border-bottom-color: var(--brand);\n      font-weight: 700;\n      background: #eef4ff;\n    }\n\n    .platform-content { display: none; }\n    .platform-content.active { display: block; }\n\n    /* APIã‚­ãƒ¼è¡¨ç¤º/å…¥åŠ›åˆ‡ã‚Šæ›¿ãˆ */\n    .api-key-wrapper {\n      margin-top: 5px;\n    }\n    .api-key-display {\n      display: flex;\n      align-items: center;\n      gap: 12px;\n      padding: 10px 12px;\n      background: #f0f4f9;\n      border: 1px solid #dadce0;\n      border-radius: 8px;\n    }\n    .api-key-display.hidden {\n      display: none;\n    }\n    .masked-key {\n      font-family: monospace;\n      font-size: 14px;\n      color: #5f6368;\n      letter-spacing: 2px;\n    }\n    .key-status {\n      font-size: 13px;\n      color: #16a34a;\n      font-weight: 500;\n    }\n    .btn-change-key {\n      margin-left: auto;\n      padding: 6px 14px;\n      background: #fff;\n      border: 1px solid #dadce0;\n      border-radius: 6px;\n      font-size: 13px;\n      cursor: pointer;\n      transition: background .15s ease;\n    }\n    .btn-change-key:hover {\n      background: #f1f3f4;\n    }\n    .api-key-input {\n      display: flex;\n      gap: 8px;\n      align-items: center;\n    }\n    .api-key-input.hidden {\n      display: none;\n    }\n    .api-key-input input {\n      flex: 1;\n    }\n    .btn-cancel-key {\n      padding: 10px 14px;\n      background: #f1f3f4;\n      border: 1px solid #dadce0;\n      border-radius: 8px;\n      font-size: 13px;\n      cursor: pointer;\n      transition: background .15s ease;\n    }\n    .btn-cancel-key:hover {\n      background: #e0e0e0;\n    }\n    .btn-cancel-key.hidden {\n      display: none;\n    }\n\n    /* é‡è¤‡ãƒã‚§ãƒƒã‚¯è¨­å®š */\n    .target-sheets-container {\n      border: 1px solid #ddd;\n      padding: 15px;\n      background: #f9f9f9;\n      border-radius: 4px;\n      min-height: 100px;\n      margin-top: 10px;\n    }\n\n    .target-sheet-item {\n      display: grid;\n      grid-template-columns: 1fr 100px 80px;\n      gap: 10px;\n      margin-bottom: 15px;\n      padding: 10px;\n      background: white;\n      border-radius: 4px;\n      border: 1px solid #ddd;\n    }\n\n    .input-row {\n      display: flex;\n      gap: 20px;\n      margin: 15px 0;\n    }\n\n    .input-group {\n      flex: 1;\n    }\n\n    .input-group label {\n      margin-top: 0;\n      font-size: 13px;\n    }\n\n    /* æƒ…å ±ãƒœãƒƒã‚¯ã‚¹ */\n    .info-box, .warning-box {\n      border-radius: 10px;\n      padding: 12px;\n      margin-top: 10px;\n    }\n\n    .info-box {\n      background-color: #e8f0fe;\n      border: 1px solid #dadce0;\n    }\n\n    .warning-box {\n      background-color: #fff3cd;\n      border: 1px solid #ffeaa7;\n    }\n\n    .info-box .title, .warning-box .title {\n      font-weight: 700;\n      margin-bottom: 6px;\n    }\n\n    .info-box .title {\n      color: var(--brand);\n    }\n\n    .warning-box .title {\n      color: #856404;\n    }\n\n    .info-box .content, .warning-box .content {\n      font-size: 12px;\n      line-height: 1.6;\n    }\n\n    .info-box .content {\n      color: var(--muted);\n    }\n\n    .warning-box .content {\n      color: #856404;\n    }\n\n    .help-text {\n      font-size: 12px;\n      color: var(--muted);\n      margin-top: 4px;\n    }\n\n    .cost-info {\n      font-size: 12px;\n      color: #666;\n      font-style: italic;\n      margin-top: 6px;\n    }\n\n    /* ãƒœã‚¿ãƒ³ */\n    .button-group {\n      margin-top: 26px;\n      display: flex;\n      justify-content: flex-end;\n      gap: 12px;\n    }\n\n    .btn {\n      position: relative;\n      overflow: hidden;\n      border: none;\n      padding: 10px 18px;\n      border-radius: 999px;\n      cursor: pointer;\n      font-size: 14px;\n      line-height: 1;\n      transition: transform .06s ease, box-shadow .2s ease, background-color .2s ease;\n      user-select: none;\n    }\n\n    .btn:active { transform: translateY(0.5px) scale(.99); }\n\n    .btn.primary {\n      background-color: var(--brand);\n      color: #fff;\n      box-shadow: 0 6px 16px rgba(26,115,232,.25);\n    }\n\n    .btn.primary:hover { background-color: var(--brand-600); }\n\n    .btn.secondary {\n      background-color: #edf2f7;\n      color: var(--text);\n    }\n\n    .btn.secondary:hover { background: #e2e8f0; }\n\n    .btn:disabled {\n      opacity: .65;\n      cursor: not-allowed;\n      box-shadow: none;\n    }\n\n    .spinner {\n      width: 16px;\n      height: 16px;\n      border-radius: 50%;\n      border: 2px solid rgba(255,255,255,.55);\n      border-top-color: #fff;\n      animation: spin .8s linear infinite;\n      display: inline-block;\n      vertical-align: middle;\n      margin-right: 8px;\n    }\n\n    @keyframes spin {\n      to { transform: rotate(360deg); }\n    }\n\n    .disabled-overlay {\n      opacity: 0.5;\n      pointer-events: none;\n    }\n  </style>\n</head>\n<body>\n  <div class="container">\n    <h2>åˆæœŸè¨­å®šï¼ˆçµ±åˆç‰ˆï¼‰</h2>\n\n    <form id="setupForm">\n      <!-- 1. AIãƒ»åŸºæœ¬è¨­å®š -->\n      <div class="section" data-section="ai-basic">\n        <div class="section-header" onclick="toggleSection(\'ai-basic\')">\n          <div class="section-title">\n            <span class="priority-badge priority-required">å¿…é ˆ</span>\n            <div>\n              <div>AIãƒ»åŸºæœ¬è¨­å®š</div>\n              <div class="section-description">AIã‚µãƒ¼ãƒ“ã‚¹ã¨ä½œæ¥­ã‚·ãƒ¼ãƒˆã®åŸºæœ¬çš„ãªè¨­å®š</div>\n            </div>\n          </div>\n          <div class="section-controls">\n            <div class="edit-toggle">\n              <label><input type="radio" name="edit-ai-basic" value="maintain" checked> ç¶­æŒ</label>\n              <label><input type="radio" name="edit-ai-basic" value="edit"> ç·¨é›†</label>\n            </div>\n            <button type="button" class="collapse-btn">â–¼</button>\n          </div>\n        </div>\n        <div class="section-content" id="content-ai-basic">\n          <label>AI ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é¸æŠ *</label>\n          <div class="api-platform-section">\n            <div class="platform-tabs" id="platformTabs">\n              <button type="button" class="platform-tab" data-platform="openai">OpenAI</button>\n              <button type="button" class="platform-tab" data-platform="claude">Claude</button>\n              <button type="button" class="platform-tab" data-platform="gemini">Gemini</button>\n            </div>\n\n            <div class="platform-content" id="openai-content">\n              <label for="openaiApiKey">OpenAI APIã‚­ãƒ¼ *</label>\n              <div class="api-key-wrapper">\n                <div class="api-key-display <?= hasApiKey.openai ? \'\' : \'hidden\' ?>" id="openaiApiKeyDisplay">\n                  <span class="masked-key">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>\n                  <span class="key-status">âœ… è¨­å®šæ¸ˆã¿</span>\n                  <button type="button" class="btn-change-key" onclick="showApiKeyInput(\'openai\')">å¤‰æ›´</button>\n                </div>\n                <div class="api-key-input <?= hasApiKey.openai ? \'hidden\' : \'\' ?>" id="openaiApiKeyInput">\n                  <input type="text" id="openaiApiKey" name="openaiApiKey" value="" placeholder="sk-...">\n                  <button type="button" class="btn-cancel-key <?= hasApiKey.openai ? \'\' : \'hidden\' ?>" onclick="cancelApiKeyChange(\'openai\')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>\n                </div>\n              </div>\n              <div class="help-text">OpenAIã®APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>\n\n              <label for="openaiModel">ãƒ¢ãƒ‡ãƒ«é¸æŠ *</label>\n              <select id="openaiModel" name="openaiModel">\n                <option value="gpt-5-nano" <?= currentModel === \'gpt-5-nano\' ? \'selected\' : \'\' ?>>GPT-5-nanoï¼ˆæœ€å®‰ãƒ»æ¨å¥¨ï¼‰</option>\n                <option value="gpt-4o-mini" <?= currentModel === \'gpt-4o-mini\' ? \'selected\' : \'\' ?>>GPT-4o-miniï¼ˆäº’æ›ãƒ»ä½ã‚³ã‚¹ãƒˆï¼‰</option>\n                <option value="gpt-5-mini" <?= currentModel === \'gpt-5-mini\' ? \'selected\' : \'\' ?>>GPT-5-miniï¼ˆã‚„ã‚„é«˜å“è³ªï¼‰</option>\n              </select>\n              <div class="cost-info">ç›®å®‰: GPT-5-nano â‰ˆ ~$0.0003â€“0.0004 / 1K tokens</div>\n            </div>\n\n            <div class="platform-content" id="claude-content">\n              <label for="claudeApiKey">Claude APIã‚­ãƒ¼ *</label>\n              <div class="api-key-wrapper">\n                <div class="api-key-display <?= hasApiKey.claude ? \'\' : \'hidden\' ?>" id="claudeApiKeyDisplay">\n                  <span class="masked-key">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>\n                  <span class="key-status">âœ… è¨­å®šæ¸ˆã¿</span>\n                  <button type="button" class="btn-change-key" onclick="showApiKeyInput(\'claude\')">å¤‰æ›´</button>\n                </div>\n                <div class="api-key-input <?= hasApiKey.claude ? \'hidden\' : \'\' ?>" id="claudeApiKeyInput">\n                  <input type="text" id="claudeApiKey" name="claudeApiKey" value="" placeholder="sk-ant-...">\n                  <button type="button" class="btn-cancel-key <?= hasApiKey.claude ? \'\' : \'hidden\' ?>" onclick="cancelApiKeyChange(\'claude\')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>\n                </div>\n              </div>\n              <div class="help-text">Anthropicã®APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>\n\n              <label for="claudeModel">ãƒ¢ãƒ‡ãƒ«é¸æŠ *</label>\n              <select id="claudeModel" name="claudeModel">\n                <option value="claude-3-haiku-20240307" <?= currentModel === \'claude-3-haiku-20240307\' ? \'selected\' : \'\' ?>>Claude 3 Haikuï¼ˆæœ€å®‰ãƒ»æ¨å¥¨ï¼‰</option>\n                <option value="claude-3-sonnet-20240229" <?= currentModel === \'claude-3-sonnet-20240229\' ? \'selected\' : \'\' ?>>Claude 3 Sonnetï¼ˆãƒãƒ©ãƒ³ã‚¹ï¼‰</option>\n                <option value="claude-3-opus-20240229" <?= currentModel === \'claude-3-opus-20240229\' ? \'selected\' : \'\' ?>>Claude 3 Opusï¼ˆé«˜æ€§èƒ½ï¼‰</option>\n              </select>\n              <div class="cost-info">å‚è€ƒ: Haiku â‰ˆ ~$0.0015 / 1K tokens ã»ã‹</div>\n            </div>\n\n            <div class="platform-content" id="gemini-content">\n              <label for="geminiApiKey">Gemini APIã‚­ãƒ¼ *</label>\n              <div class="api-key-wrapper">\n                <div class="api-key-display <?= hasApiKey.gemini ? \'\' : \'hidden\' ?>" id="geminiApiKeyDisplay">\n                  <span class="masked-key">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>\n                  <span class="key-status">âœ… è¨­å®šæ¸ˆã¿</span>\n                  <button type="button" class="btn-change-key" onclick="showApiKeyInput(\'gemini\')">å¤‰æ›´</button>\n                </div>\n                <div class="api-key-input <?= hasApiKey.gemini ? \'hidden\' : \'\' ?>" id="geminiApiKeyInput">\n                  <input type="text" id="geminiApiKey" name="geminiApiKey" value="" placeholder="AIza...">\n                  <button type="button" class="btn-cancel-key <?= hasApiKey.gemini ? \'\' : \'hidden\' ?>" onclick="cancelApiKeyChange(\'gemini\')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>\n                </div>\n              </div>\n              <div class="help-text">Google AI Studioã®APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>\n\n              <label for="geminiModel">ãƒ¢ãƒ‡ãƒ«é¸æŠ *</label>\n              <select id="geminiModel" name="geminiModel">\n                <option value="gemini-1.5-flash" <?= currentModel === \'gemini-1.5-flash\' ? \'selected\' : \'\' ?>>Gemini 1.5 Flashï¼ˆæœ€å®‰ãƒ»æ¨å¥¨ï¼‰</option>\n                <option value="gemini-1.5-pro" <?= currentModel === \'gemini-1.5-pro\' ? \'selected\' : \'\' ?>>Gemini 1.5 Proï¼ˆãƒãƒ©ãƒ³ã‚¹ï¼‰</option>\n                <option value="gemini-pro" <?= currentModel === \'gemini-pro\' ? \'selected\' : \'\' ?>>Gemini Proï¼ˆå®‰å®šï¼‰</option>\n              </select>\n              <div class="cost-info">å‚è€ƒ: Flash â‰ˆ ~$0.0008 / 1K tokens ã»ã‹</div>\n            </div>\n          </div>\n\n          <label for="sheetName">ä½œæ¥­ã‚·ãƒ¼ãƒˆå *</label>\n          <input type="text" id="sheetName" name="sheetName" value="<?= currentSheetName ?>" required>\n          <div class="help-text">ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚’è¡Œã†ã‚·ãƒ¼ãƒˆã®åå‰</div>\n\n          <div class="info-box">\n            <div class="title">ã‚³ã‚¹ãƒˆæ¯”è¼ƒã®ç›®å®‰ï¼ˆ1K tokensï¼‰</div>\n            <div class="content">\n              æœ€å®‰: GPT-5-nano â‰² GPT-5-mini â‰² Gemini 1.5 Flash â‰² Claude 3 Haiku<br>\n              é«˜æ€§èƒ½: Claude 3 Opus / GPT-5-mini / GPT-4ç³» / Gemini 1.5 Proï¼ˆç”¨é€”æ¬¡ç¬¬ï¼‰<br>\n              ã¾ãšã¯ GPT-5-nano ã‚’ãŠè©¦ã—ãã ã•ã„ï¼ˆæ¨å¥¨ï¼‰\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- 2. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š -->\n      <div class="section" data-section="prompt">\n        <div class="section-header" onclick="toggleSection(\'prompt\')">\n          <div class="section-title">\n            <span class="priority-badge priority-recommended">æ¨å¥¨</span>\n            <div>\n              <div>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š</div>\n              <div class="section-description">AIç”Ÿæˆã®å“è³ªã‚’æ±ºå®šã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š</div>\n            </div>\n          </div>\n          <div class="section-controls">\n            <div class="edit-toggle">\n              <label><input type="radio" name="edit-prompt" value="maintain" checked> ç¶­æŒ</label>\n              <label><input type="radio" name="edit-prompt" value="edit"> ç·¨é›†</label>\n            </div>\n            <button type="button" class="collapse-btn">â–¼</button>\n          </div>\n        </div>\n        <div class="section-content" id="content-prompt">\n          <label for="promptId">ä½¿ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ *</label>\n          <select id="promptId" name="promptId" required>\n            <? for (var i = 0; i < promptIds.length; i++) { ?>\n              <option value="<?= promptIds[i] ?>" <?= promptIds[i] === currentPromptId ? \'selected\' : \'\' ?>>\n                <?= promptIds[i] ?>\n              </option>\n            <? } ?>\n          </select>\n          <div class="help-text">GPT_Prompts ã‚·ãƒ¼ãƒˆã‹ã‚‰é¸æŠ</div>\n\n          <div class="info-box">\n            <div class="title">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†</div>\n            <div class="content">\n              ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å†…å®¹ã¯ã€Œãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†ã€ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§å¤‰æ›´ã§ãã¾ã™ã€‚<br>\n              ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ŒAIç¿»è¨³ãƒ»ä¾¡æ ¼è¨ˆç®—ã€â†’ã€Œãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†ã€ã‹ã‚‰é–‹ã‘ã¾ã™ã€‚\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- 3. åˆ©ç›Šãƒ»ä¾¡æ ¼è¨ˆç®— -->\n      <div class="section" data-section="price-calc">\n        <div class="section-header" onclick="toggleSection(\'price-calc\')">\n          <div class="section-title">\n            <span class="priority-badge priority-required">å¿…é ˆ</span>\n            <div>\n              <div>åˆ©ç›Šãƒ»ä¾¡æ ¼è¨ˆç®—</div>\n              <div class="section-description">åˆ©ç›Šè¨ˆç®—ã¨ä¾¡æ ¼è¡¨ç¤ºã®è¨­å®š</div>\n            </div>\n          </div>\n          <div class="section-controls">\n            <div class="edit-toggle">\n              <label><input type="radio" name="edit-price-calc" value="maintain" checked> ç¶­æŒ</label>\n              <label><input type="radio" name="edit-price-calc" value="edit"> ç·¨é›†</label>\n            </div>\n            <button type="button" class="collapse-btn">â–¼</button>\n          </div>\n        </div>\n        <div class="section-content" id="content-price-calc">\n          <label>åˆ©ç›Šè¨ˆç®—æ–¹æ³• *</label>\n          <div class="radio-group">\n            <label><input type="radio" name="profitMethod" value="RATE" <?= currentProfitCalculationMethod === \'RATE\' ? \'checked\' : \'\' ?>> åˆ©ç›Šç‡ã§è¨ˆç®—</label>\n            <label><input type="radio" name="profitMethod" value="AMOUNT" <?= currentProfitCalculationMethod === \'AMOUNT\' ? \'checked\' : \'\' ?>> åˆ©ç›Šé¡ã§è¨ˆç®—</label>\n          </div>\n\n          <label>ä¾¡æ ¼è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ *</label>\n          <div class="radio-group">\n            <label><input type="radio" name="priceDisplayMode" value="NORMAL" <?= currentPriceDisplayMode === \'NORMAL\' ? \'checked\' : \'\' ?>> è²©å£²ä¾¡æ ¼ï¼ˆDDUï¼‰</label>\n            <label><input type="radio" name="priceDisplayMode" value="TAX_INCLUDED" <?= currentPriceDisplayMode === \'TAX_INCLUDED\' ? \'checked\' : \'\' ?>> é–¢ç¨è¾¼ã¿ä¾¡æ ¼ï¼ˆDDPï¼‰</label>\n          </div>\n\n          <label>DDUä¾¡æ ¼èª¿æ•´æ©Ÿèƒ½</label>\n          <div class="checkbox-group">\n            <label class="checkbox-label">\n <input type="checkbox" id="dduAdjustmentEnabled" name="dduAdjustmentEnabled" checked>\n  DDUä¾¡æ ¼èª¿æ•´æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹\n</label>\n          </div>\n          \n\n          <div id="dduSettingsGroup">\n            <div class="input-row">\n              <div class="input-group">\n                <label for="dduThreshold">æƒ³å®šé–¢ç¨é–¾å€¤ï¼ˆãƒ‰ãƒ«ï¼‰:</label>\n                <input type="number" id="dduThreshold" name="dduThreshold"\n                       value="<?= currentDduThreshold || \'390\' ?>" min="1" step="1">\n              </div>\n            </div>\n            <div class="help-text">\n              æƒ³å®šé–¢ç¨ï¼ˆADåˆ—ï¼‰ãŒé–¾å€¤ä»¥ä¸Šã®å ´åˆã€DDPä¾¡æ ¼ï¼ˆSåˆ—ï¼‰ã‹ã‚‰æƒ³å®šé–¢ç¨ã‚’å¼•ã„ãŸä¾¡æ ¼ã‚’è¨ˆç®—ã—ã¾ã™\n            </div>\n          </div>\n\n          <div class="info-box">\n            <div class="title">ä¾¡æ ¼è¨ˆç®—ã®è¨­å®šç®‡æ‰€</div>\n            <div class="content">\n              â€¢ æ‰‹æ•°æ–™ç‡: F1 / åºƒå‘Šè²»ç‡: F2<br>\n              â€¢ åˆ©ç›Šé¡: H1ï¼ˆåˆ©ç›Šé¡è¨ˆç®—é¸æŠæ™‚ï¼‰<br>\n              â€¢ åˆ©ç›Šç‡: H2ï¼ˆåˆ©ç›Šç‡è¨ˆç®—é¸æŠæ™‚ï¼‰\n            </div>\n          </div>\n\n          <div class="warning-box">\n            <div class="title">DDUä¾¡æ ¼èª¿æ•´æ©Ÿèƒ½ã®æ³¨æ„äº‹é …</div>\n            <div class="content">\n              ã“ã®æ©Ÿèƒ½ã¯DDUå•†å“å°‚ç”¨ã§ã™ã€‚DDPã§å‡ºå“ã™ã‚‹å ´åˆã§ã‚‚ã€å®Ÿéš›ã®è²©å£²ä¾¡æ ¼ã¯DDUä¾¡æ ¼ã‚’ä½¿ç”¨ã—ã€é–¢ç¨åˆ†ã‚’é€æ–™ã¨ã—ã¦åˆ¥é€”å¾´åã™ã‚‹ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«å‘ã‘ã§ã™ã€‚\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- 4. é€æ–™ãƒ»é…é€è¨­å®š -->\n      <div class="section" data-section="shipping">\n        <div class="section-header" onclick="toggleSection(\'shipping\')">\n          <div class="section-title">\n            <span class="priority-badge priority-required">å¿…é ˆ</span>\n            <div>\n              <div>é€æ–™ãƒ»é…é€è¨­å®š</div>\n              <div class="section-description">é€æ–™è¨ˆç®—ã¨é…é€æ–¹æ³•ã®è¨­å®š</div>\n            </div>\n          </div>\n          <div class="section-controls">\n            <div class="edit-toggle">\n              <label><input type="radio" name="edit-shipping" value="maintain" checked> ç¶­æŒ</label>\n              <label><input type="radio" name="edit-shipping" value="edit"> ç·¨é›†</label>\n            </div>\n            <button type="button" class="collapse-btn">â–¼</button>\n          </div>\n        </div>\n        <div class="section-content" id="content-shipping">\n          <label>é€æ–™è¨ˆç®—æ–¹æ³• *</label>\n          <div class="radio-group">\n            <label><input type="radio" name="shippingCalcMethod" value="TABLE" <?= currentShippingCalculationMethod === \'TABLE\' ? \'checked\' : \'\' ?>> ãƒ†ãƒ¼ãƒ–ãƒ«è¨ˆç®—</label>\n            <label><input type="radio" name="shippingCalcMethod" value="FIXED" <?= currentShippingCalculationMethod === \'FIXED\' ? \'checked\' : \'\' ?>> å›ºå®šé‡‘é¡</label>\n          </div>\n\n          <label for="shippingThreshold">é€æ–™è¨ˆç®—åˆ‡æ›¿åŸºæº–é‡‘é¡ï¼ˆå††ï¼‰ *</label>\n          <input type="number" id="shippingThreshold" name="shippingThreshold" value="<?= currentShippingThreshold || \'5500\' ?>" min="1" step="1" required>\n          <div class="help-text">ã“ã®é‡‘é¡ä»¥ä¸Šã¯é«˜ä¾¡æ ¼é…é€ã€æœªæº€ã®å ´åˆã¯ä½ä¾¡æ ¼é…é€ã‚’ä½¿ç”¨</div>\n\n          <label for="lowPriceMethod">ä½ä¾¡æ ¼å•†å“é…é€æ–¹æ³• *</label>\n          <select id="lowPriceMethod" name="lowPriceMethod" required>\n            <option value="NONE" <?= currentLowPriceMethod === \'NONE\' ? \'selected\' : \'\' ?>>ãªã—ï¼ˆé«˜ä¾¡æ ¼é…é€ã®ã¿ä½¿ç”¨ï¼‰</option>\n            <option value="EP" <?= currentLowPriceMethod === \'EP\' ? \'selected\' : \'\' ?>>eãƒ‘ã‚±ãƒƒãƒˆï¼ˆé‡é‡ãƒ»ã‚µã‚¤ã‚ºåˆ¶é™ã‚ã‚Šï¼‰</option>\n            <option value="CE" <?= currentLowPriceMethod === \'CE\' ? \'selected\' : \'\' ?>>Cpass Economyï¼ˆé‡é‡åˆ¶é™ãªã—ï¼‰</option>\n          </select>\n\n          <label for="highPriceMethod">é«˜ä¾¡æ ¼å•†å“é…é€æ–¹æ³• *</label>\n          <select id="highPriceMethod" name="highPriceMethod" required>\n            <option value="CF" <?= currentHighPriceMethod === \'CF\' ? \'selected\' : \'\' ?>>Cpass FedExï¼ˆç‡ƒæ²¹ãƒ»å‰²å¼•ãƒ»è¿½åŠ æ–™é‡‘ã‚ã‚Šï¼‰</option>\n            <option value="CD" <?= currentHighPriceMethod === \'CD\' ? \'selected\' : \'\' ?>>Cpass DHLï¼ˆç‡ƒæ²¹ãƒ»å‰²å¼•ãƒ»è¿½åŠ æ–™é‡‘ã‚ã‚Šï¼‰</option>\n            <option value="EL" <?= currentHighPriceMethod === \'EL\' ? \'selected\' : \'\' ?>>eLogisticsï¼ˆè¿½åŠ æ–™é‡‘ãªã—ï¼‰</option>\n          </select>\n\n          <div class="info-box">\n            <div class="title">é€æ–™è¨ˆç®—æ–¹æ³•ã®èª¬æ˜</div>\n            <div class="content">\n              <strong>ãƒ†ãƒ¼ãƒ–ãƒ«è¨ˆç®—</strong>: é‡é‡ãƒ»ã‚µã‚¤ã‚ºã«åŸºã¥ã„ã¦è‡ªå‹•è¨ˆç®—ï¼ˆæ¨å¥¨ï¼‰<br>\n              <strong>å›ºå®šé‡‘é¡</strong>: J1 ã¾ãŸã¯ Profit_Amounts!D ã‹ã‚‰å–å¾—<br><br>\n              <strong>å›ºå®šé‡‘é¡ã®è¨­å®š</strong><br>\n              â€¢ å…¨å•†å“å…±é€š: J1 ã‚»ãƒ«ã«é‡‘é¡ã‚’å…¥åŠ›<br>\n              â€¢ ä»•å…¥ã‚Œå€¤åˆ¥: Profit_Amounts!Dåˆ—ã«å„é‡‘é¡å¸¯ã®é€æ–™\n            </div>\n          </div>\n\n          <div style="margin-top: 20px; padding-top: 16px; border-top: 1px dashed var(--line);">\n            <label>é€æ–™ãƒ¬ãƒ¼ãƒˆæ›´æ–°ï¼ˆ2026å¹´ç‰ˆï¼‰</label>\n            <div class="checkbox-group">\n              <label class="checkbox-label">\n                <input type="checkbox" id="updateShippingRates" name="updateShippingRates">\n                FedExãƒ»DHLã®é€æ–™ãƒ¬ãƒ¼ãƒˆã‚’æœ€æ–°ï¼ˆ2026å¹´ï¼‰ã«æ›´æ–°ã™ã‚‹\n              </label>\n            </div>\n            <div class="help-text">\n              Shipping_Ratesã‚·ãƒ¼ãƒˆã®CFï¼ˆFedExï¼‰åˆ—ã¨CDï¼ˆDHLï¼‰åˆ—ã®ã¿æ›´æ–°ã•ã‚Œã¾ã™ã€‚<br>\n              ä»–ã®åˆ—ï¼ˆCEã€ELç­‰ï¼‰ã‚„ã‚µãƒ¼ãƒãƒ£ãƒ¼ã‚¸è¨­å®šï¼ˆV1ã€V2ã€W2ã€Y1ã€Y2ï¼‰ã¯å¤‰æ›´ã•ã‚Œã¾ã›ã‚“ã€‚\n            </div>\n            <div class="warning-box" id="shippingUpdateWarning" style="display: none; margin-top: 10px;">\n              <div class="title">ç¢ºèª</div>\n              <div class="content">\n                ä¿å­˜æ™‚ã«Shipping_Ratesã‚·ãƒ¼ãƒˆã®Fåˆ—ï¼ˆCFï¼‰ã¨Gåˆ—ï¼ˆCDï¼‰ã®å€¤ãŒ2026å¹´ç‰ˆã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚<br>\n                ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚æ›´æ–°å‰ã«ã‚·ãƒ¼ãƒˆã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- 5. é‡è¤‡ãƒã‚§ãƒƒã‚¯è¨­å®š -->\n      <div class="section" data-section="duplicate-check">\n        <div class="section-header" onclick="toggleSection(\'duplicate-check\')">\n          <div class="section-title">\n            <span class="priority-badge priority-optional">ä»»æ„</span>\n            <div>\n              <div>é‡è¤‡ãƒã‚§ãƒƒã‚¯è¨­å®š</div>\n              <div class="section-description">å•†å“ã®é‡è¤‡ã‚’è‡ªå‹•æ¤œå‡ºã™ã‚‹æ©Ÿèƒ½</div>\n            </div>\n          </div>\n          <div class="section-controls">\n            <div class="edit-toggle">\n              <label><input type="radio" name="edit-duplicate-check" value="maintain" checked> ç¶­æŒ</label>\n              <label><input type="radio" name="edit-duplicate-check" value="edit"> ç·¨é›†</label>\n            </div>\n            <button type="button" class="collapse-btn">â–¼</button>\n          </div>\n        </div>\n        <div class="section-content" id="content-duplicate-check">\n          <div class="checkbox-group">\n            <label class="checkbox-label">\n              <input type="checkbox" id="duplicateCheckEnabled" name="duplicateCheckEnabled" \n                     <?= currentDuplicateCheckEnabled === \'true\' ? \'checked\' : \'\' ?>>\n              é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹\n            </label>\n          </div>\n\n          <div id="duplicateCheckSettings">\n            <label for="duplicateSourceSheet">ä½œæ¥­ã‚·ãƒ¼ãƒˆï¼ˆé‡è¤‡ã‚’ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹å´ï¼‰:</label>\n            <select id="duplicateSourceSheet" name="duplicateSourceSheet">\n              <option value="">ã‚·ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</option>\n            </select>\n\n            <label for="duplicateSourceColumn">ä½œæ¥­ã‚·ãƒ¼ãƒˆã®åˆ—:</label>\n            <select id="duplicateSourceColumn" name="duplicateSourceColumn">\n              <option value="">åˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„</option>\n              <option value="A">Aåˆ—</option>\n              <option value="B">Båˆ—</option>\n              <option value="C">Cåˆ—</option>\n              <option value="D">Dåˆ—</option>\n              <option value="E">Eåˆ—</option>\n              <option value="F">Fåˆ—</option>\n              <option value="G">Gåˆ—</option>\n              <option value="H">Håˆ—</option>\n              <option value="I">Iåˆ—</option>\n              <option value="J">Jåˆ—</option>\n            </select>\n\n            <label>ãƒã‚§ãƒƒã‚¯å¯¾è±¡ã‚·ãƒ¼ãƒˆï¼ˆé‡è¤‡å…ƒï¼‰:</label>\n            <div id="targetSheetsContainer" class="target-sheets-container">\n              <div id="noTargetSheetsMsg">å‚ç…§ã‚·ãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</div>\n            </div>\n            <button type="button" onclick="addTargetSheetDropdown()">å‚ç…§ã‚·ãƒ¼ãƒˆè¿½åŠ </button>\n\n            <div class="checkbox-group">\n              <label class="checkbox-label">\n                <input type="checkbox" id="applyToSheet" name="applyToSheet">\n                ç”Ÿæˆã—ãŸå¼ã‚’ã‚·ãƒ¼ãƒˆã«ç›´æ¥é©ç”¨ã™ã‚‹\n              </label>\n            </div>\n\n            <div id="outputSettings" style="display: none;">\n              <label for="outputSheet">å‡ºåŠ›å…ˆã‚·ãƒ¼ãƒˆ:</label>\n              <select id="outputSheet" name="outputSheet">\n                <option value="">ã‚·ãƒ¼ãƒˆã‚’é¸æŠ...</option>\n              </select>\n\n              <div class="input-row">\n                <div class="input-group">\n                  <label for="outputColumn">å‡ºåŠ›å…ˆåˆ—:</label>\n                  <select id="outputColumn" name="outputColumn">\n                    <option value="">åˆ—ã‚’é¸æŠ...</option>\n                  </select>\n                </div>\n                <div class="input-group">\n                  <label for="outputStartRow">é–‹å§‹è¡Œ:</label>\n                  <input type="number" id="outputStartRow" name="outputStartRow" value="1" min="1">\n                </div>\n              </div>\n\n              <label for="outputRange">é©ç”¨ç¯„å›²:</label>\n              <select id="outputRange" name="outputRange">\n                <option value="DATA">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ç¯„å›²ã¾ã§</option>\n                <option value="CUSTOM">ã‚«ã‚¹ã‚¿ãƒ ç¯„å›²ï¼ˆ100è¡Œï¼‰</option>\n                <option value="ALL">ã‚·ãƒ¼ãƒˆå…¨ä½“ï¼ˆ1000è¡Œï¼‰</option>\n              </select>\n            </div>\n          </div>\n\n          <div class="info-box">\n            <div class="title">é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã«ã¤ã„ã¦</div>\n            <div class="content">\n              ä½œæ¥­ã‚·ãƒ¼ãƒˆã§ã®å…¥åŠ›æ™‚ã«ã€æ—¢å­˜ã®ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã¨é‡è¤‡ã™ã‚‹å•†å“ã‚’è‡ªå‹•æ¤œå‡ºã—ã¾ã™ã€‚<br>\n              ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒï¼ˆä¿å­˜ãƒ‡ãƒ¼ã‚¿_*ï¼‰ã‚‚ä½¿ç”¨å¯èƒ½ã§ã™ã€‚\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- 6. è¡¨ç¤ºè¨­å®š -->\n      <div class="section" data-section="display">\n        <div class="section-header" onclick="toggleSection(\'display\')">\n          <div class="section-title">\n            <span class="priority-badge priority-optional">ä»»æ„</span>\n            <div>\n              <div>è¡¨ç¤ºè¨­å®š</div>\n              <div class="section-description">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«é–¢ã™ã‚‹è¨­å®š</div>\n            </div>\n          </div>\n          <div class="section-controls">\n            <div class="edit-toggle">\n              <label><input type="radio" name="edit-display" value="maintain" checked> ç¶­æŒ</label>\n              <label><input type="radio" name="edit-display" value="edit"> ç·¨é›†</label>\n            </div>\n            <button type="button" class="collapse-btn">â–¼</button>\n          </div>\n        </div>\n        <div class="section-content" id="content-display">\n          <label>ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤ºè¨­å®š *</label>\n          <div class="radio-group">\n            <label><input type="radio" name="showPopups" value="true" <?= currentShowPopups === \'true\' ? \'checked\' : \'\' ?>> ONï¼ˆè¡¨ç¤ºã™ã‚‹ï¼‰</label>\n            <label><input type="radio" name="showPopups" value="false" <?= currentShowPopups === \'false\' ? \'checked\' : \'\' ?>> OFFï¼ˆè¡¨ç¤ºã—ãªã„ï¼‰</label>\n          </div>\n          <div class="help-text">ä½œæ¥­é–‹å§‹ãƒ»å®Œäº†æ™‚ã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºã‚’åˆ¶å¾¡ï¼ˆã‚¨ãƒ©ãƒ¼ã¯å¸¸ã«è¡¨ç¤ºï¼‰</div>\n\n          <div class="info-box">\n            <div class="title">ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤ºã®èª¬æ˜</div>\n            <div class="content">\n              â€¢ ON: ä½œæ¥­é–‹å§‹æ™‚ã«ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã€å®Œäº†æ™‚ã«çµæœè¡¨ç¤º<br>\n              â€¢ OFF: ç¢ºèªãªã—ã§å³åº§ã«å®Ÿè¡Œé–‹å§‹ã€å®Œäº†æ™‚ã‚‚ç„¡é€šçŸ¥<br>\n              â€¢ ã‚¨ãƒ©ãƒ¼: è¨­å®šã«é–¢ä¿‚ãªãå¸¸ã«è¡¨ç¤ºï¼ˆå®‰å…¨ã®ãŸã‚ï¼‰<br>\n              â€¢ ä½œæ¥­åˆ¶å¾¡: D2ã‚»ãƒ«ï¼ˆGO/STOPï¼‰ã§ã®åœæ­¢ã¯åˆ¥æ©Ÿèƒ½\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="button-group">\n        <button type="button" class="btn secondary" id="cancelBtn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>\n        <button type="submit" class="btn primary" id="saveBtn">\n          <span class="btn-label">ä¿å­˜</span>\n        </button>\n      </div>\n    </form>\n  </div>\n\n  <script>\n    // åˆæœŸè¨­å®š\n    const CURRENT_PLATFORM = "<?= typeof currentPlatform !== \'undefined\' ? currentPlatform : \'openai\' ?>";\n    const DEFAULT_OPENAI_MODEL = "gpt-5-nano";\n    \n    var allSheetNames = [];\n    var targetSheetCounter = 0;\n\n    // åˆæœŸåŒ–\n    document.addEventListener(\'DOMContentLoaded\', function() {\n      initializeSections();\n      initializePlatformTabs();\n      loadSheetNames();\n      setupEventListeners();\n      updateSectionStates();\n    });\n\n    // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†\n    function toggleSection(sectionId) {\n      const content = document.getElementById(\'content-\' + sectionId);\n      const btn = document.querySelector(`[data-section="${sectionId}"] .collapse-btn`);\n      \n      if (content.classList.contains(\'expanded\')) {\n        content.classList.remove(\'expanded\');\n        btn.classList.add(\'collapsed\');\n      } else {\n        content.classList.add(\'expanded\');\n        btn.classList.remove(\'collapsed\');\n      }\n    }\n\n    function initializeSections() {\n      // å¿…é ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯åˆæœŸå±•é–‹\n      const requiredSections = [\'ai-basic\', \'price-calc\', \'shipping\'];\n      requiredSections.forEach(sectionId => {\n        const content = document.getElementById(\'content-\' + sectionId);\n        content.classList.add(\'expanded\');\n      });\n    }\n\n    function updateSectionStates() {\n      document.querySelectorAll(\'[name^="edit-"]\').forEach(radio => {\n        radio.addEventListener(\'change\', function() {\n          const sectionId = this.name.replace(\'edit-\', \'\');\n          const content = document.getElementById(\'content-\' + sectionId);\n          const isEdit = this.value === \'edit\';\n\n          if (isEdit) {\n            content.classList.remove(\'disabled-overlay\');\n          } else {\n            content.classList.add(\'disabled-overlay\');\n          }\n        });\n      });\n    }\n\n    // APIã‚­ãƒ¼è¡¨ç¤º/å…¥åŠ›åˆ‡ã‚Šæ›¿ãˆ\n    function showApiKeyInput(platform) {\n      document.getElementById(platform + \'ApiKeyDisplay\').classList.add(\'hidden\');\n      document.getElementById(platform + \'ApiKeyInput\').classList.remove(\'hidden\');\n      document.getElementById(platform + \'ApiKey\').focus();\n    }\n\n    function cancelApiKeyChange(platform) {\n      document.getElementById(platform + \'ApiKeyInput\').classList.add(\'hidden\');\n      document.getElementById(platform + \'ApiKeyDisplay\').classList.remove(\'hidden\');\n      document.getElementById(platform + \'ApiKey\').value = \'\';\n    }\n\n    // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚¿ãƒ–\n    function initializePlatformTabs() {\n      const tabs = document.querySelectorAll(\'.platform-tab\');\n      const contents = {\n        openai: document.getElementById(\'openai-content\'),\n        claude: document.getElementById(\'claude-content\'),\n        gemini: document.getElementById(\'gemini-content\')\n      };\n\n      function activatePlatform(platform) {\n        tabs.forEach(tab => tab.classList.toggle(\'active\', tab.dataset.platform === platform));\n        Object.keys(contents).forEach(key => contents[key].classList.toggle(\'active\', key === platform));\n      }\n\n      activatePlatform(CURRENT_PLATFORM || \'openai\');\n\n      tabs.forEach(tab => {\n        tab.addEventListener(\'click\', function() {\n          activatePlatform(this.dataset.platform);\n        });\n      });\n    }\n\n    // ã‚·ãƒ¼ãƒˆåå–å¾—\n    function loadSheetNames() {\n      google.script.run\n        .withSuccessHandler(function(sheetNames) {\n          allSheetNames = sheetNames;\n          populateSheetDropdowns();\n        })\n        .withFailureHandler(function(error) {\n          console.error(\'ã‚·ãƒ¼ãƒˆåå–å¾—ã‚¨ãƒ©ãƒ¼:\', error);\n        })\n        .getAllSheetNames();\n    }\n\n    function populateSheetDropdowns() {\n      const duplicateSourceSheet = document.getElementById(\'duplicateSourceSheet\');\n      const outputSheet = document.getElementById(\'outputSheet\');\n      \n      [duplicateSourceSheet, outputSheet].forEach(select => {\n        if (select) {\n          select.innerHTML = \'<option value="">ã‚·ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</option>\';\n          allSheetNames.forEach(name => {\n            const option = document.createElement(\'option\');\n            option.value = name;\n            option.textContent = name;\n            select.appendChild(option);\n          });\n        }\n      });\n\n      // å‡ºåŠ›åˆ—ã®è¨­å®š\n      const outputColumn = document.getElementById(\'outputColumn\');\n      if (outputColumn) {\n        outputColumn.innerHTML = \'<option value="">åˆ—ã‚’é¸æŠ...</option>\';\n        // Aï½Zåˆ—\n        for (let i = 0; i < 26; i++) {\n          const col = String.fromCharCode(65 + i);\n          const option = document.createElement(\'option\');\n          option.value = col;\n          option.textContent = col + \'åˆ—\';\n          outputColumn.appendChild(option);\n        }\n        // AAï½AZåˆ—\n        for (let i = 0; i < 26; i++) {\n          const col = \'A\' + String.fromCharCode(65 + i);\n          const option = document.createElement(\'option\');\n          option.value = col;\n          option.textContent = col + \'åˆ—\';\n          outputColumn.appendChild(option);\n        }\n      }\n    }\n\n    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š\n    function setupEventListeners() {\n      // DDUä¾¡æ ¼èª¿æ•´æ©Ÿèƒ½\n      const dduCheckbox = document.getElementById(\'dduAdjustmentEnabled\');\n      const dduSettings = document.getElementById(\'dduSettingsGroup\');\n      \n      function toggleDduSettings() {\n        const enabled = dduCheckbox.checked;\n        dduSettings.style.display = enabled ? \'block\' : \'none\';\n        dduSettings.style.opacity = enabled ? \'1\' : \'0.5\';\n      }\n      \n      if (dduCheckbox) {\n        dduCheckbox.addEventListener(\'change\', toggleDduSettings);\n        toggleDduSettings();\n      }\n\n      // é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½\n      const duplicateCheckbox = document.getElementById(\'duplicateCheckEnabled\');\n      const duplicateSettings = document.getElementById(\'duplicateCheckSettings\');\n      \n      function toggleDuplicateSettings() {\n        const enabled = duplicateCheckbox.checked;\n        duplicateSettings.style.display = enabled ? \'block\' : \'none\';\n        duplicateSettings.style.opacity = enabled ? \'1\' : \'0.5\';\n      }\n      \n      if (duplicateCheckbox) {\n        duplicateCheckbox.addEventListener(\'change\', toggleDuplicateSettings);\n        toggleDuplicateSettings();\n      }\n\n      // å‡ºåŠ›è¨­å®šè¡¨ç¤ºåˆ¶å¾¡\n      const applyCheckbox = document.getElementById(\'applyToSheet\');\n      const outputSettings = document.getElementById(\'outputSettings\');\n\n      if (applyCheckbox) {\n        applyCheckbox.addEventListener(\'change\', function() {\n          outputSettings.style.display = this.checked ? \'block\' : \'none\';\n        });\n      }\n\n      // é€æ–™ãƒ¬ãƒ¼ãƒˆæ›´æ–°ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹\n      const shippingUpdateCheckbox = document.getElementById(\'updateShippingRates\');\n      const shippingUpdateWarning = document.getElementById(\'shippingUpdateWarning\');\n\n      if (shippingUpdateCheckbox) {\n        shippingUpdateCheckbox.addEventListener(\'change\', function() {\n          shippingUpdateWarning.style.display = this.checked ? \'block\' : \'none\';\n        });\n      }\n\n      // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡\n      const form = document.getElementById(\'setupForm\');\n      const saveBtn = document.getElementById(\'saveBtn\');\n      const btnLabel = saveBtn.querySelector(\'.btn-label\');\n\n      form.addEventListener(\'submit\', function(e) {\n        e.preventDefault();\n        handleFormSubmit();\n      });\n\n      // ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n      document.getElementById(\'cancelBtn\').addEventListener(\'click\', function() {\n        google.script.host.close();\n      });\n    }\n\n    // é‡è¤‡ãƒã‚§ãƒƒã‚¯: å‚ç…§ã‚·ãƒ¼ãƒˆè¿½åŠ \n    function addTargetSheetDropdown() {\n      const container = document.getElementById(\'targetSheetsContainer\');\n      const noMsgDiv = document.getElementById(\'noTargetSheetsMsg\');\n      if (noMsgDiv) noMsgDiv.style.display = \'none\';\n      \n      targetSheetCounter++;\n      const itemDiv = document.createElement(\'div\');\n      itemDiv.className = \'target-sheet-item\';\n      itemDiv.id = \'targetSheet_\' + targetSheetCounter;\n      \n      // ã‚·ãƒ¼ãƒˆé¸æŠ\n      const sheetDiv = document.createElement(\'div\');\n      const sheetSelect = document.createElement(\'select\');\n      sheetSelect.className = \'target-sheet-select\';\n      sheetSelect.innerHTML = \'<option value="">å‚ç…§ã‚·ãƒ¼ãƒˆã‚’é¸æŠ</option>\';\n      \n      allSheetNames.forEach(name => {\n        const option = document.createElement(\'option\');\n        option.value = name;\n        option.textContent = name;\n        sheetSelect.appendChild(option);\n      });\n      \n      const specialOption = document.createElement(\'option\');\n      specialOption.value = \'ä¿å­˜ãƒ‡ãƒ¼ã‚¿_*\';\n      specialOption.textContent = \'ä¿å­˜ãƒ‡ãƒ¼ã‚¿_* (ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒ)\';\n      sheetSelect.appendChild(specialOption);\n      \n      sheetDiv.appendChild(sheetSelect);\n      \n      // åˆ—é¸æŠ\n      const columnDiv = document.createElement(\'div\');\n      const columnSelect = document.createElement(\'select\');\n      columnSelect.className = \'target-column-select\';\n      columnSelect.innerHTML = \'<option value="">åˆ—é¸æŠ</option>\';\n      \n      [\'A\',\'B\',\'C\',\'D\',\'E\',\'F\',\'G\',\'H\',\'I\',\'J\'].forEach(col => {\n        const option = document.createElement(\'option\');\n        option.value = col;\n        option.textContent = col + \'åˆ—\';\n        if (col === \'H\') option.selected = true;\n        columnSelect.appendChild(option);\n      });\n      columnDiv.appendChild(columnSelect);\n      \n      // å‰Šé™¤ãƒœã‚¿ãƒ³\n      const removeBtn = document.createElement(\'button\');\n      removeBtn.textContent = \'å‰Šé™¤\';\n      removeBtn.type = \'button\';\n      removeBtn.onclick = function() {\n        itemDiv.remove();\n        if (container.querySelectorAll(\'.target-sheet-item\').length === 0) {\n          if (noMsgDiv) noMsgDiv.style.display = \'block\';\n        }\n      };\n      \n      itemDiv.appendChild(sheetDiv);\n      itemDiv.appendChild(columnDiv);\n      itemDiv.appendChild(removeBtn);\n      container.appendChild(itemDiv);\n    }\n\n    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†\n    function handleFormSubmit() {\n      const saveBtn = document.getElementById(\'saveBtn\');\n      const btnLabel = saveBtn.querySelector(\'.btn-label\');\n\n      function setLoading(isLoading) {\n        if (isLoading) {\n          saveBtn.disabled = true;\n          btnLabel.innerHTML = \'<span class="spinner"></span>ä¿å­˜ä¸­...\';\n        } else {\n          saveBtn.disabled = false;\n          btnLabel.textContent = \'ä¿å­˜\';\n        }\n      }\n\n      // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç‰¹å®š\n      const activeTab = document.querySelector(\'.platform-tab.active\');\n      const activePlatform = activeTab ? activeTab.getAttribute(\'data-platform\') : \'openai\';\n\n      let apiKey = \'\', model = \'\';\n      let hasExistingKey = false;\n      if (activePlatform === \'openai\') {\n        apiKey = document.getElementById(\'openaiApiKey\').value.trim();\n        model = document.getElementById(\'openaiModel\').value || DEFAULT_OPENAI_MODEL;\n        hasExistingKey = !document.getElementById(\'openaiApiKeyDisplay\').classList.contains(\'hidden\');\n      } else if (activePlatform === \'claude\') {\n        apiKey = document.getElementById(\'claudeApiKey\').value.trim();\n        model = document.getElementById(\'claudeModel\').value;\n        hasExistingKey = !document.getElementById(\'claudeApiKeyDisplay\').classList.contains(\'hidden\');\n      } else if (activePlatform === \'gemini\') {\n        apiKey = document.getElementById(\'geminiApiKey\').value.trim();\n        model = document.getElementById(\'geminiModel\').value;\n        hasExistingKey = !document.getElementById(\'geminiApiKeyDisplay\').classList.contains(\'hidden\');\n      }\n\n      // APIã‚­ãƒ¼ãŒç©ºã§æ—¢å­˜ã‚­ãƒ¼ã‚‚ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼\n      if (!apiKey && !hasExistingKey) {\n        alert(\'é¸æŠã—ãŸãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\');\n        return;\n      }\n\n      // APIã‚­ãƒ¼ãŒç©ºã®å ´åˆã¯ç‰¹åˆ¥ãªå€¤ã‚’é€ä¿¡ï¼ˆã‚µãƒ¼ãƒãƒ¼å´ã§æ—¢å­˜ã‚­ãƒ¼ã‚’ç¶­æŒï¼‰\n      const apiKeyToSend = apiKey || \'__KEEP_EXISTING__\';\n\n      // é‡è¤‡ãƒã‚§ãƒƒã‚¯ã®å¯¾è±¡ã‚·ãƒ¼ãƒˆåé›†\n      const targetSheets = [];\n      const targetItems = document.querySelectorAll(\'.target-sheet-item\');\n      targetItems.forEach(item => {\n        const sheetSelect = item.querySelector(\'.target-sheet-select\');\n        const columnSelect = item.querySelector(\'.target-column-select\');\n        \n        if (sheetSelect && sheetSelect.value && columnSelect && columnSelect.value) {\n          targetSheets.push({\n            sheet: sheetSelect.value,\n            column: columnSelect.value\n          });\n        }\n      });\n\n      const formData = {\n        // åŸºæœ¬è¨­å®š\n        platform: activePlatform,\n        apiKey: apiKeyToSend,\n        model: model,\n        sheetName: document.getElementById(\'sheetName\').value,\n        \n        // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š\n        promptId: document.getElementById(\'promptId\').value,\n        \n        // åˆ©ç›Šãƒ»ä¾¡æ ¼è¨ˆç®—\n        profitMethod: document.querySelector(\'input[name="profitMethod"]:checked\').value,\n        priceDisplayMode: document.querySelector(\'input[name="priceDisplayMode"]:checked\').value,\n        dduAdjustmentEnabled: document.getElementById(\'dduAdjustmentEnabled\').checked ? \'true\' : \'false\',\n        dduThreshold: document.getElementById(\'dduThreshold\').value,\n        \n        // é€æ–™ãƒ»é…é€è¨­å®š\n        shippingCalcMethod: document.querySelector(\'input[name="shippingCalcMethod"]:checked\').value,\n        shippingThreshold: document.getElementById(\'shippingThreshold\').value,\n        lowPriceMethod: document.getElementById(\'lowPriceMethod\').value,\n        highPriceMethod: document.getElementById(\'highPriceMethod\').value,\n        updateShippingRates: document.getElementById(\'updateShippingRates\').checked,\n        \n        // é‡è¤‡ãƒã‚§ãƒƒã‚¯è¨­å®š\n        duplicateCheckEnabled: document.getElementById(\'duplicateCheckEnabled\').checked,\n        duplicateSourceSheet: document.getElementById(\'duplicateSourceSheet\').value,\n        duplicateSourceColumn: document.getElementById(\'duplicateSourceColumn\').value,\n        duplicateTargetSheets: targetSheets,\n        duplicateApplyToSheet: document.getElementById(\'applyToSheet\').checked,\n        duplicateOutputSheet: document.getElementById(\'outputSheet\').value,\n        duplicateOutputColumn: document.getElementById(\'outputColumn\').value,\n        duplicateOutputStartRow: document.getElementById(\'outputStartRow\').value,\n        duplicateOutputRange: document.getElementById(\'outputRange\').value,\n        \n        // è¡¨ç¤ºè¨­å®š\n        showPopups: document.querySelector(\'input[name="showPopups"]:checked\').value\n      };\n\n      setLoading(true);\n      google.script.run\n        .withSuccessHandler(function(result) {\n          setLoading(false);\n          if (result.success) {\n            google.script.host.close();\n          } else {\n            alert(\'ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: \' + result.error);\n          }\n        })\n        .withFailureHandler(function(error) {\n          setLoading(false);\n          alert(\'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: \' + (error && error.message ? error.message : error));\n        })\n        .saveIntegratedSettings(formData);\n    }\n  </script>\n</body>\n</html>';


/**
 * ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåã‹ã‚‰HTMLæ–‡å­—åˆ—ã‚’å–å¾—
 * @param {string} name ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå
 * @return {string} HTMLæ–‡å­—åˆ—ï¼ˆè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯nullï¼‰
 */
function getHtmlTemplate(name) {
  return HTML_TEMPLATES[name] || null;
}

/**
 * ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåã‹ã‚‰HtmlOutputã‚’ä½œæˆ
 * @param {string} name ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå
 * @return {HtmlOutput} HtmlOutputã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯nullï¼‰
 */
function createHtmlFromTemplate(name) {
  var html = getHtmlTemplate(name);
  if (html) {
    return HtmlService.createHtmlOutput(html);
  }
  return null;
}
