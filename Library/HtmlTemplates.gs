/******************************************************
 * HtmlTemplates.gs - HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ–‡å­—åˆ—
 *
 * ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå†…ã§HTMLã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€æ–‡å­—åˆ—ã¨ã—ã¦åŸ‹ã‚è¾¼ã¿
 ******************************************************/

var HTML_TEMPLATES = {};


HTML_TEMPLATES['SimpleSetup'] = '<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset="UTF-8">\n    <style>\n      body { font-family: Arial, sans-serif; padding: 14px; }\n      label { display:block; margin-bottom:6px; }\n      input[type="password"], input[type="text"] { width:100%; padding:8px; box-sizing:border-box; }\n      .row { margin: 10px 0; }\n      .hint { font-size: 12px; color: #666; margin-top: 6px; }\n      .actions { margin-top: 16px; display:flex; gap:8px; }\n      button { padding:8px 14px; cursor:pointer; }\n      .ok { background:#1976d2; color:white; border:none; }\n      .cancel { background:#eee; border:1px solid #ccc; }\n      .msg { margin-top:10px; font-size: 12px; }\n    </style>\n  </head>\n  <body>\n    <h3>ğŸ”‘ ç°¡æ˜“ç‰ˆ åˆæœŸè¨­å®šï¼ˆAPIã‚­ãƒ¼ã®ã¿ï¼‰</h3>\n    <div class="row">\n      <label for="apiKey">OpenAI APIã‚­ãƒ¼</label>\n      <input id="apiKey" type="password" placeholder="sk-..." />\n      <div class="hint">\n        â€» ã“ã®ã‚­ãƒ¼ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®è¨­å®šï¼ˆUserPropertiesï¼‰ã«ä¿å­˜ã•ã‚Œã€ãƒ•ãƒ«ç‰ˆè¨­å®šã¨ã¯ç‹¬ç«‹ã§ã™ã€‚<br>\n        â€» ç°¡æ˜“ç‰ˆã§ã¯ <b>GPT-5-nano</b> / <b>EBAY_FULL_LISTING_PROMPT</b> / <b>Profit-Amounts</b> å›ºå®šã§å‹•ä½œã—ã¾ã™ã€‚\n      </div>\n    </div>\n    <div class="actions">\n      <button class="ok" onclick="save()">ä¿å­˜</button>\n      <button class="cancel" onclick="google.script.host.close()">é–‰ã˜ã‚‹</button>\n    </div>\n    <div id="msg" class="msg"></div>\n\n    <script>\n      // æ—¢å­˜å€¤ã®èª­ã¿è¾¼ã¿ï¼ˆåˆæœŸè¡¨ç¤ºï¼‰\n      google.script.run.withSuccessHandler(function(s){\n        if (s && s.apiKey) document.getElementById(\'apiKey\').value = s.apiKey;\n      }).getSimpleSettings();\n\n      function save(){\n        const el = document.getElementById(\'apiKey\');\n        const key = (el.value || \'\').trim();\n        const msg = document.getElementById(\'msg\');\n        msg.textContent = \'ä¿å­˜ä¸­â€¦\';\n        google.script.run.withSuccessHandler(function(res){\n          if (res && res.ok) {\n            msg.textContent = \'âœ… ä¿å­˜ã—ã¾ã—ãŸã€‚\';\n            setTimeout(()=> google.script.host.close(), 600);\n          } else {\n            msg.textContent = \'âš ï¸ ã‚¨ãƒ©ãƒ¼: \' + (res && res.error ? res.error : \'ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ\');\n          }\n        }).saveSimpleSettings(key);\n      }\n    </script>\n  </body>\n</html>\n';


HTML_TEMPLATES['PromptEditor'] = '<!DOCTYPE html>\n<html>\n<head>\n  <base target="_top">\n  <style>\n    body { font-family: sans-serif; margin: 10px; background-color: #f8f9fa; }\n    h3 { color: #1a73e8; margin-bottom: 15px; }\n    label { display: block; margin-bottom: 5px; font-weight: bold; color: #3c4043; }\n    textarea { \n      width: calc(100% - 20px); /* å·¦å³ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’è€ƒæ…® */\n      height: 250px; /* ç·¨é›†ã‚¨ãƒªã‚¢ã®é«˜ã•ã‚’ç¢ºä¿ */\n      margin-bottom: 15px; \n      padding: 10px; \n      font-size: 14px; \n      border: 1px solid #dadce0; \n      border-radius: 4px;\n      box-sizing: border-box; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒœãƒ¼ãƒ€ãƒ¼ã‚’å¹…ã«å«ã‚ã‚‹ */\n      resize: vertical; /* ç¸¦æ–¹å‘ã®ã¿ãƒªã‚µã‚¤ã‚ºå¯èƒ½ã«ã™ã‚‹ */\n    }\n    select { \n      width: calc(100% - 20px); \n      margin-bottom: 15px; \n      padding: 8px; \n      font-size: 14px; \n      border: 1px solid #dadce0; \n      border-radius: 4px;\n      background-color: #fff;\n    }\n    button { \n      padding: 10px 20px; \n      font-size: 14px; \n      border: none; \n      border-radius: 4px; \n      cursor: pointer; \n      margin-right: 10px;\n    }\n    button.primary { \n      background-color: #1a73e8; \n      color: white; \n    }\n    button.secondary { \n      background-color: #e8eaed; \n      color: #3c4043; \n    }\n    .message {\n      margin-top: 15px;\n      padding: 10px;\n      border-radius: 4px;\n      font-weight: bold;\n      display: none; /* åˆæœŸçŠ¶æ…‹ã§ã¯éè¡¨ç¤º */\n    }\n    .message.success {\n      background-color: #e6ffe6;\n      color: #188038;\n      border: 1px solid #188038;\n    }\n    .message.error {\n      background-color: #ffe6e6;\n      color: #d93025;\n      border: 1px solid #d93025;\n    }\n  </style>\n</head>\n<body>\n  <h3>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†</h3>\n  <label for="promptSelect">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆID:</label>\n  <select id="promptSelect" onchange="loadPrompt()">\n    </select>\n  <br>\n  <label for="promptContent">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹:</label>\n  <textarea id="promptContent"></textarea>\n  <button class="primary" onclick="savePrompt()">ä¿å­˜</button>\n  <button class="secondary" onclick="google.script.host.close()">é–‰ã˜ã‚‹</button>\n\n  <div id="messageBox" class="message"></div>\n\n  <script>\n    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºé–¢æ•°\n    function showMessage(msg, type) {\n      const msgBox = document.getElementById(\'messageBox\');\n      msgBox.textContent = msg;\n      msgBox.className = \'message \' + type; // ã‚¯ãƒ©ã‚¹ã‚’æ›´æ–°\n      msgBox.style.display = \'block\';\n      setTimeout(() => {\n        msgBox.style.display = \'none\'; // 3ç§’å¾Œã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éè¡¨ç¤º\n      }, 3000);\n    }\n\n    // GASã‹ã‚‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆIDã®ãƒªã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã«è¡¨ç¤º\n    function populatePromptSelect(promptIds) {\n      const select = document.getElementById(\'promptSelect\');\n      select.innerHTML = \'<option value="">--é¸æŠã—ã¦ãã ã•ã„--</option>\';\n      promptIds.forEach(id => {\n        const option = document.createElement(\'option\');\n        option.value = id;\n        option.textContent = id;\n        select.appendChild(option);\n      });\n    }\n\n    // é¸æŠã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å†…å®¹ã‚’GASã‹ã‚‰èª­ã¿è¾¼ã‚€\n    function loadPrompt() {\n      const promptId = document.getElementById(\'promptSelect\').value;\n      if (promptId) {\n        google.script.run.withSuccessHandler(function(content) {\n          document.getElementById(\'promptContent\').value = content;\n        }).withFailureHandler(function(error) {\n          showMessage(\'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: \' + error.message, \'error\');\n          document.getElementById(\'promptContent\').value = \'\';\n        }).getPromptContent(promptId); // GASã®getPromptContentã‚’å‘¼ã³å‡ºã™\n      } else {\n        document.getElementById(\'promptContent\').value = \'\';\n      }\n    }\n\n    // ç·¨é›†ã—ãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å†…å®¹ã‚’GASã«æ¸¡ã—ã¦ä¿å­˜ã™ã‚‹\n    function savePrompt() {\n      const promptId = document.getElementById(\'promptSelect\').value;\n      const promptContent = document.getElementById(\'promptContent\').value;\n      if (!promptId) {\n        showMessage(\'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆIDã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚\', \'error\');\n        return;\n      }\n      if (!promptContent.trim()) {\n        showMessage(\'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\', \'error\');\n        return;\n      }\n      \n      google.script.run.withSuccessHandler(function() {\n        showMessage(\'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸï¼\', \'success\');\n      }).withFailureHandler(function(error) {\n        showMessage(\'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: \' + error.message, \'error\');\n      }).savePromptContent(promptId, promptContent); // GASã®savePromptContentã‚’å‘¼ã³å‡ºã™\n    }\n\n    // åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆIDãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¦ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’ç”Ÿæˆ\n    google.script.run.withSuccessHandler(populatePromptSelect).getAllPromptIds();\n  </script>\n</body>\n</html>';


HTML_TEMPLATES['ProgressSidebar'] = '<!DOCTYPE html>\n<html>\n<head>\n  <base target="_top">\n  <style>\n    body {\n      font-family: Arial, sans-serif;\n      margin: 0;\n      padding: 16px;\n      background-color: #f5f5f5;\n    }\n\n    .header {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 16px;\n      margin: -16px -16px 16px -16px;\n      border-radius: 0 0 8px 8px;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n    }\n\n    .header h2 {\n      margin: 0;\n      font-size: 18px;\n      font-weight: 600;\n    }\n\n    .status-card {\n      background: white;\n      border-radius: 8px;\n      padding: 16px;\n      margin-bottom: 12px;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n    }\n\n    .status-label {\n      font-size: 12px;\n      color: #666;\n      text-transform: uppercase;\n      letter-spacing: 0.5px;\n      margin-bottom: 8px;\n      font-weight: 600;\n    }\n\n    .status-value {\n      font-size: 24px;\n      font-weight: bold;\n      color: #333;\n    }\n\n    .status-value.success {\n      color: #10b981;\n    }\n\n    .status-value.error {\n      color: #ef4444;\n    }\n\n    .status-value.batch {\n      color: #3b82f6;\n    }\n\n    .progress-bar {\n      width: 100%;\n      height: 8px;\n      background-color: #e5e7eb;\n      border-radius: 4px;\n      overflow: hidden;\n      margin-top: 8px;\n    }\n\n    .progress-fill {\n      height: 100%;\n      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);\n      transition: width 0.3s ease;\n      border-radius: 4px;\n    }\n\n    .log-container {\n      background: white;\n      border-radius: 8px;\n      padding: 12px;\n      max-height: 300px;\n      overflow-y: auto;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n    }\n\n    .log-title {\n      font-size: 14px;\n      font-weight: 600;\n      color: #333;\n      margin-bottom: 8px;\n    }\n\n    .log-entry {\n      font-size: 12px;\n      padding: 6px 8px;\n      margin-bottom: 4px;\n      border-radius: 4px;\n      border-left: 3px solid #e5e7eb;\n      background-color: #f9fafb;\n    }\n\n    .log-entry.success {\n      border-left-color: #10b981;\n      background-color: #f0fdf4;\n    }\n\n    .log-entry.error {\n      border-left-color: #ef4444;\n      background-color: #fef2f2;\n    }\n\n    .log-entry.info {\n      border-left-color: #3b82f6;\n      background-color: #eff6ff;\n    }\n\n    .log-entry.warning {\n      border-left-color: #f59e0b;\n      background-color: #fffbeb;\n    }\n\n    .timestamp {\n      color: #9ca3af;\n      font-size: 10px;\n      margin-right: 6px;\n    }\n\n    .stats-grid {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 12px;\n      margin-bottom: 12px;\n    }\n\n    .stat-mini {\n      background: white;\n      border-radius: 6px;\n      padding: 12px;\n      box-shadow: 0 1px 3px rgba(0,0,0,0.05);\n    }\n\n    .stat-mini-label {\n      font-size: 11px;\n      color: #666;\n      margin-bottom: 4px;\n    }\n\n    .stat-mini-value {\n      font-size: 18px;\n      font-weight: bold;\n      color: #333;\n    }\n\n    .completion-banner {\n      display: none;\n      background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n      color: white;\n      padding: 20px;\n      margin-bottom: 16px;\n      border-radius: 8px;\n      box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n      text-align: center;\n    }\n\n    .completion-banner.show {\n      display: block;\n      animation: slideDown 0.3s ease-out;\n    }\n\n    @keyframes slideDown {\n      from {\n        opacity: 0;\n        transform: translateY(-10px);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0);\n      }\n    }\n\n    .completion-title {\n      font-size: 20px;\n      font-weight: bold;\n      margin-bottom: 8px;\n    }\n\n    .completion-message {\n      font-size: 14px;\n      margin-bottom: 16px;\n      opacity: 0.95;\n    }\n\n    .close-button {\n      background: white;\n      color: #10b981;\n      border: none;\n      padding: 12px 24px;\n      border-radius: 6px;\n      font-size: 14px;\n      font-weight: 600;\n      cursor: pointer;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n      transition: all 0.2s ease;\n    }\n\n    .close-button:hover {\n      background: #f0fdf4;\n      transform: translateY(-1px);\n      box-shadow: 0 4px 6px rgba(0,0,0,0.15);\n    }\n\n    .close-button:active {\n      transform: translateY(0);\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n    }\n  </style>\n</head>\n<body>\n  <div class="header">\n    <h2 id="headerTitle">ğŸ”„ ç¿»è¨³å‡¦ç†ã®é€²æ—</h2>\n  </div>\n\n  <div class="completion-banner" id="completionBanner">\n    <div class="completion-title">âœ… å‡¦ç†å®Œäº†ï¼</div>\n    <div class="completion-message">ã™ã¹ã¦ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸã€‚<br>ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‰ã˜ã¦ãã ã•ã„ã€‚</div>\n    <button class="close-button" onclick="closeSidebar()">ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‰ã˜ã‚‹</button>\n  </div>\n\n  <div class="status-card">\n    <div class="status-label">ç¾åœ¨ã®ãƒãƒƒãƒ</div>\n    <div class="status-value batch" id="currentBatch">-</div>\n    <div class="progress-bar">\n      <div class="progress-fill" id="progressBar" style="width: 0%"></div>\n    </div>\n  </div>\n\n  <div class="stats-grid">\n    <div class="stat-mini">\n      <div class="stat-mini-label">âœ… æˆåŠŸ</div>\n      <div class="stat-mini-value" style="color: #10b981;" id="successCount">0</div>\n    </div>\n    <div class="stat-mini">\n      <div class="stat-mini-label">âŒ ã‚¨ãƒ©ãƒ¼</div>\n      <div class="stat-mini-value" style="color: #ef4444;" id="errorCount">0</div>\n    </div>\n  </div>\n\n  <div class="log-container">\n    <div class="log-title">ğŸ“‹ å‡¦ç†ãƒ­ã‚°</div>\n    <div id="logEntries"></div>\n  </div>\n\n  <script>\n    var pollingInterval = null;\n    var isCompleted = false;\n\n    function updateProgress(data) {\n      // ãƒãƒƒãƒé€²æ—\n      if (data.currentBatch !== undefined && data.totalBatches !== undefined) {\n        document.getElementById(\'currentBatch\').textContent =\n          data.currentBatch + \' / \' + data.totalBatches;\n\n        var progress = (data.currentBatch / data.totalBatches) * 100;\n        document.getElementById(\'progressBar\').style.width = progress + \'%\';\n      }\n\n      // å®Œäº†æ¤œçŸ¥ï¼ˆæ˜ç¤ºçš„ãªãƒ•ãƒ©ã‚°ã§åˆ¤å®šï¼‰\n      if (!isCompleted && data.isCompleted === true) {\n        showCompletionBanner();\n      }\n\n      // æˆåŠŸãƒ»ã‚¨ãƒ©ãƒ¼ã‚«ã‚¦ãƒ³ãƒˆ\n      if (data.successCount !== undefined) {\n        document.getElementById(\'successCount\').textContent = data.successCount;\n      }\n      if (data.errorCount !== undefined) {\n        document.getElementById(\'errorCount\').textContent = data.errorCount;\n      }\n\n      // ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n      if (data.message) {\n        addLogEntry(data.message, data.logType || \'info\');\n      }\n    }\n\n    function showCompletionBanner() {\n      isCompleted = true;\n\n      // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã‚’å¤‰æ›´\n      document.getElementById(\'headerTitle\').textContent = \'âœ… ç¿»è¨³å‡¦ç†ã®é€²æ—\';\n\n      // å®Œäº†ãƒãƒŠãƒ¼ã‚’è¡¨ç¤º\n      var banner = document.getElementById(\'completionBanner\');\n      banner.classList.add(\'show\');\n\n      // ãƒãƒ¼ãƒªãƒ³ã‚°ã‚’åœæ­¢\n      if (pollingInterval) {\n        clearInterval(pollingInterval);\n        pollingInterval = null;\n        console.log(\'âœ… ãƒãƒ¼ãƒªãƒ³ã‚°åœæ­¢ï¼ˆå‡¦ç†å®Œäº†ï¼‰\');\n      }\n\n      // å®Œäº†ãƒ­ã‚°ã‚’è¿½åŠ \n      addLogEntry(\'âœ… ã™ã¹ã¦ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸï¼\', \'success\');\n    }\n\n    function closeSidebar() {\n      // Google Apps Scriptã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‰ã˜ã‚‹\n      google.script.host.close();\n    }\n\n    var lastMessage = \'\';  // æœ€å¾Œã«è¿½åŠ ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨˜éŒ²\n\n    function addLogEntry(message, type) {\n      // åŒã˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€£ç¶šã™ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—\n      if (message === lastMessage) {\n        return;\n      }\n\n      lastMessage = message;\n\n      var logContainer = document.getElementById(\'logEntries\');\n      var entry = document.createElement(\'div\');\n      entry.className = \'log-entry \' + type;\n\n      var timestamp = new Date().toLocaleTimeString(\'ja-JP\');\n      entry.innerHTML = \'<span class="timestamp">\' + timestamp + \'</span>\' + message;\n\n      logContainer.insertBefore(entry, logContainer.firstChild);\n\n      // æœ€å¤§50ä»¶ã¾ã§ã®ãƒ­ã‚°ã‚’ä¿æŒ\n      while (logContainer.children.length > 50) {\n        logContainer.removeChild(logContainer.lastChild);\n      }\n    }\n\n    // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n    addLogEntry(\'ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ\', \'info\');\n\n    // å®šæœŸçš„ã«ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰é€²æ—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\n    function pollProgress() {\n      google.script.run\n        .withSuccessHandler(function(data) {\n          if (data) {\n            updateProgress(data);\n          }\n        })\n        .withFailureHandler(function(error) {\n          console.error(\'é€²æ—å–å¾—ã‚¨ãƒ©ãƒ¼:\', error);\n        })\n        .getProgressData();\n    }\n\n    // 5ç§’ã”ã¨ã«ãƒãƒ¼ãƒªãƒ³ã‚°\n    pollingInterval = setInterval(pollProgress, 5000);\n\n    // åˆå›å®Ÿè¡Œ\n    pollProgress();\n  </script>\n</body>\n</html>\n';


HTML_TEMPLATES['CategorySelectionDialog'] = '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">\n<html>\n<head>\n  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">\n  <meta http-equiv="Content-Style-Type" content="text/css">\n  <title></title>\n  <meta name="Generator" content="Cocoa HTML Writer">\n  <meta name="CocoaVersion" content="2575.7">\n  <style type="text/css">\n    body {background-color: #f7f7f7}\n    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px \'Hiragino Sans\'; color: #175ae2; -webkit-text-stroke: #175ae2}\n    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px \'Hiragino Sans\'; color: #4d5055; -webkit-text-stroke: #4d5055}\n    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px \'Hiragino Sans\'; color: #202326; -webkit-text-stroke: #202326; background-color: #ffffff}\n    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px \'Helvetica Neue\'; -webkit-text-stroke: #000000; background-color: #ffffff}\n    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px \'Helvetica Neue\'; -webkit-text-stroke: #000000; background-color: #ffffff; min-height: 17.0px}\n    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px \'Hiragino Sans\'; color: #175ae2; -webkit-text-stroke: #175ae2}\n    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px \'Hiragino Sans\'; color: #4d5055; -webkit-text-stroke: #4d5055}\n    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Arial; color: #4d5055; -webkit-text-stroke: #4d5055; min-height: 14.0px}\n    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 14.0px \'Hiragino Sans\'; color: #2e3133; -webkit-text-stroke: #2e3133; background-color: #eef0f1}\n    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 14.0px \'Hiragino Sans\'; color: #ffffff; -webkit-text-stroke: #ffffff; background-color: #175ae2}\n    span.s1 {font: 18.0px \'Apple Color Emoji\'; font-kerning: none; background-color: #ffffff}\n    span.s2 {font: 18.0px Arial; font-kerning: none; background-color: #ffffff}\n    span.s3 {font-kerning: none; background-color: #ffffff}\n    span.s4 {font: 14.0px Arial; font-kerning: none; background-color: #ffffff}\n    span.s5 {font-kerning: none}\n    span.s6 {font: 12.0px Arial; font-kerning: none}\n    span.s7 {font: 14.0px \'Hiragino Mincho ProN\'; font-kerning: none}\n    span.s8 {font: 14.0px Times; font-kerning: none}\n    span.s9 {font: 13.0px \'Apple Color Emoji\'; font-kerning: none; background-color: #e3ecfe}\n    span.s10 {font: 13.0px Arial; font-kerning: none; background-color: #e3ecfe}\n    span.s11 {font-kerning: none; background-color: #e3ecfe}\n    span.s12 {font: 12.0px Arial; font-kerning: none; background-color: #e3ecfe}\n  </style>\n</head>\n<body>\n<p class="p1"><span class="s1">ğŸ“‚</span><span class="s2"><b> </b></span><span class="s3"><b>ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠ</b><b></b></span></p>\n<p class="p2"><span class="s3">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–°ã§ä½¿ç”¨ã™ã‚‹å•†å“ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</span></p>\n<p class="p2"><span class="s3">é¸æŠå¾Œã€å„è¡Œã®</span><span class="s4">Q</span><span class="s3">åˆ—ï¼ˆä¾¡æ ¼ï¼‰ã€</span><span class="s4">AB</span><span class="s3">åˆ—ï¼ˆå•†å“çŠ¶æ…‹ï¼‰ã€</span><span class="s4">W</span><span class="s3">åˆ—ï¼ˆé…é€æ–¹æ³•ï¼‰ã‹ã‚‰è‡ªå‹•çš„ã«æ¡ä»¶ã‚’èª­ã¿å–ã‚Šã€</span><span class="s4">4</span><span class="s3">æ¬¡å…ƒæ¤œç´¢ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</span></p>\n<p class="p3"><span class="s5"><b>å•†å“ã‚«ãƒ†ã‚´ãƒªãƒ¼</b></span><span class="s6"><b> *</b><b></b></span></p>\n<p class="p4"><span class="s5"><span class="Apple-converted-space">Â  Â  Â  Â  </span></span><span class="s7">èª­ã¿è¾¼ã¿ä¸­</span><span class="s8">...</span></p>\n<p class="p5"><span class="s5"><span class="Apple-converted-space">Â Â  Â  Â </span></span></p>\n<p class="p6"><span class="s9">ğŸ’¡</span><span class="s10"><b> 4</b></span><span class="s11"><b>æ¬¡å…ƒæ¤œç´¢ã«ã¤ã„ã¦</b><b></b></span></p>\n<p class="p7"><span class="s11"><b>æ¤œç´¢æ¡ä»¶ï¼š</b><b></b></span></p>\n<p class="p7"><span class="s12">1. </span><span class="s11">ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆã“ã“ã§é¸æŠï¼‰</span></p>\n<p class="p7"><span class="s12">2. </span><span class="s11">å•†å“çŠ¶æ…‹ï¼ˆ</span><span class="s12">AB</span><span class="s11">åˆ—ã‹ã‚‰è‡ªå‹•å–å¾—ï¼‰</span></p>\n<p class="p7"><span class="s12">3. </span><span class="s11">é…é€æ–¹æ³•ï¼ˆ</span><span class="s12">W</span><span class="s11">åˆ—ã‹ã‚‰è‡ªå‹•å–å¾—ï¼‰</span></p>\n<p class="p7"><span class="s12">4. </span><span class="s11">è²©å£²ä¾¡æ ¼ï¼ˆ</span><span class="s12">Q</span><span class="s11">åˆ—ã‹ã‚‰è‡ªå‹•å–å¾—ï¼‰</span></p>\n<p class="p8"><span class="s5"></span><br></p>\n<p class="p7"><span class="s11">å‚ç…§ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆã‹ã‚‰è©²å½“ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ¤œç´¢ã—ã€</span><span class="s12">E</span><span class="s11">åˆ—ã«è¨­å®šã—ã¾ã™ã€‚</span></p>\n<p class="p9"><span class="s5">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</span></p>\n<p class="p10"><span class="s5">é¸æŠã—ã¦æ›´æ–°é–‹å§‹</span></p>\n</body>\n</html>\n';


HTML_TEMPLATES['ShippingPolicyCategoryDialog'] = '<!DOCTYPE html>\n<html>\n<head>\n  <base target="_top">\n  <style>\n    body {\n      font-family: Arial, sans-serif;\n      padding: 20px;\n      margin: 0;\n    }\n    \n    .header {\n      margin-bottom: 20px;\n      padding-bottom: 15px;\n      border-bottom: 2px solid #4285f4;\n    }\n    \n    .header h2 {\n      margin: 0 0 10px 0;\n      color: #202124;\n      font-size: 20px;\n    }\n    \n    .header p {\n      margin: 0;\n      color: #5f6368;\n      font-size: 14px;\n    }\n    \n    .form-group {\n      margin-bottom: 20px;\n    }\n    \n    label {\n      display: block;\n      font-weight: bold;\n      margin-bottom: 8px;\n      color: #202124;\n      font-size: 14px;\n    }\n    \n    select {\n      width: 100%;\n      padding: 10px;\n      font-size: 14px;\n      border: 1px solid #dadce0;\n      border-radius: 4px;\n      background-color: white;\n      cursor: pointer;\n    }\n    \n    select:focus {\n      outline: none;\n      border-color: #4285f4;\n      box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);\n    }\n    \n    .info-box {\n      background-color: #e8f0fe;\n      border-left: 4px solid #4285f4;\n      padding: 12px;\n      margin-bottom: 20px;\n      border-radius: 4px;\n      font-size: 13px;\n      color: #202124;\n    }\n    \n    .info-box strong {\n      color: #1967d2;\n    }\n    \n    .buttons {\n      text-align: center;\n      margin-top: 25px;\n    }\n    \n    .btn {\n      padding: 10px 24px;\n      font-size: 14px;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n      margin: 0 5px;\n      font-weight: 500;\n    }\n    \n    .btn-primary {\n      background-color: #4285f4;\n      color: white;\n    }\n    \n    .btn-primary:hover {\n      background-color: #3367d6;\n    }\n    \n    .btn-secondary {\n      background-color: #f1f3f4;\n      color: #202124;\n    }\n    \n    .btn-secondary:hover {\n      background-color: #e8eaed;\n    }\n    \n    .category-option {\n      padding: 8px;\n    }\n    \n    .limit-warning {\n      color: #d93025;\n      font-size: 12px;\n      margin-top: 8px;\n    }\n  </style>\n</head>\n<body>\n  <div class="header">\n    <h2>ğŸ“¦ ã‚·ãƒƒãƒ”ãƒ³ã‚°ãƒãƒªã‚·ãƒ¼è¨­å®š</h2>\n    <p>ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„</p>\n  </div>\n  \n  <div class="info-box">\n    <strong>ğŸ’¡ é€æ–™ä¸Šé™ã«ã¤ã„ã¦ï¼š</strong><br>\n    ä¸€éƒ¨ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã§ã¯eBayã®è¦å®šã«ã‚ˆã‚Šé€æ–™ä¸Šé™ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚<br>\n    ä¸Šé™ã‚’è¶…ãˆã‚‹å•†å“ã«ã¯ã€æœ€å¤§è¨±å®¹ç¯„å›²ã®ãƒãƒªã‚·ãƒ¼ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚\n  </div>\n  \n  <div class="form-group">\n    <label for="categorySelect">ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠï¼š</label>\n    <select id="categorySelect" onchange="updateLimitWarning()">\n      <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>\n    </select>\n    <div id="limitWarning" class="limit-warning" style="display: none;"></div>\n  </div>\n  \n  <div class="buttons">\n    <button class="btn btn-primary" onclick="applyCategory()">é©ç”¨</button>\n    <button class="btn btn-secondary" onclick="google.script.host.close()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>\n  </div>\n  \n  <script>\n    // ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿\n    google.script.run\n      .withSuccessHandler(function(categories) {\n        var select = document.getElementById(\'categorySelect\');\n        \n        categories.forEach(function(cat) {\n          var option = document.createElement(\'option\');\n          option.value = cat.value;\n          option.textContent = cat.display;\n          option.dataset.limit = cat.limit;\n          select.appendChild(option);\n        });\n      })\n      .withFailureHandler(function(error) {\n        alert(\'ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: \' + error.message);\n      })\n      .getShippingPolicyCategories();\n    \n    // ä¸Šé™è­¦å‘Šã®è¡¨ç¤ºåˆ¶å¾¡\n    function updateLimitWarning() {\n      var select = document.getElementById(\'categorySelect\');\n      var warning = document.getElementById(\'limitWarning\');\n      var selectedOption = select.options[select.selectedIndex];\n      \n      if (selectedOption && selectedOption.dataset.limit && selectedOption.dataset.limit !== \'null\') {\n        var limit = selectedOption.dataset.limit;\n        warning.textContent = \'âš ï¸ ã“ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã¯é€æ–™ä¸Šé™ $\' + limit + \' ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™\';\n        warning.style.display = \'block\';\n      } else {\n        warning.style.display = \'none\';\n      }\n    }\n    \n    // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é©ç”¨\n    function applyCategory() {\n      var select = document.getElementById(\'categorySelect\');\n      var selectedValue = select.value;\n      \n      if (!selectedValue) {\n        alert(\'ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„\');\n        return;\n      }\n      \n      // ã‚µãƒ¼ãƒãƒ¼å´ã®å‡¦ç†ã‚’å‘¼ã³å‡ºã—\n      google.script.run\n        .withSuccessHandler(function() {\n          google.script.host.close();\n        })\n        .withFailureHandler(function(error) {\n          alert(\'è¨­å®šã‚¨ãƒ©ãƒ¼: \' + error.message);\n        })\n        .applyShippingPolicyWithCategory(selectedValue);\n    }\n  </script>\n</body>\n</html>';


HTML_TEMPLATES['TemplateManualSearch'] = '<!DOCTYPE html>\n<html>\n<head>\n  <base target="_top">\n  <style>\n    body {\n      font-family: Arial, sans-serif;\n      padding: 20px;\n      margin: 0;\n    }\n    \n    .header {\n      margin-bottom: 20px;\n      padding-bottom: 15px;\n      border-bottom: 2px solid #4285f4;\n    }\n    \n    .header h2 {\n      margin: 0 0 10px 0;\n      color: #202124;\n      font-size: 20px;\n    }\n    \n    .header p {\n      margin: 0;\n      color: #5f6368;\n      font-size: 14px;\n    }\n    \n    .info-box {\n      background-color: #e8f0fe;\n      border-left: 4px solid #4285f4;\n      padding: 12px;\n      margin-bottom: 20px;\n      border-radius: 4px;\n      font-size: 13px;\n      color: #202124;\n    }\n    \n    .form-group {\n      margin-bottom: 20px;\n    }\n    \n    label {\n      display: block;\n      font-weight: bold;\n      margin-bottom: 8px;\n      color: #202124;\n      font-size: 14px;\n    }\n    \n    select {\n      width: 100%;\n      padding: 10px;\n      font-size: 14px;\n      border: 1px solid #dadce0;\n      border-radius: 4px;\n      background-color: white;\n      cursor: pointer;\n      box-sizing: border-box;\n    }\n    \n    select:focus {\n      outline: none;\n      border-color: #4285f4;\n      box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);\n    }\n    \n    .result-box {\n      background-color: #f8f9fa;\n      border: 1px solid #dadce0;\n      border-radius: 4px;\n      padding: 15px;\n      margin-top: 20px;\n      display: none;\n    }\n    \n    .result-box.success {\n      background-color: #e6f4ea;\n      border-color: #34a853;\n    }\n    \n    .result-box.error {\n      background-color: #fce8e6;\n      border-color: #ea4335;\n    }\n    \n    .result-box h3 {\n      margin: 0 0 10px 0;\n      font-size: 16px;\n    }\n    \n    .result-item {\n      margin: 8px 0;\n      font-size: 14px;\n    }\n    \n    .result-item strong {\n      color: #1967d2;\n    }\n    \n    .buttons {\n      text-align: center;\n      margin-top: 25px;\n    }\n    \n    .btn {\n      padding: 10px 24px;\n      font-size: 14px;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n      margin: 0 5px;\n      font-weight: 500;\n    }\n    \n    .btn-primary {\n      background-color: #4285f4;\n      color: white;\n    }\n    \n    .btn-primary:hover {\n      background-color: #3367d6;\n    }\n    \n    .btn-secondary {\n      background-color: #f1f3f4;\n      color: #202124;\n    }\n    \n    .btn-secondary:hover {\n      background-color: #e8eaed;\n    }\n    \n    .btn:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n    \n    .loading {\n      display: none;\n      text-align: center;\n      color: #5f6368;\n      font-size: 14px;\n      margin-top: 15px;\n    }\n  </style>\n</head>\n<body>\n  <div class="header">\n    <h2>ğŸ” ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ‰‹å‹•æ¤œç´¢</h2>\n    <p>æ¡ä»¶ã‚’å…¥åŠ›ã—ã¦è©²å½“ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ¤œç´¢ã—ã¾ã™</p>\n  </div>\n  \n  <div class="info-box">\n    æ¡ä»¶ã«åˆã†ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆIDã‚’æ¤œç´¢ã—ã¾ã™ã€‚<br>\n    ã‚¨ãƒ©ãƒ¼ã§è‡ªå‹•è¨­å®šã§ããªã‹ã£ãŸå ´åˆã®ç¢ºèªç”¨ã§ã™ã€‚\n  </div>\n  \n  <div class="form-group">\n    <label for="categorySelect">ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼š</label>\n    <select id="categorySelect" onchange="updateConditionVisibility()">\n      <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>\n      <option value="general">æ±ç”¨ï¼ˆé€æ–™ä¸Šé™ãªã—ï¼‰</option>\n      <option value="videogames">Video Gamesï¼ˆé€æ–™ä¸Šé™$20ï¼‰</option>\n      <option value="books">Booksï¼ˆé€æ–™ä¸Šé™$20ï¼‰</option>\n      <option value="movies">Movies & TVï¼ˆé€æ–™ä¸Šé™$20ï¼‰</option>\n      <option value="music">Musicï¼ˆé€æ–™ä¸Šé™$25ï¼‰</option>\n      <option value="console">Video Game Consolesï¼ˆé€æ–™ä¸Šé™$50ï¼‰</option>\n      <option value="card_graded">ãƒˆãƒ¬ã‚« - Graded</option>\n      <option value="card_raw">ãƒˆãƒ¬ã‚« - æœªé‘‘å®š</option>\n      <option value="preorder">äºˆç´„è²©å£²</option>\n    </select>\n  </div>\n  \n  <div class="form-group" id="conditionGroup">\n    <label for="conditionSelect">å•†å“çŠ¶æ…‹ï¼š</label>\n    <select id="conditionSelect">\n      <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>\n      <option value="æ–°å“">æ–°å“</option>\n      <option value="ä¸­å¤">ä¸­å¤</option>\n    </select>\n  </div>\n  \n  <div class="form-group" id="shippingGroup">\n    <label for="shippingTypeSelect">é…é€æ–¹æ³•ï¼š</label>\n    <select id="shippingTypeSelect">\n      <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>\n      <option value="ã‚¨ã‚³ãƒãƒŸãƒ¼">ã‚¨ã‚³ãƒãƒŸãƒ¼ï¼ˆeãƒ‘ã‚±ãƒƒãƒˆ / Cpass-Economyï¼‰</option>\n      <option value="EX">EXï¼ˆCpass-FedEx / Cpass-DHL / eLogisticsï¼‰</option>\n    </select>\n  </div>\n  \n  <div class="buttons">\n    <button class="btn btn-primary" id="searchBtn" onclick="searchTemplate()">æ¤œç´¢</button>\n    <button class="btn btn-secondary" onclick="google.script.host.close()">é–‰ã˜ã‚‹</button>\n  </div>\n  \n  <div class="loading" id="loading">æ¤œç´¢ä¸­...</div>\n  \n  <div class="result-box" id="resultBox">\n    <h3 id="resultTitle">æ¤œç´¢çµæœ</h3>\n    <div id="resultContent"></div>\n  </div>\n  \n  <script>\n    // ã‚«ãƒ†ã‚´ãƒªãƒ¼å¤‰æ›´æ™‚ã®è¡¨ç¤ºåˆ¶å¾¡\n    function updateConditionVisibility() {\n      var category = document.getElementById(\'categorySelect\').value;\n      var conditionGroup = document.getElementById(\'conditionGroup\');\n      var shippingGroup = document.getElementById(\'shippingGroup\');\n      \n      // ãƒˆãƒ¬ã‚«ã¯çŠ¶æ…‹ãƒ»é…é€ä¸è¦\n      if (category === \'card_graded\' || category === \'card_raw\') {\n        conditionGroup.style.display = \'none\';\n        shippingGroup.style.display = \'none\';\n      }\n      // äºˆç´„è²©å£²ã¯çŠ¶æ…‹ä¸è¦ï¼ˆæ–°å“å›ºå®šï¼‰\n      else if (category === \'preorder\') {\n        conditionGroup.style.display = \'none\';\n        shippingGroup.style.display = \'block\';\n      }\n      // ãã®ä»–ã¯å…¨ã¦å¿…è¦\n      else {\n        conditionGroup.style.display = \'block\';\n        shippingGroup.style.display = \'block\';\n      }\n    }\n    \n    // æ¤œç´¢å®Ÿè¡Œ\n    function searchTemplate() {\n      var category = document.getElementById(\'categorySelect\').value;\n      var condition = document.getElementById(\'conditionSelect\').value;\n      var shippingType = document.getElementById(\'shippingTypeSelect\').value;\n      \n      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³\n      if (!category) {\n        alert(\'ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„\');\n        return;\n      }\n      \n      // ãƒˆãƒ¬ã‚«ãƒ»äºˆç´„è²©å£²ä»¥å¤–ã¯çŠ¶æ…‹ãƒ»é…é€ãƒã‚§ãƒƒã‚¯\n      if (![\'card_graded\', \'card_raw\'].includes(category)) {\n        if (category !== \'preorder\' && !condition) {\n          alert(\'å•†å“çŠ¶æ…‹ã‚’é¸æŠã—ã¦ãã ã•ã„\');\n          return;\n        }\n        if (!shippingType) {\n          alert(\'é…é€æ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„\');\n          return;\n        }\n      }\n      \n      // UIçŠ¶æ…‹å¤‰æ›´\n      document.getElementById(\'searchBtn\').disabled = true;\n      document.getElementById(\'loading\').style.display = \'block\';\n      document.getElementById(\'resultBox\').style.display = \'none\';\n      \n      // æ¤œç´¢å®Ÿè¡Œ\n      google.script.run\n        .withSuccessHandler(function(result) {\n          document.getElementById(\'searchBtn\').disabled = false;\n          document.getElementById(\'loading\').style.display = \'none\';\n          displayResult(result);\n        })\n        .withFailureHandler(function(error) {\n          document.getElementById(\'searchBtn\').disabled = false;\n          document.getElementById(\'loading\').style.display = \'none\';\n          alert(\'æ¤œç´¢ã‚¨ãƒ©ãƒ¼: \' + error.message);\n        })\n        .searchTemplateManually({\n          category: category,\n          condition: condition,\n          shippingType: shippingType\n        });\n    }\n    \n    // çµæœè¡¨ç¤º\n    function displayResult(result) {\n      var resultBox = document.getElementById(\'resultBox\');\n      var resultTitle = document.getElementById(\'resultTitle\');\n      var resultContent = document.getElementById(\'resultContent\');\n      \n      if (!result.success) {\n        resultBox.className = \'result-box error\';\n        resultTitle.textContent = \'âŒ ã‚¨ãƒ©ãƒ¼\';\n        resultContent.innerHTML = \'<div class="result-item">\' + result.error + \'</div>\';\n        resultBox.style.display = \'block\';\n        return;\n      }\n      \n      if (result.templateId === null) {\n        resultBox.className = \'result-box error\';\n        resultTitle.textContent = \'âš ï¸ è©²å½“ãªã—\';\n        \n        var html = \'<div class="result-item">è©²å½“ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</div>\';\n        html += \'<div class="result-item"><strong>æ¤œç´¢æ¡ä»¶ï¼š</strong></div>\';\n        html += \'<div class="result-item">ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼: \' + getCategoryDisplay(result.searchConditions.category) + \'</div>\';\n        if (result.searchConditions.condition) {\n          html += \'<div class="result-item">ãƒ»å•†å“çŠ¶æ…‹: \' + result.searchConditions.condition + \'</div>\';\n        }\n        if (result.searchConditions.shippingType) {\n          html += \'<div class="result-item">ãƒ»é…é€æ–¹æ³•: \' + result.searchConditions.shippingType + \'</div>\';\n        }\n        \n        resultContent.innerHTML = html;\n        resultBox.style.display = \'block\';\n        return;\n      }\n      \n      resultBox.className = \'result-box success\';\n      resultTitle.textContent = \'âœ… æ¤œç´¢æˆåŠŸ\';\n      \n      var html = \'<div class="result-item"><strong>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆID:</strong> \' + result.templateId + \'</div>\';\n      if (result.templateName) {\n        html += \'<div class="result-item"><strong>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåç§°:</strong> \' + result.templateName + \'</div>\';\n      }\n      html += \'<div class="result-item" style="margin-top: 10px;"><strong>æ¤œç´¢æ¡ä»¶ï¼š</strong></div>\';\n      html += \'<div class="result-item">ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼: \' + getCategoryDisplay(result.searchConditions.category) + \'</div>\';\n      if (result.searchConditions.condition) {\n        html += \'<div class="result-item">ãƒ»å•†å“çŠ¶æ…‹: \' + result.searchConditions.condition + \'</div>\';\n      }\n      if (result.searchConditions.shippingType) {\n        html += \'<div class="result-item">ãƒ»é…é€æ–¹æ³•: \' + result.searchConditions.shippingType + \'</div>\';\n      }\n      \n      resultContent.innerHTML = html;\n      resultBox.style.display = \'block\';\n    }\n    \n    // ã‚«ãƒ†ã‚´ãƒªãƒ¼è¡¨ç¤ºåå–å¾—\n    function getCategoryDisplay(value) {\n      var mapping = {\n        \'general\': \'æ±ç”¨\',\n        \'videogames\': \'Video Games\',\n        \'books\': \'Books\',\n        \'movies\': \'Movies & TV\',\n        \'music\': \'Music\',\n        \'console\': \'Video Game Consoles\',\n        \'card_graded\': \'ãƒˆãƒ¬ã‚« - Graded\',\n        \'card_raw\': \'ãƒˆãƒ¬ã‚« - æœªé‘‘å®š\',\n        \'preorder\': \'äºˆç´„è²©å£²\'\n      };\n      return mapping[value] || value;\n    }\n    \n    // åˆæœŸåŒ–\n    updateConditionVisibility();\n  </script>\n</body>\n</html>';


HTML_TEMPLATES['ShippingPolicyManualSearch'] = '<!DOCTYPE html>\n<html>\n<head>\n  <base target="_top">\n  <style>\n    body {\n      font-family: Arial, sans-serif;\n      padding: 20px;\n      margin: 0;\n    }\n    \n    .header {\n      margin-bottom: 20px;\n      padding-bottom: 15px;\n      border-bottom: 2px solid #4285f4;\n    }\n    \n    .header h2 {\n      margin: 0 0 10px 0;\n      color: #202124;\n      font-size: 20px;\n    }\n    \n    .header p {\n      margin: 0;\n      color: #5f6368;\n      font-size: 14px;\n    }\n    \n    .form-group {\n      margin-bottom: 20px;\n    }\n    \n    label {\n      display: block;\n      font-weight: bold;\n      margin-bottom: 8px;\n      color: #202124;\n      font-size: 14px;\n    }\n    \n    select, input {\n      width: 100%;\n      padding: 10px;\n      font-size: 14px;\n      border: 1px solid #dadce0;\n      border-radius: 4px;\n      box-sizing: border-box;\n    }\n    \n    select {\n      background-color: white;\n      cursor: pointer;\n    }\n    \n    input[type="number"] {\n      -moz-appearance: textfield;\n    }\n    \n    input[type="number"]::-webkit-inner-spin-button,\n    input[type="number"]::-webkit-outer-spin-button {\n      -webkit-appearance: none;\n      margin: 0;\n    }\n    \n    select:focus, input:focus {\n      outline: none;\n      border-color: #4285f4;\n      box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);\n    }\n    \n    .info-box {\n      background-color: #e8f0fe;\n      border-left: 4px solid #4285f4;\n      padding: 12px;\n      margin-bottom: 20px;\n      border-radius: 4px;\n      font-size: 13px;\n      color: #202124;\n    }\n    \n    .result-box {\n      background-color: #f8f9fa;\n      border: 1px solid #dadce0;\n      border-radius: 4px;\n      padding: 15px;\n      margin-top: 20px;\n      display: none;\n    }\n    \n    .result-box.success {\n      background-color: #e6f4ea;\n      border-color: #34a853;\n    }\n    \n    .result-box.error {\n      background-color: #fce8e6;\n      border-color: #ea4335;\n    }\n    \n    .result-box h3 {\n      margin: 0 0 10px 0;\n      font-size: 16px;\n    }\n    \n    .result-item {\n      margin: 8px 0;\n      font-size: 14px;\n    }\n    \n    .result-item strong {\n      color: #1967d2;\n    }\n    \n    .buttons {\n      text-align: center;\n      margin-top: 25px;\n    }\n    \n    .btn {\n      padding: 10px 24px;\n      font-size: 14px;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n      margin: 0 5px;\n      font-weight: 500;\n    }\n    \n    .btn-primary {\n      background-color: #4285f4;\n      color: white;\n    }\n    \n    .btn-primary:hover {\n      background-color: #3367d6;\n    }\n    \n    .btn-secondary {\n      background-color: #f1f3f4;\n      color: #202124;\n    }\n    \n    .btn-secondary:hover {\n      background-color: #e8eaed;\n    }\n    \n    .btn:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n    \n    .loading {\n      display: none;\n      text-align: center;\n      color: #5f6368;\n      font-size: 14px;\n      margin-top: 15px;\n    }\n  </style>\n</head>\n<body>\n  <div class="header">\n    <h2>ğŸ” ã‚·ãƒƒãƒ”ãƒ³ã‚°ãƒãƒªã‚·ãƒ¼æ‰‹å‹•æ¤œç´¢</h2>\n    <p>æ¡ä»¶ã‚’å…¥åŠ›ã—ã¦è©²å½“ã™ã‚‹ãƒãƒªã‚·ãƒ¼ã‚’æ¤œç´¢ã—ã¾ã™</p>\n  </div>\n  \n  <div class="info-box">\n    æ¡ä»¶ã«åˆã†ã‚·ãƒƒãƒ”ãƒ³ã‚°ãƒãƒªã‚·ãƒ¼IDã‚’æ¤œç´¢ã—ã¾ã™ã€‚<br>\n    ã‚¨ãƒ©ãƒ¼ã§è‡ªå‹•è¨­å®šã§ããªã‹ã£ãŸå ´åˆã®ç¢ºèªç”¨ã§ã™ã€‚\n  </div>\n  \n  <div class="form-group">\n    <label for="categorySelect">ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼š</label>\n    <select id="categorySelect">\n      <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>\n    </select>\n  </div>\n  \n  <div class="form-group">\n    <label for="conditionSelect">å•†å“çŠ¶æ…‹ï¼š</label>\n    <select id="conditionSelect">\n      <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>\n      <option value="æ–°å“">æ–°å“</option>\n      <option value="ä¸­å¤">ä¸­å¤</option>\n    </select>\n  </div>\n  \n  <div class="form-group">\n    <label for="shippingTypeSelect">é…é€æ–¹æ³•ï¼š</label>\n    <select id="shippingTypeSelect">\n      <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>\n      <option value="ã‚¨ã‚³ãƒãƒŸãƒ¼">ã‚¨ã‚³ãƒãƒŸãƒ¼ï¼ˆeãƒ‘ã‚±ãƒƒãƒˆ / Cpass-Economyï¼‰</option>\n      <option value="EX">EXï¼ˆCpass-FedEx / Cpass-DHL / eLogisticsï¼‰</option>\n    </select>\n  </div>\n  \n  <div class="form-group">\n    <label for="priceInput">è²©å£²ä¾¡æ ¼ï¼ˆUSDï¼‰ï¼š</label>\n    <input type="number" id="priceInput" placeholder="ä¾‹: 85.50" step="0.01" min="0">\n  </div>\n  \n  <div class="buttons">\n    <button class="btn btn-primary" id="searchBtn" onclick="searchPolicy()">æ¤œç´¢</button>\n    <button class="btn btn-secondary" onclick="google.script.host.close()">é–‰ã˜ã‚‹</button>\n  </div>\n  \n  <div class="loading" id="loading">æ¤œç´¢ä¸­...</div>\n  \n  <div class="result-box" id="resultBox">\n    <h3 id="resultTitle">æ¤œç´¢çµæœ</h3>\n    <div id="resultContent"></div>\n  </div>\n  \n  <script>\n    // ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿\n    google.script.run\n      .withSuccessHandler(function(categories) {\n        var select = document.getElementById(\'categorySelect\');\n        \n        categories.forEach(function(cat) {\n          var option = document.createElement(\'option\');\n          option.value = cat.value;\n          option.textContent = cat.display;\n          select.appendChild(option);\n        });\n      })\n      .withFailureHandler(function(error) {\n        alert(\'ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: \' + error.message);\n      })\n      .getShippingPolicyCategories();\n    \n    // æ¤œç´¢å®Ÿè¡Œ\n    function searchPolicy() {\n      var category = document.getElementById(\'categorySelect\').value;\n      var condition = document.getElementById(\'conditionSelect\').value;\n      var shippingType = document.getElementById(\'shippingTypeSelect\').value;\n      var price = parseFloat(document.getElementById(\'priceInput\').value);\n      \n      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³\n      if (!category) {\n        alert(\'ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„\');\n        return;\n      }\n      if (!condition) {\n        alert(\'å•†å“çŠ¶æ…‹ã‚’é¸æŠã—ã¦ãã ã•ã„\');\n        return;\n      }\n      if (!shippingType) {\n        alert(\'é…é€æ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„\');\n        return;\n      }\n      if (isNaN(price) || price < 0) {\n        alert(\'ä¾¡æ ¼ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„\');\n        return;\n      }\n      \n      // UIçŠ¶æ…‹å¤‰æ›´\n      document.getElementById(\'searchBtn\').disabled = true;\n      document.getElementById(\'loading\').style.display = \'block\';\n      document.getElementById(\'resultBox\').style.display = \'none\';\n      \n      // æ¤œç´¢å®Ÿè¡Œ\n      google.script.run\n        .withSuccessHandler(function(result) {\n          document.getElementById(\'searchBtn\').disabled = false;\n          document.getElementById(\'loading\').style.display = \'none\';\n          displayResult(result);\n        })\n        .withFailureHandler(function(error) {\n          document.getElementById(\'searchBtn\').disabled = false;\n          document.getElementById(\'loading\').style.display = \'none\';\n          alert(\'æ¤œç´¢ã‚¨ãƒ©ãƒ¼: \' + error.message);\n        })\n        .searchShippingPolicyManually({\n          category: category,\n          condition: condition,\n          shippingType: shippingType,\n          price: price\n        });\n    }\n    \n    // çµæœè¡¨ç¤º\n    function displayResult(result) {\n      var resultBox = document.getElementById(\'resultBox\');\n      var resultTitle = document.getElementById(\'resultTitle\');\n      var resultContent = document.getElementById(\'resultContent\');\n      \n      if (result.success && result.policyId !== null) {\n  html += \'<div class="result-success">\';\n  html += \'<h3>âœ… æ¤œç´¢æˆåŠŸ</h3>\';\n  html += \'<p><strong>ãƒãƒªã‚·ãƒ¼ID:</strong> \' + result.policyId + \'</p>\';\n  html += \'<p><strong>ãƒãƒªã‚·ãƒ¼å:</strong> \' + (result.policyName || \'ä¸æ˜\') + \'</p>\';\n  \n  // ã€è¿½åŠ ã€‘ä¾¡æ ¼æƒ…å ±ã®è¡¨ç¤º\n  if (result.originalPrice !== undefined && result.adjustedPrice !== undefined) {\n    html += \'<hr style="margin: 15px 0; border: none; border-top: 1px solid #ddd;">\';\n    html += \'<h4 style="margin-top: 15px; color: #666;">ä¾¡æ ¼æƒ…å ±ï¼ˆé–¢ç¨ç‡è€ƒæ…®ï¼‰</h4>\';\n    html += \'<p><strong>å…¥åŠ›ä¾¡æ ¼ï¼ˆDDUï¼‰:</strong> $\' + result.originalPrice.toFixed(2) + \'</p>\';\n    html += \'<p><strong>èª¿æ•´å¾Œä¾¡æ ¼:</strong> $\' + result.adjustedPrice.toFixed(2) + \'</p>\';\n    \n    if (result.adjustment > 0) {\n      html += \'<p><strong>èª¿æ•´é¡:</strong> <span style="color: #d32f2f;">+$\' + result.adjustment.toFixed(2) + \'</span></p>\';\n      html += \'<p style="font-size: 13px; color: #666; background: #fff3cd; padding: 8px; border-radius: 4px;">\';\n      html += \'ğŸ’¡ ç¾åœ¨ã®é–¢ç¨ç‡ï¼ˆAD2ã‚»ãƒ«ï¼‰ã«ã‚ˆã‚Šã€ä¾¡æ ¼å¸¯ãŒä¸Šæ–¹èª¿æ•´ã•ã‚Œã¾ã—ãŸã€‚\';\n      html += \'</p>\';\n    } else {\n      html += \'<p><strong>èª¿æ•´é¡:</strong> $0.00ï¼ˆèª¿æ•´ãªã—ï¼‰</p>\';\n      html += \'<p style="font-size: 13px; color: #666;">ğŸ’¡ åŸºæº–é–¢ç¨ç‡ï¼ˆ15%ï¼‰ã¨åŒã˜ãŸã‚ã€èª¿æ•´ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>\';\n    }\n  }\n  \n  // é€æ–™ä¸Šé™ã®è¡¨ç¤ºï¼ˆæ—¢å­˜ï¼‰\n  if (result.shippingLimit !== null && result.shippingLimit !== undefined) {\n    html += \'<p><strong>é€æ–™ä¸Šé™:</strong> $\' + result.shippingLimit + \'</p>\';\n  } else {\n    html += \'<p><strong>é€æ–™ä¸Šé™:</strong> ãªã—</p>\';\n  }\n  \n  html += \'</div>\';\n}\n      \n      if (result.policyId === null) {\n        resultBox.className = \'result-box error\';\n        resultTitle.textContent = \'âš ï¸ è©²å½“ãªã—\';\n        \n        var html = \'<div class="result-item">è©²å½“ã™ã‚‹ã‚·ãƒƒãƒ”ãƒ³ã‚°ãƒãƒªã‚·ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</div>\';\n        html += \'<div class="result-item"><strong>æ¤œç´¢æ¡ä»¶ï¼š</strong></div>\';\n        html += \'<div class="result-item">ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼: \' + result.searchConditions.category + \'</div>\';\n        html += \'<div class="result-item">ãƒ»å•†å“çŠ¶æ…‹: \' + result.searchConditions.condition + \'</div>\';\n        html += \'<div class="result-item">ãƒ»é…é€æ–¹æ³•: \' + result.searchConditions.shippingType + \'</div>\';\n        html += \'<div class="result-item">ãƒ»ä¾¡æ ¼: $\' + result.searchConditions.price.toFixed(2) + \'</div>\';\n        \n        if (result.shippingLimit !== null) {\n          html += \'<div class="result-item" style="color: #d93025; margin-top: 10px;">ã“ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®é€æ–™ä¸Šé™: $\' + result.shippingLimit + \'</div>\';\n        }\n        \n        resultContent.innerHTML = html;\n        resultBox.style.display = \'block\';\n        return;\n      }\n      \n      resultBox.className = \'result-box success\';\n      resultTitle.textContent = \'âœ… æ¤œç´¢æˆåŠŸ\';\n      \n      var html = \'<div class="result-item"><strong>ãƒãƒªã‚·ãƒ¼ID:</strong> \' + result.policyId + \'</div>\';\n      if (result.policyName) {\n        html += \'<div class="result-item"><strong>ãƒãƒªã‚·ãƒ¼åç§°:</strong> \' + result.policyName + \'</div>\';\n      }\n      html += \'<div class="result-item" style="margin-top: 10px;"><strong>æ¤œç´¢æ¡ä»¶ï¼š</strong></div>\';\n      html += \'<div class="result-item">ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼: \' + result.searchConditions.category + \'</div>\';\n      html += \'<div class="result-item">ãƒ»å•†å“çŠ¶æ…‹: \' + result.searchConditions.condition + \'</div>\';\n      html += \'<div class="result-item">ãƒ»é…é€æ–¹æ³•: \' + result.searchConditions.shippingType + \'</div>\';\n      html += \'<div class="result-item">ãƒ»ä¾¡æ ¼: $\' + result.searchConditions.price.toFixed(2) + \'</div>\';\n      \n      if (result.shippingLimit !== null) {\n        html += \'<div class="result-item" style="color: #1967d2; margin-top: 10px;">ã“ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®é€æ–™ä¸Šé™: $\' + result.shippingLimit + \'</div>\';\n      }\n      \n      resultContent.innerHTML = html;\n      resultBox.style.display = \'block\';\n    }\n  </script>\n</body>\n</html>';


HTML_TEMPLATES['SettingsImportDialog'] = '<!DOCTYPE html>\n<html>\n<head>\n  <base target="_top">\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    \n    body {\n      font-family: \'Segoe UI\', Tahoma, Geneva, Verdana, sans-serif;\n      padding: 20px;\n      background: #f5f5f5;\n    }\n    \n    .container {\n      max-width: 650px;\n      margin: 0 auto;\n      background: white;\n      border-radius: 8px;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n      padding: 20px;\n    }\n    \n    h2 {\n      color: #333;\n      margin-bottom: 20px;\n      font-size: 20px;\n    }\n    \n    .section {\n      margin-bottom: 20px;\n    }\n    \n    .section-title {\n      font-weight: 600;\n      color: #555;\n      margin-bottom: 10px;\n      font-size: 14px;\n    }\n    \n    .input-group {\n      margin-bottom: 15px;\n    }\n    \n    label {\n      display: block;\n      margin-bottom: 5px;\n      color: #666;\n      font-size: 13px;\n    }\n    \n    input[type="text"] {\n      width: 100%;\n      padding: 10px;\n      border: 1px solid #ddd;\n      border-radius: 4px;\n      font-size: 13px;\n    }\n    \n    input[type="text"]:focus {\n      outline: none;\n      border-color: #4CAF50;\n    }\n    \n    .mode-selector {\n      display: flex;\n      gap: 10px;\n      margin-bottom: 20px;\n    }\n    \n    .mode-option {\n      flex: 1;\n      padding: 15px;\n      border: 2px solid #ddd;\n      border-radius: 6px;\n      cursor: pointer;\n      text-align: center;\n      transition: all 0.3s;\n    }\n    \n    .mode-option:hover {\n      border-color: #4CAF50;\n      background: #f0f9f0;\n    }\n    \n    .mode-option.selected {\n      border-color: #4CAF50;\n      background: #e8f5e9;\n    }\n    \n    .mode-option input[type="radio"] {\n      display: none;\n    }\n    \n    .mode-title {\n      font-weight: 600;\n      color: #333;\n      margin-bottom: 5px;\n      font-size: 15px;\n    }\n    \n    .mode-desc {\n      font-size: 12px;\n      color: #666;\n    }\n    \n    .settings-container {\n      display: none;\n      margin-top: 20px;\n      padding: 15px;\n      border: 1px solid #ddd;\n      border-radius: 6px;\n      background: #fafafa;\n      max-height: 300px;\n      overflow-y: auto;\n    }\n    \n    .settings-container.visible {\n      display: block;\n    }\n    \n    .setting-group {\n      margin-bottom: 20px;\n    }\n    \n    .group-header {\n      display: flex;\n      align-items: center;\n      margin-bottom: 10px;\n      padding-bottom: 8px;\n      border-bottom: 2px solid #e0e0e0;\n    }\n    \n    .group-title {\n      flex: 1;\n      font-weight: 600;\n      color: #333;\n      font-size: 14px;\n    }\n    \n    .group-toggle {\n      font-size: 12px;\n      color: #4CAF50;\n      cursor: pointer;\n      text-decoration: underline;\n    }\n    \n    .setting-item {\n      display: flex;\n      align-items: center;\n      padding: 8px;\n      margin-bottom: 5px;\n      background: white;\n      border-radius: 4px;\n    }\n    \n    .setting-item input[type="checkbox"] {\n      margin-right: 10px;\n      cursor: pointer;\n    }\n    \n    .setting-label {\n      flex: 1;\n      font-size: 13px;\n      color: #555;\n    }\n    \n    .setting-value {\n      font-size: 12px;\n      color: #888;\n      font-family: monospace;\n      max-width: 200px;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n    }\n    \n    .button-group {\n      display: flex;\n      gap: 10px;\n      margin-top: 20px;\n    }\n    \n    button {\n      flex: 1;\n      padding: 12px 20px;\n      border: none;\n      border-radius: 6px;\n      font-size: 14px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.3s;\n    }\n    \n    .btn-primary {\n      background: #4CAF50;\n      color: white;\n    }\n    \n    .btn-primary:hover {\n      background: #45a049;\n    }\n    \n    .btn-secondary {\n      background: #2196F3;\n      color: white;\n    }\n    \n    .btn-secondary:hover {\n      background: #0b7dda;\n    }\n    \n    .btn-cancel {\n      background: #f44336;\n      color: white;\n    }\n    \n    .btn-cancel:hover {\n      background: #da190b;\n    }\n    \n    button:disabled {\n      background: #ccc;\n      cursor: not-allowed;\n    }\n    \n    .message {\n      padding: 10px;\n      margin-bottom: 15px;\n      border-radius: 4px;\n      font-size: 13px;\n    }\n    \n    .message.info {\n      background: #e3f2fd;\n      color: #1976d2;\n      border-left: 4px solid #2196F3;\n    }\n    \n    .message.success {\n      background: #e8f5e9;\n      color: #388e3c;\n      border-left: 4px solid #4CAF50;\n    }\n    \n    .message.error {\n      background: #ffebee;\n      color: #c62828;\n      border-left: 4px solid #f44336;\n    }\n    \n    .loading {\n      text-align: center;\n      padding: 20px;\n      color: #666;\n    }\n    \n    .spinner {\n      border: 3px solid #f3f3f3;\n      border-top: 3px solid #4CAF50;\n      border-radius: 50%;\n      width: 30px;\n      height: 30px;\n      animation: spin 1s linear infinite;\n      margin: 10px auto;\n    }\n    \n    @keyframes spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n  </style>\n</head>\n<body>\n  <div class="container">\n    <h2>âš™ï¸ åˆæœŸè¨­å®šã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h2>\n    \n    <div class="section">\n      <div class="input-group">\n        <label for="sourceUrl">ğŸ“‚ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå…ƒã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURL</label>\n        <input type="text" id="sourceUrl" placeholder="https://docs.google.com/spreadsheets/d/..." />\n      </div>\n      \n      <button class="btn-secondary" onclick="loadSettings()">è¨­å®šã‚’èª­ã¿è¾¼ã‚€</button>\n    </div>\n    \n    <div id="settingsSection" style="display:none;">\n      <div class="message info" id="sourceInfo"></div>\n      \n      <div class="section">\n        <div class="section-title">ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰é¸æŠ</div>\n        <div class="mode-selector">\n          <label class="mode-option selected" for="modeAll">\n            <input type="radio" id="modeAll" name="importMode" value="all" checked onchange="toggleMode()">\n            <div class="mode-title">ğŸ”„ å…¨éƒ¨å¼•ãç¶™ã</div>\n            <div class="mode-desc">APIã‚­ãƒ¼ä»¥å¤–ã®ã™ã¹ã¦ã®è¨­å®šã‚’ä¸€æ‹¬ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</div>\n          </label>\n          \n          <label class="mode-option" for="modeSelected">\n            <input type="radio" id="modeSelected" name="importMode" value="selected" onchange="toggleMode()">\n            <div class="mode-title">âœ… å€‹åˆ¥ã«é¸æŠ</div>\n            <div class="mode-desc">å¿…è¦ãªè¨­å®šé …ç›®ã ã‘ã‚’é¸ã‚“ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</div>\n          </label>\n        </div>\n      </div>\n      \n      <div id="settingsContainer" class="settings-container">\n        <!-- ã“ã“ã«è¨­å®šé …ç›®ãŒå‹•çš„ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->\n      </div>\n      \n      <div class="button-group">\n        <button class="btn-primary" onclick="executeImport()">ğŸ“¥ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ</button>\n        <button class="btn-cancel" onclick="google.script.host.close()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>\n      </div>\n    </div>\n    \n    <div id="messageArea"></div>\n  </div>\n\n  <script>\n    let settingsData = null;\n    \n    // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ\n    function toggleMode() {\n      const mode = document.querySelector(\'input[name="importMode"]:checked\').value;\n      const container = document.getElementById(\'settingsContainer\');\n      const options = document.querySelectorAll(\'.mode-option\');\n      \n      options.forEach(opt => opt.classList.remove(\'selected\'));\n      document.querySelector(`label[for="mode${mode === \'all\' ? \'All\' : \'Selected\'}"]`).classList.add(\'selected\');\n      \n      if (mode === \'selected\') {\n        container.classList.add(\'visible\');\n      } else {\n        container.classList.remove(\'visible\');\n      }\n    }\n    \n    // è¨­å®šã‚’èª­ã¿è¾¼ã‚€\n    function loadSettings() {\n      const sourceUrl = document.getElementById(\'sourceUrl\').value.trim();\n      \n      if (!sourceUrl) {\n        showMessage(\'error\', \'ã‚¤ãƒ³ãƒãƒ¼ãƒˆå…ƒURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\');\n        return;\n      }\n      \n      showMessage(\'info\', \'<div class="loading"><div class="spinner"></div>è¨­å®šã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>\');\n      \n      google.script.run\n        .withSuccessHandler(onSettingsLoaded)\n        .withFailureHandler(onError)\n        .getSourceSettings(sourceUrl);\n    }\n    \n    // è¨­å®šèª­ã¿è¾¼ã¿æˆåŠŸæ™‚\n    function onSettingsLoaded(result) {\n      if (!result.success) {\n        showMessage(\'error\', \'âŒ \' + result.error);\n        return;\n      }\n      \n      settingsData = result;\n      document.getElementById(\'sourceInfo\').textContent = \n        `ğŸ“Š ã‚¤ãƒ³ãƒãƒ¼ãƒˆå…ƒ: ${result.spreadsheetName}`;\n      document.getElementById(\'settingsSection\').style.display = \'block\';\n      \n      renderSettings(result.settingGroups);\n      showMessage(\'success\', \'âœ… è¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ\');\n    }\n    \n    // è¨­å®šé …ç›®ã‚’è¡¨ç¤º\n    function renderSettings(groups) {\n      const container = document.getElementById(\'settingsContainer\');\n      container.innerHTML = \'\';\n      \n      for (const groupKey in groups) {\n        const group = groups[groupKey];\n        const groupDiv = document.createElement(\'div\');\n        groupDiv.className = \'setting-group\';\n        \n        const header = document.createElement(\'div\');\n        header.className = \'group-header\';\n        header.innerHTML = `\n          <div class="group-title">${group.title}</div>\n          <span class="group-toggle" onclick="toggleGroup(\'${groupKey}\', true)">ã™ã¹ã¦é¸æŠ</span>\n          <span class="group-toggle" onclick="toggleGroup(\'${groupKey}\', false)" style="margin-left:10px;">è§£é™¤</span>\n        `;\n        groupDiv.appendChild(header);\n        \n        group.settings.forEach(setting => {\n          const itemDiv = document.createElement(\'div\');\n          itemDiv.className = \'setting-item\';\n          \n          const displayValue = setting.value || \'(æœªè¨­å®š)\';\n          const truncatedValue = displayValue.length > 30 \n            ? displayValue.substring(0, 30) + \'...\' \n            : displayValue;\n          \n          itemDiv.innerHTML = `\n            <input type="checkbox" class="setting-checkbox" data-group="${groupKey}" value="${setting.key}" checked>\n            <span class="setting-label">${setting.label}</span>\n            <span class="setting-value" title="${displayValue}">${truncatedValue}</span>\n          `;\n          groupDiv.appendChild(itemDiv);\n        });\n        \n        container.appendChild(groupDiv);\n      }\n    }\n    \n    // ã‚°ãƒ«ãƒ¼ãƒ—ã®ä¸€æ‹¬é¸æŠ/è§£é™¤\n    function toggleGroup(groupKey, checked) {\n      const checkboxes = document.querySelectorAll(`.setting-checkbox[data-group="${groupKey}"]`);\n      checkboxes.forEach(cb => cb.checked = checked);\n    }\n    \n    // ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ\n    function executeImport() {\n      const sourceUrl = document.getElementById(\'sourceUrl\').value.trim();\n      const mode = document.querySelector(\'input[name="importMode"]:checked\').value;\n      \n      let selectedKeys = [];\n      if (mode === \'selected\') {\n        const checkboxes = document.querySelectorAll(\'.setting-checkbox:checked\');\n        selectedKeys = Array.from(checkboxes).map(cb => cb.value);\n        \n        if (selectedKeys.length === 0) {\n          showMessage(\'error\', \'âŒ è¨­å®šé …ç›®ã‚’1ã¤ä»¥ä¸Šé¸æŠã—ã¦ãã ã•ã„\');\n          return;\n        }\n      }\n      \n      if (!confirm(`${mode === \'all\' ? \'ã™ã¹ã¦ã®è¨­å®š\' : selectedKeys.length + \'å€‹ã®è¨­å®š\'}ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã‹ï¼Ÿ\\n\\nâš ï¸ ç¾åœ¨ã®è¨­å®šã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚`)) {\n        return;\n      }\n      \n      showMessage(\'info\', \'<div class="loading"><div class="spinner"></div>ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­...</div>\');\n      \n      google.script.run\n        .withSuccessHandler(onImportSuccess)\n        .withFailureHandler(onError)\n        .importSelectedSettings(sourceUrl, mode, selectedKeys);\n    }\n    \n    // ã‚¤ãƒ³ãƒãƒ¼ãƒˆæˆåŠŸæ™‚\n    function onImportSuccess(result) {\n      if (!result.success) {\n        showMessage(\'error\', \'âŒ \' + result.error);\n        return;\n      }\n      \n      let message = `âœ… ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†ï¼\\n\\n`;\n      message += `ğŸ“Š ã‚¤ãƒ³ãƒãƒ¼ãƒˆå…ƒ: ${result.sourceSpreadsheet}\\n`;\n      message += `ğŸ“‹ ãƒ¢ãƒ¼ãƒ‰: ${result.mode === \'all\' ? \'å…¨éƒ¨å¼•ãç¶™ã\' : \'å€‹åˆ¥é¸æŠ\'}\\n\\n`;\n      message += `âœ… ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸè¨­å®š: ${result.imported.length}å€‹\\n`;\n      \n      if (result.imported.length > 0) {\n        message += result.imported.map(k => `  â€¢ ${k}`).join(\'\\n\') + \'\\n\';\n      }\n      \n      if (result.skipped.length > 0) {\n        message += `\\nâš ï¸ ã‚¹ã‚­ãƒƒãƒ—ã•ã‚ŒãŸè¨­å®š: ${result.skipped.length}å€‹\\n`;\n        message += result.skipped.map(k => `  â€¢ ${k}`).join(\'\\n\');\n      }\n      \n      alert(message);\n      google.script.host.close();\n    }\n    \n    // ã‚¨ãƒ©ãƒ¼å‡¦ç†\n    function onError(error) {\n      showMessage(\'error\', \'âŒ ã‚¨ãƒ©ãƒ¼: \' + error.message);\n    }\n    \n    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º\n    function showMessage(type, text) {\n      const area = document.getElementById(\'messageArea\');\n      area.innerHTML = `<div class="message ${type}">${text}</div>`;\n      \n      if (type === \'success\') {\n        setTimeout(() => area.innerHTML = \'\', 3000);\n      }\n    }\n  </script>\n</body>\n</html>';


HTML_TEMPLATES['DuplicateCheckSettings'] = '<!DOCTYPE html>\n<html>\n<head>\n  <style>\n    body { \n      font-family: Arial, sans-serif; \n      padding: 20px; \n      line-height: 1.6;\n    }\n    .form-group { \n      margin-bottom: 20px; \n    }\n    label { \n      display: block; \n      font-weight: bold; \n      margin-bottom: 5px; \n    }\n    select, input { \n      width: 100%; \n      padding: 8px; \n      border: 1px solid #ddd; \n      border-radius: 4px; \n      font-size: 14px;\n    }\n    .error-message {\n      background: #ffebee;\n      color: #c62828;\n      padding: 10px;\n      border-radius: 4px;\n      margin-bottom: 15px;\n      border-left: 4px solid #c62828;\n    }\n    .manual-input {\n      background: #fff3e0;\n      padding: 10px;\n      border-radius: 4px;\n      margin-top: 10px;\n    }\n    .target-sheets-container {\n      border: 1px solid #ddd;\n      padding: 15px;\n      background: #f9f9f9;\n      border-radius: 4px;\n      min-height: 100px;\n    }\n    .target-sheet-item {\n      display: grid;\n      grid-template-columns: 1fr 100px 80px;\n      gap: 10px;\n      margin-bottom: 15px;\n      padding: 10px;\n      background: white;\n      border-radius: 4px;\n      border: 1px solid #ddd;\n    }\n    \n    /* ğŸ†• æ–°ã—ã„å‡ºåŠ›è¨­å®šç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */\n    .section {\n      margin-bottom: 25px;\n      padding-bottom: 15px;\n      border-bottom: 1px solid #ddd;\n    }\n    .checkbox-group {\n      margin: 10px 0;\n    }\n    .checkbox-label {\n      display: flex;\n      align-items: center;\n      cursor: pointer;\n      font-size: 14px;\n    }\n    .checkbox-label input[type="checkbox"] {\n      margin-right: 8px;\n      width: auto;\n    }\n    .output-settings {\n      margin-top: 15px;\n      padding: 15px;\n      border: 1px solid #ddd;\n      border-radius: 8px;\n      background: #f9f9f9;\n    }\n    .input-row {\n      display: flex;\n      gap: 15px;\n      margin-top: 10px;\n    }\n    .input-group {\n      flex: 1;\n    }\n    \n    .buttons { \n      text-align: center; \n      margin-top: 30px;\n    }\n    .btn { \n      padding: 10px 20px; \n      margin: 0 10px; \n      border: none; \n      border-radius: 4px; \n      cursor: pointer; \n      font-size: 14px;\n    }\n    .btn-primary { background: #4CAF50; color: white; }\n    .btn-secondary { background: #6c757d; color: white; }\n    .btn-danger { background: #dc3545; color: white; }\n    .help-text { font-size: 12px; color: #666; margin-top: 5px; }\n  </style>\n</head>\n<body>\n  <div id="error-container"></div>\n  \n  <h3>é‡è¤‡ãƒã‚§ãƒƒã‚¯è¨­å®š</h3>\n  \n  <div class="form-group">\n    <label for="sourceSheet">ä½œæ¥­ã‚·ãƒ¼ãƒˆï¼ˆé‡è¤‡ã‚’ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹å´ï¼‰:</label>\n    <select id="sourceSheet">\n      <option value="">èª­ã¿è¾¼ã¿ä¸­...</option>\n    </select>\n    <div id="manualSheetInput" class="manual-input" style="display: none;">\n      <label for="manualSheet">æ‰‹å‹•å…¥åŠ›:</label>\n      <input type="text" id="manualSheet" placeholder="ã‚·ãƒ¼ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">\n      <button onclick="useManualSheet()">ã“ã®åå‰ã‚’ä½¿ç”¨</button>\n    </div>\n    <div class="help-text">ãƒ‡ãƒ¼ã‚¿å…¥åŠ›æ™‚ã«é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã‚·ãƒ¼ãƒˆã§ã™</div>\n  </div>\n  \n  <div class="form-group">\n    <label for="sourceColumn">ä½œæ¥­ã‚·ãƒ¼ãƒˆã®åˆ—:</label>\n    <select id="sourceColumn">\n      <option value="">åˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„</option>\n      <option value="A">Aåˆ—</option>\n      <option value="B">Båˆ—</option>\n      <option value="C">Cåˆ—</option>\n      <option value="D">Dåˆ—</option>\n      <option value="E">Eåˆ—</option>\n      <option value="F">Fåˆ—</option>\n      <option value="G">Gåˆ—</option>\n      <option value="H">Håˆ—</option>\n      <option value="I">Iåˆ—</option>\n      <option value="J">Jåˆ—</option>\n    </select>\n  </div>\n  \n  <div class="form-group">\n    <label>ãƒã‚§ãƒƒã‚¯å¯¾è±¡ã‚·ãƒ¼ãƒˆï¼ˆé‡è¤‡å…ƒï¼‰:</label>\n    <div id="targetSheetsContainer" class="target-sheets-container">\n      <div id="noTargetSheetsMsg">å‚ç…§ã‚·ãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</div>\n    </div>\n    <button onclick="addTargetSheetDropdown()">å‚ç…§ã‚·ãƒ¼ãƒˆè¿½åŠ </button>\n  </div>\n\n  <!-- ğŸ†• å‡ºåŠ›è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->\n  <div class="section">\n    <h4>ğŸ“¤ å‡ºåŠ›è¨­å®š</h4>\n    \n    <div class="checkbox-group">\n      <label class="checkbox-label">\n        <input type="checkbox" id="applyToSheet" name="applyToSheet">\n        ç”Ÿæˆã—ãŸå¼ã‚’ã‚·ãƒ¼ãƒˆã«ç›´æ¥é©ç”¨ã™ã‚‹\n      </label>\n    </div>\n    \n    <div id="outputSettings" class="output-settings" style="display: none;">\n      <div class="form-group">\n        <label for="outputSheet">å‡ºåŠ›å…ˆã‚·ãƒ¼ãƒˆ:</label>\n        <select id="outputSheet" name="outputSheet">\n          <option value="">ã‚·ãƒ¼ãƒˆã‚’é¸æŠ...</option>\n        </select>\n      </div>\n      \n      <div class="input-row">\n        <div class="input-group">\n          <label for="outputColumn">å‡ºåŠ›å…ˆåˆ—:</label>\n          <select id="outputColumn" name="outputColumn">\n            <option value="">åˆ—ã‚’é¸æŠ...</option>\n          </select>\n        </div>\n        \n        <div class="input-group">\n          <label for="outputStartRow">é–‹å§‹è¡Œ:</label>\n          <input type="number" id="outputStartRow" name="outputStartRow" value="1" min="1">\n        </div>\n      </div>\n      \n      <div class="form-group">\n        <label for="outputRange">é©ç”¨ç¯„å›²:</label>\n        <select id="outputRange" name="outputRange">\n          <option value="DATA">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ç¯„å›²ã¾ã§</option>\n          <option value="CUSTOM">ã‚«ã‚¹ã‚¿ãƒ ç¯„å›²ï¼ˆ100è¡Œï¼‰</option>\n          <option value="ALL">ã‚·ãƒ¼ãƒˆå…¨ä½“ï¼ˆ1000è¡Œï¼‰</option>\n        </select>\n      </div>\n      \n      <div class="help-text">\n        é¸æŠã—ãŸç¯„å›²ã«é‡è¤‡ãƒã‚§ãƒƒã‚¯æ•°å¼ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã®ã§ã”æ³¨æ„ãã ã•ã„ã€‚\n      </div>\n    </div>\n  </div>\n  \n  <div class="buttons">\n    <button class="btn btn-primary" onclick="saveSettings()">è¨­å®šã‚’ä¿å­˜ãƒ»é©ç”¨</button>\n    <button class="btn btn-danger" onclick="disableCheck()">é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ–</button>\n    <button class="btn btn-secondary" onclick="google.script.host.close()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>\n  </div>\n\n  <script>\n    var allSheetNames = [];\n    var targetSheetCounter = 0;\n    var loadAttempts = 0;\n    var maxLoadAttempts = 3;\n\n    window.onload = function() {\n      loadSheetNamesWithRetry();\n      setupEventListeners(); // ğŸ†• ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®åˆæœŸè¨­å®š\n    };\n\n    // ğŸ†• ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š\n    function setupEventListeners() {\n      var applyCheckbox = document.getElementById(\'applyToSheet\');\n      if (applyCheckbox) {\n        applyCheckbox.addEventListener(\'change\', function() {\n          var outputSettings = document.getElementById(\'outputSettings\');\n          outputSettings.style.display = this.checked ? \'block\' : \'none\';\n          \n          if (this.checked) {\n            loadOutputOptions();\n          }\n        });\n      }\n    }\n\n    function showError(message) {\n      var container = document.getElementById(\'error-container\');\n      container.innerHTML = \'<div class="error-message">\' + message + \'</div>\';\n    }\n\n    function loadSheetNamesWithRetry() {\n      loadAttempts++;\n      \n      if (loadAttempts > maxLoadAttempts) {\n        showError(\'ã‚·ãƒ¼ãƒˆåã®è‡ªå‹•å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚\');\n        enableManualMode();\n        return;\n      }\n\n      console.log(\'ã‚·ãƒ¼ãƒˆåå–å¾—è©¦è¡Œ \' + loadAttempts + \'/\' + maxLoadAttempts);\n      \n      var timeoutId = setTimeout(function() {\n        console.log(\'ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: å†è©¦è¡Œã—ã¾ã™\');\n        loadSheetNamesWithRetry();\n      }, 5000);\n\n      google.script.run\n        .withSuccessHandler(function(sheetNames) {\n          clearTimeout(timeoutId);\n          console.log(\'ã‚·ãƒ¼ãƒˆåå–å¾—æˆåŠŸ:\', sheetNames);\n          allSheetNames = sheetNames;\n          populateSourceSheetDropdown();\n          loadCurrentSettings();\n        })\n        .withFailureHandler(function(error) {\n          clearTimeout(timeoutId);\n          console.error(\'ã‚·ãƒ¼ãƒˆåå–å¾—ã‚¨ãƒ©ãƒ¼:\', error);\n          loadSheetNamesWithRetry();\n        })\n        .getAllSheetNames();\n    }\n\n    // ğŸ†• å‡ºåŠ›ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’èª­ã¿è¾¼ã¿\nfunction loadOutputOptions() {\n  // ã‚·ãƒ¼ãƒˆä¸€è¦§ã‚’å–å¾—ï¼ˆã‚¨ãƒ©ãƒ¼å‡¦ç†ä»˜ãï¼‰\n  google.script.run\n    .withSuccessHandler(function(sheets) {\n      var select = document.getElementById(\'outputSheet\');\n      if (select) {\n        select.innerHTML = \'<option value="">ã‚·ãƒ¼ãƒˆã‚’é¸æŠ...</option>\';\n        if (sheets && sheets.length > 0) {\n          sheets.forEach(function(sheet) {\n            var option = document.createElement(\'option\');\n            option.value = sheet;\n            option.textContent = sheet;\n            select.appendChild(option);\n          });\n        } else {\n          // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: allSheetNames ã‚’ä½¿ç”¨\n          allSheetNames.forEach(function(sheet) {\n            var option = document.createElement(\'option\');\n            option.value = sheet;\n            option.textContent = sheet;\n            select.appendChild(option);\n          });\n        }\n      }\n    })\n    .withFailureHandler(function(error) {\n      console.error(\'å‡ºåŠ›å…ˆã‚·ãƒ¼ãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼:\', error);\n      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†\n      var select = document.getElementById(\'outputSheet\');\n      if (select && allSheetNames.length > 0) {\n        select.innerHTML = \'<option value="">ã‚·ãƒ¼ãƒˆã‚’é¸æŠ...</option>\';\n        allSheetNames.forEach(function(sheet) {\n          var option = document.createElement(\'option\');\n          option.value = sheet;\n          option.textContent = sheet;\n          select.appendChild(option);\n        });\n      }\n    })\n    .getOutputAvailableSheets();\n    \n  // åˆ—ä¸€è¦§ã‚’æ‰‹å‹•ã§è¨­å®šï¼ˆAEåˆ—ã¾ã§å¯¾å¿œï¼‰\n  var columnSelect = document.getElementById(\'outputColumn\');\n  if (columnSelect) {\n    columnSelect.innerHTML = \'<option value="">åˆ—ã‚’é¸æŠ...</option>\';\n    \n    // Aï½Zåˆ—ï¼ˆ1ï½26åˆ—ï¼‰\n    for (var i = 0; i < 26; i++) {\n      var col = String.fromCharCode(65 + i);\n      var option = document.createElement(\'option\');\n      option.value = col;\n      option.textContent = col + \'åˆ—\';\n      columnSelect.appendChild(option);\n    }\n    \n    // AAï½AZåˆ—ï¼ˆ27ï½52åˆ—ï¼‰\n    for (var i = 0; i < 26; i++) {\n      var col = \'A\' + String.fromCharCode(65 + i);\n      var option = document.createElement(\'option\');\n      option.value = col;\n      option.textContent = col + \'åˆ—\';\n      columnSelect.appendChild(option);\n    }\n  }\n} // â† ã“ã®é–‰ã˜æ‹¬å¼§ãŒé‡è¦ï¼\n\n    function enableManualMode() {\n      var sourceSelect = document.getElementById(\'sourceSheet\');\n      sourceSelect.innerHTML = \'<option value="">æ‰‹å‹•å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã§ã™</option>\';\n      document.getElementById(\'manualSheetInput\').style.display = \'block\';\n      \n      addTargetSheetDropdown();\n    }\n\n    function useManualSheet() {\n      var manualSheet = document.getElementById(\'manualSheet\').value.trim();\n      if (!manualSheet) {\n        alert(\'ã‚·ãƒ¼ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\');\n        return;\n      }\n      \n      var sourceSelect = document.getElementById(\'sourceSheet\');\n      sourceSelect.innerHTML = \'\';\n      var option = document.createElement(\'option\');\n      option.value = manualSheet;\n      option.textContent = manualSheet + \' (æ‰‹å‹•å…¥åŠ›)\';\n      option.selected = true;\n      sourceSelect.appendChild(option);\n      \n      document.getElementById(\'manualSheetInput\').style.display = \'none\';\n    }\n\n    function populateSourceSheetDropdown() {\n      var sourceSelect = document.getElementById(\'sourceSheet\');\n      sourceSelect.innerHTML = \'<option value="">ã‚·ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</option>\';\n      \n      allSheetNames.forEach(function(name) {\n        var option = document.createElement(\'option\');\n        option.value = name;\n        option.textContent = name;\n        sourceSelect.appendChild(option);\n      });\n    }\n\n    function addTargetSheetDropdown() {\n      var container = document.getElementById(\'targetSheetsContainer\');\n      var noMsgDiv = document.getElementById(\'noTargetSheetsMsg\');\n      if (noMsgDiv) noMsgDiv.style.display = \'none\';\n      \n      targetSheetCounter++;\n      var itemDiv = document.createElement(\'div\');\n      itemDiv.className = \'target-sheet-item\';\n      itemDiv.id = \'targetSheet_\' + targetSheetCounter;\n      \n      var sheetDiv = document.createElement(\'div\');\n      if (allSheetNames.length > 0) {\n        var sheetSelect = document.createElement(\'select\');\n        sheetSelect.className = \'target-sheet-select\';\n        sheetSelect.innerHTML = \'<option value="">å‚ç…§ã‚·ãƒ¼ãƒˆã‚’é¸æŠ</option>\';\n        \n        allSheetNames.forEach(function(name) {\n          var option = document.createElement(\'option\');\n          option.value = name;\n          option.textContent = name;\n          sheetSelect.appendChild(option);\n        });\n        \n        var specialOption = document.createElement(\'option\');\n        specialOption.value = \'ä¿å­˜ãƒ‡ãƒ¼ã‚¿_*\';\n        specialOption.textContent = \'ä¿å­˜ãƒ‡ãƒ¼ã‚¿_* (ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒ)\';\n        sheetSelect.appendChild(specialOption);\n        \n        sheetDiv.appendChild(sheetSelect);\n      } else {\n        var sheetInput = document.createElement(\'input\');\n        sheetInput.type = \'text\';\n        sheetInput.className = \'target-sheet-input\';\n        sheetInput.placeholder = \'ã‚·ãƒ¼ãƒˆåã‚’å…¥åŠ›\';\n        sheetDiv.appendChild(sheetInput);\n      }\n      \n      var columnDiv = document.createElement(\'div\');\n      var columnSelect = document.createElement(\'select\');\n      columnSelect.className = \'target-column-select\';\n      columnSelect.innerHTML = \'<option value="">åˆ—é¸æŠ</option>\';\n      [\'A\',\'B\',\'C\',\'D\',\'E\',\'F\',\'G\',\'H\',\'I\',\'J\'].forEach(function(col) {\n        var option = document.createElement(\'option\');\n        option.value = col;\n        option.textContent = col + \'åˆ—\';\n        if (col === \'H\') option.selected = true;\n        columnSelect.appendChild(option);\n      });\n      columnDiv.appendChild(columnSelect);\n      \n      var removeBtn = document.createElement(\'button\');\n      removeBtn.textContent = \'å‰Šé™¤\';\n      removeBtn.onclick = function() {\n        itemDiv.remove();\n        if (container.querySelectorAll(\'.target-sheet-item\').length === 0) {\n          if (noMsgDiv) noMsgDiv.style.display = \'block\';\n        }\n      };\n      \n      itemDiv.appendChild(sheetDiv);\n      itemDiv.appendChild(columnDiv);\n      itemDiv.appendChild(removeBtn);\n      container.appendChild(itemDiv);\n    }\n\n    function loadCurrentSettings() {\n      google.script.run\n        .withSuccessHandler(function(settings) {\n          if (settings && settings.sourceSheet) {\n            document.getElementById(\'sourceSheet\').value = settings.sourceSheet;\n            document.getElementById(\'sourceColumn\').value = settings.sourceColumn;\n          }\n        })\n        .withFailureHandler(function(error) {\n          console.error(\'è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:\', error);\n        })\n        .getDuplicateCheckSettings();\n    }\n\n    function saveSettings() {\n      var sourceSheet = document.getElementById(\'sourceSheet\').value;\n      var sourceColumn = document.getElementById(\'sourceColumn\').value;\n      \n      var targetSheets = [];\n      var targetItems = document.querySelectorAll(\'.target-sheet-item\');\n      \n      targetItems.forEach(function(item) {\n        var sheetSelect = item.querySelector(\'.target-sheet-select\');\n        var columnSelect = item.querySelector(\'.target-column-select\');\n        \n        if (sheetSelect && sheetSelect.value && columnSelect && columnSelect.value) {\n          targetSheets.push({\n            sheet: sheetSelect.value,\n            column: columnSelect.value\n          });\n        }\n      });\n      \n      if (!sourceSheet || !sourceColumn || targetSheets.length === 0) {\n        alert(\'ã™ã¹ã¦ã®é …ç›®ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚\');\n        return;\n      }\n      \n      // ğŸ†• å‡ºåŠ›è¨­å®šã‚’å«ã‚ã‚‹ã‚ˆã†ã«ä¿®æ­£\n      var formData = {\n        sourceSheet: sourceSheet,\n        sourceColumn: sourceColumn,\n        targetSheets: targetSheets\n      };\n      \n      var applyCheckbox = document.getElementById(\'applyToSheet\');\n      if (applyCheckbox && applyCheckbox.checked) {\n        formData.outputSheet = document.getElementById(\'outputSheet\').value;\n        formData.outputColumn = document.getElementById(\'outputColumn\').value;\n        formData.outputStartRow = document.getElementById(\'outputStartRow\').value;\n        formData.outputRange = document.getElementById(\'outputRange\').value;\n      }\n      \n      google.script.run\n        .withSuccessHandler(function(result) {\n          if (result.success) {\n            if (result.applied) {\n              alert(\'é‡è¤‡ãƒã‚§ãƒƒã‚¯å¼ã‚’ç”Ÿæˆã—ã€\' + result.appliedRange + \'ã«é©ç”¨ã—ã¾ã—ãŸï¼ˆ\' + result.appliedCount + \'è¡Œï¼‰ã€‚\');\n              google.script.host.close();\n            } else if (result.formula) {\n              // å¾“æ¥é€šã‚Šã®è¡¨ç¤º\n              document.body.innerHTML += `\n                <div style="margin-top: 20px; padding: 15px; border: 2px solid #28a745; background: #f8f9fa;">\n                  <h4>ç”Ÿæˆã•ã‚ŒãŸé–¢æ•°</h4>\n                  <p>ä»¥ä¸‹ã®é–¢æ•°ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€${sourceSheet}ã®éš£ã®åˆ—ï¼ˆä¾‹ï¼šIåˆ—ï¼‰ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼š</p>\n                  <textarea id="generatedFormula" style="width: 100%; height: 80px; font-family: monospace; font-size: 14px;" readonly>${result.formula}</textarea>\n                  <br><br>\n                  <button onclick="copyFormula()" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px;">é–¢æ•°ã‚’ã‚³ãƒ”ãƒ¼</button>\n                  <button onclick="google.script.host.close()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; margin-left: 10px;">é–‰ã˜ã‚‹</button>\n                </div>\n              `;\n              \n              var textarea = document.getElementById(\'generatedFormula\');\n              textarea.focus();\n              textarea.select();\n            } else {\n              alert(result.message);\n              google.script.host.close();\n            }\n          } else {\n            alert(\'ã‚¨ãƒ©ãƒ¼: \' + result.error);\n          }\n        })\n        .withFailureHandler(function(error) {\n          alert(\'ä¿å­˜ã‚¨ãƒ©ãƒ¼: \' + error.message);\n        })\n        .saveDuplicateCheckSettings(formData);\n    }\n\n    function copyFormula() {\n      var textarea = document.getElementById(\'generatedFormula\');\n      textarea.select();\n      document.execCommand(\'copy\');\n      alert(\'é–¢æ•°ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\');\n    }\n\n    function disableCheck() {\n      if (confirm(\'é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã™ã‹ï¼Ÿ\')) {\n        google.script.run\n          .withSuccessHandler(function() {\n            alert(\'é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã—ãŸã€‚\');\n            google.script.host.close();\n          })\n          .disableDuplicateCheck();\n      }\n    }\n  </script>\n</body>\n</html>';


HTML_TEMPLATES['UnifiedCategoryDialog'] = '<!DOCTYPE html>\n<html>\n<head>\n  <base target="_top">\n  <style>\n    * {\n      box-sizing: border-box;\n    }\n    \n    body {\n      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;\n      padding: 0;\n      margin: 0;\n      background: #fff;\n      color: #333;\n      line-height: 1.6;\n    }\n    \n    .container {\n      max-width: 600px;\n      margin: 0 auto;\n      padding: 30px 30px 100px 30px;\n    }\n    \n    h2 {\n      font-size: 22px;\n      margin: 0 0 8px 0;\n      font-weight: 600;\n      color: #1a1a1a;\n    }\n    \n    .subtitle {\n      color: #666;\n      font-size: 14px;\n      margin: 0 0 30px 0;\n    }\n    \n    .prev-settings {\n      background: #f5f5f5;\n      padding: 15px;\n      border-radius: 8px;\n      margin-bottom: 30px;\n      font-size: 13px;\n      display: none;\n    }\n    \n    .prev-settings.show {\n      display: block;\n    }\n    \n    .prev-settings-label {\n      font-weight: 600;\n      margin-bottom: 5px;\n      color: #333;\n    }\n    \n    .prev-settings-value {\n      color: #666;\n    }\n    \n    .section {\n      margin-bottom: 35px;\n    }\n    \n    .section.hidden {\n      display: none;\n    }\n    \n    .section-title {\n      font-size: 15px;\n      font-weight: 600;\n      margin-bottom: 15px;\n      color: #1a1a1a;\n    }\n    \n    .radio-group {\n      display: flex;\n      flex-direction: column;\n      gap: 10px;\n    }\n    \n    .radio-item {\n      border: 1px solid #ddd;\n      border-radius: 6px;\n      padding: 14px 16px;\n      cursor: pointer;\n      transition: all 0.15s ease;\n      background: #fff;\n    }\n    \n    .radio-item:hover {\n      border-color: #999;\n      background: #fafafa;\n    }\n    \n    .radio-item.selected {\n      border-color: #2196F3;\n      background: #f0f8ff;\n    }\n    \n    .radio-item input[type="radio"] {\n      margin: 0 10px 0 0;\n      vertical-align: middle;\n    }\n    \n    .radio-label {\n      font-size: 14px;\n      font-weight: 500;\n      color: #333;\n      vertical-align: middle;\n    }\n    \n    .radio-desc {\n      font-size: 12px;\n      color: #666;\n      margin: 6px 0 0 26px;\n      line-height: 1.5;\n    }\n    \n    .warning {\n      background: #fff3cd;\n      border-left: 3px solid #ffc107;\n      padding: 12px;\n      margin-top: 15px;\n      font-size: 12px;\n      border-radius: 4px;\n      display: none;\n    }\n    \n    .warning.show {\n      display: block;\n    }\n    \n    select {\n      width: 100%;\n      padding: 10px 12px;\n      border: 1px solid #ddd;\n      border-radius: 6px;\n      font-size: 14px;\n      background: #fff;\n      margin-top: 10px;\n      cursor: pointer;\n    }\n    \n    select:focus {\n      outline: none;\n      border-color: #2196F3;\n    }\n    \n    .buttons {\n      position: fixed;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      background: #fff;\n      padding: 16px 20px;\n      box-shadow: 0 -2px 8px rgba(0,0,0,0.08);\n      display: flex;\n      justify-content: center;\n      gap: 10px;\n    }\n    \n    .btn {\n      padding: 11px 24px;\n      font-size: 14px;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      font-weight: 500;\n      transition: all 0.15s ease;\n    }\n    \n    .btn-primary {\n      background: #2196F3;\n      color: white;\n    }\n    \n    .btn-primary:hover {\n      background: #1976D2;\n    }\n    \n    .btn-primary:disabled {\n      background: #ccc;\n      cursor: not-allowed;\n    }\n    \n    .btn-quick {\n      background: #4CAF50;\n      color: white;\n    }\n    \n    .btn-quick:hover {\n      background: #45a049;\n    }\n    \n    .btn-secondary {\n      background: #f5f5f5;\n      color: #333;\n      border: 1px solid #ddd;\n    }\n    \n    .btn-secondary:hover {\n      background: #e8e8e8;\n    }\n  </style>\n</head>\n<body>\n  <div class="container">\n    <h2>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‹ãƒãƒªã‚·ãƒ¼è¨­å®š</h2>\n    <p class="subtitle">é¸æŠç¯„å›²ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã‚·ãƒƒãƒ”ãƒ³ã‚°ãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã—ã¾ã™</p>\n    \n    <div class="prev-settings" id="prevSettings">\n      <div class="prev-settings-label">å‰å›ã®è¨­å®š</div>\n      <div class="prev-settings-value" id="prevSettingsValue"></div>\n    </div>\n    \n    <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‡ºåŠ›æ–¹æ³• -->\n    <div class="section">\n      <div class="section-title">1. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‡ºåŠ›æ–¹æ³•</div>\n      <div class="radio-group">\n        <label class="radio-item selected" onclick="selectTemplateMode(\'auto\')">\n          <input type="radio" name="templateMode" value="auto" checked>\n          <span class="radio-label">è‡ªå‹•å‡ºåŠ›ï¼ˆæ¨å¥¨ï¼‰</span>\n          <div class="radio-desc">Policy_Masterã‹ã‚‰è‡ªå‹•åˆ¤å®š</div>\n        </label>\n        \n        <label class="radio-item" onclick="selectTemplateMode(\'manual\')">\n          <input type="radio" name="templateMode" value="manual">\n          <span class="radio-label">æ‰‹å‹•å…¥åŠ›</span>\n          <div class="radio-desc">Eåˆ—ã‚’ç©ºæ¬„ã«ã—ã¦å¾Œã§æ‰‹å‹•å…¥åŠ›</div>\n        </label>\n      </div>\n      \n      <div class="warning" id="manualWarning">\n        âš ï¸ æ‰‹å‹•ãƒ¢ãƒ¼ãƒ‰ã§ã¯Eåˆ—ã¯ç©ºæ¬„ã«ãªã‚Šã¾ã™\n      </div>\n    </div>\n    \n    <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåé¸æŠ -->\n    <div class="section" id="templateNameSection">\n      <div class="section-title">2. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå</div>\n      <div class="radio-group" id="templateNameOptions">\n        <div style="text-align: center; padding: 20px; color: #999;">èª­ã¿è¾¼ã¿ä¸­...</div>\n      </div>\n    </div>\n    \n    <!-- é€æ–™ä¸Šé™ã‚«ãƒ†ã‚´ãƒªãƒ¼ -->\n    <div class="section">\n      <div class="section-title" id="categoryTitle">3. é€æ–™ä¸Šé™ã‚«ãƒ†ã‚´ãƒªãƒ¼</div>\n      <div class="radio-group">\n        <label class="radio-item" onclick="selectCategory(\'general\')">\n          <input type="radio" name="category" value="general">\n          <span class="radio-label">æ±ç”¨ï¼ˆä¸Šé™ãªã—ï¼‰</span>\n          <div class="radio-desc">Electronicsã€Clothingãªã©</div>\n        </label>\n        \n        <label class="radio-item" onclick="selectCategory(\'videogames\')">\n          <input type="radio" name="category" value="videogames">\n          <span class="radio-label">Video Gamesï¼ˆ$20ï¼‰</span>\n        </label>\n        \n        <label class="radio-item" onclick="selectCategory(\'books\')">\n          <input type="radio" name="category" value="books">\n          <span class="radio-label">Booksï¼ˆ$20ï¼‰</span>\n        </label>\n        \n        <label class="radio-item" onclick="selectCategory(\'movies\')">\n          <input type="radio" name="category" value="movies">\n          <span class="radio-label">Movies & TVï¼ˆ$20ï¼‰</span>\n        </label>\n        \n        <label class="radio-item" onclick="selectCategory(\'music\')">\n          <input type="radio" name="category" value="music">\n          <span class="radio-label">Musicï¼ˆ$25ï¼‰</span>\n        </label>\n        \n        <label class="radio-item" onclick="selectCategory(\'console\')">\n          <input type="radio" name="category" value="console">\n          <span class="radio-label">Game Consolesï¼ˆ$50ï¼‰</span>\n        </label>\n      </div>\n    </div>\n    \n    <!-- ãƒãƒªã‚·ãƒ¼å‡ºåŠ›æ–¹æ³• -->\n    <div class="section">\n      <div class="section-title">4. ãƒãƒªã‚·ãƒ¼å‡ºåŠ›æ–¹æ³•</div>\n      <div class="radio-group">\n        <label class="radio-item selected" onclick="selectPolicyMode(\'auto\')">\n          <input type="radio" name="policyMode" value="auto" checked>\n          <span class="radio-label">è‡ªå‹•åˆ¤å®šï¼ˆæ¨å¥¨ï¼‰</span>\n          <div class="radio-desc">ä¾¡æ ¼ãƒ»çŠ¶æ…‹ãƒ»é…é€æ–¹æ³•ã‹ã‚‰è‡ªå‹•é¸æŠ</div>\n        </label>\n        \n        <label class="radio-item" onclick="selectPolicyMode(\'manual\')">\n          <input type="radio" name="policyMode" value="manual">\n          <span class="radio-label">æ‰‹å‹•é¸æŠ</span>\n          <div class="radio-desc">ç‰¹å®šã®ãƒãƒªã‚·ãƒ¼ã‚’æŒ‡å®š</div>\n        </label>\n      </div>\n      \n      <div id="manualPolicySection" style="display: none;">\n        <select id="manualPolicySelect">\n          <option value="">èª­ã¿è¾¼ã¿ä¸­...</option>\n        </select>\n      </div>\n    </div>\n  </div>\n  \n  <div class="buttons">\n    <button class="btn btn-quick" id="quickApplyBtn" onclick="applyPreviousSettings()" style="display: none;">å‰å›ã®è¨­å®šã§é©ç”¨</button>\n    <button class="btn btn-primary" id="applyBtn" onclick="applySettings()" disabled>é©ç”¨</button>\n    <button class="btn btn-secondary" onclick="google.script.host.close()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>\n  </div>\n  \n  <script>\n    var selectedCategory = null;\n    var selectedTemplateName = null;\n    var selectedTemplateMode = \'auto\';\n    var selectedPolicyMode = \'auto\';\n    var selectedManualPolicyId = null;\n    var previousSettings = null;\n    \n    window.onload = function() {\n      loadPreviousSettings();\n      loadTemplateNames();\n      loadManualPolicies();\n    };\n    \n    function loadPreviousSettings() {\n      google.script.run\n        .withSuccessHandler(function(settings) {\n          if (settings) {\n            previousSettings = settings;\n            displayPreviousSettings(settings);\n            restorePreviousSettings(settings);\n          }\n        })\n        .withFailureHandler(function(error) {\n          console.log(\'å‰å›è¨­å®šã®èª­ã¿è¾¼ã¿å¤±æ•—:\', error);\n        })\n        .getPreviousSettings();\n    }\n    \n    function displayPreviousSettings(settings) {\n      var valueEl = document.getElementById(\'prevSettingsValue\');\n      var boxEl = document.getElementById(\'prevSettings\');\n      var quickBtn = document.getElementById(\'quickApplyBtn\');\n      \n      var parts = [];\n      \n      if (settings.templateMode === \'auto\' && settings.templateName) {\n        parts.push(\'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: \' + settings.templateName);\n      } else if (settings.templateMode === \'manual\') {\n        parts.push(\'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: æ‰‹å‹•\');\n      }\n      \n      var categoryNames = {\n        \'general\': \'æ±ç”¨\',\n        \'videogames\': \'Video Games\',\n        \'books\': \'Books\',\n        \'movies\': \'Movies & TV\',\n        \'music\': \'Music\',\n        \'console\': \'Game Consoles\'\n      };\n      if (settings.category) {\n        parts.push(\'ã‚«ãƒ†ã‚´ãƒªãƒ¼: \' + categoryNames[settings.category]);\n      }\n      \n      if (settings.policyMode === \'auto\') {\n        parts.push(\'ãƒãƒªã‚·ãƒ¼: è‡ªå‹•\');\n      } else if (settings.policyMode === \'manual\' && settings.manualPolicyId) {\n        parts.push(\'ãƒãƒªã‚·ãƒ¼: ID \' + settings.manualPolicyId);\n      }\n      \n      valueEl.textContent = parts.join(\' / \');\n      boxEl.classList.add(\'show\');\n      quickBtn.style.display = \'inline-block\';\n    }\n    \n    function restorePreviousSettings(settings) {\n      setTimeout(function() {\n        if (settings.category) {\n          selectCategoryByValue(settings.category);\n        }\n        \n        if (settings.templateMode) {\n          selectTemplateModeByValue(settings.templateMode);\n        }\n        \n        if (settings.templateMode === \'auto\' && settings.templateName) {\n          selectTemplateNameByValue(settings.templateName);\n        }\n        \n        if (settings.policyMode) {\n          selectPolicyModeByValue(settings.policyMode);\n        }\n        \n        if (settings.policyMode === \'manual\' && settings.manualPolicyId) {\n          var select = document.getElementById(\'manualPolicySelect\');\n          if (select) {\n            select.value = settings.manualPolicyId;\n            selectedManualPolicyId = settings.manualPolicyId;\n          }\n        }\n        \n        updateApplyButton();\n      }, 500);\n    }\n    \n    function selectCategoryByValue(value) {\n      var items = document.querySelectorAll(\'input[name="category"]\');\n      items.forEach(function(radio) {\n        if (radio.value === value) {\n          radio.closest(\'.radio-item\').classList.add(\'selected\');\n          radio.checked = true;\n          selectedCategory = value;\n        }\n      });\n    }\n    \n    function selectTemplateModeByValue(value) {\n      var items = document.querySelectorAll(\'input[name="templateMode"]\');\n      items.forEach(function(radio) {\n        if (radio.value === value) {\n          radio.closest(\'.radio-item\').classList.add(\'selected\');\n          radio.checked = true;\n          selectedTemplateMode = value;\n          \n          var warning = document.getElementById(\'manualWarning\');\n          var templateSection = document.getElementById(\'templateNameSection\');\n          var categoryTitle = document.getElementById(\'categoryTitle\');\n          \n          if (value === \'manual\') {\n            warning.classList.add(\'show\');\n            templateSection.classList.add(\'hidden\');\n            categoryTitle.textContent = \'2. é€æ–™ä¸Šé™ã‚«ãƒ†ã‚´ãƒªãƒ¼\';\n          } else {\n            warning.classList.remove(\'show\');\n            templateSection.classList.remove(\'hidden\');\n            categoryTitle.textContent = \'3. é€æ–™ä¸Šé™ã‚«ãƒ†ã‚´ãƒªãƒ¼\';\n          }\n        }\n      });\n    }\n    \n    function selectTemplateNameByValue(value) {\n      var items = document.querySelectorAll(\'input[name="templateName"]\');\n      items.forEach(function(radio) {\n        if (radio.value === value) {\n          radio.closest(\'.radio-item\').classList.add(\'selected\');\n          radio.checked = true;\n          selectedTemplateName = value;\n        }\n      });\n    }\n    \n    function selectPolicyModeByValue(value) {\n      var items = document.querySelectorAll(\'input[name="policyMode"]\');\n      items.forEach(function(radio) {\n        if (radio.value === value) {\n          radio.closest(\'.radio-item\').classList.add(\'selected\');\n          radio.checked = true;\n          selectedPolicyMode = value;\n          \n          var manualSection = document.getElementById(\'manualPolicySection\');\n          if (value === \'manual\') {\n            manualSection.style.display = \'block\';\n          } else {\n            manualSection.style.display = \'none\';\n          }\n        }\n      });\n    }\n    \n    function applyPreviousSettings() {\n      if (!previousSettings) return;\n      \n      var btn = document.getElementById(\'quickApplyBtn\');\n      btn.disabled = true;\n      btn.textContent = \'å‡¦ç†ä¸­...\';\n      \n      google.script.run\n        .withSuccessHandler(function() {\n          google.script.host.close();\n        })\n        .withFailureHandler(function(error) {\n          alert(\'ã‚¨ãƒ©ãƒ¼: \' + error.message);\n          btn.disabled = false;\n          btn.textContent = \'å‰å›ã®è¨­å®šã§é©ç”¨\';\n        })\n        .applyUnifiedSettings(\n          previousSettings.category,\n          previousSettings.templateName,\n          previousSettings.templateMode,\n          previousSettings.policyMode,\n          previousSettings.manualPolicyId\n        );\n    }\n    \n    function loadTemplateNames() {\n      google.script.run\n        .withSuccessHandler(function(templateNames) {\n          renderTemplateOptions(templateNames);\n        })\n        .withFailureHandler(function(error) {\n          document.getElementById(\'templateNameOptions\').innerHTML = \n            \'<div style="text-align: center; color: red;">èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</div>\';\n        })\n        .getTemplateNameList();\n    }\n    \n    function loadManualPolicies() {\n      google.script.run\n        .withSuccessHandler(function(policies) {\n          renderManualPolicyOptions(policies);\n        })\n        .withFailureHandler(function(error) {\n          document.getElementById(\'manualPolicySelect\').innerHTML = \n            \'<option value="">èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</option>\';\n        })\n        .getManualPolicies();\n    }\n    \n    function renderTemplateOptions(templateNames) {\n      var container = document.getElementById(\'templateNameOptions\');\n      container.innerHTML = \'\';\n      \n      if (!templateNames || templateNames.length === 0) {\n        container.innerHTML = \'<div style="text-align: center; color: #999;">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãªã—</div>\';\n        return;\n      }\n      \n      templateNames.forEach(function(name) {\n        var label = document.createElement(\'label\');\n        label.className = \'radio-item\';\n        label.onclick = function() { selectTemplateName(name); };\n        \n        var radio = document.createElement(\'input\');\n        radio.type = \'radio\';\n        radio.name = \'templateName\';\n        radio.value = name;\n        \n        var span = document.createElement(\'span\');\n        span.className = \'radio-label\';\n        span.textContent = name;\n        \n        label.appendChild(radio);\n        label.appendChild(span);\n        container.appendChild(label);\n      });\n    }\n    \n    function renderManualPolicyOptions(policies) {\n      var select = document.getElementById(\'manualPolicySelect\');\n      select.innerHTML = \'<option value="">é¸æŠã—ã¦ãã ã•ã„</option>\';\n      \n      if (!policies || policies.length === 0) {\n        select.innerHTML = \'<option value="">ãƒãƒªã‚·ãƒ¼ãªã—</option>\';\n        return;\n      }\n      \n      policies.forEach(function(policy) {\n        var option = document.createElement(\'option\');\n        option.value = policy.id;\n        option.textContent = \'ID \' + policy.id + \': \' + policy.name;\n        select.appendChild(option);\n      });\n      \n      select.onchange = function() {\n        selectedManualPolicyId = this.value;\n        updateApplyButton();\n      };\n    }\n    \n    function selectTemplateMode(mode) {\n      selectedTemplateMode = mode;\n      \n      var items = document.querySelectorAll(\'input[name="templateMode"]\');\n      items.forEach(function(radio) {\n        radio.closest(\'.radio-item\').classList.remove(\'selected\');\n      });\n      \n      event.currentTarget.classList.add(\'selected\');\n      event.currentTarget.querySelector(\'input\').checked = true;\n      \n      var warning = document.getElementById(\'manualWarning\');\n      var templateSection = document.getElementById(\'templateNameSection\');\n      var categoryTitle = document.getElementById(\'categoryTitle\');\n      \n      if (mode === \'manual\') {\n        warning.classList.add(\'show\');\n        templateSection.classList.add(\'hidden\');\n        categoryTitle.textContent = \'2. é€æ–™ä¸Šé™ã‚«ãƒ†ã‚´ãƒªãƒ¼\';\n        selectedTemplateName = null;\n      } else {\n        warning.classList.remove(\'show\');\n        templateSection.classList.remove(\'hidden\');\n        categoryTitle.textContent = \'3. é€æ–™ä¸Šé™ã‚«ãƒ†ã‚´ãƒªãƒ¼\';\n      }\n      \n      updateApplyButton();\n    }\n    \n    function selectTemplateName(name) {\n      selectedTemplateName = name;\n      \n      var items = document.querySelectorAll(\'input[name="templateName"]\');\n      items.forEach(function(radio) {\n        radio.closest(\'.radio-item\').classList.remove(\'selected\');\n      });\n      \n      event.currentTarget.classList.add(\'selected\');\n      event.currentTarget.querySelector(\'input\').checked = true;\n      \n      updateApplyButton();\n    }\n    \n    function selectCategory(value) {\n      selectedCategory = value;\n      \n      var items = document.querySelectorAll(\'input[name="category"]\');\n      items.forEach(function(radio) {\n        radio.closest(\'.radio-item\').classList.remove(\'selected\');\n      });\n      \n      event.currentTarget.classList.add(\'selected\');\n      event.currentTarget.querySelector(\'input\').checked = true;\n      \n      updateApplyButton();\n    }\n    \n    function selectPolicyMode(mode) {\n      selectedPolicyMode = mode;\n      \n      var items = document.querySelectorAll(\'input[name="policyMode"]\');\n      items.forEach(function(radio) {\n        radio.closest(\'.radio-item\').classList.remove(\'selected\');\n      });\n      \n      event.currentTarget.classList.add(\'selected\');\n      event.currentTarget.querySelector(\'input\').checked = true;\n      \n      var manualSection = document.getElementById(\'manualPolicySection\');\n      if (mode === \'manual\') {\n        manualSection.style.display = \'block\';\n      } else {\n        manualSection.style.display = \'none\';\n        selectedManualPolicyId = null;\n      }\n      \n      updateApplyButton();\n    }\n    \n    function updateApplyButton() {\n      var btn = document.getElementById(\'applyBtn\');\n      \n      var templateOk = (selectedTemplateMode === \'manual\') || selectedTemplateName;\n      var categoryOk = selectedCategory;\n      var policyOk = (selectedPolicyMode === \'auto\') || selectedManualPolicyId;\n      \n      btn.disabled = !(templateOk && categoryOk && policyOk);\n    }\n    \n    function applySettings() {\n      if (!selectedCategory) {\n        alert(\'ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„\');\n        return;\n      }\n      \n      if (selectedTemplateMode === \'auto\' && !selectedTemplateName) {\n        alert(\'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåã‚’é¸æŠã—ã¦ãã ã•ã„\');\n        return;\n      }\n      \n      if (selectedPolicyMode === \'manual\' && !selectedManualPolicyId) {\n        alert(\'ãƒãƒªã‚·ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„\');\n        return;\n      }\n      \n      var btn = document.getElementById(\'applyBtn\');\n      btn.disabled = true;\n      btn.textContent = \'å‡¦ç†ä¸­...\';\n      \n      var settings = {\n        category: selectedCategory,\n        templateName: selectedTemplateName,\n        templateMode: selectedTemplateMode,\n        policyMode: selectedPolicyMode,\n        manualPolicyId: selectedManualPolicyId\n      };\n      \n      google.script.run\n        .withSuccessHandler(function() {\n          google.script.host.close();\n        })\n        .withFailureHandler(function(error) {\n          alert(\'ã‚¨ãƒ©ãƒ¼: \' + error.message);\n          btn.disabled = false;\n          btn.textContent = \'é©ç”¨\';\n        })\n        .applyUnifiedSettingsWithSave(\n          selectedCategory,\n          selectedTemplateName,\n          selectedTemplateMode,\n          selectedPolicyMode,\n          selectedManualPolicyId,\n          settings\n        );\n    }\n  </script>\n</body>\n</html>';


HTML_TEMPLATES['UnifiedDataImportDialog'] = '<!DOCTYPE html>\n<html>\n<head>\n  <base target="_top">\n  <style>\n    * {\n      box-sizing: border-box;\n    }\n    \n    body {\n      font-family: \'Google Sans\', Arial, sans-serif;\n      padding: 0;\n      margin: 0;\n      font-size: 13px;\n      background-color: #f8f9fa;\n    }\n    \n    .container {\n      max-width: 100%;\n      height: 100vh;\n      display: flex;\n      flex-direction: column;\n    }\n    \n    .header {\n      background: white;\n      padding: 15px 20px;\n      border-bottom: 1px solid #dadce0;\n    }\n    \n    .mode-selector {\n      display: flex;\n      gap: 10px;\n      margin-bottom: 15px;\n    }\n    \n    .mode-button {\n      flex: 1;\n      padding: 10px 16px;\n      border: 2px solid #e0e0e0;\n      border-radius: 6px;\n      background: white;\n      cursor: pointer;\n      font-size: 13px;\n      font-weight: 500;\n      transition: all 0.2s;\n    }\n    \n    .mode-button:hover {\n      border-color: #1a73e8;\n    }\n    \n    .mode-button.active {\n      border-color: #1a73e8;\n      background: #e8f0fe;\n      color: #1a73e8;\n    }\n    \n    .url-section {\n      display: flex;\n      gap: 10px;\n      align-items: center;\n    }\n    \n    .url-section input {\n      flex: 1;\n      padding: 8px 12px;\n      border: 1px solid #dadce0;\n      border-radius: 4px;\n      font-size: 13px;\n    }\n    \n    .content {\n      flex: 1;\n      overflow: hidden;\n      display: flex;\n    }\n    \n    .simple-layout {\n      flex: 1;\n      padding: 20px;\n      overflow-y: auto;\n    }\n    \n    .advanced-layout {\n      flex: 1;\n      display: flex;\n      gap: 0;\n    }\n    \n    .sheet-list-panel {\n      width: 320px;\n      background: white;\n      border-right: 1px solid #dadce0;\n      display: flex;\n      flex-direction: column;\n    }\n    \n    .panel-header {\n      padding: 15px;\n      border-bottom: 1px solid #e0e0e0;\n      font-weight: 600;\n      font-size: 14px;\n      background: #f8f9fa;\n    }\n    \n    .sheet-list-scroll {\n      flex: 1;\n      overflow-y: auto;\n    }\n    \n    .config-panel {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n    }\n    \n    .config-scroll {\n      flex: 1;\n      overflow-y: auto;\n      padding: 20px;\n    }\n    \n    .section {\n      margin-bottom: 20px;\n      background: white;\n      border-radius: 8px;\n      padding: 20px;\n      box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n    }\n    \n    .section-title {\n      font-weight: 600;\n      font-size: 15px;\n      margin-bottom: 15px;\n      color: #202124;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n    \n    .button {\n      padding: 8px 20px;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 13px;\n      font-weight: 500;\n      transition: all 0.2s;\n    }\n    \n    .button-primary {\n      background-color: #1a73e8;\n      color: white;\n    }\n    \n    .button-primary:hover:not(:disabled) {\n      background-color: #1557b0;\n    }\n    \n    .button-primary:disabled {\n      background-color: #dadce0;\n      cursor: not-allowed;\n    }\n    \n    .button-secondary {\n      background-color: white;\n      color: #5f6368;\n      border: 1px solid #dadce0;\n    }\n    \n    .button-secondary:hover {\n      background-color: #f8f9fa;\n    }\n    \n    .button-success {\n      background-color: #1e8e3e;\n      color: white;\n    }\n    \n    .button-success:hover:not(:disabled) {\n      background-color: #188038;\n    }\n    \n    .button-success:disabled {\n      background-color: #dadce0;\n      cursor: not-allowed;\n    }\n    \n    .button-danger {\n      background-color: #d93025;\n      color: white;\n    }\n    \n    .sheet-item {\n      padding: 12px 15px;\n      border-bottom: 1px solid #f0f0f0;\n      cursor: pointer;\n      transition: background-color 0.2s;\n    }\n    \n    .sheet-item:hover {\n      background-color: #f8f9fa;\n    }\n    \n    .sheet-item.selected {\n      background-color: #e8f0fe;\n      border-left: 4px solid #1a73e8;\n      padding-left: 11px;\n    }\n    \n    .sheet-item.dangerous-item {\n      background-color: #fff5f5;\n      border-left: 4px solid #d93025;\n      padding-left: 11px;\n    }\n    \n    .sheet-item.dangerous-item .sheet-name {\n      color: #d93025;\n      font-weight: 700;\n    }\n    \n    .sheet-item.recommended-item {\n      background-color: #f0f9ff;\n      border-left: 4px solid #1e8e3e;\n      padding-left: 11px;\n    }\n    \n    .sheet-name {\n      font-weight: 500;\n      color: #202124;\n      margin-bottom: 4px;\n    }\n    \n    .sheet-info {\n      color: #5f6368;\n      font-size: 12px;\n      white-space: pre-line;\n      line-height: 1.5;\n    }\n    \n    .sheet-check-item {\n      padding: 12px 15px;\n      border-bottom: 1px solid #f0f0f0;\n      display: flex;\n      gap: 12px;\n    }\n    \n    /* ğŸ”´ å±é™ºã‚·ãƒ¼ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« */\n    .sheet-check-item.dangerous {\n      background-color: #fff5f5;\n      border-left: 4px solid #d93025;\n      padding-left: 11px;\n    }\n    \n    .sheet-check-item.dangerous .sheet-name {\n      color: #d93025;\n      font-weight: 700;\n    }\n    \n    .sheet-check-item.dangerous .sheet-info {\n      color: #c5221f;\n      font-weight: 500;\n      font-size: 13px;\n      line-height: 1.6;\n      white-space: pre-line;\n      margin-top: 8px;\n      padding: 8px;\n      background-color: #ffebee;\n      border-radius: 4px;\n      border-left: 3px solid #d93025;\n    }\n    \n    /* âœ… æ¨å¥¨ã‚·ãƒ¼ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« */\n    .sheet-check-item.recommended {\n      background-color: #f0f9ff;\n      border-left: 4px solid #1e8e3e;\n      padding-left: 11px;\n    }\n    \n    .form-group {\n      margin-bottom: 18px;\n    }\n    \n    .form-label {\n      display: block;\n      margin-bottom: 6px;\n      font-weight: 500;\n      color: #202124;\n      font-size: 13px;\n    }\n    \n    input[type="text"], input[type="number"], select {\n      padding: 8px 12px;\n      border: 1px solid #dadce0;\n      border-radius: 4px;\n      font-size: 13px;\n    }\n    \n    input[type="text"] {\n      width: 100%;\n    }\n    \n    input[type="number"] {\n      width: 90px;\n    }\n    \n    select {\n      width: 100%;\n    }\n    \n    .form-row {\n      display: flex;\n      gap: 12px;\n      align-items: center;\n    }\n    \n    .help-text {\n      color: #5f6368;\n      font-size: 12px;\n      margin-top: 6px;\n    }\n    \n    .preview-box {\n      border: 1px solid #dadce0;\n      border-radius: 4px;\n      padding: 12px;\n      background-color: #f8f9fa;\n      max-height: 200px;\n      overflow: auto;\n      font-family: \'Roboto Mono\', monospace;\n      font-size: 11px;\n    }\n    \n    .preview-table {\n      border-collapse: collapse;\n      width: 100%;\n      background: white;\n    }\n    \n    .preview-table td {\n      border: 1px solid #dadce0;\n      padding: 6px 8px;\n      white-space: nowrap;\n      max-width: 150px;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n    \n    .config-list {\n      border: 1px solid #dadce0;\n      border-radius: 4px;\n      max-height: 300px;\n      overflow-y: auto;\n      background: white;\n    }\n    \n    .config-item {\n      padding: 15px;\n      border-bottom: 1px solid #f0f0f0;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      gap: 15px;\n    }\n    \n    .config-details {\n      font-size: 12px;\n      color: #5f6368;\n      margin-top: 6px;\n    }\n    \n    .loading {\n      text-align: center;\n      padding: 20px;\n      color: #5f6368;\n    }\n    \n    .message {\n      padding: 12px 16px;\n      border-radius: 4px;\n      margin-bottom: 15px;\n    }\n    \n    .error {\n      background-color: #fce8e6;\n      color: #c5221f;\n      border: 1px solid #f5c6cb;\n      border-left: 4px solid #d93025;\n      white-space: pre-line;\n      line-height: 1.6;\n    }\n    \n    .success {\n      background-color: #e6f4ea;\n      color: #137333;\n      border: 1px solid #c3e6cb;\n    }\n    \n    .warning {\n      background-color: #fef7e0;\n      color: #9f6c00;\n      border: 1px solid #ffc107;\n      border-left: 4px solid #ff9800;\n      white-space: pre-line;\n      line-height: 1.6;\n    }\n    \n    .badge {\n      display: inline-block;\n      padding: 3px 8px;\n      border-radius: 12px;\n      font-size: 11px;\n      font-weight: 500;\n      margin-left: 6px;\n    }\n    \n    .badge-mode {\n      background-color: #e8f0fe;\n      color: #1967d2;\n    }\n    \n    .badge-recommended {\n      background-color: #e6f4ea;\n      color: #137333;\n    }\n    \n    .badge-danger {\n      background-color: #fce8e6;\n      color: #d93025;\n    }\n    \n    .badge-optional {\n      background-color: #f5f5f5;\n      color: #5f6368;\n    }\n    \n    .action-bar {\n      padding: 15px 20px;\n      background: white;\n      border-top: 1px solid #dadce0;\n      display: flex;\n      gap: 10px;\n    }\n    \n    .tab-content {\n      display: none;\n    }\n    \n    .tab-content.active {\n      display: flex;\n      flex: 1;\n    }\n    \n    .empty-state {\n      padding: 40px 20px;\n      text-align: center;\n      color: #5f6368;\n    }\n  </style>\n</head>\n<body>\n  <div class="container">\n    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->\n    <div class="header">\n      <div class="mode-selector">\n        <button class="mode-button active" onclick="switchMode(\'simple\')" id="modeSimple">\n          ğŸš€ ç°¡å˜ãƒ¢ãƒ¼ãƒ‰\n        </button>\n        <button class="mode-button" onclick="switchMode(\'advanced\')" id="modeAdvanced">\n          âš™ï¸ è©³ç´°ãƒ¢ãƒ¼ãƒ‰\n        </button>\n      </div>\n      \n      <div class="url-section">\n        <input type="text" id="sourceUrl" placeholder="ã‚¤ãƒ³ãƒãƒ¼ãƒˆå…ƒã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURL">\n        <button class="button button-primary" onclick="loadSheetsList()">èª­ã¿è¾¼ã¿</button>\n      </div>\n    </div>\n    \n    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->\n    <div style="padding: 0 20px;">\n      <div id="loading" class="loading" style="display: none;">èª­ã¿è¾¼ã¿ä¸­...</div>\n      <div id="error" class="message error" style="display: none;"></div>\n      <div id="success" class="message success" style="display: none;"></div>\n      <div id="warning" class="message warning" style="display: none;"></div>\n    </div>\n    \n    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->\n    <div class="content">\n      <!-- ç°¡å˜ãƒ¢ãƒ¼ãƒ‰ -->\n      <div id="simpleMode" class="tab-content active">\n        <div class="simple-layout">\n          <div id="simpleEmpty" class="empty-state">\n            ä¸Šéƒ¨ã®URLæ¬„ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆå…ƒã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLã‚’å…¥åŠ›ã—ã¦ã€<br>\n            ã€Œèª­ã¿è¾¼ã¿ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„\n          </div>\n          \n          <div id="simpleContent" style="display: none;">\n            <div class="section">\n              <div class="section-title">ğŸ“‹ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’é¸æŠ</div>\n              <div id="spreadsheetName" style="margin-bottom: 12px; color: #5f6368; font-size: 12px;"></div>\n              <div id="simpleSheetsList"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <!-- è©³ç´°ãƒ¢ãƒ¼ãƒ‰ -->\n      <div id="advancedMode" class="tab-content">\n        <div id="advancedEmpty" class="empty-state" style="flex: 1;">\n          ä¸Šéƒ¨ã®URLæ¬„ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆå…ƒã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLã‚’å…¥åŠ›ã—ã¦ã€<br>\n          ã€Œèª­ã¿è¾¼ã¿ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„\n        </div>\n        \n        <div id="advancedContent" class="advanced-layout" style="display: none;">\n          <!-- å·¦ãƒ‘ãƒãƒ«: ã‚·ãƒ¼ãƒˆä¸€è¦§ -->\n          <div class="sheet-list-panel">\n            <div class="panel-header">ğŸ“‹ ã‚·ãƒ¼ãƒˆä¸€è¦§</div>\n            <div class="sheet-list-scroll" id="advancedSheetsList"></div>\n          </div>\n          \n          <!-- å³ãƒ‘ãƒãƒ«: è¨­å®š -->\n          <div class="config-panel">\n            <div class="config-scroll" id="configArea">\n              <div class="empty-state">\n                å·¦ã®ã‚·ãƒ¼ãƒˆä¸€è¦§ã‹ã‚‰ã‚·ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„\n              </div>\n            </div>\n            \n            <!-- ç¢ºèªç”»é¢ -->\n            <div id="confirmArea" style="display: none; flex: 1; overflow-y: auto; padding: 20px;">\n              <div class="section">\n                <div class="section-title">âœ… ã‚¤ãƒ³ãƒãƒ¼ãƒˆè¨­å®šã®ç¢ºèª</div>\n                <div class="form-group">\n                  <label class="form-label">è¨­å®šä¸€è¦§ï¼ˆ<span id="configCount">0</span>ä»¶ï¼‰</label>\n                  <div id="configList" class="config-list"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    \n    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->\n    <div class="action-bar">\n      <button class="button button-success" onclick="executeImport()" disabled id="executeBtn">\n        ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ\n      </button>\n      <button class="button button-secondary" onclick="showConfirmList()" style="display: none;" id="showConfirmBtn">\n        è¨­å®šã‚’ç¢ºèª\n      </button>\n      <button class="button button-danger" onclick="clearAllConfigs()" style="display: none;" id="clearBtn">\n        å…¨ã¦ã‚¯ãƒªã‚¢\n      </button>\n      <button class="button button-secondary" onclick="google.script.host.close()">é–‰ã˜ã‚‹</button>\n    </div>\n  </div>\n  \n  <script>\n    var currentMode = \'simple\';\n    var currentSheet = null;\n    var sourceUrl = \'\';\n    var allSheets = [];\n    var importConfigs = [];\n    \n    function switchMode(mode) {\n      currentMode = mode;\n      \n      document.getElementById(\'modeSimple\').classList.toggle(\'active\', mode === \'simple\');\n      document.getElementById(\'modeAdvanced\').classList.toggle(\'active\', mode === \'advanced\');\n      document.getElementById(\'simpleMode\').classList.toggle(\'active\', mode === \'simple\');\n      document.getElementById(\'advancedMode\').classList.toggle(\'active\', mode === \'advanced\');\n      \n      updateUI();\n    }\n    \n    function loadSheetsList() {\n      var url = document.getElementById(\'sourceUrl\').value.trim();\n      \n      if (!url) {\n        showError(\'URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\');\n        return;\n      }\n      \n      if (url.indexOf(\'docs.google.com/spreadsheets\') === -1) {\n        showError(\'æœ‰åŠ¹ãªGoogleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\');\n        return;\n      }\n      \n      sourceUrl = url;\n      hideMessages();\n      document.getElementById(\'loading\').style.display = \'block\';\n      \n      google.script.run\n        .withSuccessHandler(onSheetsListLoaded)\n        .withFailureHandler(onError)\n        .getSourceSheetsInfo(url);\n    }\n    \n    function onSheetsListLoaded(result) {\n      document.getElementById(\'loading\').style.display = \'none\';\n      \n      if (!result.success) {\n        showError(result.error);\n        return;\n      }\n      \n      allSheets = result.sheets;\n      document.getElementById(\'spreadsheetName\').textContent = \'ã‚¤ãƒ³ãƒãƒ¼ãƒˆå…ƒ: \' + result.spreadsheetName;\n      \n      if (currentMode === \'simple\') {\n        renderSimpleSheetsList();\n      } else {\n        renderAdvancedSheetsList();\n      }\n    }\n    \n    function renderSimpleSheetsList() {\n      var html = \'\';\n      \n      for (var i = 0; i < allSheets.length; i++) {\n        var sheet = allSheets[i];\n        \n        // ãƒãƒƒã‚¸ã‚’æ±ºå®š\n        var badge = \'\';\n        var itemClass = \'\';\n        \n        if (sheet.isDangerous) {\n          badge = \'<span class="badge badge-danger">âš ï¸ è¦æ³¨æ„</span>\';\n          itemClass = \'dangerous\';\n        } else if (sheet.isRecommended) {\n          badge = \'<span class="badge badge-recommended">âœ… æ¨å¥¨</span>\';\n          itemClass = \'recommended\';\n        } else {\n          badge = \'<span class="badge badge-optional">åŸºæœ¬çš„ã«ä¸è¦</span>\';\n        }\n        \n        html += \'<div class="sheet-check-item \' + itemClass + \'">\' +\n          \'<input type="checkbox" id="simple_\' + i + \'" value="\' + i + \'" onchange="updateSimpleUI()" \' + \n          (sheet.isRecommended ? \'checked\' : \'\') + \'>\' +\n          \'<div style="flex: 1;">\' +\n          \'<label for="simple_\' + i + \'" style="cursor: pointer;">\' +\n          \'<div class="sheet-name">\' + sheet.name + badge + \'</div>\' +\n          \'<div class="sheet-info">\' + sheet.description + \' (\' + sheet.rows + \'è¡Œ Ã— \' + sheet.cols + \'åˆ—)</div>\' +\n          \'</label>\' +\n          \'</div>\' +\n          \'</div>\';\n      }\n      \n      document.getElementById(\'simpleSheetsList\').innerHTML = html;\n      document.getElementById(\'simpleEmpty\').style.display = \'none\';\n      document.getElementById(\'simpleContent\').style.display = \'block\';\n      updateSimpleUI();\n    }\n    \n    function updateSimpleUI() {\n      var checked = document.querySelectorAll(\'#simpleSheetsList input:checked\').length;\n      document.getElementById(\'executeBtn\').disabled = checked === 0;\n    }\n    \n    function renderAdvancedSheetsList() {\n      var html = \'\';\n      \n      for (var i = 0; i < allSheets.length; i++) {\n        var sheet = allSheets[i];\n        var badge = \'\';\n        var itemClass = \'\';\n        \n        if (sheet.isDangerous) {\n          badge = \'<span class="badge badge-danger">âš ï¸ è¦æ³¨æ„</span>\';\n          itemClass = \'dangerous-item\';\n        } else if (sheet.isRecommended) {\n          badge = \'<span class="badge badge-recommended">âœ… æ¨å¥¨</span>\';\n          itemClass = \'recommended-item\';\n        } else {\n          badge = \'<span class="badge badge-optional">åŸºæœ¬çš„ã«ä¸è¦</span>\';\n        }\n        \n        html += \'<div class="sheet-item \' + itemClass + \'" onclick="selectSheet(\' + i + \')">\' +\n          \'<div class="sheet-name">\' + sheet.name + badge + \'</div>\' +\n          \'<div class="sheet-info">\' + sheet.rows + \'è¡Œ Ã— \' + sheet.cols + \'åˆ—</div>\' +\n          \'</div>\';\n      }\n      \n      document.getElementById(\'advancedSheetsList\').innerHTML = html;\n      document.getElementById(\'advancedEmpty\').style.display = \'none\';\n      document.getElementById(\'advancedContent\').style.display = \'flex\';\n    }\n    \n    function selectSheet(index) {\n      var items = document.querySelectorAll(\'#advancedSheetsList .sheet-item\');\n      items.forEach(function(item, i) {\n        item.classList.toggle(\'selected\', i === index);\n      });\n      \n      currentSheet = allSheets[index];\n      showConfigPanel();\n    }\n    \n    function showConfigPanel() {\n      var dangerWarning = \'\';\n      if (currentSheet.isDangerous) {\n        dangerWarning = \'<div class="message error" style="display: block; white-space: pre-line; line-height: 1.8;">\' +\n          currentSheet.description +\n          \'</div>\';\n      }\n      \n      var html = dangerWarning +\n        \'<div class="section">\' +\n        \'<div class="section-title">âš™ï¸ ã‚¤ãƒ³ãƒãƒ¼ãƒˆè¨­å®š</div>\' +\n        \'<div class="form-group">\' +\n        \'<label class="form-label">ã‚·ãƒ¼ãƒˆ: <span style="color: #1a73e8;">\' + currentSheet.name + \'</span></label>\' +\n        \'<div class="sheet-info">\' + currentSheet.rows + \'è¡Œ Ã— \' + currentSheet.cols + \'åˆ—</div>\' +\n        \'</div>\' +\n        \'<div class="form-group">\' +\n        \'<label class="form-label">ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰</label>\' +\n        \'<select id="importMode" onchange="updateModeOptions()">\' +\n        \'<option value="full_copy">å®Œå…¨ã‚³ãƒ”ãƒ¼ï¼ˆã‚·ãƒ¼ãƒˆå…¨ä½“ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¾¼ã¿ï¼‰</option>\' +\n        \'<option value="range_with_format">ç¯„å›²æŒ‡å®šï¼ˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¾¼ã¿ï¼‰</option>\' +\n        \'<option value="range_values_only">ç¯„å›²æŒ‡å®šï¼ˆå€¤ã®ã¿ï¼‰</option>\' +\n        \'<option value="append_values">æ—¢å­˜ã‚·ãƒ¼ãƒˆã«è¿½åŠ </option>\' +\n        \'<option value="conditional">æ¡ä»¶ä»˜ãã‚¤ãƒ³ãƒãƒ¼ãƒˆ</option>\' +\n        \'</select>\' +\n        \'</div>\' +\n        \'<div id="modeOptions"></div>\' +\n        \'<div class="form-group">\' +\n        \'<button class="button button-secondary" onclick="previewData()">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>\' +\n        \'</div>\' +\n        \'<div id="previewSection" style="display: none;">\' +\n        \'<div class="form-group">\' +\n        \'<label class="form-label">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</label>\' +\n        \'<div id="preview" class="preview-box"></div>\' +\n        \'<div class="help-text">ç·è¡Œæ•°: <span id="totalRows"></span>è¡Œ</div>\' +\n        \'</div>\' +\n        \'</div>\' +\n        \'<div style="margin-top: 20px;">\' +\n        \'<button class="button button-primary" onclick="addToList()">ã“ã®è¨­å®šã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ </button>\' +\n        \'</div>\' +\n        \'</div>\';\n      \n      document.getElementById(\'configArea\').innerHTML = html;\n      document.getElementById(\'confirmArea\').style.display = \'none\';\n      \n      if (currentSheet.recommended) {\n        document.getElementById(\'importMode\').value = currentSheet.recommended;\n      }\n      \n      updateModeOptions();\n    }\n    \n    function updateModeOptions() {\n      var mode = document.getElementById(\'importMode\').value;\n      var html = \'\';\n      \n      if (mode === \'range_with_format\' || mode === \'range_values_only\') {\n        html = \'<div class="form-group">\' +\n          \'<label class="form-label">ğŸ“¥ ã‚³ãƒ”ãƒ¼å…ƒã®ç¯„å›²</label>\' +\n          \'<div class="form-row">\' +\n          \'<span>è¡Œ:</span><input type="number" id="startRow" value="1" min="1" onchange="syncTargetPosition()">\' +\n          \'<span>ã€œ</span><input type="number" id="endRow" value="\' + currentSheet.rows + \'">\' +\n          \'</div>\' +\n          \'<div class="form-row" style="margin-top: 8px;">\' +\n          \'<span>åˆ—:</span><input type="number" id="startCol" value="1" min="1" onchange="syncTargetPosition()">\' +\n          \'<span>ã€œ</span><input type="number" id="endCol" value="\' + currentSheet.cols + \'">\' +\n          \'</div>\' +\n          \'</div>\' +\n          \'<div class="form-group">\' +\n          \'<label class="form-label">ğŸ“¤ è²¼ã‚Šä»˜ã‘å…ˆã®ä½ç½®</label>\' +\n          \'<div class="form-row">\' +\n          \'<span>é–‹å§‹è¡Œ:</span><input type="number" id="targetStartRow" value="1" min="1">\' +\n          \'<span>é–‹å§‹åˆ—:</span><input type="number" id="targetStartCol" value="1" min="1">\' +\n          \'</div>\' +\n          \'<div class="help-text">ğŸ’¡ ã‚³ãƒ”ãƒ¼å…ƒã¨åŒã˜ä½ç½®ã«è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚å¤‰æ›´ã‚‚å¯èƒ½ã§ã™ã€‚</div>\' +\n          \'</div>\';\n      } else if (mode === \'append_values\') {\n        html = \'<div class="form-group">\' +\n          \'<label class="form-label">è¿½åŠ ç¯„å›²</label>\' +\n          \'<div class="form-row">\' +\n          \'<span>è¡Œ:</span><input type="number" id="appendStartRow" value="5" min="1">\' +\n          \'<span>ã€œ</span><input type="number" id="appendEndRow" value="\' + currentSheet.rows + \'">\' +\n          \'</div>\' +\n          \'<div class="help-text">ğŸ’¡ åˆ—ä½ç½®ã¯ã‚³ãƒ”ãƒ¼å…ƒã¨åŒã˜ã«ãªã‚Šã¾ã™</div>\' +\n          \'</div>\' +\n          \'<div class="form-group">\' +\n          \'<label><input type="checkbox" id="appendIncludeFormat"> ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚‚å«ã‚ã‚‹</label>\' +\n          \'</div>\';\n      } else if (mode === \'conditional\') {\n        html = \'<div class="form-group">\' +\n          \'<label class="form-label">æ¡ä»¶</label>\' +\n          \'<select id="condition">\' +\n          \'<option value="untranslated">æœªç¿»è¨³ã®ã¿</option>\' +\n          \'<option value="translated">ç¿»è¨³æ¸ˆã¿ã®ã¿</option>\' +\n          \'<option value="has_error">ã‚¨ãƒ©ãƒ¼è¡Œã®ã¿</option>\' +\n          \'<option value="no_template">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæœªè¨­å®š</option>\' +\n          \'<option value="no_policy">ãƒãƒªã‚·ãƒ¼æœªè¨­å®š</option>\' +\n          \'<option value="all">å…¨è¡Œ</option>\' +\n          \'</select>\' +\n          \'</div>\' +\n          \'<div class="form-group">\' +\n          \'<label class="form-label">æ¤œç´¢ç¯„å›²</label>\' +\n          \'<div class="form-row">\' +\n          \'<span>è¡Œ:</span><input type="number" id="condStartRow" value="5" min="1">\' +\n          \'<span>ã€œ</span><input type="number" id="condEndRow" value="\' + currentSheet.rows + \'">\' +\n          \'</div>\' +\n          \'<div class="help-text">ğŸ’¡ åˆ—ä½ç½®ã¯ã‚³ãƒ”ãƒ¼å…ƒã¨åŒã˜ã«ãªã‚Šã¾ã™</div>\' +\n          \'</div>\' +\n          \'<div class="form-group">\' +\n          \'<label><input type="checkbox" id="condIncludeFormat"> ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚‚å«ã‚ã‚‹</label>\' +\n          \'</div>\';\n      }\n      \n      document.getElementById(\'modeOptions\').innerHTML = html;\n    }\n    \n    function syncTargetPosition() {\n      var startRow = document.getElementById(\'startRow\');\n      var startCol = document.getElementById(\'startCol\');\n      var targetStartRow = document.getElementById(\'targetStartRow\');\n      var targetStartCol = document.getElementById(\'targetStartCol\');\n      \n      if (startRow && targetStartRow) {\n        targetStartRow.value = startRow.value;\n      }\n      \n      if (startCol && targetStartCol) {\n        targetStartCol.value = startCol.value;\n      }\n    }\n    \n    function previewData() {\n      var mode = document.getElementById(\'importMode\').value;\n      var startRow, endRow, condition;\n      \n      if (mode === \'full_copy\') {\n        startRow = 1;\n        endRow = currentSheet.rows;\n        condition = \'none\';\n      } else if (mode === \'range_with_format\' || mode === \'range_values_only\') {\n        startRow = parseInt(document.getElementById(\'startRow\').value) || 1;\n        endRow = parseInt(document.getElementById(\'endRow\').value) || currentSheet.rows;\n        condition = \'none\';\n      } else if (mode === \'append_values\') {\n        startRow = parseInt(document.getElementById(\'appendStartRow\').value) || 5;\n        endRow = parseInt(document.getElementById(\'appendEndRow\').value) || currentSheet.rows;\n        condition = \'none\';\n      } else if (mode === \'conditional\') {\n        startRow = parseInt(document.getElementById(\'condStartRow\').value) || 5;\n        endRow = parseInt(document.getElementById(\'condEndRow\').value) || currentSheet.rows;\n        condition = document.getElementById(\'condition\').value;\n      }\n      \n      document.getElementById(\'loading\').style.display = \'block\';\n      \n      google.script.run\n        .withSuccessHandler(onPreviewLoaded)\n        .withFailureHandler(onError)\n        .getSheetPreview(sourceUrl, currentSheet.name, startRow, endRow, condition);\n    }\n    \n    function onPreviewLoaded(result) {\n      document.getElementById(\'loading\').style.display = \'none\';\n      \n      if (!result.success) {\n        showError(result.error);\n        return;\n      }\n      \n      if (result.message) {\n        showWarning(result.message);\n      }\n      \n      var html = \'<table class="preview-table">\';\n      for (var i = 0; i < result.preview.length; i++) {\n        html += \'<tr>\';\n        for (var j = 0; j < result.preview[i].length; j++) {\n          var val = result.preview[i][j];\n          html += \'<td>\' + (val || \'\').toString().substring(0, 40) + \'</td>\';\n        }\n        html += \'</tr>\';\n      }\n      html += \'</table>\';\n      \n      document.getElementById(\'preview\').innerHTML = html;\n      document.getElementById(\'totalRows\').textContent = result.totalRows;\n      document.getElementById(\'previewSection\').style.display = \'block\';\n    }\n    \n    function addToList() {\n      var mode = document.getElementById(\'importMode\').value;\n      var config = {\n        sheetName: currentSheet.name,\n        targetSheetName: currentSheet.name,\n        importMode: mode\n      };\n      \n      if (mode === \'range_with_format\' || mode === \'range_values_only\') {\n        config.startRow = parseInt(document.getElementById(\'startRow\').value) || 1;\n        config.endRow = parseInt(document.getElementById(\'endRow\').value) || currentSheet.rows;\n        config.startCol = parseInt(document.getElementById(\'startCol\').value) || 1;\n        config.endCol = parseInt(document.getElementById(\'endCol\').value) || currentSheet.cols;\n        config.targetStartRow = parseInt(document.getElementById(\'targetStartRow\').value) || config.startRow;\n        config.targetStartCol = parseInt(document.getElementById(\'targetStartCol\').value) || config.startCol;\n      } else if (mode === \'append_values\') {\n        config.startRow = parseInt(document.getElementById(\'appendStartRow\').value) || 5;\n        config.endRow = parseInt(document.getElementById(\'appendEndRow\').value) || currentSheet.rows;\n        config.startCol = 1;\n        config.endCol = currentSheet.cols;\n        config.includeFormat = document.getElementById(\'appendIncludeFormat\').checked;\n      } else if (mode === \'conditional\') {\n        config.startRow = parseInt(document.getElementById(\'condStartRow\').value) || 5;\n        config.endRow = parseInt(document.getElementById(\'condEndRow\').value) || currentSheet.rows;\n        config.condition = document.getElementById(\'condition\').value;\n        config.includeFormat = document.getElementById(\'condIncludeFormat\').checked;\n      }\n      \n      importConfigs.push(config);\n      updateAdvancedUI();\n      showSuccess(\'è¨­å®šã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸï¼ˆ\' + importConfigs.length + \'ä»¶ï¼‰\');\n    }\n    \n    function updateAdvancedUI() {\n      document.getElementById(\'executeBtn\').disabled = importConfigs.length === 0;\n      document.getElementById(\'showConfirmBtn\').style.display = importConfigs.length > 0 ? \'inline-block\' : \'none\';\n      document.getElementById(\'clearBtn\').style.display = importConfigs.length > 0 ? \'inline-block\' : \'none\';\n    }\n    \n    function showConfirmList() {\n      var html = \'\';\n      \n      for (var i = 0; i < importConfigs.length; i++) {\n        var cfg = importConfigs[i];\n        var modeNames = {\n          \'full_copy\': \'å®Œå…¨ã‚³ãƒ”ãƒ¼\',\n          \'range_with_format\': \'ç¯„å›²+æ›¸å¼\',\n          \'range_values_only\': \'ç¯„å›²ï¼ˆå€¤ã®ã¿ï¼‰\',\n          \'append_values\': \'è¿½åŠ \',\n          \'conditional\': \'æ¡ä»¶ä»˜ã\'\n        };\n        \n        var details = [];\n        if (cfg.startRow) details.push(\'è¡Œ\' + cfg.startRow + \'ã€œ\' + cfg.endRow);\n        if (cfg.condition) {\n          var condNames = {\n            \'untranslated\': \'æœªç¿»è¨³ã®ã¿\',\n            \'translated\': \'ç¿»è¨³æ¸ˆã¿ã®ã¿\',\n            \'has_error\': \'ã‚¨ãƒ©ãƒ¼è¡Œã®ã¿\',\n            \'no_template\': \'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæœªè¨­å®š\',\n            \'no_policy\': \'ãƒãƒªã‚·ãƒ¼æœªè¨­å®š\',\n            \'all\': \'å…¨è¡Œ\'\n          };\n          details.push(condNames[cfg.condition] || cfg.condition);\n        }\n        \n        html += \'<div class="config-item">\' +\n          \'<div style="flex: 1;">\' +\n          \'<strong>\' + cfg.sheetName + \'</strong>\' +\n          \'<span class="badge badge-mode">\' + (modeNames[cfg.importMode] || cfg.importMode) + \'</span>\' +\n          \'<div class="config-details">\' + details.join(\' / \') + \'</div>\' +\n          \'</div>\' +\n          \'<button class="button button-secondary" onclick="removeConfig(\' + i + \')">å‰Šé™¤</button>\' +\n          \'</div>\';\n      }\n      \n      if (!html) {\n        html = \'<div class="empty-state">è¨­å®šãŒã‚ã‚Šã¾ã›ã‚“</div>\';\n      }\n      \n      document.getElementById(\'configList\').innerHTML = html;\n      document.getElementById(\'configCount\').textContent = importConfigs.length;\n      document.getElementById(\'configArea\').style.display = \'none\';\n      document.getElementById(\'confirmArea\').style.display = \'block\';\n    }\n    \n    function removeConfig(index) {\n      importConfigs.splice(index, 1);\n      showConfirmList();\n      updateAdvancedUI();\n    }\n    \n    function clearAllConfigs() {\n      if (confirm(\'å…¨ã¦ã®è¨­å®šã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ\')) {\n        importConfigs = [];\n        updateAdvancedUI();\n        document.getElementById(\'confirmArea\').style.display = \'none\';\n        document.getElementById(\'configArea\').innerHTML = \'<div class="empty-state">å·¦ã®ã‚·ãƒ¼ãƒˆä¸€è¦§ã‹ã‚‰ã‚·ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</div>\';\n      }\n    }\n    \n    function executeImport() {\n      var configs = [];\n      \n      if (currentMode === \'simple\') {\n        var checkboxes = document.querySelectorAll(\'#simpleSheetsList input:checked\');\n        checkboxes.forEach(function(cb) {\n          var idx = parseInt(cb.value);\n          var sheet = allSheets[idx];\n          configs.push({\n            sheetName: sheet.name,\n            targetSheetName: sheet.name,\n            importMode: sheet.recommended || \'full_copy\'\n          });\n        });\n      } else {\n        configs = importConfigs;\n      }\n      \n      if (configs.length === 0) {\n        showError(\'è¨­å®šãŒã‚ã‚Šã¾ã›ã‚“\');\n        return;\n      }\n      \n      if (!confirm(configs.length + \'ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚\\næ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚\\n\\nã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\')) {\n        return;\n      }\n      \n      hideMessages();\n      document.getElementById(\'loading\').style.display = \'block\';\n      document.getElementById(\'executeBtn\').disabled = true;\n      \n      google.script.run\n        .withSuccessHandler(onImportComplete)\n        .withFailureHandler(onError)\n        .importWithUnifiedSettings(sourceUrl, configs);\n    }\n    \n    function onImportComplete(result) {\n      document.getElementById(\'loading\').style.display = \'none\';\n      document.getElementById(\'executeBtn\').disabled = false;\n      \n      if (!result.success) {\n        showError(result.error);\n        return;\n      }\n      \n      var msg = \'âœ… ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†\\n\\n\';\n      var ok = 0, ng = 0;\n      \n      result.results.forEach(function(r) {\n        if (r.success) {\n          msg += \'âœ“ \' + r.sheetName + \' (\' + r.rowsImported + \'è¡Œ)\\n\';\n          ok++;\n        } else {\n          msg += \'âœ— \' + r.sheetName + \': \' + r.error + \'\\n\';\n          ng++;\n        }\n      });\n      \n      msg += \'\\næˆåŠŸ: \' + ok + \'ä»¶ / å¤±æ•—: \' + ng + \'ä»¶\';\n      showSuccess(msg);\n      \n      setTimeout(function() {\n        google.script.host.close();\n      }, 3000);\n    }\n    \n    function updateUI() {\n      if (currentMode === \'simple\') {\n        updateSimpleUI();\n      } else {\n        updateAdvancedUI();\n      }\n    }\n    \n    function showError(msg) {\n      document.getElementById(\'error\').textContent = \'âŒ \' + msg;\n      document.getElementById(\'error\').style.display = \'block\';\n    }\n    \n    function showSuccess(msg) {\n      document.getElementById(\'success\').textContent = \'âœ… \' + msg;\n      document.getElementById(\'success\').style.display = \'block\';\n    }\n    \n    function showWarning(msg) {\n      document.getElementById(\'warning\').textContent = \'âš ï¸ \' + msg;\n      document.getElementById(\'warning\').style.display = \'block\';\n    }\n    \n    function hideMessages() {\n      document.getElementById(\'error\').style.display = \'none\';\n      document.getElementById(\'success\').style.display = \'none\';\n      document.getElementById(\'warning\').style.display = \'none\';\n    }\n    \n    function onError(error) {\n      document.getElementById(\'loading\').style.display = \'none\';\n      document.getElementById(\'executeBtn\').disabled = false;\n      showError(error.message);\n    }\n  </script>\n</body>\n</html>';


HTML_TEMPLATES['SetupDialog'] = '<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="utf-8">\n  <title>åˆæœŸè¨­å®šï¼ˆçµ±åˆç‰ˆï¼‰</title>\n  <style>\n    :root {\n      --brand: #1a73e8;\n      --brand-600: #1557b0;\n      --text: #3c4043;\n      --muted: #5f6368;\n      --line: #e0e0e0;\n      --bg: #f9f9f9;\n      --card: #fff;\n      --required: #dc2626;\n      --recommended: #16a34a;\n      --optional: #2563eb;\n    }\n\n    * { box-sizing: border-box; }\n    \n    body {\n      font-family: \'Segoe UI\', Arial, sans-serif;\n      margin: 20px;\n      background-color: var(--bg);\n      color: var(--text);\n      max-height: 80vh;\n      overflow-y: auto;\n    }\n\n    .container {\n      background: var(--card);\n      padding: 20px;\n      border-radius: 12px;\n      box-shadow: 0 2px 12px rgba(0,0,0,0.08);\n    }\n\n    h2 {\n      color: var(--brand);\n      margin-bottom: 20px;\n      font-size: 18px;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */\n    .section {\n      margin-bottom: 16px;\n      border: 1px solid var(--line);\n      border-radius: 12px;\n      background: var(--card);\n      overflow: hidden;\n    }\n\n    .section-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 16px 20px;\n      background: #fafbfc;\n      border-bottom: 1px solid var(--line);\n      cursor: pointer;\n      user-select: none;\n    }\n\n    .section-header:hover {\n      background: #f1f3f4;\n    }\n\n    .section-title {\n      display: flex;\n      align-items: center;\n      gap: 12px;\n      font-weight: 600;\n      font-size: 16px;\n    }\n\n    .priority-badge {\n      padding: 4px 8px;\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 700;\n      color: white;\n    }\n\n    .priority-required { background-color: var(--required); }\n    .priority-recommended { background-color: var(--recommended); }\n    .priority-optional { background-color: var(--optional); }\n\n    .section-description {\n      font-size: 14px;\n      color: var(--muted);\n      margin-top: 4px;\n    }\n\n    .section-controls {\n      display: flex;\n      align-items: center;\n      gap: 16px;\n    }\n\n    .edit-toggle {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      font-size: 14px;\n    }\n\n    .edit-toggle input[type="radio"] {\n      width: auto;\n      margin: 0;\n    }\n\n    .collapse-btn {\n      background: none;\n      border: none;\n      font-size: 20px;\n      cursor: pointer;\n      transition: transform 0.2s ease;\n    }\n\n    .collapse-btn.collapsed {\n      transform: rotate(-90deg);\n    }\n\n    .section-content {\n      padding: 20px;\n      display: none;\n    }\n\n    .section-content.expanded {\n      display: block;\n    }\n\n    /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  */\n    label {\n      display: block;\n      margin-top: 15px;\n      margin-bottom: 6px;\n      font-weight: 600;\n      color: #2b2f33;\n    }\n\n    input[type="text"], input[type="number"], select {\n      width: 100%;\n      padding: 10px 12px;\n      border: 1px solid #dadce0;\n      border-radius: 8px;\n      font-size: 14px;\n      transition: box-shadow .15s ease, border-color .15s ease;\n      background: #fff;\n    }\n\n    input[type="text"]:focus, input[type="number"]:focus, select:focus {\n      outline: none;\n      border-color: var(--brand);\n      box-shadow: 0 0 0 3px rgba(26,115,232,.18);\n    }\n\n    .radio-group {\n      margin: 8px 0 0;\n      display: flex;\n      flex-wrap: wrap;\n      gap: 12px;\n    }\n\n    .radio-group label {\n      display: inline-flex;\n      align-items: center;\n      gap: 6px;\n      margin: 0;\n      font-weight: 500;\n      color: #333;\n      cursor: pointer;\n    }\n\n    .radio-group input[type="radio"] {\n      width: auto;\n      margin: 0;\n    }\n\n    .checkbox-group {\n      margin: 10px 0;\n    }\n\n    .checkbox-label {\n      display: flex;\n      align-items: center;\n      cursor: pointer;\n      font-size: 14px;\n      font-weight: 500;\n    }\n\n    .checkbox-label input[type="checkbox"] {\n      margin-right: 8px;\n      width: auto;\n      transform: scale(1.1);\n    }\n\n    /* ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚¿ãƒ– */\n    .api-platform-section {\n      background-color: #fafafa;\n      border: 1px solid var(--line);\n      border-radius: 12px;\n      padding: 14px;\n      margin-top: 10px;\n    }\n\n    .platform-tabs {\n      display: flex;\n      margin-bottom: 14px;\n      border-bottom: 1px solid var(--line);\n      gap: 2px;\n    }\n\n    .platform-tab {\n      padding: 8px 14px;\n      cursor: pointer;\n      border: none;\n      background: none;\n      font-size: 14px;\n      border-bottom: 2px solid transparent;\n      border-radius: 8px 8px 0 0;\n      transition: background .15s ease, color .15s ease, border-color .15s ease;\n    }\n\n    .platform-tab:hover { background-color: #f1f3f4; }\n\n    .platform-tab.active {\n      color: var(--brand);\n      border-bottom-color: var(--brand);\n      font-weight: 700;\n      background: #eef4ff;\n    }\n\n    .platform-content { display: none; }\n    .platform-content.active { display: block; }\n\n    /* é‡è¤‡ãƒã‚§ãƒƒã‚¯è¨­å®š */\n    .target-sheets-container {\n      border: 1px solid #ddd;\n      padding: 15px;\n      background: #f9f9f9;\n      border-radius: 4px;\n      min-height: 100px;\n      margin-top: 10px;\n    }\n\n    .target-sheet-item {\n      display: grid;\n      grid-template-columns: 1fr 100px 80px;\n      gap: 10px;\n      margin-bottom: 15px;\n      padding: 10px;\n      background: white;\n      border-radius: 4px;\n      border: 1px solid #ddd;\n    }\n\n    .input-row {\n      display: flex;\n      gap: 20px;\n      margin: 15px 0;\n    }\n\n    .input-group {\n      flex: 1;\n    }\n\n    .input-group label {\n      margin-top: 0;\n      font-size: 13px;\n    }\n\n    /* æƒ…å ±ãƒœãƒƒã‚¯ã‚¹ */\n    .info-box, .warning-box {\n      border-radius: 10px;\n      padding: 12px;\n      margin-top: 10px;\n    }\n\n    .info-box {\n      background-color: #e8f0fe;\n      border: 1px solid #dadce0;\n    }\n\n    .warning-box {\n      background-color: #fff3cd;\n      border: 1px solid #ffeaa7;\n    }\n\n    .info-box .title, .warning-box .title {\n      font-weight: 700;\n      margin-bottom: 6px;\n    }\n\n    .info-box .title {\n      color: var(--brand);\n    }\n\n    .warning-box .title {\n      color: #856404;\n    }\n\n    .info-box .content, .warning-box .content {\n      font-size: 12px;\n      line-height: 1.6;\n    }\n\n    .info-box .content {\n      color: var(--muted);\n    }\n\n    .warning-box .content {\n      color: #856404;\n    }\n\n    .help-text {\n      font-size: 12px;\n      color: var(--muted);\n      margin-top: 4px;\n    }\n\n    .cost-info {\n      font-size: 12px;\n      color: #666;\n      font-style: italic;\n      margin-top: 6px;\n    }\n\n    /* ãƒœã‚¿ãƒ³ */\n    .button-group {\n      margin-top: 26px;\n      display: flex;\n      justify-content: flex-end;\n      gap: 12px;\n    }\n\n    .btn {\n      position: relative;\n      overflow: hidden;\n      border: none;\n      padding: 10px 18px;\n      border-radius: 999px;\n      cursor: pointer;\n      font-size: 14px;\n      line-height: 1;\n      transition: transform .06s ease, box-shadow .2s ease, background-color .2s ease;\n      user-select: none;\n    }\n\n    .btn:active { transform: translateY(0.5px) scale(.99); }\n\n    .btn.primary {\n      background-color: var(--brand);\n      color: #fff;\n      box-shadow: 0 6px 16px rgba(26,115,232,.25);\n    }\n\n    .btn.primary:hover { background-color: var(--brand-600); }\n\n    .btn.secondary {\n      background-color: #edf2f7;\n      color: var(--text);\n    }\n\n    .btn.secondary:hover { background: #e2e8f0; }\n\n    .btn:disabled {\n      opacity: .65;\n      cursor: not-allowed;\n      box-shadow: none;\n    }\n\n    .spinner {\n      width: 16px;\n      height: 16px;\n      border-radius: 50%;\n      border: 2px solid rgba(255,255,255,.55);\n      border-top-color: #fff;\n      animation: spin .8s linear infinite;\n      display: inline-block;\n      vertical-align: middle;\n      margin-right: 8px;\n    }\n\n    @keyframes spin {\n      to { transform: rotate(360deg); }\n    }\n\n    .disabled-overlay {\n      opacity: 0.5;\n      pointer-events: none;\n    }\n  </style>\n</head>\n<body>\n  <div class="container">\n    <h2>åˆæœŸè¨­å®šï¼ˆçµ±åˆç‰ˆï¼‰</h2>\n\n    <form id="setupForm">\n      <!-- 1. AIãƒ»åŸºæœ¬è¨­å®š -->\n      <div class="section" data-section="ai-basic">\n        <div class="section-header" onclick="toggleSection(\'ai-basic\')">\n          <div class="section-title">\n            <span class="priority-badge priority-required">å¿…é ˆ</span>\n            <div>\n              <div>AIãƒ»åŸºæœ¬è¨­å®š</div>\n              <div class="section-description">AIã‚µãƒ¼ãƒ“ã‚¹ã¨ä½œæ¥­ã‚·ãƒ¼ãƒˆã®åŸºæœ¬çš„ãªè¨­å®š</div>\n            </div>\n          </div>\n          <div class="section-controls">\n            <div class="edit-toggle">\n              <label><input type="radio" name="edit-ai-basic" value="maintain" checked> ç¶­æŒ</label>\n              <label><input type="radio" name="edit-ai-basic" value="edit"> ç·¨é›†</label>\n            </div>\n            <button type="button" class="collapse-btn">â–¼</button>\n          </div>\n        </div>\n        <div class="section-content" id="content-ai-basic">\n          <label>AI ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é¸æŠ *</label>\n          <div class="api-platform-section">\n            <div class="platform-tabs" id="platformTabs">\n              <button type="button" class="platform-tab" data-platform="openai">OpenAI</button>\n              <button type="button" class="platform-tab" data-platform="claude">Claude</button>\n              <button type="button" class="platform-tab" data-platform="gemini">Gemini</button>\n            </div>\n\n            <div class="platform-content" id="openai-content">\n              <label for="openaiApiKey">OpenAI APIã‚­ãƒ¼ *</label>\n              <input type="text" id="openaiApiKey" name="openaiApiKey" value="<?= currentApiKeys.openai || \'\' ?>" placeholder="sk-...">\n              <div class="help-text">OpenAIã®APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>\n\n              <label for="openaiModel">ãƒ¢ãƒ‡ãƒ«é¸æŠ *</label>\n              <select id="openaiModel" name="openaiModel">\n                <option value="gpt-5-nano" <?= (currentModel === \'gpt-5-nano\' || !currentModel) ? \'selected\' : \'\' ?>>GPT-5-nanoï¼ˆæœ€å®‰ãƒ»æ¨å¥¨ï¼‰</option>\n                <option value="gpt-4o-mini" <?= currentModel === \'gpt-4o-mini\' ? \'selected\' : \'\' ?>>GPT-4o-miniï¼ˆäº’æ›ãƒ»ä½ã‚³ã‚¹ãƒˆï¼‰</option>\n                <option value="gpt-5-mini" <?= currentModel === \'gpt-5-mini\' ? \'selected\' : \'\' ?>>GPT-5-miniï¼ˆã‚„ã‚„é«˜å“è³ªï¼‰</option>\n              </select>\n              <div class="cost-info">ç›®å®‰: GPT-5-nano â‰ˆ ~$0.0003â€“0.0004 / 1K tokens</div>\n            </div>\n\n            <div class="platform-content" id="claude-content">\n              <label for="claudeApiKey">Claude APIã‚­ãƒ¼ *</label>\n              <input type="text" id="claudeApiKey" name="claudeApiKey" value="<?= currentApiKeys.claude || \'\' ?>" placeholder="sk-ant-...">\n              <div class="help-text">Anthropicã®APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>\n\n              <label for="claudeModel">ãƒ¢ãƒ‡ãƒ«é¸æŠ *</label>\n              <select id="claudeModel" name="claudeModel">\n                <option value="claude-3-haiku-20240307" <?= currentModel === \'claude-3-haiku-20240307\' ? \'selected\' : \'\' ?>>Claude 3 Haikuï¼ˆæœ€å®‰ãƒ»æ¨å¥¨ï¼‰</option>\n                <option value="claude-3-sonnet-20240229" <?= currentModel === \'claude-3-sonnet-20240229\' ? \'selected\' : \'\' ?>>Claude 3 Sonnetï¼ˆãƒãƒ©ãƒ³ã‚¹ï¼‰</option>\n                <option value="claude-3-opus-20240229" <?= currentModel === \'claude-3-opus-20240229\' ? \'selected\' : \'\' ?>>Claude 3 Opusï¼ˆé«˜æ€§èƒ½ï¼‰</option>\n              </select>\n              <div class="cost-info">å‚è€ƒ: Haiku â‰ˆ ~$0.0015 / 1K tokens ã»ã‹</div>\n            </div>\n\n            <div class="platform-content" id="gemini-content">\n              <label for="geminiApiKey">Gemini APIã‚­ãƒ¼ *</label>\n              <input type="text" id="geminiApiKey" name="geminiApiKey" value="<?= currentApiKeys.gemini || \'\' ?>" placeholder="AIza...">\n              <div class="help-text">Google AI Studioã®APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>\n\n              <label for="geminiModel">ãƒ¢ãƒ‡ãƒ«é¸æŠ *</label>\n              <select id="geminiModel" name="geminiModel">\n                <option value="gemini-1.5-flash" <?= currentModel === \'gemini-1.5-flash\' ? \'selected\' : \'\' ?>>Gemini 1.5 Flashï¼ˆæœ€å®‰ãƒ»æ¨å¥¨ï¼‰</option>\n                <option value="gemini-1.5-pro" <?= currentModel === \'gemini-1.5-pro\' ? \'selected\' : \'\' ?>>Gemini 1.5 Proï¼ˆãƒãƒ©ãƒ³ã‚¹ï¼‰</option>\n                <option value="gemini-pro" <?= currentModel === \'gemini-pro\' ? \'selected\' : \'\' ?>>Gemini Proï¼ˆå®‰å®šï¼‰</option>\n              </select>\n              <div class="cost-info">å‚è€ƒ: Flash â‰ˆ ~$0.0008 / 1K tokens ã»ã‹</div>\n            </div>\n          </div>\n\n          <label for="sheetName">ä½œæ¥­ã‚·ãƒ¼ãƒˆå *</label>\n          <input type="text" id="sheetName" name="sheetName" value="<?= currentSheetName ?>" required>\n          <div class="help-text">ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚’è¡Œã†ã‚·ãƒ¼ãƒˆã®åå‰</div>\n\n          <div class="info-box">\n            <div class="title">ã‚³ã‚¹ãƒˆæ¯”è¼ƒã®ç›®å®‰ï¼ˆ1K tokensï¼‰</div>\n            <div class="content">\n              æœ€å®‰: GPT-5-nano â‰² GPT-5-mini â‰² Gemini 1.5 Flash â‰² Claude 3 Haiku<br>\n              é«˜æ€§èƒ½: Claude 3 Opus / GPT-5-mini / GPT-4ç³» / Gemini 1.5 Proï¼ˆç”¨é€”æ¬¡ç¬¬ï¼‰<br>\n              ã¾ãšã¯ GPT-5-nano ã‚’ãŠè©¦ã—ãã ã•ã„ï¼ˆæ¨å¥¨ï¼‰\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- 2. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š -->\n      <div class="section" data-section="prompt">\n        <div class="section-header" onclick="toggleSection(\'prompt\')">\n          <div class="section-title">\n            <span class="priority-badge priority-recommended">æ¨å¥¨</span>\n            <div>\n              <div>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š</div>\n              <div class="section-description">AIç”Ÿæˆã®å“è³ªã‚’æ±ºå®šã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š</div>\n            </div>\n          </div>\n          <div class="section-controls">\n            <div class="edit-toggle">\n              <label><input type="radio" name="edit-prompt" value="maintain" checked> ç¶­æŒ</label>\n              <label><input type="radio" name="edit-prompt" value="edit"> ç·¨é›†</label>\n            </div>\n            <button type="button" class="collapse-btn">â–¼</button>\n          </div>\n        </div>\n        <div class="section-content" id="content-prompt">\n          <label for="promptId">ä½¿ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ *</label>\n          <select id="promptId" name="promptId" required>\n            <? for (var i = 0; i < promptIds.length; i++) { ?>\n              <option value="<?= promptIds[i] ?>" <?= promptIds[i] === currentPromptId ? \'selected\' : \'\' ?>>\n                <?= promptIds[i] ?>\n              </option>\n            <? } ?>\n          </select>\n          <div class="help-text">GPT_Prompts ã‚·ãƒ¼ãƒˆã‹ã‚‰é¸æŠ</div>\n\n          <div class="info-box">\n            <div class="title">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†</div>\n            <div class="content">\n              ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å†…å®¹ã¯ã€Œãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†ã€ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§å¤‰æ›´ã§ãã¾ã™ã€‚<br>\n              ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ŒAIç¿»è¨³ãƒ»ä¾¡æ ¼è¨ˆç®—ã€â†’ã€Œãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†ã€ã‹ã‚‰é–‹ã‘ã¾ã™ã€‚\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- 3. åˆ©ç›Šãƒ»ä¾¡æ ¼è¨ˆç®— -->\n      <div class="section" data-section="price-calc">\n        <div class="section-header" onclick="toggleSection(\'price-calc\')">\n          <div class="section-title">\n            <span class="priority-badge priority-required">å¿…é ˆ</span>\n            <div>\n              <div>åˆ©ç›Šãƒ»ä¾¡æ ¼è¨ˆç®—</div>\n              <div class="section-description">åˆ©ç›Šè¨ˆç®—ã¨ä¾¡æ ¼è¡¨ç¤ºã®è¨­å®š</div>\n            </div>\n          </div>\n          <div class="section-controls">\n            <div class="edit-toggle">\n              <label><input type="radio" name="edit-price-calc" value="maintain" checked> ç¶­æŒ</label>\n              <label><input type="radio" name="edit-price-calc" value="edit"> ç·¨é›†</label>\n            </div>\n            <button type="button" class="collapse-btn">â–¼</button>\n          </div>\n        </div>\n        <div class="section-content" id="content-price-calc">\n          <label>åˆ©ç›Šè¨ˆç®—æ–¹æ³• *</label>\n          <div class="radio-group">\n            <label><input type="radio" name="profitMethod" value="RATE" <?= currentProfitCalculationMethod === \'RATE\' ? \'checked\' : \'\' ?>> åˆ©ç›Šç‡ã§è¨ˆç®—</label>\n            <label><input type="radio" name="profitMethod" value="AMOUNT" <?= currentProfitCalculationMethod === \'AMOUNT\' ? \'checked\' : \'\' ?>> åˆ©ç›Šé¡ã§è¨ˆç®—</label>\n          </div>\n\n          <label>ä¾¡æ ¼è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ *</label>\n          <div class="radio-group">\n            <label><input type="radio" name="priceDisplayMode" value="NORMAL" <?= (currentPriceDisplayMode === \'NORMAL\' || !currentPriceDisplayMode) ? \'checked\' : \'\' ?>> è²©å£²ä¾¡æ ¼ï¼ˆDDUï¼‰</label>\n            <label><input type="radio" name="priceDisplayMode" value="TAX_INCLUDED" <?= currentPriceDisplayMode === \'TAX_INCLUDED\' ? \'checked\' : \'\' ?>> é–¢ç¨è¾¼ã¿ä¾¡æ ¼ï¼ˆDDPï¼‰</label>\n          </div>\n\n          <label>DDUä¾¡æ ¼èª¿æ•´æ©Ÿèƒ½</label>\n          <div class="checkbox-group">\n            <label class="checkbox-label">\n <input type="checkbox" id="dduAdjustmentEnabled" name="dduAdjustmentEnabled" checked>\n  DDUä¾¡æ ¼èª¿æ•´æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹\n</label>\n          </div>\n          \n\n          <div id="dduSettingsGroup">\n            <div class="input-row">\n              <div class="input-group">\n                <label for="dduThreshold">æƒ³å®šé–¢ç¨é–¾å€¤ï¼ˆãƒ‰ãƒ«ï¼‰:</label>\n                <input type="number" id="dduThreshold" name="dduThreshold"\n                       value="<?= currentDduThreshold ?>" min="1" step="1">\n              </div>\n            </div>\n            <div class="help-text">\n              æƒ³å®šé–¢ç¨ï¼ˆADåˆ—ï¼‰ãŒé–¾å€¤ä»¥ä¸Šã®å ´åˆã€DDPä¾¡æ ¼ï¼ˆSåˆ—ï¼‰ã‹ã‚‰æƒ³å®šé–¢ç¨ã‚’å¼•ã„ãŸä¾¡æ ¼ã‚’è¨ˆç®—ã—ã¾ã™\n            </div>\n          </div>\n\n          <div class="info-box">\n            <div class="title">ä¾¡æ ¼è¨ˆç®—ã®è¨­å®šç®‡æ‰€</div>\n            <div class="content">\n              â€¢ æ‰‹æ•°æ–™ç‡: F1 / åºƒå‘Šè²»ç‡: F2<br>\n              â€¢ åˆ©ç›Šé¡: H1ï¼ˆåˆ©ç›Šé¡è¨ˆç®—é¸æŠæ™‚ï¼‰<br>\n              â€¢ åˆ©ç›Šç‡: H2ï¼ˆåˆ©ç›Šç‡è¨ˆç®—é¸æŠæ™‚ï¼‰\n            </div>\n          </div>\n\n          <div class="warning-box">\n            <div class="title">DDUä¾¡æ ¼èª¿æ•´æ©Ÿèƒ½ã®æ³¨æ„äº‹é …</div>\n            <div class="content">\n              ã“ã®æ©Ÿèƒ½ã¯DDUå•†å“å°‚ç”¨ã§ã™ã€‚DDPã§å‡ºå“ã™ã‚‹å ´åˆã§ã‚‚ã€å®Ÿéš›ã®è²©å£²ä¾¡æ ¼ã¯DDUä¾¡æ ¼ã‚’ä½¿ç”¨ã—ã€é–¢ç¨åˆ†ã‚’é€æ–™ã¨ã—ã¦åˆ¥é€”å¾´åã™ã‚‹ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«å‘ã‘ã§ã™ã€‚\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- 4. é€æ–™ãƒ»é…é€è¨­å®š -->\n      <div class="section" data-section="shipping">\n        <div class="section-header" onclick="toggleSection(\'shipping\')">\n          <div class="section-title">\n            <span class="priority-badge priority-required">å¿…é ˆ</span>\n            <div>\n              <div>é€æ–™ãƒ»é…é€è¨­å®š</div>\n              <div class="section-description">é€æ–™è¨ˆç®—ã¨é…é€æ–¹æ³•ã®è¨­å®š</div>\n            </div>\n          </div>\n          <div class="section-controls">\n            <div class="edit-toggle">\n              <label><input type="radio" name="edit-shipping" value="maintain" checked> ç¶­æŒ</label>\n              <label><input type="radio" name="edit-shipping" value="edit"> ç·¨é›†</label>\n            </div>\n            <button type="button" class="collapse-btn">â–¼</button>\n          </div>\n        </div>\n        <div class="section-content" id="content-shipping">\n          <label>é€æ–™è¨ˆç®—æ–¹æ³• *</label>\n          <div class="radio-group">\n            <label><input type="radio" name="shippingCalcMethod" value="TABLE" <?= currentShippingCalculationMethod === \'TABLE\' ? \'checked\' : \'\' ?>> ãƒ†ãƒ¼ãƒ–ãƒ«è¨ˆç®—</label>\n            <label><input type="radio" name="shippingCalcMethod" value="FIXED" <?= currentShippingCalculationMethod === \'FIXED\' ? \'checked\' : \'\' ?>> å›ºå®šé‡‘é¡</label>\n          </div>\n\n          <label for="shippingThreshold">é€æ–™è¨ˆç®—åˆ‡æ›¿åŸºæº–é‡‘é¡ï¼ˆå††ï¼‰ *</label>\n          <input type="number" id="shippingThreshold" name="shippingThreshold" value="<?= currentShippingThreshold ?>" min="1" step="1" required>\n          <div class="help-text">ã“ã®é‡‘é¡ä»¥ä¸Šã¯é«˜ä¾¡æ ¼é…é€ã€æœªæº€ã®å ´åˆã¯ä½ä¾¡æ ¼é…é€ã‚’ä½¿ç”¨</div>\n\n          <label for="lowPriceMethod">ä½ä¾¡æ ¼å•†å“é…é€æ–¹æ³• *</label>\n          <select id="lowPriceMethod" name="lowPriceMethod" required>\n            <? Object.keys(lowPriceOptions).forEach(function(key) { ?>\n              <option value="<?= key ?>" <?= currentLowPriceMethod === key ? \'selected\' : \'\' ?>>\n                <?= lowPriceOptions[key].displayName ?>\n              </option>\n            <? }); ?>\n          </select>\n\n          <label for="highPriceMethod">é«˜ä¾¡æ ¼å•†å“é…é€æ–¹æ³• *</label>\n          <select id="highPriceMethod" name="highPriceMethod" required>\n            <? Object.keys(highPriceOptions).forEach(function(key) { ?>\n              <option value="<?= key ?>" <?= currentHighPriceMethod === key ? \'selected\' : \'\' ?>>\n                <?= highPriceOptions[key].displayName ?>\n              </option>\n            <? }); ?>\n          </select>\n\n          <div class="info-box">\n            <div class="title">é€æ–™è¨ˆç®—æ–¹æ³•ã®èª¬æ˜</div>\n            <div class="content">\n              <strong>ãƒ†ãƒ¼ãƒ–ãƒ«è¨ˆç®—</strong>: é‡é‡ãƒ»ã‚µã‚¤ã‚ºã«åŸºã¥ã„ã¦è‡ªå‹•è¨ˆç®—ï¼ˆæ¨å¥¨ï¼‰<br>\n              <strong>å›ºå®šé‡‘é¡</strong>: J1 ã¾ãŸã¯ Profit_Amounts!D ã‹ã‚‰å–å¾—<br><br>\n              <strong>å›ºå®šé‡‘é¡ã®è¨­å®š</strong><br>\n              â€¢ å…¨å•†å“å…±é€š: J1 ã‚»ãƒ«ã«é‡‘é¡ã‚’å…¥åŠ›<br>\n              â€¢ ä»•å…¥ã‚Œå€¤åˆ¥: Profit_Amounts!Dåˆ—ã«å„é‡‘é¡å¸¯ã®é€æ–™\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- 5. é‡è¤‡ãƒã‚§ãƒƒã‚¯è¨­å®š -->\n      <div class="section" data-section="duplicate-check">\n        <div class="section-header" onclick="toggleSection(\'duplicate-check\')">\n          <div class="section-title">\n            <span class="priority-badge priority-optional">ä»»æ„</span>\n            <div>\n              <div>é‡è¤‡ãƒã‚§ãƒƒã‚¯è¨­å®š</div>\n              <div class="section-description">å•†å“ã®é‡è¤‡ã‚’è‡ªå‹•æ¤œå‡ºã™ã‚‹æ©Ÿèƒ½</div>\n            </div>\n          </div>\n          <div class="section-controls">\n            <div class="edit-toggle">\n              <label><input type="radio" name="edit-duplicate-check" value="maintain" checked> ç¶­æŒ</label>\n              <label><input type="radio" name="edit-duplicate-check" value="edit"> ç·¨é›†</label>\n            </div>\n            <button type="button" class="collapse-btn">â–¼</button>\n          </div>\n        </div>\n        <div class="section-content" id="content-duplicate-check">\n          <div class="checkbox-group">\n            <label class="checkbox-label">\n              <input type="checkbox" id="duplicateCheckEnabled" name="duplicateCheckEnabled" \n                     <?= currentDuplicateCheckEnabled === \'true\' ? \'checked\' : \'\' ?>>\n              é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹\n            </label>\n          </div>\n\n          <div id="duplicateCheckSettings">\n            <label for="duplicateSourceSheet">ä½œæ¥­ã‚·ãƒ¼ãƒˆï¼ˆé‡è¤‡ã‚’ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹å´ï¼‰:</label>\n            <select id="duplicateSourceSheet" name="duplicateSourceSheet">\n              <option value="">ã‚·ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</option>\n            </select>\n\n            <label for="duplicateSourceColumn">ä½œæ¥­ã‚·ãƒ¼ãƒˆã®åˆ—:</label>\n            <select id="duplicateSourceColumn" name="duplicateSourceColumn">\n              <option value="">åˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„</option>\n              <option value="A">Aåˆ—</option>\n              <option value="B">Båˆ—</option>\n              <option value="C">Cåˆ—</option>\n              <option value="D">Dåˆ—</option>\n              <option value="E">Eåˆ—</option>\n              <option value="F">Fåˆ—</option>\n              <option value="G">Gåˆ—</option>\n              <option value="H">Håˆ—</option>\n              <option value="I">Iåˆ—</option>\n              <option value="J">Jåˆ—</option>\n            </select>\n\n            <label>ãƒã‚§ãƒƒã‚¯å¯¾è±¡ã‚·ãƒ¼ãƒˆï¼ˆé‡è¤‡å…ƒï¼‰:</label>\n            <div id="targetSheetsContainer" class="target-sheets-container">\n              <div id="noTargetSheetsMsg">å‚ç…§ã‚·ãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</div>\n            </div>\n            <button type="button" onclick="addTargetSheetDropdown()">å‚ç…§ã‚·ãƒ¼ãƒˆè¿½åŠ </button>\n\n            <div class="checkbox-group">\n              <label class="checkbox-label">\n                <input type="checkbox" id="applyToSheet" name="applyToSheet">\n                ç”Ÿæˆã—ãŸå¼ã‚’ã‚·ãƒ¼ãƒˆã«ç›´æ¥é©ç”¨ã™ã‚‹\n              </label>\n            </div>\n\n            <div id="outputSettings" style="display: none;">\n              <label for="outputSheet">å‡ºåŠ›å…ˆã‚·ãƒ¼ãƒˆ:</label>\n              <select id="outputSheet" name="outputSheet">\n                <option value="">ã‚·ãƒ¼ãƒˆã‚’é¸æŠ...</option>\n              </select>\n\n              <div class="input-row">\n                <div class="input-group">\n                  <label for="outputColumn">å‡ºåŠ›å…ˆåˆ—:</label>\n                  <select id="outputColumn" name="outputColumn">\n                    <option value="">åˆ—ã‚’é¸æŠ...</option>\n                  </select>\n                </div>\n                <div class="input-group">\n                  <label for="outputStartRow">é–‹å§‹è¡Œ:</label>\n                  <input type="number" id="outputStartRow" name="outputStartRow" value="1" min="1">\n                </div>\n              </div>\n\n              <label for="outputRange">é©ç”¨ç¯„å›²:</label>\n              <select id="outputRange" name="outputRange">\n                <option value="DATA">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ç¯„å›²ã¾ã§</option>\n                <option value="CUSTOM">ã‚«ã‚¹ã‚¿ãƒ ç¯„å›²ï¼ˆ100è¡Œï¼‰</option>\n                <option value="ALL">ã‚·ãƒ¼ãƒˆå…¨ä½“ï¼ˆ1000è¡Œï¼‰</option>\n              </select>\n            </div>\n          </div>\n\n          <div class="info-box">\n            <div class="title">é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã«ã¤ã„ã¦</div>\n            <div class="content">\n              ä½œæ¥­ã‚·ãƒ¼ãƒˆã§ã®å…¥åŠ›æ™‚ã«ã€æ—¢å­˜ã®ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã¨é‡è¤‡ã™ã‚‹å•†å“ã‚’è‡ªå‹•æ¤œå‡ºã—ã¾ã™ã€‚<br>\n              ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒï¼ˆä¿å­˜ãƒ‡ãƒ¼ã‚¿_*ï¼‰ã‚‚ä½¿ç”¨å¯èƒ½ã§ã™ã€‚\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- 6. è¡¨ç¤ºè¨­å®š -->\n      <div class="section" data-section="display">\n        <div class="section-header" onclick="toggleSection(\'display\')">\n          <div class="section-title">\n            <span class="priority-badge priority-optional">ä»»æ„</span>\n            <div>\n              <div>è¡¨ç¤ºè¨­å®š</div>\n              <div class="section-description">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«é–¢ã™ã‚‹è¨­å®š</div>\n            </div>\n          </div>\n          <div class="section-controls">\n            <div class="edit-toggle">\n              <label><input type="radio" name="edit-display" value="maintain" checked> ç¶­æŒ</label>\n              <label><input type="radio" name="edit-display" value="edit"> ç·¨é›†</label>\n            </div>\n            <button type="button" class="collapse-btn">â–¼</button>\n          </div>\n        </div>\n        <div class="section-content" id="content-display">\n          <label>ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤ºè¨­å®š *</label>\n          <div class="radio-group">\n            <label><input type="radio" name="showPopups" value="true" <?= currentShowPopups === \'true\' ? \'checked\' : \'\' ?>> ONï¼ˆè¡¨ç¤ºã™ã‚‹ï¼‰</label>\n            <label><input type="radio" name="showPopups" value="false" <?= (currentShowPopups === \'false\' || !currentShowPopups) ? \'checked\' : \'\' ?>> OFFï¼ˆè¡¨ç¤ºã—ãªã„ï¼‰</label>\n          </div>\n          <div class="help-text">ä½œæ¥­é–‹å§‹ãƒ»å®Œäº†æ™‚ã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºã‚’åˆ¶å¾¡ï¼ˆã‚¨ãƒ©ãƒ¼ã¯å¸¸ã«è¡¨ç¤ºï¼‰</div>\n\n          <div class="info-box">\n            <div class="title">ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤ºã®èª¬æ˜</div>\n            <div class="content">\n              â€¢ ON: ä½œæ¥­é–‹å§‹æ™‚ã«ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã€å®Œäº†æ™‚ã«çµæœè¡¨ç¤º<br>\n              â€¢ OFF: ç¢ºèªãªã—ã§å³åº§ã«å®Ÿè¡Œé–‹å§‹ã€å®Œäº†æ™‚ã‚‚ç„¡é€šçŸ¥<br>\n              â€¢ ã‚¨ãƒ©ãƒ¼: è¨­å®šã«é–¢ä¿‚ãªãå¸¸ã«è¡¨ç¤ºï¼ˆå®‰å…¨ã®ãŸã‚ï¼‰<br>\n              â€¢ ä½œæ¥­åˆ¶å¾¡: D2ã‚»ãƒ«ï¼ˆGO/STOPï¼‰ã§ã®åœæ­¢ã¯åˆ¥æ©Ÿèƒ½\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="button-group">\n        <button type="button" class="btn secondary" id="cancelBtn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>\n        <button type="submit" class="btn primary" id="saveBtn">\n          <span class="btn-label">ä¿å­˜</span>\n        </button>\n      </div>\n    </form>\n  </div>\n\n  <script>\n    // åˆæœŸè¨­å®š\n    const CURRENT_PLATFORM = "<?= typeof currentPlatform !== \'undefined\' ? currentPlatform : \'openai\' ?>";\n    const DEFAULT_OPENAI_MODEL = "gpt-5-nano";\n    \n    var allSheetNames = [];\n    var targetSheetCounter = 0;\n\n    // åˆæœŸåŒ–\n    document.addEventListener(\'DOMContentLoaded\', function() {\n      initializeSections();\n      initializePlatformTabs();\n      loadSheetNames();\n      setupEventListeners();\n      updateSectionStates();\n    });\n\n    // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†\n    function toggleSection(sectionId) {\n      const content = document.getElementById(\'content-\' + sectionId);\n      const btn = document.querySelector(`[data-section="${sectionId}"] .collapse-btn`);\n      \n      if (content.classList.contains(\'expanded\')) {\n        content.classList.remove(\'expanded\');\n        btn.classList.add(\'collapsed\');\n      } else {\n        content.classList.add(\'expanded\');\n        btn.classList.remove(\'collapsed\');\n      }\n    }\n\n    function initializeSections() {\n      // å¿…é ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯åˆæœŸå±•é–‹\n      const requiredSections = [\'ai-basic\', \'price-calc\', \'shipping\'];\n      requiredSections.forEach(sectionId => {\n        const content = document.getElementById(\'content-\' + sectionId);\n        content.classList.add(\'expanded\');\n      });\n    }\n\n    function updateSectionStates() {\n      document.querySelectorAll(\'[name^="edit-"]\').forEach(radio => {\n        radio.addEventListener(\'change\', function() {\n          const sectionId = this.name.replace(\'edit-\', \'\');\n          const content = document.getElementById(\'content-\' + sectionId);\n          const isEdit = this.value === \'edit\';\n          \n          if (isEdit) {\n            content.classList.remove(\'disabled-overlay\');\n          } else {\n            content.classList.add(\'disabled-overlay\');\n          }\n        });\n      });\n    }\n\n    // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚¿ãƒ–\n    function initializePlatformTabs() {\n      const tabs = document.querySelectorAll(\'.platform-tab\');\n      const contents = {\n        openai: document.getElementById(\'openai-content\'),\n        claude: document.getElementById(\'claude-content\'),\n        gemini: document.getElementById(\'gemini-content\')\n      };\n\n      function activatePlatform(platform) {\n        tabs.forEach(tab => tab.classList.toggle(\'active\', tab.dataset.platform === platform));\n        Object.keys(contents).forEach(key => contents[key].classList.toggle(\'active\', key === platform));\n      }\n\n      activatePlatform(CURRENT_PLATFORM || \'openai\');\n\n      tabs.forEach(tab => {\n        tab.addEventListener(\'click\', function() {\n          activatePlatform(this.dataset.platform);\n        });\n      });\n    }\n\n    // ã‚·ãƒ¼ãƒˆåå–å¾—\n    function loadSheetNames() {\n      google.script.run\n        .withSuccessHandler(function(sheetNames) {\n          allSheetNames = sheetNames;\n          populateSheetDropdowns();\n        })\n        .withFailureHandler(function(error) {\n          console.error(\'ã‚·ãƒ¼ãƒˆåå–å¾—ã‚¨ãƒ©ãƒ¼:\', error);\n        })\n        .getAllSheetNames();\n    }\n\n    function populateSheetDropdowns() {\n      const duplicateSourceSheet = document.getElementById(\'duplicateSourceSheet\');\n      const outputSheet = document.getElementById(\'outputSheet\');\n      \n      [duplicateSourceSheet, outputSheet].forEach(select => {\n        if (select) {\n          select.innerHTML = \'<option value="">ã‚·ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</option>\';\n          allSheetNames.forEach(name => {\n            const option = document.createElement(\'option\');\n            option.value = name;\n            option.textContent = name;\n            select.appendChild(option);\n          });\n        }\n      });\n\n      // å‡ºåŠ›åˆ—ã®è¨­å®š\n      const outputColumn = document.getElementById(\'outputColumn\');\n      if (outputColumn) {\n        outputColumn.innerHTML = \'<option value="">åˆ—ã‚’é¸æŠ...</option>\';\n        // Aï½Zåˆ—\n        for (let i = 0; i < 26; i++) {\n          const col = String.fromCharCode(65 + i);\n          const option = document.createElement(\'option\');\n          option.value = col;\n          option.textContent = col + \'åˆ—\';\n          outputColumn.appendChild(option);\n        }\n        // AAï½AZåˆ—\n        for (let i = 0; i < 26; i++) {\n          const col = \'A\' + String.fromCharCode(65 + i);\n          const option = document.createElement(\'option\');\n          option.value = col;\n          option.textContent = col + \'åˆ—\';\n          outputColumn.appendChild(option);\n        }\n      }\n    }\n\n    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š\n    function setupEventListeners() {\n      // DDUä¾¡æ ¼èª¿æ•´æ©Ÿèƒ½\n      const dduCheckbox = document.getElementById(\'dduAdjustmentEnabled\');\n      const dduSettings = document.getElementById(\'dduSettingsGroup\');\n      \n      function toggleDduSettings() {\n        const enabled = dduCheckbox.checked;\n        dduSettings.style.display = enabled ? \'block\' : \'none\';\n        dduSettings.style.opacity = enabled ? \'1\' : \'0.5\';\n      }\n      \n      if (dduCheckbox) {\n        dduCheckbox.addEventListener(\'change\', toggleDduSettings);\n        toggleDduSettings();\n      }\n\n      // é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½\n      const duplicateCheckbox = document.getElementById(\'duplicateCheckEnabled\');\n      const duplicateSettings = document.getElementById(\'duplicateCheckSettings\');\n      \n      function toggleDuplicateSettings() {\n        const enabled = duplicateCheckbox.checked;\n        duplicateSettings.style.display = enabled ? \'block\' : \'none\';\n        duplicateSettings.style.opacity = enabled ? \'1\' : \'0.5\';\n      }\n      \n      if (duplicateCheckbox) {\n        duplicateCheckbox.addEventListener(\'change\', toggleDuplicateSettings);\n        toggleDuplicateSettings();\n      }\n\n      // å‡ºåŠ›è¨­å®šè¡¨ç¤ºåˆ¶å¾¡\n      const applyCheckbox = document.getElementById(\'applyToSheet\');\n      const outputSettings = document.getElementById(\'outputSettings\');\n      \n      if (applyCheckbox) {\n        applyCheckbox.addEventListener(\'change\', function() {\n          outputSettings.style.display = this.checked ? \'block\' : \'none\';\n        });\n      }\n\n      // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡\n      const form = document.getElementById(\'setupForm\');\n      const saveBtn = document.getElementById(\'saveBtn\');\n      const btnLabel = saveBtn.querySelector(\'.btn-label\');\n\n      form.addEventListener(\'submit\', function(e) {\n        e.preventDefault();\n        handleFormSubmit();\n      });\n\n      // ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n      document.getElementById(\'cancelBtn\').addEventListener(\'click\', function() {\n        google.script.host.close();\n      });\n    }\n\n    // é‡è¤‡ãƒã‚§ãƒƒã‚¯: å‚ç…§ã‚·ãƒ¼ãƒˆè¿½åŠ \n    function addTargetSheetDropdown() {\n      const container = document.getElementById(\'targetSheetsContainer\');\n      const noMsgDiv = document.getElementById(\'noTargetSheetsMsg\');\n      if (noMsgDiv) noMsgDiv.style.display = \'none\';\n      \n      targetSheetCounter++;\n      const itemDiv = document.createElement(\'div\');\n      itemDiv.className = \'target-sheet-item\';\n      itemDiv.id = \'targetSheet_\' + targetSheetCounter;\n      \n      // ã‚·ãƒ¼ãƒˆé¸æŠ\n      const sheetDiv = document.createElement(\'div\');\n      const sheetSelect = document.createElement(\'select\');\n      sheetSelect.className = \'target-sheet-select\';\n      sheetSelect.innerHTML = \'<option value="">å‚ç…§ã‚·ãƒ¼ãƒˆã‚’é¸æŠ</option>\';\n      \n      allSheetNames.forEach(name => {\n        const option = document.createElement(\'option\');\n        option.value = name;\n        option.textContent = name;\n        sheetSelect.appendChild(option);\n      });\n      \n      const specialOption = document.createElement(\'option\');\n      specialOption.value = \'ä¿å­˜ãƒ‡ãƒ¼ã‚¿_*\';\n      specialOption.textContent = \'ä¿å­˜ãƒ‡ãƒ¼ã‚¿_* (ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒ)\';\n      sheetSelect.appendChild(specialOption);\n      \n      sheetDiv.appendChild(sheetSelect);\n      \n      // åˆ—é¸æŠ\n      const columnDiv = document.createElement(\'div\');\n      const columnSelect = document.createElement(\'select\');\n      columnSelect.className = \'target-column-select\';\n      columnSelect.innerHTML = \'<option value="">åˆ—é¸æŠ</option>\';\n      \n      [\'A\',\'B\',\'C\',\'D\',\'E\',\'F\',\'G\',\'H\',\'I\',\'J\'].forEach(col => {\n        const option = document.createElement(\'option\');\n        option.value = col;\n        option.textContent = col + \'åˆ—\';\n        if (col === \'H\') option.selected = true;\n        columnSelect.appendChild(option);\n      });\n      columnDiv.appendChild(columnSelect);\n      \n      // å‰Šé™¤ãƒœã‚¿ãƒ³\n      const removeBtn = document.createElement(\'button\');\n      removeBtn.textContent = \'å‰Šé™¤\';\n      removeBtn.type = \'button\';\n      removeBtn.onclick = function() {\n        itemDiv.remove();\n        if (container.querySelectorAll(\'.target-sheet-item\').length === 0) {\n          if (noMsgDiv) noMsgDiv.style.display = \'block\';\n        }\n      };\n      \n      itemDiv.appendChild(sheetDiv);\n      itemDiv.appendChild(columnDiv);\n      itemDiv.appendChild(removeBtn);\n      container.appendChild(itemDiv);\n    }\n\n    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†\n    function handleFormSubmit() {\n      const saveBtn = document.getElementById(\'saveBtn\');\n      const btnLabel = saveBtn.querySelector(\'.btn-label\');\n\n      function setLoading(isLoading) {\n        if (isLoading) {\n          saveBtn.disabled = true;\n          btnLabel.innerHTML = \'<span class="spinner"></span>ä¿å­˜ä¸­...\';\n        } else {\n          saveBtn.disabled = false;\n          btnLabel.textContent = \'ä¿å­˜\';\n        }\n      }\n\n      // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç‰¹å®š\n      const activeTab = document.querySelector(\'.platform-tab.active\');\n      const activePlatform = activeTab ? activeTab.getAttribute(\'data-platform\') : \'openai\';\n\n      let apiKey = \'\', model = \'\';\n      if (activePlatform === \'openai\') {\n        apiKey = document.getElementById(\'openaiApiKey\').value.trim();\n        model = document.getElementById(\'openaiModel\').value || DEFAULT_OPENAI_MODEL;\n      } else if (activePlatform === \'claude\') {\n        apiKey = document.getElementById(\'claudeApiKey\').value.trim();\n        model = document.getElementById(\'claudeModel\').value;\n      } else if (activePlatform === \'gemini\') {\n        apiKey = document.getElementById(\'geminiApiKey\').value.trim();\n        model = document.getElementById(\'geminiModel\').value;\n      }\n\n      if (!apiKey) {\n        alert(\'é¸æŠã—ãŸãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\');\n        return;\n      }\n\n      // é‡è¤‡ãƒã‚§ãƒƒã‚¯ã®å¯¾è±¡ã‚·ãƒ¼ãƒˆåé›†\n      const targetSheets = [];\n      const targetItems = document.querySelectorAll(\'.target-sheet-item\');\n      targetItems.forEach(item => {\n        const sheetSelect = item.querySelector(\'.target-sheet-select\');\n        const columnSelect = item.querySelector(\'.target-column-select\');\n        \n        if (sheetSelect && sheetSelect.value && columnSelect && columnSelect.value) {\n          targetSheets.push({\n            sheet: sheetSelect.value,\n            column: columnSelect.value\n          });\n        }\n      });\n\n      const formData = {\n        // åŸºæœ¬è¨­å®š\n        platform: activePlatform,\n        apiKey: apiKey,\n        model: model,\n        sheetName: document.getElementById(\'sheetName\').value,\n        \n        // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š\n        promptId: document.getElementById(\'promptId\').value,\n        \n        // åˆ©ç›Šãƒ»ä¾¡æ ¼è¨ˆç®—\n        profitMethod: document.querySelector(\'input[name="profitMethod"]:checked\').value,\n        priceDisplayMode: document.querySelector(\'input[name="priceDisplayMode"]:checked\').value,\n        dduAdjustmentEnabled: document.getElementById(\'dduAdjustmentEnabled\').checked ? \'true\' : \'false\',\n        dduThreshold: document.getElementById(\'dduThreshold\').value,\n        \n        // é€æ–™ãƒ»é…é€è¨­å®š\n        shippingCalcMethod: document.querySelector(\'input[name="shippingCalcMethod"]:checked\').value,\n        shippingThreshold: document.getElementById(\'shippingThreshold\').value,\n        lowPriceMethod: document.getElementById(\'lowPriceMethod\').value,\n        highPriceMethod: document.getElementById(\'highPriceMethod\').value,\n        \n        // é‡è¤‡ãƒã‚§ãƒƒã‚¯è¨­å®š\n        duplicateCheckEnabled: document.getElementById(\'duplicateCheckEnabled\').checked,\n        duplicateSourceSheet: document.getElementById(\'duplicateSourceSheet\').value,\n        duplicateSourceColumn: document.getElementById(\'duplicateSourceColumn\').value,\n        duplicateTargetSheets: targetSheets,\n        duplicateApplyToSheet: document.getElementById(\'applyToSheet\').checked,\n        duplicateOutputSheet: document.getElementById(\'outputSheet\').value,\n        duplicateOutputColumn: document.getElementById(\'outputColumn\').value,\n        duplicateOutputStartRow: document.getElementById(\'outputStartRow\').value,\n        duplicateOutputRange: document.getElementById(\'outputRange\').value,\n        \n        // è¡¨ç¤ºè¨­å®š\n        showPopups: document.querySelector(\'input[name="showPopups"]:checked\').value\n      };\n\n      setLoading(true);\n      google.script.run\n        .withSuccessHandler(function(result) {\n          setLoading(false);\n          if (result.success) {\n            google.script.host.close();\n          } else {\n            alert(\'ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: \' + result.error);\n          }\n        })\n        .withFailureHandler(function(error) {\n          setLoading(false);\n          alert(\'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: \' + (error && error.message ? error.message : error));\n        })\n        .saveIntegratedSettings(formData);\n    }\n  </script>\n</body>\n</html>';


HTML_TEMPLATES['PriceCalc'] = '<!DOCTYPE html>\n<html lang="ja">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>ECä¾¡æ ¼è¨ˆç®—ãƒ„ãƒ¼ãƒ«</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            font-family: \'Segoe UI\', Tahoma, Geneva, Verdana, sans-serif;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            min-height: 100vh;\n            padding: 20px;\n        }\n\n        .container {\n            max-width: 1400px;\n            margin: 0 auto;\n            background: white;\n            border-radius: 20px;\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n            overflow: hidden;\n        }\n\n        .header {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            padding: 30px;\n            text-align: center;\n        }\n\n        .header h1 {\n            font-size: 2.5em;\n            margin-bottom: 10px;\n        }\n\n        .header p {\n            opacity: 0.9;\n            font-size: 1.1em;\n        }\n\n        .settings-section {\n            background: #f8f9fa;\n            padding: 25px;\n            border-bottom: 2px solid #e9ecef;\n        }\n\n        .settings-grid {\n            display: grid;\n            grid-template-columns: repeat(5, 1fr);\n            gap: 20px;\n            margin-bottom: 20px;\n        }\n\n        .input-group {\n            display: flex;\n            flex-direction: column;\n        }\n\n        .input-group label {\n            font-weight: 600;\n            margin-bottom: 8px;\n            color: #495057;\n            font-size: 0.9em;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .input-group input,\n        .input-group select {\n            padding: 12px;\n            border: 2px solid #dee2e6;\n            border-radius: 8px;\n            font-size: 1em;\n            transition: all 0.3s;\n        }\n\n        /* é‡è¦ãªé¸æŠé …ç›®ã‚’å¼·èª¿ */\n        #shippingMode,\n        #lowPriceMethod,\n        #highPriceMethod,\n        #shippingMethod {\n            background-color: #e3f2fd;\n        }\n\n        .refresh-rate-btn {\n            background: #17a2b8;\n            color: white;\n            border: none;\n            padding: 6px 12px;\n            border-radius: 5px;\n            font-size: 0.8em;\n            cursor: pointer;\n            transition: all 0.3s;\n            font-weight: 600;\n        }\n\n        .refresh-rate-btn:hover {\n            background: #138496;\n        }\n\n        .loading {\n            opacity: 0.6;\n            cursor: not-allowed;\n        }\n\n        .input-group input:focus {\n            outline: none;\n            border-color: #667eea;\n            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);\n        }\n\n        .save-settings-btn {\n            background: #28a745;\n            color: white;\n            border: none;\n            padding: 12px 30px;\n            border-radius: 8px;\n            font-size: 1em;\n            cursor: pointer;\n            transition: all 0.3s;\n            font-weight: 600;\n        }\n\n        .save-settings-btn:hover {\n            background: #218838;\n            transform: translateY(-2px);\n            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);\n        }\n\n        .main-content {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));\n            gap: 30px;\n            padding: 30px;\n        }\n\n        .calculator-card {\n            background: white;\n            border: 2px solid #e9ecef;\n            border-radius: 12px;\n            padding: 25px;\n            transition: all 0.3s;\n        }\n\n        .calculator-card:hover {\n            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);\n            transform: translateY(-4px);\n        }\n\n        .calculator-card.cost-calculation {\n            background: #fff8f0;\n            border: 2px solid #ffdbbb;\n        }\n\n        .calculator-card.cost-calculation:hover {\n            box-shadow: 0 8px 24px rgba(255, 152, 0, 0.15);\n        }\n\n        .section-divider {\n            grid-column: 1 / -1;\n            margin: 30px 0;\n            text-align: center;\n        }\n\n        .section-title {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            padding: 15px 30px;\n            border-radius: 10px;\n            display: inline-block;\n            font-size: 1.3em;\n            font-weight: 700;\n            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);\n        }\n\n        .section-title.cost-section {\n            background: linear-gradient(135deg, #ff9800 0%, #ff6f00 100%);\n            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);\n        }\n\n        .calculator-card h2 {\n            color: #667eea;\n            margin-bottom: 20px;\n            padding-bottom: 15px;\n            border-bottom: 3px solid #667eea;\n            font-size: 1.5em;\n        }\n\n        .calculator-card.cost-calculation h2 {\n            color: #ff6f00;\n            border-bottom: 3px solid #ff9800;\n        }\n\n        .calc-input-row {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 15px;\n            margin-bottom: 15px;\n        }\n\n        .calc-input-group {\n            display: flex;\n            flex-direction: column;\n        }\n\n        .calc-input-group label {\n            font-weight: 600;\n            margin-bottom: 6px;\n            color: #495057;\n            font-size: 0.9em;\n        }\n\n        .calc-input-group input,\n        .calc-input-group select {\n            padding: 10px;\n            border: 2px solid #dee2e6;\n            border-radius: 6px;\n            font-size: 0.95em;\n        }\n\n        .calculate-btn {\n            width: 100%;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            border: none;\n            padding: 15px;\n            border-radius: 8px;\n            font-size: 1.1em;\n            cursor: pointer;\n            margin-top: 15px;\n            font-weight: 600;\n            transition: all 0.3s;\n        }\n\n        .calculate-btn:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);\n        }\n\n        .result-section {\n            margin-top: 25px;\n            padding: 20px;\n            background: #f8f9fa;\n            border-radius: 8px;\n            border-left: 4px solid #667eea;\n        }\n\n        .result-section h3 {\n            color: #667eea;\n            margin-bottom: 15px;\n            font-size: 1.2em;\n        }\n\n        .result-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 15px;\n        }\n\n        .result-item {\n            background: white;\n            padding: 15px;\n            border-radius: 6px;\n            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n        }\n\n        .result-item label {\n            display: block;\n            font-size: 0.85em;\n            color: #6c757d;\n            margin-bottom: 5px;\n            font-weight: 600;\n        }\n\n        .result-item .value {\n            font-size: 1.3em;\n            font-weight: 700;\n            color: #212529;\n        }\n\n        .result-item.highlight .value {\n            color: #667eea;\n            font-size: 1.5em;\n        }\n\n        .tariff-table-section {\n            grid-column: 1 / -1;\n            margin-top: 20px;\n        }\n\n        .tariff-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 15px;\n            font-size: 0.9em;\n        }\n\n        .tariff-table th,\n        .tariff-table td {\n            padding: 10px;\n            text-align: left;\n            border-bottom: 1px solid #dee2e6;\n        }\n\n        .tariff-table th {\n            background: #667eea;\n            color: white;\n            font-weight: 600;\n        }\n\n        .tariff-table tr:hover {\n            background: #f8f9fa;\n        }\n\n        @media (max-width: 1200px) {\n            .settings-grid {\n                grid-template-columns: repeat(3, 1fr);\n            }\n        }\n\n        @media (max-width: 768px) {\n            .main-content {\n                grid-template-columns: 1fr;\n            }\n\n            .settings-grid {\n                grid-template-columns: 1fr;\n            }\n\n            .calc-input-row {\n                grid-template-columns: 1fr;\n            }\n\n            .header h1 {\n                font-size: 1.8em;\n            }\n        }\n\n        .hidden {\n            display: none;\n        }\n\n        .note {\n            background: #fff3cd;\n            border-left: 4px solid #ffc107;\n            padding: 15px;\n            margin-top: 15px;\n            border-radius: 6px;\n            font-size: 0.9em;\n            color: #856404;\n        }\n\n        .formula {\n            background: #e3f2fd;\n            border-left: 4px solid #2196f3;\n            padding: 15px;\n            margin-top: 15px;\n            border-radius: 6px;\n            font-size: 0.85em;\n            color: #0d47a1;\n            font-family: \'Courier New\', monospace;\n            line-height: 1.6;\n        }\n\n        .formula strong {\n            color: #1565c0;\n        }\n\n        .tutorial-btn {\n            background: #4caf50;\n            color: white;\n            border: none;\n            padding: 10px 25px;\n            border-radius: 8px;\n            font-size: 1em;\n            cursor: pointer;\n            transition: all 0.3s;\n            font-weight: 600;\n            margin-left: 15px;\n        }\n\n        .tutorial-btn:hover {\n            background: #45a049;\n            transform: translateY(-2px);\n            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);\n        }\n\n        .modal {\n            display: none;\n            position: fixed;\n            z-index: 1000;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 100%;\n            background-color: rgba(0, 0, 0, 0.5);\n            animation: fadeIn 0.3s;\n        }\n\n        .modal.show {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .modal-content {\n            background: white;\n            padding: 40px;\n            border-radius: 15px;\n            max-width: 800px;\n            max-height: 80vh;\n            overflow-y: auto;\n            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);\n            animation: slideIn 0.3s;\n        }\n\n        .modal-content h2 {\n            color: #667eea;\n            margin-bottom: 20px;\n            font-size: 2em;\n        }\n\n        .modal-content h3 {\n            color: #764ba2;\n            margin-top: 25px;\n            margin-bottom: 15px;\n            font-size: 1.3em;\n        }\n\n        .modal-content p {\n            line-height: 1.8;\n            color: #495057;\n            margin-bottom: 15px;\n        }\n\n        .modal-content ul {\n            margin-left: 20px;\n            margin-bottom: 15px;\n        }\n\n        .modal-content li {\n            margin-bottom: 10px;\n            line-height: 1.6;\n            color: #495057;\n        }\n\n        .close-btn {\n            background: #667eea;\n            color: white;\n            border: none;\n            padding: 12px 30px;\n            border-radius: 8px;\n            font-size: 1em;\n            cursor: pointer;\n            margin-top: 20px;\n            font-weight: 600;\n            transition: all 0.3s;\n        }\n\n        .close-btn:hover {\n            background: #5568d3;\n            transform: translateY(-2px);\n        }\n\n        @keyframes fadeIn {\n            from { opacity: 0; }\n            to { opacity: 1; }\n        }\n\n        @keyframes slideIn {\n            from {\n                transform: translateY(-50px);\n                opacity: 0;\n            }\n            to {\n                transform: translateY(0);\n                opacity: 1;\n            }\n        }\n\n        .step {\n            background: #f8f9fa;\n            padding: 15px;\n            border-left: 4px solid #667eea;\n            margin-bottom: 15px;\n            border-radius: 6px;\n        }\n\n        .step strong {\n            color: #667eea;\n        }\n\n        /* é€æ–™è©¦ç®—è¡¨ã‚¹ã‚¿ã‚¤ãƒ« */\n        .shipping-estimate-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 10px;\n        }\n        .shipping-estimate-table th,\n        .shipping-estimate-table td {\n            padding: 8px 12px;\n            text-align: left;\n            border-bottom: 1px solid #e9ecef;\n        }\n        .shipping-estimate-table th {\n            font-weight: 600;\n            color: #6c757d;\n            font-size: 0.85em;\n        }\n        .shipping-estimate-table td {\n            font-size: 0.95em;\n        }\n        .shipping-estimate-table .cost-cell {\n            text-align: right;\n            font-weight: 500;\n        }\n        .shipping-estimate-table .weight-cell {\n            text-align: right;\n            color: #6c757d;\n            font-size: 0.85em;\n        }\n        .shipping-estimate-table tr.selected {\n            background: linear-gradient(90deg, #fff3e0, #ffe0b2);\n            border-left: 4px solid #ff9800;\n        }\n        .shipping-estimate-table tr.selected td {\n            font-weight: 700;\n            color: #e65100;\n        }\n        .shipping-estimate-table tr.unavailable td {\n            color: #adb5bd;\n            text-decoration: line-through;\n        }\n        .shipping-estimate-table tr:hover:not(.selected) {\n            background-color: #f8f9fa;\n        }\n    </style>\n</head>\n<body>\n    <div class="container">\n        <div class="header">\n            <h1>ECä¾¡æ ¼è¨ˆç®—ãƒ„ãƒ¼ãƒ«</h1>\n            <p>ä»•å…¥ã‚Œä¾¡æ ¼ã¨è²©å£²ä¾¡æ ¼ã‚’ç°¡å˜ã«è¨ˆç®—</p>\n            <button class="tutorial-btn" onclick="openTutorial()">ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</button>\n            <a href="https://naokijodan.github.io/ec-price-calculator/tariff-table.html" target="_blank" class="tutorial-btn" style="text-decoration: none; margin-left: 10px; background: #ff9800;">é–¢ç¨å¯¾å¿œè¡¨</a>\n        </div>\n\n        <div class="settings-section">\n            <h2 style="margin-bottom: 20px; color: #495057;">å…±é€šè¨­å®š</h2>\n            <div class="settings-grid">\n                <!-- 1æ®µç›®ï¼šç‚ºæ›¿ã€æ‰‹æ•°æ–™ç‡ã€åºƒå‘Šè²»ç‡ã€ãƒšã‚¤ã‚ªãƒ‹ã‚¢æ‰‹æ•°æ–™ -->\n                <div class="input-group">\n                    <label>\n                        ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ (å††/ãƒ‰ãƒ«)\n                        <button class="refresh-rate-btn" onclick="fetchExchangeRate()">æœ€æ–°å–å¾—</button>\n                    </label>\n                    <input type="number" id="exchangeRate" value="153.435" step="0.001">\n                </div>\n                <div class="input-group">\n                    <label>æ‰‹æ•°æ–™ç‡ (%)</label>\n                    <input type="number" id="feeRate" value="18" step="0.1" onchange="updateAdjustedTariffRate()">\n                </div>\n                <div class="input-group">\n                    <label>åºƒå‘Šè²»ç‡ (%)</label>\n                    <input type="number" id="adRate" value="10" step="0.1" onchange="updateAdjustedTariffRate()">\n                </div>\n                <div class="input-group">\n                    <label>ãƒšã‚¤ã‚ªãƒ‹ã‚¢æ‰‹æ•°æ–™ (%)</label>\n                    <input type="number" id="payoneerRate" value="2" step="0.1">\n                </div>\n                <div class="input-group">\n                    <label>é€æ–™è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰</label>\n                    <select id="shippingMode" onchange="toggleShippingMode()">\n                        <option value="fixed">å›ºå®šé€æ–™</option>\n                        <option value="table">ãƒ†ãƒ¼ãƒ–ãƒ«è¨ˆç®—</option>\n                    </select>\n                </div>\n                <!-- 2æ®µç›®ï¼šé–¢ç¨ç‡ã€VATç‡ã€é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ç‡ã€ç±³å›½é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ã€MPFã€EUé€æ–™å·®é¡ -->\n                <div class="input-group">\n                    <label>å®Ÿéš›ã®é–¢ç¨ç‡ (%)</label>\n                    <input type="number" id="tariffRate" value="15" step="0.1" onchange="updateAdjustedTariffRate()">\n                    <div id="adjustedTariffDisplay" style="font-size: 0.85em; color: #6c757d; margin-top: 4px;">\n                        èª¿æ•´å¾Œ: <span id="adjustedTariffRate">19.5</span>%\n                    </div>\n                </div>\n                <div class="input-group">\n                    <label>VATç‡ (%)</label>\n                    <input type="number" id="vatRate" value="0" step="0.1">\n                </div>\n                <div class="input-group">\n                    <label>é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ç‡ (%)</label>\n                    <input type="number" id="processingFeeRate" value="2.1" step="0.1">\n                </div>\n                <div class="input-group">\n                    <label>CFç”¨é€šé–¢æ‰‹æ•°æ–™ (å††) <span style="font-size: 0.7em; color: #6c757d;">â€»å°†æ¥ç”¨/ç›´å¥‘ç´„ã¯åˆ¥é€”</span></label>\n                    <input type="number" id="mpf" value="0" step="1" style="background-color: #f8f9fa;" title="Cpass-FedExç”¨ã€‚ç¾åœ¨ã¯0ã§é‹ç”¨ã€‚ç›´å¥‘ç´„ã®å ´åˆã¯åˆ¥é€”è¨­å®šãŒå¿…è¦ã€‚">\n                </div>\n                <div class="input-group">\n                    <label>CEç”¨é€šé–¢æ‰‹æ•°æ–™ (å††) <span style="font-size: 0.75em; color: #28a745;">â€»CEæ™‚ã®ã¿é©ç”¨</span></label>\n                    <input type="number" id="ceMpf" value="296" step="1">\n                </div>\n                <div class="input-group">\n                    <label>MPF ($) <span style="font-size: 0.85em; color: #6c757d;">â€»Cpasså…é™¤</span></label>\n                    <input type="number" id="mpfUsd" value="0" step="0.01">\n                </div>\n                <div class="input-group">\n                    <label>EUé€æ–™å·®é¡ (å††)</label>\n                    <input type="number" id="euShippingDiff" value="0" step="10">\n                </div>\n            </div>\n\n            <!-- è‡ªå‹•é¸æŠè¨­å®šï¼ˆå…±é€šï¼‰ -->\n            <div style="margin-top: 20px; padding: 20px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px;">\n                <h3 style="margin-bottom: 15px; color: #856404;">âš™ï¸ é…é€æ–¹æ³•è‡ªå‹•é¸æŠè¨­å®š</h3>\n                <div class="settings-grid">\n                    <div class="input-group">\n                        <label>é€æ–™åˆ‡æ›¿åŸºæº–é‡‘é¡ (å††)</label>\n                        <input type="number" id="shippingThreshold" value="5500" step="100">\n                    </div>\n                    <div class="input-group">\n                        <label>ä½ä¾¡æ ¼å•†å“é…é€æ–¹æ³•</label>\n                        <select id="lowPriceMethod">\n                            <option value="EP" selected>eãƒ‘ã‚±ãƒƒãƒˆ</option>\n                            <option value="CE">Cpass-Economy</option>\n                            <option value="NONE">ãªã—</option>\n                        </select>\n                    </div>\n                    <div class="input-group">\n                        <label>é«˜ä¾¡æ ¼å•†å“é…é€æ–¹æ³•</label>\n                        <select id="highPriceMethod">\n                            <option value="CF" selected>Cpass-FedEx</option>\n                            <option value="CD">Cpass-DHL</option>\n                            <option value="EL">eLogistics</option>\n                        </select>\n                    </div>\n                </div>\n                <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 5px; font-size: 0.9em; color: #856404;">\n                    <strong>ğŸ’¡ è‡ªå‹•é¸æŠãƒ­ã‚¸ãƒƒã‚¯:</strong><br>\n                    â€¢ ä»•å…¥ã‚Œä¾¡æ ¼ â‰¥ åˆ‡æ›¿åŸºæº–é‡‘é¡ â†’ é«˜ä¾¡æ ¼å•†å“é…é€æ–¹æ³•<br>\n                    â€¢ ä»•å…¥ã‚Œä¾¡æ ¼ &lt; åˆ‡æ›¿åŸºæº–é‡‘é¡ â†’ ä½ä¾¡æ ¼å•†å“é…é€æ–¹æ³•ï¼ˆeãƒ‘ã‚±ãƒƒãƒˆã¯2000gä»¥ä¸‹ã®ã¿ï¼‰<br>\n                    â€¢ ä½ä¾¡æ ¼å•†å“é…é€æ–¹æ³•ãŒã€Œãªã—ã€ã®å ´åˆ â†’ å¸¸ã«é«˜ä¾¡æ ¼å•†å“é…é€æ–¹æ³•\n                </div>\n            </div>\n\n            <!-- é€æ–™è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰åˆ¥ã®è¨­å®š -->\n            <div id="shippingSettings" style="margin-top: 20px;">\n                <!-- å›ºå®šé€æ–™ãƒ¢ãƒ¼ãƒ‰ -->\n                <div id="fixedShippingSettings" style="padding: 20px; background: #e8f5e9; border: 2px solid #4caf50; border-radius: 8px;">\n                    <h3 style="margin-bottom: 15px; color: #2e7d32;">ğŸ’° å›ºå®šé€æ–™è¨­å®š</h3>\n                    <div class="settings-grid">\n                        <div class="input-group">\n                            <label>é€æ–™ (å††)</label>\n                            <input type="number" id="shippingCost" value="3000" step="100">\n                        </div>\n                    </div>\n                </div>\n\n                <!-- ãƒ†ãƒ¼ãƒ–ãƒ«è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰ -->\n                <div id="tableShippingSettings" class="hidden" style="padding: 20px; background: #e3f2fd; border: 2px solid #2196f3; border-radius: 8px;">\n                    <h3 style="margin-bottom: 15px; color: #1565c0;">ğŸ“¦ ãƒ†ãƒ¼ãƒ–ãƒ«è¨ˆç®—è¨­å®š</h3>\n\n                    <!-- é‡é‡ãƒ»ã‚µã‚¤ã‚ºè¨­å®š -->\n                    <div style="padding: 15px; background: white; border-radius: 5px; margin-bottom: 15px;">\n                        <h4 style="margin: 0 0 15px 0; color: #1565c0; font-size: 1em;">é‡é‡ãƒ»ã‚µã‚¤ã‚º</h4>\n                        <div class="settings-grid">\n                            <div class="input-group">\n                                <label>å®Ÿé‡é‡ (g)</label>\n                                <input type="number" id="actualWeight" value="500" step="10" oninput="calculateVolumetricWeight()">\n                            </div>\n                            <div class="input-group">\n                                <label>é•·ã• (cm)</label>\n                                <input type="number" id="packageLength" value="20" step="1" oninput="calculateVolumetricWeight()">\n                            </div>\n                            <div class="input-group">\n                                <label>å¹… (cm)</label>\n                                <input type="number" id="packageWidth" value="20" step="1" oninput="calculateVolumetricWeight()">\n                            </div>\n                            <div class="input-group">\n                                <label>é«˜ã• (cm)</label>\n                                <input type="number" id="packageHeight" value="20" step="1" oninput="calculateVolumetricWeight()">\n                            </div>\n                        </div>\n                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">\n                            <div class="input-group">\n                                <label>å®¹ç©é‡é‡ (g) <span style="font-size: 0.8em; color: #1976d2;">CF/CD/EL/EMSç”¨ Ã·5</span></label>\n                                <input type="number" id="volumetricWeight" value="0" step="10" readonly style="background-color: #e3f2fd; border-color: #1976d2;">\n                            </div>\n                            <div class="input-group">\n                                <label>å®¹ç©é‡é‡ (g) <span style="font-size: 0.8em; color: #7b1fa2;">CEç”¨ Ã·8</span></label>\n                                <input type="number" id="volumetricWeightCE" value="0" step="10" readonly style="background-color: #f3e5f5; border-color: #7b1fa2;">\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- é…é€æ–¹æ³•é¸æŠ -->\n                    <div style="padding: 15px; background: white; border-radius: 5px; margin-bottom: 15px;">\n                        <h4 style="margin: 0 0 15px 0; color: #1565c0; font-size: 1em;">é…é€æ–¹æ³•é¸æŠ</h4>\n                        <div class="settings-grid">\n                            <div class="input-group">\n                                <label>é…é€æ–¹æ³•</label>\n                                <select id="shippingMethod" onchange="calculateVolumetricWeight()">\n                                    <option value="è‡ªå‹•é¸æŠ">è‡ªå‹•é¸æŠ</option>\n                                    <option value="EP">eãƒ‘ã‚±ãƒƒãƒˆ</option>\n                                    <option value="CF">Cpass-FedEx</option>\n                                    <option value="CD">Cpass-DHL</option>\n                                    <option value="EL">eLogistics</option>\n                                    <option value="CE">Cpass-Economy</option>\n                                    <option value="EMS">EMS</option>\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- é€æ–™è©¦ç®—çµæœ -->\n                    <div id="shippingEstimate" style="padding: 15px; background: #fff9c4; border: 2px solid #fbc02d; border-radius: 5px;">\n                        <h4 style="margin: 0 0 10px 0; color: #f57f17;">ğŸ’¡ é€æ–™è©¦ç®—ï¼ˆå…¨é…é€æ–¹æ³•ï¼‰</h4>\n                        <table class="shipping-estimate-table">\n                            <thead>\n                                <tr>\n                                    <th>é…é€æ–¹æ³•</th>\n                                    <th style="text-align: right;">èª²é‡‘é‡é‡</th>\n                                    <th style="text-align: right;">é€æ–™</th>\n                                </tr>\n                            </thead>\n                            <tbody id="shippingEstimateBody">\n                                <!-- å‹•çš„ã«ç”Ÿæˆ -->\n                            </tbody>\n                        </table>\n                        <div id="autoSelectNote" style="margin-top: 10px; padding: 8px; background: #fff3e0; border-radius: 4px; font-size: 0.85em; color: #e65100; display: none;">\n                            â€» ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã®è¡ŒãŒç¾åœ¨ã®è¨­å®šã§ä½¿ç”¨ã•ã‚Œã‚‹é…é€æ–¹æ³•ã§ã™\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <button class="save-settings-btn" onclick="saveSettings()" style="margin-top: 20px;">è¨­å®šã‚’ä¿å­˜</button>\n        </div>\n\n        <div class="main-content">\n            <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³: è²©å£²ä¾¡æ ¼ç®—å‡º -->\n            <div class="section-divider">\n                <div class="section-title">è²©å£²ä¾¡æ ¼ç®—å‡º</div>\n            </div>\n\n            <!-- åˆ©ç›Šé¡ãƒ™ãƒ¼ã‚¹: ä»•å…¥ã‚Œâ†’è²©å£²ä¾¡æ ¼ -->\n            <div class="calculator-card">\n                <h2>åˆ©ç›Šé¡ã§è¨ˆç®—ï¼ˆä»•å…¥ã‚Œâ†’è²©å£²ä¾¡æ ¼ï¼‰</h2>\n                <div class="calc-input-row">\n                    <div class="calc-input-group">\n                        <label>ä»•å…¥ã‚Œä¾¡æ ¼ï¼ˆå††ï¼‰</label>\n                        <input type="number" id="cost1" value="5000" step="1000">\n                    </div>\n                    <div class="calc-input-group">\n                        <label>åˆ©ç›Šé¡ï¼ˆå††ï¼‰</label>\n                        <input type="number" id="profit1" value="3000" step="100">\n                    </div>\n                </div>\n                <button class="calculate-btn" onclick="calculatePriceFromCostProfit()">è¨ˆç®—ã™ã‚‹</button>\n                <div id="result1" class="result-section hidden">\n                    <h3>è¨ˆç®—çµæœ</h3>\n                    <div class="result-grid">\n                        <div class="result-item highlight">\n                            <label>è²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>\n                            <div class="value" id="sellingPrice1">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>æƒ³å®šé–¢ç¨ï¼ˆãƒ‰ãƒ«ï¼‰</label>\n                            <div class="value" id="tariff1">-</div>\n                        </div>\n                        <div class="result-item highlight">\n                            <label>DDPä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>\n                            <div class="value" id="ddpPrice1">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>å‚è€ƒé€æ–™ï¼ˆå††ï¼‰</label>\n                            <div class="value" id="shipping1">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>å‚è€ƒåˆ©ç›Šï¼ˆå††ï¼‰</label>\n                            <div class="value" id="refProfit1">-</div>\n                        </div>\n                    </div>\n                    <div class="formula">\n                        <strong>è¨ˆç®—å¼:</strong><br>\n                        è²©å£²ä¾¡æ ¼ = (ä»•å…¥ã‚Œä¾¡æ ¼ + é€æ–™ + åˆ©ç›Šé¡) Ã· ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ Ã· (1 - æ‰‹æ•°æ–™ç‡ - åºƒå‘Šè²»ç‡ - ãƒšã‚¤ã‚ªãƒ‹ã‚¢ç‡)<br>\n                        æƒ³å®šé–¢ç¨ = è²©å£²ä¾¡æ ¼ Ã— é–¢ç¨ç‡ Ã— (1 + é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡) + è²©å£²ä¾¡æ ¼ Ã— VATç‡ Ã— é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡ + (é€šé–¢æ‰‹æ•°æ–™å†† Ã· ç‚ºæ›¿) + MPF($) + (EUé€æ–™å·®é¡å†† Ã· ç‚ºæ›¿)<br>\n                        <small style="color: #6c757d;">â€»é€šé–¢æ‰‹æ•°æ–™: CFã¯ç¾çŠ¶0ã€CEã¯296å††ã€ç›´å¥‘ç´„ã¯åˆ¥é€”</small><br>\n                        DDPä¾¡æ ¼ = è²©å£²ä¾¡æ ¼ + æƒ³å®šé–¢ç¨\n                    </div>\n                </div>\n            </div>\n\n            <!-- åˆ©ç›Šç‡ãƒ™ãƒ¼ã‚¹: ä»•å…¥ã‚Œâ†’è²©å£²ä¾¡æ ¼ -->\n            <div class="calculator-card">\n                <h2>åˆ©ç›Šç‡ã§è¨ˆç®—ï¼ˆä»•å…¥ã‚Œâ†’è²©å£²ä¾¡æ ¼ï¼‰</h2>\n                <div class="calc-input-row">\n                    <div class="calc-input-group">\n                        <label>ä»•å…¥ã‚Œä¾¡æ ¼ï¼ˆå††ï¼‰</label>\n                        <input type="number" id="cost2" value="5000" step="1000">\n                    </div>\n                    <div class="calc-input-group">\n                        <label>åˆ©ç›Šç‡ (%)</label>\n                        <input type="number" id="profitRate2" value="20" step="1">\n                    </div>\n                </div>\n                <button class="calculate-btn" onclick="calculatePriceFromCostProfitRate()">è¨ˆç®—ã™ã‚‹</button>\n                <div id="result2" class="result-section hidden">\n                    <h3>è¨ˆç®—çµæœ</h3>\n                    <div class="result-grid">\n                        <div class="result-item highlight">\n                            <label>è²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>\n                            <div class="value" id="sellingPrice2">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>æƒ³å®šé–¢ç¨ï¼ˆãƒ‰ãƒ«ï¼‰</label>\n                            <div class="value" id="tariff2">-</div>\n                        </div>\n                        <div class="result-item highlight">\n                            <label>DDPä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>\n                            <div class="value" id="ddpPrice2">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>å‚è€ƒé€æ–™ï¼ˆå††ï¼‰</label>\n                            <div class="value" id="shipping2">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>å‚è€ƒåˆ©ç›Šï¼ˆå††ï¼‰</label>\n                            <div class="value" id="refProfit2">-</div>\n                        </div>\n                    </div>\n                    <div class="formula">\n                        <strong>è¨ˆç®—å¼:</strong><br>\n                        è²©å£²ä¾¡æ ¼ = (ä»•å…¥ã‚Œä¾¡æ ¼ + é€æ–™) Ã· ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ Ã· (1 - åˆ©ç›Šç‡ - æ‰‹æ•°æ–™ç‡ - åºƒå‘Šè²»ç‡ - ãƒšã‚¤ã‚ªãƒ‹ã‚¢ç‡)<br>\n                        æƒ³å®šé–¢ç¨ = è²©å£²ä¾¡æ ¼ Ã— é–¢ç¨ç‡ Ã— (1 + é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡) + è²©å£²ä¾¡æ ¼ Ã— VATç‡ Ã— é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡ + (é€šé–¢æ‰‹æ•°æ–™å†† Ã· ç‚ºæ›¿) + MPF($) + (EUé€æ–™å·®é¡å†† Ã· ç‚ºæ›¿)<br>\n                        <small style="color: #6c757d;">â€»é€šé–¢æ‰‹æ•°æ–™: CFã¯ç¾çŠ¶0ã€CEã¯296å††ã€ç›´å¥‘ç´„ã¯åˆ¥é€”</small><br>\n                        DDPä¾¡æ ¼ = è²©å£²ä¾¡æ ¼ + æƒ³å®šé–¢ç¨\n                    </div>\n                </div>\n            </div>\n\n            <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³: ä»•å…¥ã‚Œä¾¡æ ¼ç®—å‡º -->\n            <div class="section-divider">\n                <div class="section-title cost-section">ä»•å…¥ã‚Œä¾¡æ ¼ç®—å‡º</div>\n            </div>\n\n            <!-- åˆ©ç›Šé¡ãƒ™ãƒ¼ã‚¹: è²©å£²ä¾¡æ ¼â†’ä»•å…¥ã‚Œ -->\n            <div class="calculator-card cost-calculation">\n                <h2>åˆ©ç›Šé¡ã§è¨ˆç®—ï¼ˆè²©å£²ä¾¡æ ¼â†’ä»•å…¥ã‚Œï¼‰</h2>\n                <div class="calc-input-row">\n                    <div class="calc-input-group">\n                        <label>åˆ©ç›Šé¡ï¼ˆå††ï¼‰</label>\n                        <input type="number" id="profit3" value="3000" step="100">\n                    </div>\n                </div>\n                <button class="calculate-btn" onclick="calculateCostFromPriceProfit()">è¨ˆç®—ã™ã‚‹</button>\n\n                <!-- DDUä¾¡æ ¼ã‹ã‚‰ã®è¨ˆç®— -->\n                <div id="result3-ddu" class="result-section hidden">\n                    <h3>DDUä¾¡æ ¼ï¼ˆé–¢ç¨æŠœãï¼‰ã‹ã‚‰ç®—å‡º</h3>\n                    <div class="calc-input-row" style="margin-bottom: 15px;">\n                        <div class="calc-input-group">\n                            <label>DDUè²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>\n                            <input type="number" id="sellingPriceDDU3" value="500" step="10">\n                        </div>\n                    </div>\n                    <div class="result-grid">\n                        <div class="result-item highlight">\n                            <label>ä»•å…¥ã‚Œä¾¡æ ¼ï¼ˆå††ï¼‰</label>\n                            <div class="value" id="costPriceDDU3">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>æƒ³å®šé–¢ç¨ï¼ˆãƒ‰ãƒ«ï¼‰</label>\n                            <div class="value" id="tariffDDU3">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>å‚è€ƒé€æ–™ï¼ˆå††ï¼‰</label>\n                            <div class="value" id="shippingDDU3">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>å‚è€ƒåˆ©ç›Šï¼ˆå††ï¼‰</label>\n                            <div class="value" id="refProfitDDU3">-</div>\n                        </div>\n                    </div>\n                    <div class="formula">\n                        <strong>è¨ˆç®—å¼:</strong><br>\n                        ä»•å…¥ã‚Œä¾¡æ ¼ = (DDUè²©å£²ä¾¡æ ¼ Ã— ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ Ã— (1 - æ‰‹æ•°æ–™ç‡ - åºƒå‘Šè²»ç‡ - ãƒšã‚¤ã‚ªãƒ‹ã‚¢ç‡)) - é€æ–™ - åˆ©ç›Šé¡<br>\n                        æƒ³å®šé–¢ç¨ = è²©å£²ä¾¡æ ¼ Ã— é–¢ç¨ç‡ Ã— (1 + é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡) + è²©å£²ä¾¡æ ¼ Ã— VATç‡ Ã— é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡ + (é€šé–¢æ‰‹æ•°æ–™å†† Ã· ç‚ºæ›¿) + MPF($) + (EUé€æ–™å·®é¡å†† Ã· ç‚ºæ›¿)<br>\n                        <small style="color: #6c757d;">â€»é€šé–¢æ‰‹æ•°æ–™: CFã¯ç¾çŠ¶0ã€CEã¯296å††ã€ç›´å¥‘ç´„ã¯åˆ¥é€”</small>\n                    </div>\n                </div>\n\n                <!-- DDPä¾¡æ ¼ã‹ã‚‰ã®è¨ˆç®— -->\n                <div id="result3-ddp" class="result-section hidden" style="margin-top: 20px;">\n                    <h3>DDPä¾¡æ ¼ï¼ˆé–¢ç¨è¾¼ã¿ï¼‰ã‹ã‚‰ç®—å‡º</h3>\n                    <div class="calc-input-row" style="margin-bottom: 15px;">\n                        <div class="calc-input-group">\n                            <label>DDPè²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>\n                            <input type="number" id="sellingPriceDDP3" value="610" step="10">\n                        </div>\n                    </div>\n                    <div class="result-grid">\n                        <div class="result-item highlight">\n                            <label>ä»•å…¥ã‚Œä¾¡æ ¼ï¼ˆå††ï¼‰</label>\n                            <div class="value" id="costPriceDDP3">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>å‚è€ƒDDUè²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>\n                            <div class="value" id="sellingPriceDDU_from_DDP3">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>å‚è€ƒé–¢ç¨ï¼ˆãƒ‰ãƒ«ï¼‰</label>\n                            <div class="value" id="tariffDDP3">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>å‚è€ƒé€æ–™ï¼ˆå††ï¼‰</label>\n                            <div class="value" id="shippingDDP3">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>å‚è€ƒåˆ©ç›Šï¼ˆå††ï¼‰</label>\n                            <div class="value" id="refProfitDDP3">-</div>\n                        </div>\n                    </div>\n                    <div class="formula">\n                        <strong>è¨ˆç®—å¼:</strong><br>\n                        â‘  DDUè²©å£²ä¾¡æ ¼ = DDPä¾¡æ ¼ - æƒ³å®šé–¢ç¨ï¼ˆåå¾©è¨ˆç®—ã§æ±‚ã‚ã‚‹ï¼‰<br>\n                        â‘¡ ä»•å…¥ã‚Œä¾¡æ ¼ = (DDUè²©å£²ä¾¡æ ¼ Ã— ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ Ã— (1 - æ‰‹æ•°æ–™ç‡ - åºƒå‘Šè²»ç‡ - ãƒšã‚¤ã‚ªãƒ‹ã‚¢ç‡)) - é€æ–™ - åˆ©ç›Š\n                    </div>\n                </div>\n            </div>\n\n            <!-- åˆ©ç›Šç‡ãƒ™ãƒ¼ã‚¹: è²©å£²ä¾¡æ ¼â†’ä»•å…¥ã‚Œ -->\n            <div class="calculator-card cost-calculation">\n                <h2>åˆ©ç›Šç‡ã§è¨ˆç®—ï¼ˆè²©å£²ä¾¡æ ¼â†’ä»•å…¥ã‚Œï¼‰</h2>\n                <div class="calc-input-row">\n                    <div class="calc-input-group">\n                        <label>åˆ©ç›Šç‡ (%)</label>\n                        <input type="number" id="profitRate4" value="20" step="1">\n                    </div>\n                </div>\n                <button class="calculate-btn" onclick="calculateCostFromPriceProfitRate()">è¨ˆç®—ã™ã‚‹</button>\n\n                <!-- DDUä¾¡æ ¼ã‹ã‚‰ã®è¨ˆç®— -->\n                <div id="result4-ddu" class="result-section hidden">\n                    <h3>DDUä¾¡æ ¼ï¼ˆé–¢ç¨æŠœãï¼‰ã‹ã‚‰ç®—å‡º</h3>\n                    <div class="calc-input-row" style="margin-bottom: 15px;">\n                        <div class="calc-input-group">\n                            <label>DDUè²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>\n                            <input type="number" id="sellingPriceDDU4" value="500" step="10">\n                        </div>\n                    </div>\n                    <div class="result-grid">\n                        <div class="result-item highlight">\n                            <label>ä»•å…¥ã‚Œä¾¡æ ¼ï¼ˆå††ï¼‰</label>\n                            <div class="value" id="costPriceDDU4">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>æƒ³å®šé–¢ç¨ï¼ˆãƒ‰ãƒ«ï¼‰</label>\n                            <div class="value" id="tariffDDU4">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>å‚è€ƒé€æ–™ï¼ˆå††ï¼‰</label>\n                            <div class="value" id="shippingDDU4">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>å‚è€ƒåˆ©ç›Šï¼ˆå††ï¼‰</label>\n                            <div class="value" id="refProfitDDU4">-</div>\n                        </div>\n                    </div>\n                    <div class="formula">\n                        <strong>è¨ˆç®—å¼:</strong><br>\n                        ä»•å…¥ã‚Œä¾¡æ ¼ = (DDUè²©å£²ä¾¡æ ¼ Ã— ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ Ã— (1 - åˆ©ç›Šç‡ - æ‰‹æ•°æ–™ç‡ - åºƒå‘Šè²»ç‡ - ãƒšã‚¤ã‚ªãƒ‹ã‚¢ç‡)) - é€æ–™<br>\n                        æƒ³å®šé–¢ç¨ = è²©å£²ä¾¡æ ¼ Ã— é–¢ç¨ç‡ Ã— (1 + é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡) + è²©å£²ä¾¡æ ¼ Ã— VATç‡ Ã— é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡ + (é€šé–¢æ‰‹æ•°æ–™å†† Ã· ç‚ºæ›¿) + MPF($) + (EUé€æ–™å·®é¡å†† Ã· ç‚ºæ›¿)<br>\n                        <small style="color: #6c757d;">â€»é€šé–¢æ‰‹æ•°æ–™: CFã¯ç¾çŠ¶0ã€CEã¯296å††ã€ç›´å¥‘ç´„ã¯åˆ¥é€”</small>\n                    </div>\n                </div>\n\n                <!-- DDPä¾¡æ ¼ã‹ã‚‰ã®è¨ˆç®— -->\n                <div id="result4-ddp" class="result-section hidden" style="margin-top: 20px;">\n                    <h3>DDPä¾¡æ ¼ï¼ˆé–¢ç¨è¾¼ã¿ï¼‰ã‹ã‚‰ç®—å‡º</h3>\n                    <div class="calc-input-row" style="margin-bottom: 15px;">\n                        <div class="calc-input-group">\n                            <label>DDPè²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>\n                            <input type="number" id="sellingPriceDDP4" value="610" step="10">\n                        </div>\n                    </div>\n                    <div class="result-grid">\n                        <div class="result-item highlight">\n                            <label>ä»•å…¥ã‚Œä¾¡æ ¼ï¼ˆå††ï¼‰</label>\n                            <div class="value" id="costPriceDDP4">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>å‚è€ƒDDUè²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰</label>\n                            <div class="value" id="sellingPriceDDU_from_DDP4">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>å‚è€ƒé–¢ç¨ï¼ˆãƒ‰ãƒ«ï¼‰</label>\n                            <div class="value" id="tariffDDP4">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>å‚è€ƒé€æ–™ï¼ˆå††ï¼‰</label>\n                            <div class="value" id="shippingDDP4">-</div>\n                        </div>\n                        <div class="result-item">\n                            <label>å‚è€ƒåˆ©ç›Šï¼ˆå††ï¼‰</label>\n                            <div class="value" id="refProfitDDP4">-</div>\n                        </div>\n                    </div>\n                    <div class="formula">\n                        <strong>è¨ˆç®—å¼:</strong><br>\n                        â‘  DDUè²©å£²ä¾¡æ ¼ = DDPä¾¡æ ¼ - æƒ³å®šé–¢ç¨ï¼ˆåå¾©è¨ˆç®—ã§æ±‚ã‚ã‚‹ï¼‰<br>\n                        â‘¡ ä»•å…¥ã‚Œä¾¡æ ¼ = (DDUè²©å£²ä¾¡æ ¼ Ã— ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ Ã— (1 - æ‰‹æ•°æ–™ç‡ - åºƒå‘Šè²»ç‡ - ãƒšã‚¤ã‚ªãƒ‹ã‚¢ç‡)) - é€æ–™\n                    </div>\n                </div>\n            </div>\n\n        </div>\n    </div>\n\n    <!-- ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ« -->\n    <div id="tutorialModal" class="modal">\n        <div class="modal-content">\n            <h2>ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h2>\n\n            <h3>æ¦‚è¦</h3>\n            <p>ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€ECï¼ˆé›»å­å•†å–å¼•ï¼‰ã«ãŠã‘ã‚‹ä»•å…¥ã‚Œä¾¡æ ¼ã¨è²©å£²ä¾¡æ ¼ã‚’ç°¡å˜ã«è¨ˆç®—ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚é–¢ç¨ã€æ‰‹æ•°æ–™ã€é€æ–™ãªã©ã‚’è€ƒæ…®ã—ãŸæ­£ç¢ºãªä¾¡æ ¼è¨­å®šãŒå¯èƒ½ã§ã™ã€‚</p>\n\n            <h3>å…±é€šè¨­å®šã«ã¤ã„ã¦</h3>\n            <div class="step">\n                <strong>ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ:</strong> USD/JPYã®ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã€‚ã€Œæœ€æ–°å–å¾—ã€ãƒœã‚¿ãƒ³ã§è‡ªå‹•å–å¾—å¯èƒ½ã§ã™ã€‚<br>\n                <strong>æ‰‹æ•°æ–™ç‡:</strong> ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ‰‹æ•°æ–™ã®å‰²åˆï¼ˆ%ï¼‰<br>\n                <strong>åºƒå‘Šè²»ç‡:</strong> å£²ä¸Šã«å¯¾ã™ã‚‹åºƒå‘Šè²»ã®å‰²åˆï¼ˆ%ï¼‰<br>\n                <strong>ãƒšã‚¤ã‚ªãƒ‹ã‚¢æ‰‹æ•°æ–™:</strong> æ±ºæ¸ˆæ‰‹æ•°æ–™ã®å‰²åˆï¼ˆ%ï¼‰<br>\n                <strong>é€æ–™:</strong> å•†å“ã®é€æ–™ï¼ˆå††ï¼‰<br>\n                <strong>é–¢ç¨ç‡:</strong> é–¢ç¨ã®å‰²åˆï¼ˆ%ï¼‰<br>\n                <strong>VATç‡:</strong> ä»˜åŠ ä¾¡å€¤ç¨ã®å‰²åˆï¼ˆ%ï¼‰<br>\n                <strong>é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡:</strong> é€šé–¢å‡¦ç†ã«ã‹ã‹ã‚‹æ‰‹æ•°æ–™ã®å‰²åˆï¼ˆ%ï¼‰<br>\n                <strong>CFç”¨é€šé–¢æ‰‹æ•°æ–™:</strong> Cpass-FedExç”¨ã®é€šé–¢æ‰‹æ•°æ–™ï¼ˆå††ã€å°†æ¥ç”¨/ç›´å¥‘ç´„ã¯åˆ¥é€”ï¼‰<br>\n                <strong>CEç”¨é€šé–¢æ‰‹æ•°æ–™:</strong> Cpass-Economyç”¨ã®é€šé–¢æ‰‹æ•°æ–™ï¼ˆå††ã€CEæ™‚ã®ã¿é©ç”¨ï¼‰<br>\n                <strong>MPF($):</strong> Merchandise Processing Feeï¼ˆãƒ‰ãƒ«ã€Cpasså…é™¤ã§é€šå¸¸0ï¼‰<br>\n                <strong>EUé€æ–™å·®é¡:</strong> ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘å‘ã‘é€æ–™ã®å·®é¡ï¼ˆå††ã€é€šå¸¸ã¯0ï¼‰\n            </div>\n\n            <h3>æƒ³å®šé–¢ç¨ã®è¨ˆç®—å¼</h3>\n            <div class="step">\n                æƒ³å®šé–¢ç¨ã¯ä»¥ä¸‹ã®å¼ã§è¨ˆç®—ã•ã‚Œã¾ã™ï¼š<br>\n                <code>æƒ³å®šé–¢ç¨ = è²©å£²ä¾¡æ ¼ Ã— é–¢ç¨ç‡ Ã— (1 + é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡) + è²©å£²ä¾¡æ ¼ Ã— VATç‡ Ã— é€šé–¢å‡¦ç†æ‰‹æ•°æ–™ç‡ + (é€šé–¢æ‰‹æ•°æ–™å†† Ã· ç‚ºæ›¿) + MPF($) + (EUé€æ–™å·®é¡å†† Ã· ç‚ºæ›¿)</code><br>\n                <small style="color: #6c757d;">â€»é€šé–¢æ‰‹æ•°æ–™: CFã¯ç¾çŠ¶0ã€CEï¼ˆCpass-Economyï¼‰ã¯296å††ã€ç›´å¥‘ç´„ã¯åˆ¥é€”</small>\n            </div>\n\n            <h3>4ã¤ã®è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰</h3>\n\n            <div class="step">\n                <strong>1. åˆ©ç›Šé¡ã§è¨ˆç®—ï¼ˆä»•å…¥ã‚Œâ†’è²©å£²ä¾¡æ ¼ï¼‰</strong><br>\n                ä»•å…¥ã‚Œä¾¡æ ¼ã¨å¸Œæœ›ã™ã‚‹åˆ©ç›Šé¡ï¼ˆå††ï¼‰ã‹ã‚‰ã€å¿…è¦ãªè²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰ã‚’è¨ˆç®—ã—ã¾ã™ã€‚<br>\n                ä½¿ç”¨ä¾‹: ä»•å…¥ã‚ŒãŒ5,000å††ã§3,000å††ã®åˆ©ç›ŠãŒæ¬²ã—ã„å ´åˆã®è²©å£²ä¾¡æ ¼ã¯ï¼Ÿ\n            </div>\n\n            <div class="step">\n                <strong>2. åˆ©ç›Šç‡ã§è¨ˆç®—ï¼ˆä»•å…¥ã‚Œâ†’è²©å£²ä¾¡æ ¼ï¼‰</strong><br>\n                ä»•å…¥ã‚Œä¾¡æ ¼ã¨å¸Œæœ›ã™ã‚‹åˆ©ç›Šç‡ï¼ˆ%ï¼‰ã‹ã‚‰ã€å¿…è¦ãªè²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰ã‚’è¨ˆç®—ã—ã¾ã™ã€‚<br>\n                ä½¿ç”¨ä¾‹: ä»•å…¥ã‚ŒãŒ5,000å††ã§20%ã®åˆ©ç›Šç‡ã‚’ç¢ºä¿ã—ãŸã„å ´åˆã®è²©å£²ä¾¡æ ¼ã¯ï¼Ÿ\n            </div>\n\n            <div class="step">\n                <strong>3. åˆ©ç›Šé¡ã§è¨ˆç®—ï¼ˆè²©å£²ä¾¡æ ¼â†’ä»•å…¥ã‚Œï¼‰</strong><br>\n                è²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰ã¨å¸Œæœ›ã™ã‚‹åˆ©ç›Šé¡ï¼ˆå††ï¼‰ã‹ã‚‰ã€é©åˆ‡ãªä»•å…¥ã‚Œä¾¡æ ¼ï¼ˆå††ï¼‰ã‚’é€†ç®—ã—ã¾ã™ã€‚<br>\n                DDUä¾¡æ ¼ï¼ˆé–¢ç¨æŠœãï¼‰ã¨DDPä¾¡æ ¼ï¼ˆé–¢ç¨è¾¼ã¿ï¼‰ã®ä¸¡æ–¹ã‹ã‚‰è¨ˆç®—ã§ãã¾ã™ã€‚<br>\n                ä½¿ç”¨ä¾‹: 500ãƒ‰ãƒ«ã§è²©å£²ã—ã€3,000å††ã®åˆ©ç›Šã‚’å¾—ã‚‹ã«ã¯ã€ã„ãã‚‰ã¾ã§ä»•å…¥ã‚Œã‚‰ã‚Œã‚‹ï¼Ÿ\n            </div>\n\n            <div class="step">\n                <strong>4. åˆ©ç›Šç‡ã§è¨ˆç®—ï¼ˆè²©å£²ä¾¡æ ¼â†’ä»•å…¥ã‚Œï¼‰</strong><br>\n                è²©å£²ä¾¡æ ¼ï¼ˆãƒ‰ãƒ«ï¼‰ã¨å¸Œæœ›ã™ã‚‹åˆ©ç›Šç‡ï¼ˆ%ï¼‰ã‹ã‚‰ã€é©åˆ‡ãªä»•å…¥ã‚Œä¾¡æ ¼ï¼ˆå††ï¼‰ã‚’é€†ç®—ã—ã¾ã™ã€‚<br>\n                DDUä¾¡æ ¼ï¼ˆé–¢ç¨æŠœãï¼‰ã¨DDPä¾¡æ ¼ï¼ˆé–¢ç¨è¾¼ã¿ï¼‰ã®ä¸¡æ–¹ã‹ã‚‰è¨ˆç®—ã§ãã¾ã™ã€‚<br>\n                ä½¿ç”¨ä¾‹: 500ãƒ‰ãƒ«ã§è²©å£²ã—ã€20%ã®åˆ©ç›Šç‡ã‚’ç¢ºä¿ã™ã‚‹ã«ã¯ã€ã„ãã‚‰ã¾ã§ä»•å…¥ã‚Œã‚‰ã‚Œã‚‹ï¼Ÿ\n            </div>\n\n            <h3>DDU vs DDP ã«ã¤ã„ã¦</h3>\n            <div class="step">\n                <strong>DDUï¼ˆDelivered Duty Unpaidï¼‰:</strong> é–¢ç¨æŠœãã®ä¾¡æ ¼ã€‚è³¼å…¥è€…ãŒé–¢ç¨ã‚’è² æ‹…ã—ã¾ã™ã€‚<br>\n                <strong>DDPï¼ˆDelivered Duty Paidï¼‰:</strong> é–¢ç¨è¾¼ã¿ã®ä¾¡æ ¼ã€‚è²©å£²è€…ãŒé–¢ç¨ã‚’è² æ‹…ã—ã€ä¾¡æ ¼ã«å«ã‚ã¾ã™ã€‚<br>\n                <br>\n                ä»•å…¥ã‚Œä¾¡æ ¼ç®—å‡ºã§ã¯ã€DDUä¾¡æ ¼ã¨DDPä¾¡æ ¼ã®ä¸¡æ–¹ã‚’åŒæ™‚ã«å…¥åŠ›ãƒ»è¨ˆç®—ã§ãã‚‹ã®ã§ã€ã©ã¡ã‚‰ã®è²©å£²æ–¹æ³•ã§ã‚‚å¯¾å¿œå¯èƒ½ã§ã™ã€‚\n            </div>\n\n            <h3>è¨ˆç®—å¼ã®è¦‹æ–¹</h3>\n            <p>å„è¨ˆç®—çµæœã®ä¸‹éƒ¨ã«ã¯ã€é’ã„èƒŒæ™¯ã®è¨ˆç®—å¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯å®Ÿéš›ã®æ•°å€¤ã§ã¯ãªãã€å¤‰æ•°åã§ç¤ºã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç†è§£ã™ã‚‹éš›ã«å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚</p>\n\n            <h3>è¨­å®šã®ä¿å­˜</h3>\n            <p>ã€Œè¨­å®šã‚’ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€å…±é€šè¨­å®šãŒãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã€æ¬¡å›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã‚‚åŒã˜è¨­å®šãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</p>\n\n            <button class="close-btn" onclick="closeTutorial()">é–‰ã˜ã‚‹</button>\n        </div>\n    </div>\n\n    <script>\n        // é€æ–™ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã®Shipping_Ratesã‚·ãƒ¼ãƒˆã‹ã‚‰å–å¾—ï¼‰\n        const SHIPPING_RATE_TABLE = {\n            EP: [ // eãƒ‘ã‚±ãƒƒãƒˆ\n                { min: 1, max: 100, yen: 1200 }, { min: 101, max: 200, yen: 1410 }, { min: 201, max: 300, yen: 1620 },\n                { min: 301, max: 400, yen: 1830 }, { min: 401, max: 500, yen: 2040 }, { min: 501, max: 600, yen: 2250 },\n                { min: 601, max: 700, yen: 2460 }, { min: 701, max: 800, yen: 2670 }, { min: 801, max: 900, yen: 2880 },\n                { min: 901, max: 1000, yen: 3090 }, { min: 1001, max: 1100, yen: 3300 }, { min: 1101, max: 1200, yen: 3510 },\n                { min: 1201, max: 1300, yen: 3720 }, { min: 1301, max: 1400, yen: 3930 }, { min: 1401, max: 1500, yen: 4140 },\n                { min: 1501, max: 1600, yen: 4350 }, { min: 1601, max: 1700, yen: 4560 }, { min: 1701, max: 1800, yen: 4770 },\n                { min: 1801, max: 1900, yen: 4980 }, { min: 1901, max: 2000, yen: 5190 }\n            ],\n            CE: [ // Cpass-Economy\n                { min: 1, max: 100, yen: 1227 }, { min: 101, max: 200, yen: 1367 }, { min: 201, max: 300, yen: 1581 },\n                { min: 301, max: 400, yen: 1778 }, { min: 401, max: 500, yen: 2060 }, { min: 501, max: 600, yen: 2222 },\n                { min: 601, max: 700, yen: 2321 }, { min: 701, max: 800, yen: 2703 }, { min: 801, max: 900, yen: 2820 },\n                { min: 901, max: 1000, yen: 3020 }, { min: 1001, max: 1100, yen: 3136 }, { min: 1101, max: 1200, yen: 3250 },\n                { min: 1201, max: 1250, yen: 3366 }, { min: 1251, max: 1300, yen: 3366 }, { min: 1301, max: 1400, yen: 3704 },\n                { min: 1401, max: 1500, yen: 3816 }, { min: 1501, max: 1600, yen: 3935 }, { min: 1601, max: 1700, yen: 4046 },\n                { min: 1701, max: 1750, yen: 4165 }, { min: 1751, max: 1800, yen: 4165 }, { min: 1801, max: 1900, yen: 5056 },\n                { min: 1901, max: 2000, yen: 5245 }, { min: 2001, max: 2500, yen: 5582 }, { min: 2501, max: 3000, yen: 6333 },\n                { min: 3001, max: 3500, yen: 6958 }, { min: 3501, max: 4000, yen: 7704 }, { min: 4001, max: 4500, yen: 9135 },\n                { min: 4501, max: 5000, yen: 11733 }, { min: 5001, max: 5500, yen: 12500 }, { min: 5501, max: 6000, yen: 13335 },\n                { min: 6001, max: 6500, yen: 14160 }, { min: 6501, max: 7000, yen: 15209 }, { min: 7001, max: 7500, yen: 16058 },\n                { min: 7501, max: 8000, yen: 16893 }, { min: 8001, max: 8500, yen: 17562 }, { min: 8501, max: 9000, yen: 18152 },\n                { min: 9001, max: 9500, yen: 19106 }, { min: 9501, max: 10000, yen: 19639 }, { min: 10001, max: 10500, yen: 20276 },\n                { min: 10501, max: 11000, yen: 20864 }, { min: 11001, max: 11500, yen: 21565 }, { min: 11501, max: 12000, yen: 22199 },\n                { min: 12001, max: 12500, yen: 22887 }, { min: 12501, max: 13000, yen: 23466 }, { min: 13001, max: 13500, yen: 24054 },\n                { min: 13501, max: 14000, yen: 24869 }, { min: 14001, max: 14500, yen: 25200 }, { min: 14501, max: 15000, yen: 25988 },\n                { min: 15001, max: 15500, yen: 26656 }, { min: 15501, max: 16000, yen: 28149 }, { min: 16001, max: 16500, yen: 28775 },\n                { min: 16501, max: 17000, yen: 29495 }, { min: 17001, max: 17500, yen: 30196 }, { min: 17501, max: 18000, yen: 30902 },\n                { min: 18001, max: 18500, yen: 31478 }, { min: 18501, max: 19000, yen: 32204 }, { min: 19001, max: 19500, yen: 32936 },\n                { min: 19501, max: 20000, yen: 33947 }, { min: 20001, max: 20500, yen: 34655 }, { min: 20501, max: 21000, yen: 35426 },\n                { min: 21001, max: 21500, yen: 36145 }, { min: 21501, max: 22000, yen: 36859 }, { min: 22001, max: 22500, yen: 37602 },\n                { min: 22501, max: 23000, yen: 38516 }, { min: 23001, max: 23500, yen: 39084 }, { min: 23501, max: 24000, yen: 39678 },\n                { min: 24001, max: 24500, yen: 40374 }, { min: 24501, max: 25000, yen: 40955 }, { min: 25001, max: 26000, yen: null },\n                { min: 26001, max: 27000, yen: null }, { min: 27001, max: 28000, yen: null }, { min: 28001, max: 29000, yen: null },\n                { min: 29001, max: 30000, yen: null }\n            ],\n            EMS: [ // EMS\n                { min: 1, max: 100, yen: 3900 }, { min: 101, max: 500, yen: 3900 }, { min: 501, max: 600, yen: 4180 },\n                { min: 601, max: 700, yen: 4460 }, { min: 701, max: 800, yen: 4740 }, { min: 801, max: 900, yen: 5020 },\n                { min: 901, max: 1000, yen: 5300 }, { min: 1001, max: 1250, yen: 5990 }, { min: 1251, max: 1300, yen: 6600 },\n                { min: 1301, max: 1500, yen: 6600 }, { min: 1501, max: 1750, yen: 7290 }, { min: 1751, max: 1800, yen: 7900 },\n                { min: 1801, max: 2000, yen: 7900 }, { min: 2001, max: 2500, yen: 9100 }, { min: 2501, max: 3000, yen: 10300 },\n                { min: 3001, max: 3500, yen: 11500 }, { min: 3501, max: 4000, yen: 12700 }, { min: 4001, max: 4500, yen: 13900 },\n                { min: 4501, max: 5000, yen: 15100 }, { min: 5001, max: 5500, yen: 16300 }, { min: 5501, max: 6500, yen: 17500 },\n                { min: 6501, max: 7500, yen: 19900 }, { min: 7501, max: 8500, yen: 22300 }, { min: 8501, max: 9500, yen: 24700 },\n                { min: 9501, max: 10500, yen: 27100 }, { min: 10501, max: 11500, yen: 29500 }, { min: 11501, max: 12500, yen: 31900 },\n                { min: 12501, max: 13500, yen: 34300 }, { min: 13501, max: 14500, yen: 36700 }, { min: 14501, max: 15500, yen: 39100 },\n                { min: 15501, max: 16500, yen: 41500 }, { min: 16501, max: 17500, yen: 43900 }, { min: 17501, max: 18500, yen: 46300 },\n                { min: 18501, max: 19500, yen: 48700 }, { min: 19501, max: 20500, yen: 51100 }, { min: 20501, max: 21500, yen: 53500 },\n                { min: 21501, max: 22500, yen: 55900 }, { min: 22501, max: 23500, yen: 58300 }, { min: 23501, max: 24500, yen: 60700 },\n                { min: 24501, max: 25000, yen: 63100 }, { min: 25001, max: 26000, yen: 65500 }, { min: 26001, max: 27000, yen: 67900 },\n                { min: 27001, max: 28000, yen: 70300 }, { min: 28001, max: 29000, yen: 72700 }, { min: 29001, max: 30000, yen: 75100 }\n            ],\n            CF: [ // Cpass-FedEx\n                { min: 1, max: 1000, yen: 1984 }, { min: 1001, max: 1500, yen: 2439 }, { min: 1501, max: 2000, yen: 2666 },\n                { min: 2001, max: 2500, yen: 2918 }, { min: 2501, max: 3000, yen: 3173 }, { min: 3001, max: 3500, yen: 3329 },\n                { min: 3501, max: 4000, yen: 3382 }, { min: 4001, max: 4500, yen: 3786 }, { min: 4501, max: 5000, yen: 4188 },\n                { min: 5001, max: 5500, yen: 4495 }, { min: 5501, max: 6000, yen: 4805 }, { min: 6001, max: 6500, yen: 5114 },\n                { min: 6501, max: 7000, yen: 5465 }, { min: 7001, max: 7500, yen: 5893 }, { min: 7501, max: 8000, yen: 6267 },\n                { min: 8001, max: 8500, yen: 6444 }, { min: 8501, max: 9000, yen: 6621 }, { min: 9001, max: 9500, yen: 6797 },\n                { min: 9501, max: 10000, yen: 8327 }, { min: 10001, max: 10500, yen: 8539 }, { min: 10501, max: 11000, yen: 8765 },\n                { min: 11001, max: 11500, yen: 8991 }, { min: 11501, max: 12000, yen: 9217 }, { min: 12001, max: 12500, yen: 9444 },\n                { min: 12501, max: 13000, yen: 10790 }, { min: 13001, max: 13500, yen: 11043 }, { min: 13501, max: 14000, yen: 11295 },\n                { min: 14001, max: 14500, yen: 11548 }, { min: 14501, max: 15000, yen: 11800 }, { min: 15001, max: 15500, yen: 12052 },\n                { min: 15501, max: 16000, yen: 12305 }, { min: 16001, max: 16500, yen: 13855 }, { min: 16501, max: 17000, yen: 14133 },\n                { min: 17001, max: 17500, yen: 14411 }, { min: 17501, max: 18000, yen: 14690 }, { min: 18001, max: 18500, yen: 14969 },\n                { min: 18501, max: 19000, yen: 15246 }, { min: 19001, max: 19500, yen: 15525 }, { min: 19501, max: 20000, yen: 15804 },\n                { min: 20001, max: 20500, yen: 16082 }, { min: 20501, max: 21000, yen: 18179 }, { min: 21001, max: 21500, yen: 19099 },\n                { min: 21501, max: 22000, yen: 20020 }, { min: 22001, max: 22500, yen: 20940 }, { min: 22501, max: 23000, yen: 21860 },\n                { min: 23001, max: 23500, yen: 22780 }, { min: 23501, max: 24000, yen: 23700 }, { min: 24001, max: 24500, yen: 24621 },\n                { min: 24501, max: 25000, yen: 25541 }, { min: 25001, max: 26000, yen: 26461 }, { min: 26001, max: 27000, yen: 27381 },\n                { min: 27001, max: 28000, yen: 28301 }, { min: 28001, max: 29000, yen: 30096 }, { min: 29001, max: 30000, yen: 31008 },\n                { min: 30001, max: Infinity, yen: 31920 }\n            ],\n            CD: [ // Cpass-DHL\n                { min: 1, max: 1000, yen: 2191 }, { min: 1001, max: 1500, yen: 2482 }, { min: 1501, max: 2000, yen: 2588 },\n                { min: 2001, max: 2500, yen: 2719 }, { min: 2501, max: 3000, yen: 3040 }, { min: 3001, max: 3500, yen: 3358 },\n                { min: 3501, max: 4000, yen: 3753 }, { min: 4001, max: 4500, yen: 4079 }, { min: 4501, max: 5000, yen: 4406 },\n                { min: 5001, max: 5500, yen: 4732 }, { min: 5501, max: 6000, yen: 5058 }, { min: 6001, max: 6500, yen: 5383 },\n                { min: 6501, max: 7000, yen: 5753 }, { min: 7001, max: 7500, yen: 6203 }, { min: 7501, max: 8000, yen: 6652 },\n                { min: 8001, max: 8500, yen: 7102 }, { min: 8501, max: 9000, yen: 7550 }, { min: 9001, max: 9500, yen: 7999 },\n                { min: 9501, max: 10000, yen: 8449 }, { min: 10001, max: 10500, yen: 8898 }, { min: 10501, max: 11000, yen: 9347 },\n                { min: 11001, max: 11500, yen: 9796 }, { min: 11501, max: 12000, yen: 10246 }, { min: 12001, max: 12500, yen: 10695 },\n                { min: 12501, max: 13000, yen: 11144 }, { min: 13001, max: 13500, yen: 11594 }, { min: 13501, max: 14000, yen: 12042 },\n                { min: 14001, max: 14500, yen: 12492 }, { min: 14501, max: 15000, yen: 12941 }, { min: 15001, max: 15500, yen: 13391 },\n                { min: 15501, max: 16000, yen: 13840 }, { min: 16001, max: 16500, yen: 14290 }, { min: 16501, max: 17000, yen: 14739 },\n                { min: 17001, max: 17500, yen: 15188 }, { min: 17501, max: 18000, yen: 15638 }, { min: 18001, max: 18500, yen: 16087 },\n                { min: 18501, max: 19000, yen: 16537 }, { min: 19001, max: 19500, yen: 16986 }, { min: 19501, max: 20000, yen: 17436 },\n                { min: 20001, max: 20500, yen: 17885 }, { min: 20501, max: 21000, yen: 18784 }, { min: 21001, max: 21500, yen: 19683 },\n                { min: 21501, max: 22000, yen: 20582 }, { min: 22001, max: 22500, yen: 21481 }, { min: 22501, max: 23000, yen: 22380 },\n                { min: 23001, max: 23500, yen: 23279 }, { min: 23501, max: 24000, yen: 24177 }, { min: 24001, max: 24500, yen: 25076 },\n                { min: 24501, max: 25000, yen: 25966 }, { min: 25001, max: 26000, yen: 26865 }, { min: 26001, max: 27000, yen: 27761 },\n                { min: 27001, max: 28000, yen: 28657 }, { min: 28001, max: 29000, yen: 29552 }, { min: 29001, max: 30000, yen: 30448 },\n                { min: 30001, max: Infinity, yen: 31343 }\n            ],\n            EL: [ // eLogistics\n                { min: 1, max: 1000, yen: 3700 }, { min: 1001, max: 1500, yen: 3900 }, { min: 1501, max: 2000, yen: 4100 },\n                { min: 2001, max: 2500, yen: 4300 }, { min: 2501, max: 3000, yen: 5600 }, { min: 3001, max: 3500, yen: 5900 },\n                { min: 3501, max: 4000, yen: 6300 }, { min: 4001, max: 4500, yen: 6600 }, { min: 4501, max: 5000, yen: 7200 },\n                { min: 5001, max: 5500, yen: 7900 }, { min: 5501, max: 6000, yen: 8700 }, { min: 6001, max: 6500, yen: 10300 },\n                { min: 6501, max: 7000, yen: 12200 }, { min: 7001, max: 7500, yen: 14100 }, { min: 7501, max: 8000, yen: 16000 },\n                { min: 8001, max: 8500, yen: 17900 }, { min: 8501, max: 9000, yen: 19800 }, { min: 9001, max: 9500, yen: 21800 },\n                { min: 9501, max: 10000, yen: 23700 }, { min: 10001, max: 10500, yen: 25600 }, { min: 10501, max: 11000, yen: 25800 },\n                { min: 11001, max: 11500, yen: 26100 }, { min: 11501, max: 12000, yen: 26600 }, { min: 12001, max: 12500, yen: 27100 },\n                { min: 12501, max: 13000, yen: 27500 }, { min: 13001, max: 13500, yen: 28000 }, { min: 13501, max: 14000, yen: 28500 },\n                { min: 14001, max: 14500, yen: 28900 }, { min: 14501, max: 15000, yen: 29400 }, { min: 15001, max: 15500, yen: 29900 },\n                { min: 15501, max: 16000, yen: 30400 }, { min: 16001, max: 16500, yen: 30800 }, { min: 16501, max: 17000, yen: 31300 },\n                { min: 17001, max: 17500, yen: 31800 }, { min: 17501, max: 18000, yen: 32300 }, { min: 18001, max: 18500, yen: 32700 },\n                { min: 18501, max: 19000, yen: 33200 }, { min: 19001, max: 19500, yen: 33700 }, { min: 19501, max: 20000, yen: 34200 },\n                { min: 20001, max: 20500, yen: 34600 }, { min: 20501, max: 21000, yen: 35300 }, { min: 21001, max: 21500, yen: 35900 },\n                { min: 21501, max: 22000, yen: 36500 }, { min: 22001, max: 22500, yen: 37100 }, { min: 22501, max: 23000, yen: 37800 },\n                { min: 23001, max: 23500, yen: 38400 }, { min: 23501, max: 24000, yen: 39000 }, { min: 24001, max: 24500, yen: 39700 },\n                { min: 24501, max: 25000, yen: 40300 }, { min: 25001, max: 26000, yen: 40900 }, { min: 26001, max: 27000, yen: 42200 },\n                { min: 27001, max: 28000, yen: 43400 }, { min: 28001, max: 29000, yen: 44700 }, { min: 29001, max: 30000, yen: 45900 },\n                { min: 30001, max: Infinity, yen: 47200 }\n            ]\n        };\n\n        const SHIPPING_CONFIG = {\n            fedexFuel: 0.2975,\n            dhlFuel: 0.3,\n            cpassDiscount: 0.03,\n            fedexExtraPer500g: 115,\n            dhlExtraPer500g: 96\n        };\n\n        // ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿\n        function toggleShippingMode() {\n            const mode = document.getElementById(\'shippingMode\').value;\n            const fixedSettings = document.getElementById(\'fixedShippingSettings\');\n            const tableSettings = document.getElementById(\'tableShippingSettings\');\n\n            if (mode === \'fixed\') {\n                fixedSettings.classList.remove(\'hidden\');\n                tableSettings.classList.add(\'hidden\');\n            } else {\n                fixedSettings.classList.add(\'hidden\');\n                tableSettings.classList.remove(\'hidden\');\n                calculateVolumetricWeight();\n            }\n        }\n\n        // å®¹ç©é‡é‡ã‚’è‡ªå‹•è¨ˆç®—ï¼ˆ2ç¨®é¡ï¼‰\n        function calculateVolumetricWeight() {\n            const length = parseFloat(document.getElementById(\'packageLength\').value) || 0;\n            const width = parseFloat(document.getElementById(\'packageWidth\').value) || 0;\n            const height = parseFloat(document.getElementById(\'packageHeight\').value) || 0;\n\n            const volume = length * width * height;\n\n            // CF/CD/EL/EMSç”¨ï¼ˆÃ·5ï¼‰\n            const volWeight5 = Math.max(Math.round(volume / 5), 100);\n            // CEç”¨ï¼ˆÃ·8ï¼‰\n            const volWeight8 = Math.max(Math.round(volume / 8), 100);\n\n            document.getElementById(\'volumetricWeight\').value = volWeight5;\n            document.getElementById(\'volumetricWeightCE\').value = volWeight8;\n\n            // é€æ–™è©¦ç®—ã‚‚æ›´æ–°\n            calculateEstimatedShipping();\n        }\n\n        // é€æ–™è©¦ç®—ã‚’è¨ˆç®—ãƒ»è¡¨ç¤ºï¼ˆå…¨é…é€æ–¹æ³•ï¼‰\n        function calculateEstimatedShipping() {\n            const actualWeight = parseFloat(document.getElementById(\'actualWeight\').value) || 0;\n            const volWeight5 = parseFloat(document.getElementById(\'volumetricWeight\').value) || 0;\n            const volWeight8 = parseFloat(document.getElementById(\'volumetricWeightCE\').value) || 0;\n            const selectedMethod = document.getElementById(\'shippingMethod\').value;\n\n            // å…¨é…é€æ–¹æ³•ã®ãƒªã‚¹ãƒˆ\n            const allMethods = [\n                { code: \'EP\', name: \'eãƒ‘ã‚±ãƒƒãƒˆ\', volWeight: 0 }, // å®Ÿé‡é‡ã®ã¿\n                { code: \'CE\', name: \'Cpass-Economy\', volWeight: volWeight8 },\n                { code: \'CF\', name: \'Cpass-FedEx\', volWeight: volWeight5 },\n                { code: \'CD\', name: \'Cpass-DHL\', volWeight: volWeight5 },\n                { code: \'EL\', name: \'eLogistics\', volWeight: volWeight5 },\n                { code: \'EMS\', name: \'EMS\', volWeight: 0 } // å®Ÿé‡é‡ã®ã¿\n            ];\n\n            // è‡ªå‹•é¸æŠã®å ´åˆã€å®Ÿéš›ã«ä½¿ã‚ã‚Œã‚‹é…é€æ–¹æ³•ã‚’åˆ¤å®š\n            let autoSelectedCode = null;\n            if (selectedMethod === \'è‡ªå‹•é¸æŠ\') {\n                const settings = getSettings();\n                const lowMethod = settings.lowPriceMethod || \'EP\';\n                const highMethod = settings.highPriceMethod || \'CF\';\n                // åŸºæœ¬ã¯ä½ä¾¡æ ¼é…é€æ–¹æ³•ã€eãƒ‘ã‚±ãƒƒãƒˆã§2000gè¶…éã¯é«˜ä¾¡æ ¼é…é€æ–¹æ³•\n                autoSelectedCode = (lowMethod === \'EP\' && actualWeight > 2000) ? highMethod : lowMethod;\n            }\n\n            // å„é…é€æ–¹æ³•ã®é€æ–™ã‚’è¨ˆç®—\n            let tableHtml = \'\';\n            allMethods.forEach(m => {\n                // èª²é‡‘é‡é‡ã®è¨ˆç®—\n                let chargeableWeight;\n                if (m.code === \'EP\' || m.code === \'EMS\') {\n                    chargeableWeight = actualWeight; // eãƒ‘ã‚±ãƒƒãƒˆãƒ»EMSã¯å®Ÿé‡é‡ã®ã¿\n                } else {\n                    chargeableWeight = Math.max(actualWeight, m.volWeight);\n                }\n\n                // é€æ–™è¨ˆç®—\n                const cost = calculateSpecificMethodRate(m.code, actualWeight, chargeableWeight);\n                const isUnavailable = (cost === null || cost === undefined || cost === 999999);\n\n                // é¸æŠä¸­ã‹ã©ã†ã‹åˆ¤å®š\n                let isSelected = false;\n                if (selectedMethod === \'è‡ªå‹•é¸æŠ\') {\n                    isSelected = (m.code === autoSelectedCode);\n                } else {\n                    isSelected = (m.code === selectedMethod);\n                }\n\n                // è¡Œã‚¯ãƒ©ã‚¹\n                let rowClass = \'\';\n                if (isSelected) rowClass = \'selected\';\n                else if (isUnavailable) rowClass = \'unavailable\';\n\n                // é€æ–™è¡¨ç¤º\n                let costDisplay = isUnavailable ? \'å¯¾å¿œä¸å¯\' : `Â¥${cost.toLocaleString()}`;\n\n                tableHtml += `<tr class="${rowClass}">\n                    <td>${m.name}</td>\n                    <td class="weight-cell">${chargeableWeight.toLocaleString()} g</td>\n                    <td class="cost-cell">${costDisplay}</td>\n                </tr>`;\n            });\n\n            document.getElementById(\'shippingEstimateBody\').innerHTML = tableHtml;\n            document.getElementById(\'autoSelectNote\').style.display = (selectedMethod === \'è‡ªå‹•é¸æŠ\') ? \'block\' : \'none\';\n        }\n\n        // é…é€æ–¹æ³•ã‚³ãƒ¼ãƒ‰ã‚’æ—¥æœ¬èªåã«å¤‰æ›\n        function getMethodName(code) {\n            const methodNames = {\n                \'EP\': \'eãƒ‘ã‚±ãƒƒãƒˆ\',\n                \'CF\': \'Cpass-FedEx\',\n                \'CD\': \'Cpass-DHL\',\n                \'EL\': \'eLogistics\',\n                \'CE\': \'Cpass-Economy\',\n                \'EMS\': \'EMS\'\n            };\n            return methodNames[code] || code;\n        }\n\n        // eãƒ‘ã‚±ãƒƒãƒˆ æ–™é‡‘å–å¾—\n        function getEpacketRate(weight) {\n            // 2000gã‚’è¶…ãˆã‚‹å ´åˆã¯nullã‚’è¿”ã™\n            if (weight > 2000) {\n                return null;\n            }\n            for (let i = 0; i < SHIPPING_RATE_TABLE.EP.length; i++) {\n                if (weight >= SHIPPING_RATE_TABLE.EP[i].min && weight <= SHIPPING_RATE_TABLE.EP[i].max) {\n                    return SHIPPING_RATE_TABLE.EP[i].yen;\n                }\n            }\n            return null;\n        }\n\n        // Cpass-FedEx æ–™é‡‘è¨ˆç®—\n        function getCpassFedexRate(weight) {\n            const rounded = Math.ceil(weight / 500) * 500;\n            let base = null;\n\n            for (let i = 0; i < SHIPPING_RATE_TABLE.CF.length; i++) {\n                if (weight >= SHIPPING_RATE_TABLE.CF[i].min && weight <= SHIPPING_RATE_TABLE.CF[i].max) {\n                    base = SHIPPING_RATE_TABLE.CF[i].yen;\n                    break;\n                }\n            }\n\n            if (!base) return 999999;\n\n            const overUnits = Math.max(0, (rounded - 500) / 500);\n            const extra = overUnits * SHIPPING_CONFIG.fedexExtraPer500g;\n            const subTotal = base + extra;\n            const fuel = subTotal * SHIPPING_CONFIG.fedexFuel;\n            const discount = -(subTotal + fuel) * SHIPPING_CONFIG.cpassDiscount;\n            return Math.round(subTotal + fuel + discount);\n        }\n\n        // Cpass-DHL æ–™é‡‘è¨ˆç®—\n        function getCpassDHLRate(weight) {\n            const rounded = Math.ceil(weight / 500) * 500;\n            let base = null;\n\n            for (let i = 0; i < SHIPPING_RATE_TABLE.CD.length; i++) {\n                if (weight >= SHIPPING_RATE_TABLE.CD[i].min && weight <= SHIPPING_RATE_TABLE.CD[i].max) {\n                    base = SHIPPING_RATE_TABLE.CD[i].yen;\n                    break;\n                }\n            }\n\n            if (!base) return 999999;\n\n            const overUnits = Math.max(0, (rounded - 500) / 500);\n            const extra = overUnits * SHIPPING_CONFIG.dhlExtraPer500g;\n            const subTotal = base + extra;\n            const fuel = subTotal * SHIPPING_CONFIG.dhlFuel;\n            const discount = -(subTotal + fuel) * SHIPPING_CONFIG.cpassDiscount;\n            return Math.round(subTotal + fuel + discount);\n        }\n\n        // eLogistics æ–™é‡‘è¨ˆç®—\n        function getElogiRate(weight) {\n            for (let i = 0; i < SHIPPING_RATE_TABLE.EL.length; i++) {\n                if (weight >= SHIPPING_RATE_TABLE.EL[i].min && weight <= SHIPPING_RATE_TABLE.EL[i].max) {\n                    return SHIPPING_RATE_TABLE.EL[i].yen;\n                }\n            }\n            return 999999;\n        }\n\n        // Cpass-Economy æ–™é‡‘å–å¾—\n        function getCpassEconomyRate(weight) {\n            for (let i = 0; i < SHIPPING_RATE_TABLE.CE.length; i++) {\n                if (weight >= SHIPPING_RATE_TABLE.CE[i].min && weight <= SHIPPING_RATE_TABLE.CE[i].max) {\n                    const rate = SHIPPING_RATE_TABLE.CE[i].yen;\n                    return rate !== null ? rate : 999999;\n                }\n            }\n            return 999999;\n        }\n\n        // EMS æ–™é‡‘å–å¾—\n        function getEMSRate(weight) {\n            for (let i = 0; i < SHIPPING_RATE_TABLE.EMS.length; i++) {\n                if (weight >= SHIPPING_RATE_TABLE.EMS[i].min && weight <= SHIPPING_RATE_TABLE.EMS[i].max) {\n                    return SHIPPING_RATE_TABLE.EMS[i].yen;\n                }\n            }\n            return 999999;\n        }\n\n        // é€æ–™è¨ˆç®—ãƒ¡ã‚¤ãƒ³é–¢æ•°\n        function calculateShippingCost(costYen, actualWeight, volWeight, method, threshold, lowMethod, highMethod, volume, shippingMode) {\n            // å›ºå®šãƒ¢ãƒ¼ãƒ‰åˆ¤å®š\n            if (shippingMode === \'fixed\') {\n                return parseFloat(document.getElementById(\'shippingCost\').value) || 3000;\n            }\n\n            // ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ¢ãƒ¼ãƒ‰\n            if (method && method !== \'è‡ªå‹•é¸æŠ\') {\n                // é…é€æ–¹æ³•ã«å¿œã˜ã¦å®¹ç©é‡é‡ã‚’å†è¨ˆç®—\n                const recalcVolWeight = calculateVolWeightByMethod(method, volume);\n                const chargeableWeight = Math.max(actualWeight || 0, recalcVolWeight || 0);\n                return calculateSpecificMethodRate(method, actualWeight, chargeableWeight);\n            }\n\n            // è‡ªå‹•é¸æŠï¼šå®Ÿéš›ã«ä½¿ç”¨ã•ã‚Œã‚‹é…é€æ–¹æ³•ã‚’åˆ¤å®š\n            let actualMethod;\n            if (lowMethod === \'NONE\' || costYen >= threshold) {\n                actualMethod = highMethod;\n            } else {\n                // ä½ä¾¡æ ¼é…é€æ–¹æ³•ã‚’ä½¿ç”¨\n                actualMethod = lowMethod;\n                // ãŸã ã—ã€eãƒ‘ã‚±ãƒƒãƒˆã§é‡é‡ã‚ªãƒ¼ãƒãƒ¼ã®å ´åˆã¯é«˜ä¾¡æ ¼é…é€æ–¹æ³•\n                if (lowMethod === \'EP\' && actualWeight > 2000) {\n                    actualMethod = highMethod;\n                }\n            }\n\n            // åˆ¤å®šã•ã‚ŒãŸé…é€æ–¹æ³•ã«å¿œã˜ã¦å®¹ç©é‡é‡ã‚’å†è¨ˆç®—\n            const recalcVolWeight = calculateVolWeightByMethod(actualMethod, volume);\n            const chargeableWeight = Math.max(actualWeight || 0, recalcVolWeight || 0);\n\n            if (actualMethod === \'EP\') {\n                return getEpacketRate(actualWeight);\n            } else {\n                return calculateSpecificMethodRate(actualMethod, actualWeight, chargeableWeight);\n            }\n        }\n\n        // é…é€æ–¹æ³•ã®è¡¨ç¤ºåã‚’å–å¾—\n        function getShippingMethodDisplayName(method) {\n            const names = {\n                \'EP\': \'eãƒ‘ã‚±ãƒƒãƒˆ\',\n                \'CE\': \'Cpass-Economy\',\n                \'CF\': \'Cpass-FedEx\',\n                \'CD\': \'Cpass-DHL\',\n                \'EL\': \'eLogi\',\n                \'EMS\': \'EMS\',\n                \'è‡ªå‹•é¸æŠ\': \'è‡ªå‹•é¸æŠ\'\n            };\n            return names[method] || method;\n        }\n\n        // å®Ÿéš›ã«ä½¿ç”¨ã•ã‚Œã‚‹é…é€æ–¹æ³•ã‚’åˆ¤å®šï¼ˆé€šé–¢æ‰‹æ•°æ–™åˆ¤å®šç”¨ï¼‰\n        function getEffectiveShippingMethod(costYen, actualWeight, method, threshold, lowMethod, highMethod) {\n            // é…é€æ–¹æ³•ãŒæ˜ç¤ºçš„ã«æŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ\n            if (method && method !== \'è‡ªå‹•é¸æŠ\') {\n                return method;\n            }\n\n            // è‡ªå‹•é¸æŠã®å ´åˆ\n            if (lowMethod === \'NONE\' || costYen >= threshold) {\n                return highMethod;\n            } else {\n                // ä½ä¾¡æ ¼é…é€æ–¹æ³•ã‚’ä½¿ç”¨\n                let actualMethod = lowMethod;\n                // ãŸã ã—ã€eãƒ‘ã‚±ãƒƒãƒˆã§é‡é‡ã‚ªãƒ¼ãƒãƒ¼ã®å ´åˆã¯é«˜ä¾¡æ ¼é…é€æ–¹æ³•\n                if (lowMethod === \'EP\' && actualWeight > 2000) {\n                    actualMethod = highMethod;\n                }\n                return actualMethod;\n            }\n        }\n\n        // é…é€æ–¹æ³•ã«å¿œã˜ãŸå®¹ç©é‡é‡è¨ˆç®—\n        function calculateVolWeightByMethod(method, volume) {\n            if (!volume) return 0;\n\n            let volumetricWeight;\n            if (method === \'CE\') {\n                volumetricWeight = Math.round(volume / 8);\n            } else {\n                volumetricWeight = Math.round(volume / 5);\n            }\n            return Math.max(volumetricWeight, 100);\n        }\n\n        // é…é€æ–¹æ³•åˆ¥ã®æ–™é‡‘è¨ˆç®—\n        function calculateSpecificMethodRate(method, actualWeight, chargeableWeight) {\n            switch(method) {\n                case \'EP\':\n                    // eãƒ‘ã‚±ãƒƒãƒˆã¯å®Ÿé‡é‡ã®ã¿ä½¿ç”¨ã€2000gè¶…éæ™‚ã¯nullã‚’è¿”ã™\n                    return getEpacketRate(actualWeight);\n                case \'CF\':\n                    return getCpassFedexRate(chargeableWeight);\n                case \'CD\':\n                    return getCpassDHLRate(chargeableWeight);\n                case \'EL\':\n                    return getElogiRate(chargeableWeight);\n                case \'CE\':\n                    return getCpassEconomyRate(chargeableWeight);\n                case \'EMS\':\n                    // EMSã¯å®Ÿé‡é‡ã®ã¿ä½¿ç”¨\n                    return getEMSRate(actualWeight);\n                default:\n                    return getCpassDHLRate(chargeableWeight);\n            }\n        }\n\n        // èª¿æ•´é–¢ç¨ç‡ã‚’è¨ˆç®—ãƒ»è¡¨ç¤º\n        // DDPä¾¡æ ¼ã«eBayæ‰‹æ•°æ–™ãŒèª²ã•ã‚Œã‚‹ãŸã‚ã€é–¢ç¨ç‡ã‚’èª¿æ•´\n        // èª¿æ•´é–¢ç¨ç‡ = å®Ÿéš›ã®é–¢ç¨ç‡ / (1 - æ‰‹æ•°æ–™ç‡ - åºƒå‘Šè²»ç‡) Ã— 1.03ï¼ˆ3%å®‰å…¨ä¿‚æ•°ï¼‰\n        function updateAdjustedTariffRate() {\n            const tariffRate = parseFloat(document.getElementById(\'tariffRate\').value) / 100;\n            const feeRate = parseFloat(document.getElementById(\'feeRate\').value) / 100;\n            const adRate = parseFloat(document.getElementById(\'adRate\').value) / 100;\n            const adjustedRate = tariffRate / (1 - feeRate - adRate) * 1.03;\n            document.getElementById(\'adjustedTariffRate\').textContent = (adjustedRate * 100).toFixed(1);\n        }\n\n        // è¨­å®šã‚’å–å¾—\n        function getSettings() {\n            const tariffRate = parseFloat(document.getElementById(\'tariffRate\').value) / 100;\n            const feeRate = parseFloat(document.getElementById(\'feeRate\').value) / 100;\n            const adRate = parseFloat(document.getElementById(\'adRate\').value) / 100;\n            // èª¿æ•´é–¢ç¨ç‡ = å®Ÿéš›ã®é–¢ç¨ç‡ / (1 - æ‰‹æ•°æ–™ç‡ - åºƒå‘Šè²»ç‡) Ã— 1.03ï¼ˆ3%å®‰å…¨ä¿‚æ•°ï¼‰\n            const adjustedTariffRate = tariffRate / (1 - feeRate - adRate) * 1.03;\n\n            return {\n                exchangeRate: parseFloat(document.getElementById(\'exchangeRate\').value),\n                tariffRate: tariffRate,                    // å®Ÿéš›ã®é–¢ç¨ç‡\n                adjustedTariffRate: adjustedTariffRate,    // èª¿æ•´å¾Œé–¢ç¨ç‡ï¼ˆæƒ³å®šé–¢ç¨è¨ˆç®—ç”¨ï¼‰\n                vatRate: parseFloat(document.getElementById(\'vatRate\').value) / 100,\n                processingFeeRate: parseFloat(document.getElementById(\'processingFeeRate\').value) / 100,\n                mpf: parseFloat(document.getElementById(\'mpf\').value),\n                ceMpf: parseFloat(document.getElementById(\'ceMpf\').value),\n                mpfUsd: parseFloat(document.getElementById(\'mpfUsd\').value),\n                euShippingDiff: parseFloat(document.getElementById(\'euShippingDiff\').value),\n                adRate: adRate,\n                feeRate: feeRate,\n                payoneerRate: parseFloat(document.getElementById(\'payoneerRate\').value) / 100,\n                shippingMode: document.getElementById(\'shippingMode\').value,\n                shippingCost: parseFloat(document.getElementById(\'shippingCost\').value),\n                shippingThreshold: parseFloat(document.getElementById(\'shippingThreshold\').value),\n                lowPriceMethod: document.getElementById(\'lowPriceMethod\').value,\n                highPriceMethod: document.getElementById(\'highPriceMethod\').value,\n                actualWeight: parseFloat(document.getElementById(\'actualWeight\').value) || 0,\n                volumetricWeight: parseFloat(document.getElementById(\'volumetricWeight\').value) || 0,\n                packageLength: parseFloat(document.getElementById(\'packageLength\').value) || 0,\n                packageWidth: parseFloat(document.getElementById(\'packageWidth\').value) || 0,\n                packageHeight: parseFloat(document.getElementById(\'packageHeight\').value) || 0,\n                shippingMethod: document.getElementById(\'shippingMethod\').value\n            };\n        }\n\n        // è¨­å®šã‚’ä¿å­˜\n        function saveSettings() {\n            const settings = getSettings();\n            localStorage.setItem(\'ecCalcSettings\', JSON.stringify(settings));\n            alert(\'è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼\');\n        }\n\n        // è¨­å®šã‚’èª­ã¿è¾¼ã¿\n        function loadSettings() {\n            const saved = localStorage.getItem(\'ecCalcSettings\');\n            if (saved) {\n                const settings = JSON.parse(saved);\n                document.getElementById(\'exchangeRate\').value = settings.exchangeRate;\n                document.getElementById(\'tariffRate\').value = settings.tariffRate * 100;\n                if (settings.vatRate !== undefined) {\n                    document.getElementById(\'vatRate\').value = settings.vatRate * 100;\n                }\n                if (settings.processingFeeRate !== undefined) {\n                    document.getElementById(\'processingFeeRate\').value = settings.processingFeeRate * 100;\n                }\n                if (settings.mpf !== undefined) {\n                    document.getElementById(\'mpf\').value = settings.mpf;\n                }\n                if (settings.ceMpf !== undefined) {\n                    document.getElementById(\'ceMpf\').value = settings.ceMpf;\n                }\n                if (settings.mpfUsd !== undefined) {\n                    document.getElementById(\'mpfUsd\').value = settings.mpfUsd;\n                }\n                if (settings.euShippingDiff !== undefined) {\n                    document.getElementById(\'euShippingDiff\').value = settings.euShippingDiff;\n                }\n                document.getElementById(\'adRate\').value = settings.adRate * 100;\n                document.getElementById(\'feeRate\').value = settings.feeRate * 100;\n                document.getElementById(\'payoneerRate\').value = settings.payoneerRate * 100;\n                document.getElementById(\'shippingCost\').value = settings.shippingCost;\n\n                // é€æ–™é–¢é€£è¨­å®š\n                if (settings.shippingMode !== undefined) {\n                    document.getElementById(\'shippingMode\').value = settings.shippingMode;\n                    toggleShippingMode();\n                }\n                if (settings.shippingThreshold !== undefined) {\n                    document.getElementById(\'shippingThreshold\').value = settings.shippingThreshold;\n                }\n                if (settings.lowPriceMethod !== undefined) {\n                    const lowPriceSelect = document.getElementById(\'lowPriceMethod\');\n                    lowPriceSelect.value = settings.lowPriceMethod;\n                    // ç„¡åŠ¹ãªå€¤ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«æˆ»ã™\n                    if (!lowPriceSelect.value) {\n                        lowPriceSelect.value = \'EP\';\n                    }\n                }\n                if (settings.highPriceMethod !== undefined) {\n                    const highPriceSelect = document.getElementById(\'highPriceMethod\');\n                    highPriceSelect.value = settings.highPriceMethod;\n                    // ç„¡åŠ¹ãªå€¤ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«æˆ»ã™\n                    if (!highPriceSelect.value) {\n                        highPriceSelect.value = \'CF\';\n                    }\n                }\n                if (settings.actualWeight !== undefined) {\n                    document.getElementById(\'actualWeight\').value = settings.actualWeight;\n                }\n                if (settings.packageLength !== undefined) {\n                    document.getElementById(\'packageLength\').value = settings.packageLength;\n                }\n                if (settings.packageWidth !== undefined) {\n                    document.getElementById(\'packageWidth\').value = settings.packageWidth;\n                }\n                if (settings.packageHeight !== undefined) {\n                    document.getElementById(\'packageHeight\').value = settings.packageHeight;\n                }\n                if (settings.shippingMethod !== undefined) {\n                    document.getElementById(\'shippingMethod\').value = settings.shippingMethod;\n                }\n                // å®¹ç©é‡é‡ã‚’è¨ˆç®—\n                calculateVolumetricWeight();\n            }\n        }\n\n        // è¨ˆç®—1: åˆ©ç›Šé¡ã§ä»•å…¥ã‚Œâ†’è²©å£²ä¾¡æ ¼\n        function calculatePriceFromCostProfit() {\n            const settings = getSettings();\n            const costJPY = parseFloat(document.getElementById(\'cost1\').value);\n            const profitJPY = parseFloat(document.getElementById(\'profit1\').value);\n\n            // é€æ–™è¨ˆç®—\n            const volume = settings.packageLength * settings.packageWidth * settings.packageHeight;\n            const shippingCostJPY = calculateShippingCost(\n                costJPY,\n                settings.actualWeight,\n                settings.volumetricWeight,\n                settings.shippingMethod,\n                settings.shippingThreshold,\n                settings.lowPriceMethod,\n                settings.highPriceMethod,\n                volume,\n                settings.shippingMode\n            );\n\n            // è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæ—§DDUåŸºæº– + èª¿æ•´é–¢ç¨ç‡æ–¹å¼ï¼‰\n            // è²©å£²ä¾¡æ ¼ = (ä»•å…¥ã‚Œ + é€æ–™ + åˆ©ç›Š) / ç‚ºæ›¿ / (1 - æ‰‹æ•°æ–™ - åºƒå‘Š - Payoneer)\n            const totalCostJPY = costJPY + shippingCostJPY + profitJPY;\n            const netRate = 1 - settings.feeRate - settings.adRate - settings.payoneerRate;\n            let sellingPriceUSD = totalCostJPY / settings.exchangeRate / netRate;\n\n            // æƒ³å®šé–¢ç¨ = é–¢ç¨é¡ + é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ + (é€šé–¢æ‰‹æ•°æ–™å†† Ã· ç‚ºæ›¿) + MPF$ + (EUé€æ–™å·®é¡å†† Ã· ç‚ºæ›¿)\n            // â€»èª¿æ•´é–¢ç¨ç‡ã‚’ä½¿ç”¨ã—ã¦DDPèª²é‡‘åˆ†ã‚’è£œæ­£\n            // é–¢ç¨é¡ = è²©å£²ä¾¡æ ¼ Ã— èª¿æ•´é–¢ç¨ç‡\n            // é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ = (è²©å£²ä¾¡æ ¼ Ã— èª¿æ•´é–¢ç¨ç‡ Ã— é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ç‡) + (è²©å£²ä¾¡æ ¼ Ã— VATç‡ Ã— é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ç‡)\n            // CEï¼ˆCpass-Economyï¼‰ã®å ´åˆã®ã¿ceMpfã‚’é©ç”¨ã€ãã‚Œä»¥å¤–ã®ã‚¯ãƒ¼ãƒªã‚¨ã¯0\n            const effectiveMethod1 = getEffectiveShippingMethod(\n                costJPY, settings.actualWeight, settings.shippingMethod,\n                settings.shippingThreshold, settings.lowPriceMethod, settings.highPriceMethod\n            );\n            const customsFeeJPY1 = (effectiveMethod1 === \'CE\') ? settings.ceMpf : 0;\n            let tariffUSD = sellingPriceUSD * settings.adjustedTariffRate * (1 + settings.processingFeeRate)\n                          + sellingPriceUSD * settings.vatRate * settings.processingFeeRate\n                          + (customsFeeJPY1 / settings.exchangeRate)\n                          + settings.mpfUsd\n                          + (settings.euShippingDiff / settings.exchangeRate);\n\n            // DDPä¾¡æ ¼ = è²©å£²ä¾¡æ ¼ + æƒ³å®šé–¢ç¨\n            const ddpPrice = sellingPriceUSD + tariffUSD;\n\n            // å‚è€ƒåˆ©ç›Šï¼ˆå†è¨ˆç®—ï¼‰- DDUåŸºæº–ã§è¨ˆç®—\n            const revenue = sellingPriceUSD * settings.exchangeRate;\n            const fees = revenue * (settings.feeRate + settings.adRate + settings.payoneerRate);\n            const refProfit = revenue - fees - costJPY - shippingCostJPY;\n\n            // çµæœè¡¨ç¤º\n            document.getElementById(\'result1\').classList.remove(\'hidden\');\n            document.getElementById(\'sellingPrice1\').textContent = `$${sellingPriceUSD.toFixed(2)}`;\n            document.getElementById(\'tariff1\').textContent = `$${tariffUSD.toFixed(2)}`;\n            document.getElementById(\'ddpPrice1\').textContent = `$${ddpPrice.toFixed(2)}`;\n            document.getElementById(\'refProfit1\').textContent = `Â¥${refProfit.toFixed(0)}`;\n            document.getElementById(\'shipping1\').textContent = `Â¥${shippingCostJPY.toFixed(0)} (${getShippingMethodDisplayName(effectiveMethod1)})`;\n        }\n\n        // è¨ˆç®—2: åˆ©ç›Šç‡ã§ä»•å…¥ã‚Œâ†’è²©å£²ä¾¡æ ¼\n        function calculatePriceFromCostProfitRate() {\n            const settings = getSettings();\n            const costJPY = parseFloat(document.getElementById(\'cost2\').value);\n            const profitRate = parseFloat(document.getElementById(\'profitRate2\').value) / 100;\n\n            // é€æ–™è¨ˆç®—\n            const volume = settings.packageLength * settings.packageWidth * settings.packageHeight;\n            const shippingCostJPY = calculateShippingCost(\n                costJPY,\n                settings.actualWeight,\n                settings.volumetricWeight,\n                settings.shippingMethod,\n                settings.shippingThreshold,\n                settings.lowPriceMethod,\n                settings.highPriceMethod,\n                volume,\n                settings.shippingMode\n            );\n\n            // æ—§DDUåŸºæº– + èª¿æ•´é–¢ç¨ç‡æ–¹å¼: (ä»•å…¥ã‚Œ + é€æ–™) / ç‚ºæ›¿ / (1 - æ‰‹æ•°æ–™ - åºƒå‘Š - Payoneer - åˆ©ç›Šç‡)\n            const baseCost = costJPY + shippingCostJPY;\n            const netRate = 1 - settings.feeRate - settings.adRate - settings.payoneerRate - profitRate;\n            let sellingPriceUSD = baseCost / settings.exchangeRate / netRate;\n\n            // æƒ³å®šé–¢ç¨ = é–¢ç¨é¡ + é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ + (é€šé–¢æ‰‹æ•°æ–™å†† Ã· ç‚ºæ›¿) + MPF$ + (EUé€æ–™å·®é¡å†† Ã· ç‚ºæ›¿)\n            // â€»èª¿æ•´é–¢ç¨ç‡ã‚’ä½¿ç”¨ã—ã¦DDPèª²é‡‘åˆ†ã‚’è£œæ­£\n            // é–¢ç¨é¡ = è²©å£²ä¾¡æ ¼ Ã— èª¿æ•´é–¢ç¨ç‡\n            // é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ = (è²©å£²ä¾¡æ ¼ Ã— èª¿æ•´é–¢ç¨ç‡ Ã— é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ç‡) + (è²©å£²ä¾¡æ ¼ Ã— VATç‡ Ã— é–¢ç¨å‡¦ç†æ‰‹æ•°æ–™ç‡)\n            // CEï¼ˆCpass-Economyï¼‰ã®å ´åˆã®ã¿ceMpfã‚’é©ç”¨ã€ãã‚Œä»¥å¤–ã®ã‚¯ãƒ¼ãƒªã‚¨ã¯0\n            const effectiveMethod2 = getEffectiveShippingMethod(\n                costJPY, settings.actualWeight, settings.shippingMethod,\n                settings.shippingThreshold, settings.lowPriceMethod, settings.highPriceMethod\n            );\n            const customsFeeJPY2 = (effectiveMethod2 === \'CE\') ? settings.ceMpf : 0;\n            let tariffUSD = sellingPriceUSD * settings.adjustedTariffRate * (1 + settings.processingFeeRate)\n                          + sellingPriceUSD * settings.vatRate * settings.processingFeeRate\n                          + (customsFeeJPY2 / settings.exchangeRate)\n                          + settings.mpfUsd\n                          + (settings.euShippingDiff / settings.exchangeRate);\n\n            // DDPä¾¡æ ¼ = è²©å£²ä¾¡æ ¼ + æƒ³å®šé–¢ç¨\n            const ddpPrice = sellingPriceUSD + tariffUSD;\n\n            // å‚è€ƒåˆ©ç›Šï¼ˆDDUåŸºæº–ã§è¨ˆç®—ï¼‰\n            const revenue = sellingPriceUSD * settings.exchangeRate;\n            const fees = revenue * (settings.feeRate + settings.adRate + settings.payoneerRate);\n            const refProfit = revenue - fees - costJPY - shippingCostJPY;\n\n            document.getElementById(\'result2\').classList.remove(\'hidden\');\n            document.getElementById(\'sellingPrice2\').textContent = `$${sellingPriceUSD.toFixed(2)}`;\n            document.getElementById(\'tariff2\').textContent = `$${tariffUSD.toFixed(2)}`;\n            document.getElementById(\'ddpPrice2\').textContent = `$${ddpPrice.toFixed(2)}`;\n            document.getElementById(\'refProfit2\').textContent = `Â¥${refProfit.toFixed(0)}`;\n            document.getElementById(\'shipping2\').textContent = `Â¥${shippingCostJPY.toFixed(0)} (${getShippingMethodDisplayName(effectiveMethod2)})`;\n        }\n\n        // è¨ˆç®—3: åˆ©ç›Šé¡ã§è²©å£²ä¾¡æ ¼â†’ä»•å…¥ã‚Œï¼ˆæ—§DDUåŸºæº– + èª¿æ•´é–¢ç¨ç‡æ–¹å¼ï¼‰\n        function calculateCostFromPriceProfit() {\n            const settings = getSettings();\n            const profitJPY = parseFloat(document.getElementById(\'profit3\').value);\n            // æ—§DDUåŸºæº–: (1 - æ‰‹æ•°æ–™ - åºƒå‘Š - Payoneer)\n            const netRate = 1 - settings.feeRate - settings.adRate - settings.payoneerRate;\n\n            // DDUä¾¡æ ¼ã‹ã‚‰ã®è¨ˆç®—ï¼ˆåå¾©è¨ˆç®—ã§ä»•å…¥ã‚Œä¾¡æ ¼ã¨é€æ–™ã‚’åæŸã•ã›ã‚‹ï¼‰\n            const sellingPriceDDU = parseFloat(document.getElementById(\'sellingPriceDDU3\').value);\n            const revenueDDU = sellingPriceDDU * settings.exchangeRate;\n            const netRevenueDDU = revenueDDU * netRate;\n\n            // åå¾©è¨ˆç®—\n            let costDDU = netRevenueDDU - profitJPY;\n            let shippingCostDDU = 0;\n            let prevCostDDU = 0;\n\n            for (let i = 0; i < 10; i++) {\n                const volume = settings.packageLength * settings.packageWidth * settings.packageHeight;\n                shippingCostDDU = calculateShippingCost(\n                    costDDU,\n                    settings.actualWeight,\n                    settings.volumetricWeight,\n                    settings.shippingMethod,\n                    settings.shippingThreshold,\n                    settings.lowPriceMethod,\n                    settings.highPriceMethod,\n                    volume,\n                    settings.shippingMode\n                );\n                prevCostDDU = costDDU;\n                costDDU = netRevenueDDU - shippingCostDDU - profitJPY;\n\n                if (Math.abs(costDDU - prevCostDDU) < 1) break;\n            }\n\n            // æƒ³å®šé–¢ç¨ - â€»èª¿æ•´é–¢ç¨ç‡ã‚’ä½¿ç”¨ã—ã¦DDPèª²é‡‘åˆ†ã‚’è£œæ­£\n            // CEï¼ˆCpass-Economyï¼‰ã®å ´åˆã®ã¿ceMpfã‚’é©ç”¨\n            const effectiveMethod3DDU = getEffectiveShippingMethod(\n                costDDU, settings.actualWeight, settings.shippingMethod,\n                settings.shippingThreshold, settings.lowPriceMethod, settings.highPriceMethod\n            );\n            const customsFeeJPY3DDU = (effectiveMethod3DDU === \'CE\') ? settings.ceMpf : 0;\n            const tariffDDU = sellingPriceDDU * settings.adjustedTariffRate * (1 + settings.processingFeeRate)\n                            + sellingPriceDDU * settings.vatRate * settings.processingFeeRate\n                            + (customsFeeJPY3DDU / settings.exchangeRate)\n                            + settings.mpfUsd\n                            + (settings.euShippingDiff / settings.exchangeRate);\n\n            // å‚è€ƒåˆ©ç›Šï¼ˆDDUåŸºæº–ã§è¨ˆç®—ï¼‰\n            const feesDDU = revenueDDU * (settings.feeRate + settings.adRate + settings.payoneerRate);\n            const refProfitDDU = revenueDDU - feesDDU - costDDU - shippingCostDDU;\n\n            // DDPä¾¡æ ¼ã‹ã‚‰ã®è¨ˆç®—ï¼ˆåå¾©è¨ˆç®—ã§DDUè²©å£²ä¾¡æ ¼ã‚’é€†ç®—ï¼‰\n            const ddpPriceInput = parseFloat(document.getElementById(\'sellingPriceDDP3\').value);\n\n            // DDUè²©å£²ä¾¡æ ¼ã‚’åå¾©è¨ˆç®—ã§æ±‚ã‚ã‚‹\n            let sellingPriceDDU_fromDDP = ddpPriceInput * 0.85; // åˆæœŸå€¤ï¼ˆé–¢ç¨ã‚’ç´„15%ã¨ä»®å®šï¼‰\n            let tariffDDP = 0;\n\n            // DDPè¨ˆç®—ç”¨ã®é…é€æ–¹æ³•åˆ¤å®šï¼ˆcostDDPã‚’åŸºæº–ã«åˆ¤å®šï¼‰\n            const effectiveMethod3DDP = getEffectiveShippingMethod(\n                costDDU, settings.actualWeight, settings.shippingMethod,\n                settings.shippingThreshold, settings.lowPriceMethod, settings.highPriceMethod\n            );\n            const customsFeeJPY3DDP = (effectiveMethod3DDP === \'CE\') ? settings.ceMpf : 0;\n\n            // â€»èª¿æ•´é–¢ç¨ç‡ã‚’ä½¿ç”¨ã—ã¦DDPèª²é‡‘åˆ†ã‚’è£œæ­£\n            for (let i = 0; i < 10; i++) {\n                tariffDDP = sellingPriceDDU_fromDDP * settings.adjustedTariffRate * (1 + settings.processingFeeRate)\n                          + sellingPriceDDU_fromDDP * settings.vatRate * settings.processingFeeRate\n                          + (customsFeeJPY3DDP / settings.exchangeRate)\n                          + settings.mpfUsd\n                          + (settings.euShippingDiff / settings.exchangeRate);\n\n                const newSellingPrice = ddpPriceInput - tariffDDP;\n                if (Math.abs(newSellingPrice - sellingPriceDDU_fromDDP) < 0.01) break;\n                sellingPriceDDU_fromDDP = newSellingPrice;\n            }\n\n            // ä»•å…¥ã‚Œä¾¡æ ¼ã‚’åå¾©è¨ˆç®—ã§æ±‚ã‚ã‚‹\n            const revenueDDP = sellingPriceDDU_fromDDP * settings.exchangeRate;\n            const netRevenueDDP = revenueDDP * netRate;\n\n            let costDDP = netRevenueDDP - profitJPY;\n            let shippingCostDDP = 0;\n            let prevCostDDP = 0;\n\n            for (let i = 0; i < 10; i++) {\n                const volume = settings.packageLength * settings.packageWidth * settings.packageHeight;\n                shippingCostDDP = calculateShippingCost(\n                    costDDP,\n                    settings.actualWeight,\n                    settings.volumetricWeight,\n                    settings.shippingMethod,\n                    settings.shippingThreshold,\n                    settings.lowPriceMethod,\n                    settings.highPriceMethod,\n                    volume,\n                    settings.shippingMode\n                );\n                prevCostDDP = costDDP;\n                costDDP = netRevenueDDP - shippingCostDDP - profitJPY;\n\n                if (Math.abs(costDDP - prevCostDDP) < 1) break;\n            }\n\n            // å‚è€ƒåˆ©ç›Šï¼ˆDDUåŸºæº–ã§è¨ˆç®—ï¼‰\n            const feesDDP = revenueDDP * (settings.feeRate + settings.adRate + settings.payoneerRate);\n            const refProfitDDP = revenueDDP - feesDDP - costDDP - shippingCostDDP;\n\n            // DDUçµæœè¡¨ç¤º\n            document.getElementById(\'result3-ddu\').classList.remove(\'hidden\');\n            document.getElementById(\'costPriceDDU3\').textContent = `Â¥${costDDU.toFixed(0)}`;\n            document.getElementById(\'tariffDDU3\').textContent = `$${tariffDDU.toFixed(2)}`;\n            document.getElementById(\'refProfitDDU3\').textContent = `Â¥${refProfitDDU.toFixed(0)}`;\n            document.getElementById(\'shippingDDU3\').textContent = `Â¥${shippingCostDDU.toFixed(0)} (${getShippingMethodDisplayName(effectiveMethod3DDU)})`;\n\n            // DDPçµæœè¡¨ç¤º\n            document.getElementById(\'result3-ddp\').classList.remove(\'hidden\');\n            document.getElementById(\'costPriceDDP3\').textContent = `Â¥${costDDP.toFixed(0)}`;\n            document.getElementById(\'sellingPriceDDU_from_DDP3\').textContent = `$${sellingPriceDDU_fromDDP.toFixed(2)}`;\n            document.getElementById(\'tariffDDP3\').textContent = `$${tariffDDP.toFixed(2)}`;\n            document.getElementById(\'refProfitDDP3\').textContent = `Â¥${refProfitDDP.toFixed(0)}`;\n            document.getElementById(\'shippingDDP3\').textContent = `Â¥${shippingCostDDP.toFixed(0)} (${getShippingMethodDisplayName(effectiveMethod3DDP)})`;\n        }\n\n        // è¨ˆç®—4: åˆ©ç›Šç‡ã§è²©å£²ä¾¡æ ¼â†’ä»•å…¥ã‚Œï¼ˆæ—§DDUåŸºæº– + èª¿æ•´é–¢ç¨ç‡æ–¹å¼ï¼‰\n        function calculateCostFromPriceProfitRate() {\n            const settings = getSettings();\n            const profitRate = parseFloat(document.getElementById(\'profitRate4\').value) / 100;\n            // æ—§DDUåŸºæº–: (1 - æ‰‹æ•°æ–™ - åºƒå‘Š - Payoneer - åˆ©ç›Šç‡)\n            const netRate = 1 - settings.feeRate - settings.adRate - settings.payoneerRate - profitRate;\n\n            // DDUä¾¡æ ¼ã‹ã‚‰ã®è¨ˆç®—ï¼ˆåå¾©è¨ˆç®—ã§ä»•å…¥ã‚Œä¾¡æ ¼ã¨é€æ–™ã‚’åæŸã•ã›ã‚‹ï¼‰\n            const sellingPriceDDU = parseFloat(document.getElementById(\'sellingPriceDDU4\').value);\n            const revenueDDU = sellingPriceDDU * settings.exchangeRate;\n\n            // åå¾©è¨ˆç®—\n            let costDDU = revenueDDU * netRate;\n            let shippingCostDDU = 0;\n            let prevCostDDU = 0;\n\n            for (let i = 0; i < 10; i++) {\n                const volume = settings.packageLength * settings.packageWidth * settings.packageHeight;\n                shippingCostDDU = calculateShippingCost(\n                    costDDU,\n                    settings.actualWeight,\n                    settings.volumetricWeight,\n                    settings.shippingMethod,\n                    settings.shippingThreshold,\n                    settings.lowPriceMethod,\n                    settings.highPriceMethod,\n                    volume,\n                    settings.shippingMode\n                );\n                prevCostDDU = costDDU;\n                costDDU = revenueDDU * netRate - shippingCostDDU;\n\n                if (Math.abs(costDDU - prevCostDDU) < 1) break;\n            }\n\n            // æƒ³å®šé–¢ç¨ - â€»èª¿æ•´é–¢ç¨ç‡ã‚’ä½¿ç”¨ã—ã¦DDPèª²é‡‘åˆ†ã‚’è£œæ­£\n            // CEï¼ˆCpass-Economyï¼‰ã®å ´åˆã®ã¿ceMpfã‚’é©ç”¨\n            const effectiveMethod4DDU = getEffectiveShippingMethod(\n                costDDU, settings.actualWeight, settings.shippingMethod,\n                settings.shippingThreshold, settings.lowPriceMethod, settings.highPriceMethod\n            );\n            const customsFeeJPY4DDU = (effectiveMethod4DDU === \'CE\') ? settings.ceMpf : 0;\n            const tariffDDU = sellingPriceDDU * settings.adjustedTariffRate * (1 + settings.processingFeeRate)\n                            + sellingPriceDDU * settings.vatRate * settings.processingFeeRate\n                            + (customsFeeJPY4DDU / settings.exchangeRate)\n                            + settings.mpfUsd\n                            + (settings.euShippingDiff / settings.exchangeRate);\n\n            // å‚è€ƒåˆ©ç›Šï¼ˆDDUåŸºæº–ã§è¨ˆç®—ï¼‰\n            const feesDDU = revenueDDU * (settings.feeRate + settings.adRate + settings.payoneerRate);\n            const refProfitDDU = revenueDDU - feesDDU - costDDU - shippingCostDDU;\n\n            // DDPä¾¡æ ¼ã‹ã‚‰ã®è¨ˆç®—ï¼ˆåå¾©è¨ˆç®—ã§DDUè²©å£²ä¾¡æ ¼ã‚’é€†ç®—ï¼‰\n            const ddpPriceInput = parseFloat(document.getElementById(\'sellingPriceDDP4\').value);\n\n            // DDUè²©å£²ä¾¡æ ¼ã‚’åå¾©è¨ˆç®—ã§æ±‚ã‚ã‚‹\n            let sellingPriceDDU_fromDDP = ddpPriceInput * 0.85; // åˆæœŸå€¤ï¼ˆé–¢ç¨ã‚’ç´„15%ã¨ä»®å®šï¼‰\n            let tariffDDP = 0;\n\n            // DDPè¨ˆç®—ç”¨ã®é…é€æ–¹æ³•åˆ¤å®šï¼ˆcostDDUã‚’åŸºæº–ã«åˆ¤å®šï¼‰\n            const effectiveMethod4DDP = getEffectiveShippingMethod(\n                costDDU, settings.actualWeight, settings.shippingMethod,\n                settings.shippingThreshold, settings.lowPriceMethod, settings.highPriceMethod\n            );\n            const customsFeeJPY4DDP = (effectiveMethod4DDP === \'CE\') ? settings.ceMpf : 0;\n\n            // â€»èª¿æ•´é–¢ç¨ç‡ã‚’ä½¿ç”¨ã—ã¦DDPèª²é‡‘åˆ†ã‚’è£œæ­£\n            for (let i = 0; i < 10; i++) {\n                tariffDDP = sellingPriceDDU_fromDDP * settings.adjustedTariffRate * (1 + settings.processingFeeRate)\n                          + sellingPriceDDU_fromDDP * settings.vatRate * settings.processingFeeRate\n                          + (customsFeeJPY4DDP / settings.exchangeRate)\n                          + settings.mpfUsd\n                          + (settings.euShippingDiff / settings.exchangeRate);\n\n                const newSellingPrice = ddpPriceInput - tariffDDP;\n                if (Math.abs(newSellingPrice - sellingPriceDDU_fromDDP) < 0.01) break;\n                sellingPriceDDU_fromDDP = newSellingPrice;\n            }\n\n            // ä»•å…¥ã‚Œä¾¡æ ¼ã‚’åå¾©è¨ˆç®—ã§æ±‚ã‚ã‚‹\n            const revenueDDP = sellingPriceDDU_fromDDP * settings.exchangeRate;\n            const netRevenueDDP = revenueDDP * netRate;\n\n            let costDDP = netRevenueDDP;\n            let shippingCostDDP = 0;\n            let prevCostDDP = 0;\n\n            for (let i = 0; i < 10; i++) {\n                const volume = settings.packageLength * settings.packageWidth * settings.packageHeight;\n                shippingCostDDP = calculateShippingCost(\n                    costDDP,\n                    settings.actualWeight,\n                    settings.volumetricWeight,\n                    settings.shippingMethod,\n                    settings.shippingThreshold,\n                    settings.lowPriceMethod,\n                    settings.highPriceMethod,\n                    volume,\n                    settings.shippingMode\n                );\n                prevCostDDP = costDDP;\n                costDDP = netRevenueDDP - shippingCostDDP;\n\n                if (Math.abs(costDDP - prevCostDDP) < 1) break;\n            }\n\n            // å‚è€ƒåˆ©ç›Šï¼ˆDDUåŸºæº–ã§è¨ˆç®—ï¼‰\n            const feesDDP = revenueDDP * (settings.feeRate + settings.adRate + settings.payoneerRate);\n            const refProfitDDP = revenueDDP - feesDDP - costDDP - shippingCostDDP;\n\n            // DDUçµæœè¡¨ç¤º\n            document.getElementById(\'result4-ddu\').classList.remove(\'hidden\');\n            document.getElementById(\'costPriceDDU4\').textContent = `Â¥${costDDU.toFixed(0)}`;\n            document.getElementById(\'tariffDDU4\').textContent = `$${tariffDDU.toFixed(2)}`;\n            document.getElementById(\'refProfitDDU4\').textContent = `Â¥${refProfitDDU.toFixed(0)}`;\n            document.getElementById(\'shippingDDU4\').textContent = `Â¥${shippingCostDDU.toFixed(0)} (${getShippingMethodDisplayName(effectiveMethod4DDU)})`;\n\n            // DDPçµæœè¡¨ç¤º\n            document.getElementById(\'result4-ddp\').classList.remove(\'hidden\');\n            document.getElementById(\'costPriceDDP4\').textContent = `Â¥${costDDP.toFixed(0)}`;\n            document.getElementById(\'sellingPriceDDU_from_DDP4\').textContent = `$${sellingPriceDDU_fromDDP.toFixed(2)}`;\n            document.getElementById(\'tariffDDP4\').textContent = `$${tariffDDP.toFixed(2)}`;\n            document.getElementById(\'refProfitDDP4\').textContent = `Â¥${refProfitDDP.toFixed(0)}`;\n            document.getElementById(\'shippingDDP4\').textContent = `Â¥${shippingCostDDP.toFixed(0)} (${getShippingMethodDisplayName(effectiveMethod4DDP)})`;\n        }\n\n        // ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã‚’è‡ªå‹•å–å¾—\n        async function fetchExchangeRate() {\n            const btn = event.target;\n            btn.classList.add(\'loading\');\n            btn.textContent = \'å–å¾—ä¸­...\';\n\n            try {\n                // ç„¡æ–™ã®APIï¼ˆexchangerate-api.comï¼‰ã‚’ä½¿ç”¨\n                const response = await fetch(\'https://api.exchangerate-api.com/v4/latest/USD\');\n                const data = await response.json();\n\n                if (data && data.rates && data.rates.JPY) {\n                    const rate = data.rates.JPY;\n                    document.getElementById(\'exchangeRate\').value = rate.toFixed(3);\n                    alert(`æœ€æ–°ã®ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—ã—ã¾ã—ãŸ: $1 = Â¥${rate.toFixed(3)}`);\n                } else {\n                    throw new Error(\'ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ\');\n                }\n            } catch (error) {\n                console.error(\'Error fetching exchange rate:\', error);\n                alert(\'ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\');\n            } finally {\n                btn.classList.remove(\'loading\');\n                btn.textContent = \'æœ€æ–°å–å¾—\';\n            }\n        }\n\n        // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é–‹ã\n        function openTutorial() {\n            window.open(\'https://naokijodan.github.io/price-calc-guide/\', \'_blank\');\n        }\n\n        // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é–‰ã˜ã‚‹\n        function closeTutorial() {\n            document.getElementById(\'tutorialModal\').classList.remove(\'show\');\n        }\n\n        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å¤–å´ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰é–‰ã˜ã‚‹\n        window.onclick = function(event) {\n            const modal = document.getElementById(\'tutorialModal\');\n            if (event.target === modal) {\n                closeTutorial();\n            }\n        };\n\n        // åˆæœŸåŒ–\n        window.onload = function() {\n            loadSettings();\n            // èª¿æ•´é–¢ç¨ç‡ã‚’åˆæœŸè¡¨ç¤º\n            updateAdjustedTariffRate();\n            // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•ã§ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—\n            fetchExchangeRate();\n            // é€æ–™è©¦ç®—ã‚’åˆæœŸè¡¨ç¤º\n            calculateEstimatedShipping();\n        };\n    </script>\n</body>\n</html>\n';


/**
 * ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰HtmlOutputã‚’ç”Ÿæˆ
 * @param {string} templateName - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå
 * @return {HtmlOutput}
 */
function createHtmlFromTemplate(templateName) {
  var html = HTML_TEMPLATES[templateName];
  if (!html) {
    throw new Error('Template not found: ' + templateName);
  }
  return HtmlService.createHtmlOutput(html);
}

/**
 * ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ç½®æ›ç”¨ï¼‰
 * @param {string} templateName - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå
 * @return {string}
 */
function getHtmlTemplate(templateName) {
  return HTML_TEMPLATES[templateName] || '';
}
