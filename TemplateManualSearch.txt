<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
    }
    
    .header {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #4285f4;
    }
    
    .header h2 {
      margin: 0 0 10px 0;
      color: #202124;
      font-size: 20px;
    }
    
    .header p {
      margin: 0;
      color: #5f6368;
      font-size: 14px;
    }
    
    .info-box {
      background-color: #e8f0fe;
      border-left: 4px solid #4285f4;
      padding: 12px;
      margin-bottom: 20px;
      border-radius: 4px;
      font-size: 13px;
      color: #202124;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      font-weight: bold;
      margin-bottom: 8px;
      color: #202124;
      font-size: 14px;
    }
    
    select {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #dadce0;
      border-radius: 4px;
      background-color: white;
      cursor: pointer;
      box-sizing: border-box;
    }
    
    select:focus {
      outline: none;
      border-color: #4285f4;
      box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
    }
    
    .result-box {
      background-color: #f8f9fa;
      border: 1px solid #dadce0;
      border-radius: 4px;
      padding: 15px;
      margin-top: 20px;
      display: none;
    }
    
    .result-box.success {
      background-color: #e6f4ea;
      border-color: #34a853;
    }
    
    .result-box.error {
      background-color: #fce8e6;
      border-color: #ea4335;
    }
    
    .result-box h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
    }
    
    .result-item {
      margin: 8px 0;
      font-size: 14px;
    }
    
    .result-item strong {
      color: #1967d2;
    }
    
    .buttons {
      text-align: center;
      margin-top: 25px;
    }
    
    .btn {
      padding: 10px 24px;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 0 5px;
      font-weight: 500;
    }
    
    .btn-primary {
      background-color: #4285f4;
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #3367d6;
    }
    
    .btn-secondary {
      background-color: #f1f3f4;
      color: #202124;
    }
    
    .btn-secondary:hover {
      background-color: #e8eaed;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .loading {
      display: none;
      text-align: center;
      color: #5f6368;
      font-size: 14px;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h2>ğŸ” ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ‰‹å‹•æ¤œç´¢</h2>
    <p>æ¡ä»¶ã‚’å…¥åŠ›ã—ã¦è©²å½“ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ¤œç´¢ã—ã¾ã™</p>
  </div>
  
  <div class="info-box">
    æ¡ä»¶ã«åˆã†ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆIDã‚’æ¤œç´¢ã—ã¾ã™ã€‚<br>
    ã‚¨ãƒ©ãƒ¼ã§è‡ªå‹•è¨­å®šã§ããªã‹ã£ãŸå ´åˆã®ç¢ºèªç”¨ã§ã™ã€‚
  </div>
  
  <div class="form-group">
    <label for="categorySelect">ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼š</label>
    <select id="categorySelect" onchange="updateConditionVisibility()">
      <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
      <option value="general">æ±ç”¨ï¼ˆé€æ–™ä¸Šé™ãªã—ï¼‰</option>
      <option value="videogames">Video Gamesï¼ˆé€æ–™ä¸Šé™$20ï¼‰</option>
      <option value="books">Booksï¼ˆé€æ–™ä¸Šé™$20ï¼‰</option>
      <option value="movies">Movies & TVï¼ˆé€æ–™ä¸Šé™$20ï¼‰</option>
      <option value="music">Musicï¼ˆé€æ–™ä¸Šé™$25ï¼‰</option>
      <option value="console">Video Game Consolesï¼ˆé€æ–™ä¸Šé™$50ï¼‰</option>
      <option value="card_graded">ãƒˆãƒ¬ã‚« - Graded</option>
      <option value="card_raw">ãƒˆãƒ¬ã‚« - æœªé‘‘å®š</option>
      <option value="preorder">äºˆç´„è²©å£²</option>
    </select>
  </div>
  
  <div class="form-group" id="conditionGroup">
    <label for="conditionSelect">å•†å“çŠ¶æ…‹ï¼š</label>
    <select id="conditionSelect">
      <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
      <option value="æ–°å“">æ–°å“</option>
      <option value="ä¸­å¤">ä¸­å¤</option>
    </select>
  </div>
  
  <div class="form-group" id="shippingGroup">
    <label for="shippingTypeSelect">é…é€æ–¹æ³•ï¼š</label>
    <select id="shippingTypeSelect">
      <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
      <option value="ã‚¨ã‚³ãƒãƒŸãƒ¼">ã‚¨ã‚³ãƒãƒŸãƒ¼ï¼ˆeãƒ‘ã‚±ãƒƒãƒˆ / Cpass-Economyï¼‰</option>
      <option value="EX">EXï¼ˆCpass-FedEx / Cpass-DHL / eLogisticsï¼‰</option>
    </select>
  </div>
  
  <div class="buttons">
    <button class="btn btn-primary" id="searchBtn" onclick="searchTemplate()">æ¤œç´¢</button>
    <button class="btn btn-secondary" onclick="google.script.host.close()">é–‰ã˜ã‚‹</button>
  </div>
  
  <div class="loading" id="loading">æ¤œç´¢ä¸­...</div>
  
  <div class="result-box" id="resultBox">
    <h3 id="resultTitle">æ¤œç´¢çµæœ</h3>
    <div id="resultContent"></div>
  </div>
  
  <script>
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼å¤‰æ›´æ™‚ã®è¡¨ç¤ºåˆ¶å¾¡
    function updateConditionVisibility() {
      var category = document.getElementById('categorySelect').value;
      var conditionGroup = document.getElementById('conditionGroup');
      var shippingGroup = document.getElementById('shippingGroup');
      
      // ãƒˆãƒ¬ã‚«ã¯çŠ¶æ…‹ãƒ»é…é€ä¸è¦
      if (category === 'card_graded' || category === 'card_raw') {
        conditionGroup.style.display = 'none';
        shippingGroup.style.display = 'none';
      }
      // äºˆç´„è²©å£²ã¯çŠ¶æ…‹ä¸è¦ï¼ˆæ–°å“å›ºå®šï¼‰
      else if (category === 'preorder') {
        conditionGroup.style.display = 'none';
        shippingGroup.style.display = 'block';
      }
      // ãã®ä»–ã¯å…¨ã¦å¿…è¦
      else {
        conditionGroup.style.display = 'block';
        shippingGroup.style.display = 'block';
      }
    }
    
    // æ¤œç´¢å®Ÿè¡Œ
    function searchTemplate() {
      var category = document.getElementById('categorySelect').value;
      var condition = document.getElementById('conditionSelect').value;
      var shippingType = document.getElementById('shippingTypeSelect').value;
      
      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      if (!category) {
        alert('ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }
      
      // ãƒˆãƒ¬ã‚«ãƒ»äºˆç´„è²©å£²ä»¥å¤–ã¯çŠ¶æ…‹ãƒ»é…é€ãƒã‚§ãƒƒã‚¯
      if (!['card_graded', 'card_raw'].includes(category)) {
        if (category !== 'preorder' && !condition) {
          alert('å•†å“çŠ¶æ…‹ã‚’é¸æŠã—ã¦ãã ã•ã„');
          return;
        }
        if (!shippingType) {
          alert('é…é€æ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„');
          return;
        }
      }
      
      // UIçŠ¶æ…‹å¤‰æ›´
      document.getElementById('searchBtn').disabled = true;
      document.getElementById('loading').style.display = 'block';
      document.getElementById('resultBox').style.display = 'none';
      
      // æ¤œç´¢å®Ÿè¡Œ
      google.script.run
        .withSuccessHandler(function(result) {
          document.getElementById('searchBtn').disabled = false;
          document.getElementById('loading').style.display = 'none';
          displayResult(result);
        })
        .withFailureHandler(function(error) {
          document.getElementById('searchBtn').disabled = false;
          document.getElementById('loading').style.display = 'none';
          alert('æ¤œç´¢ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .searchTemplateManually({
          category: category,
          condition: condition,
          shippingType: shippingType
        });
    }
    
    // çµæœè¡¨ç¤º
    function displayResult(result) {
      var resultBox = document.getElementById('resultBox');
      var resultTitle = document.getElementById('resultTitle');
      var resultContent = document.getElementById('resultContent');
      
      if (!result.success) {
        resultBox.className = 'result-box error';
        resultTitle.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼';
        resultContent.innerHTML = '<div class="result-item">' + result.error + '</div>';
        resultBox.style.display = 'block';
        return;
      }
      
      if (result.templateId === null) {
        resultBox.className = 'result-box error';
        resultTitle.textContent = 'âš ï¸ è©²å½“ãªã—';
        
        var html = '<div class="result-item">è©²å½“ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</div>';
        html += '<div class="result-item"><strong>æ¤œç´¢æ¡ä»¶ï¼š</strong></div>';
        html += '<div class="result-item">ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼: ' + getCategoryDisplay(result.searchConditions.category) + '</div>';
        if (result.searchConditions.condition) {
          html += '<div class="result-item">ãƒ»å•†å“çŠ¶æ…‹: ' + result.searchConditions.condition + '</div>';
        }
        if (result.searchConditions.shippingType) {
          html += '<div class="result-item">ãƒ»é…é€æ–¹æ³•: ' + result.searchConditions.shippingType + '</div>';
        }
        
        resultContent.innerHTML = html;
        resultBox.style.display = 'block';
        return;
      }
      
      resultBox.className = 'result-box success';
      resultTitle.textContent = 'âœ… æ¤œç´¢æˆåŠŸ';
      
      var html = '<div class="result-item"><strong>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆID:</strong> ' + result.templateId + '</div>';
      if (result.templateName) {
        html += '<div class="result-item"><strong>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåç§°:</strong> ' + result.templateName + '</div>';
      }
      html += '<div class="result-item" style="margin-top: 10px;"><strong>æ¤œç´¢æ¡ä»¶ï¼š</strong></div>';
      html += '<div class="result-item">ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼: ' + getCategoryDisplay(result.searchConditions.category) + '</div>';
      if (result.searchConditions.condition) {
        html += '<div class="result-item">ãƒ»å•†å“çŠ¶æ…‹: ' + result.searchConditions.condition + '</div>';
      }
      if (result.searchConditions.shippingType) {
        html += '<div class="result-item">ãƒ»é…é€æ–¹æ³•: ' + result.searchConditions.shippingType + '</div>';
      }
      
      resultContent.innerHTML = html;
      resultBox.style.display = 'block';
    }
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼è¡¨ç¤ºåå–å¾—
    function getCategoryDisplay(value) {
      var mapping = {
        'general': 'æ±ç”¨',
        'videogames': 'Video Games',
        'books': 'Books',
        'movies': 'Movies & TV',
        'music': 'Music',
        'console': 'Video Game Consoles',
        'card_graded': 'ãƒˆãƒ¬ã‚« - Graded',
        'card_raw': 'ãƒˆãƒ¬ã‚« - æœªé‘‘å®š',
        'preorder': 'äºˆç´„è²©å£²'
      };
      return mapping[value] || value;
    }
    
    // åˆæœŸåŒ–
    updateConditionVisibility();
  </script>
</body>
</html>