<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
    }
    
    .header {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #4285f4;
    }
    
    .header h2 {
      margin: 0 0 10px 0;
      color: #202124;
      font-size: 20px;
    }
    
    .header p {
      margin: 0;
      color: #5f6368;
      font-size: 14px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      font-weight: bold;
      margin-bottom: 8px;
      color: #202124;
      font-size: 14px;
    }
    
    select {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #dadce0;
      border-radius: 4px;
      background-color: white;
      cursor: pointer;
    }
    
    select:focus {
      outline: none;
      border-color: #4285f4;
      box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
    }
    
    .info-box {
      background-color: #e8f0fe;
      border-left: 4px solid #4285f4;
      padding: 12px;
      margin-bottom: 20px;
      border-radius: 4px;
      font-size: 13px;
      color: #202124;
    }
    
    .info-box strong {
      color: #1967d2;
    }
    
    .buttons {
      text-align: center;
      margin-top: 25px;
    }
    
    .btn {
      padding: 10px 24px;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 0 5px;
      font-weight: 500;
    }
    
    .btn-primary {
      background-color: #4285f4;
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #3367d6;
    }
    
    .btn-secondary {
      background-color: #f1f3f4;
      color: #202124;
    }
    
    .btn-secondary:hover {
      background-color: #e8eaed;
    }
    
    .category-option {
      padding: 8px;
    }
    
    .limit-warning {
      color: #d93025;
      font-size: 12px;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h2>ğŸ“¦ ã‚·ãƒƒãƒ”ãƒ³ã‚°ãƒãƒªã‚·ãƒ¼è¨­å®š</h2>
    <p>ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
  </div>
  
  <div class="info-box">
    <strong>ğŸ’¡ é€æ–™ä¸Šé™ã«ã¤ã„ã¦ï¼š</strong><br>
    ä¸€éƒ¨ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã§ã¯eBayã®è¦å®šã«ã‚ˆã‚Šé€æ–™ä¸Šé™ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚<br>
    ä¸Šé™ã‚’è¶…ãˆã‚‹å•†å“ã«ã¯ã€æœ€å¤§è¨±å®¹ç¯„å›²ã®ãƒãƒªã‚·ãƒ¼ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚
  </div>
  
  <div class="form-group">
    <label for="categorySelect">ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠï¼š</label>
    <select id="categorySelect" onchange="updateLimitWarning()">
      <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
    </select>
    <div id="limitWarning" class="limit-warning" style="display: none;"></div>
  </div>
  
  <div class="buttons">
    <button class="btn btn-primary" onclick="applyCategory()">é©ç”¨</button>
    <button class="btn btn-secondary" onclick="google.script.host.close()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
  </div>
  
  <script>
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
    google.script.run
      .withSuccessHandler(function(categories) {
        var select = document.getElementById('categorySelect');
        
        categories.forEach(function(cat) {
          var option = document.createElement('option');
          option.value = cat.value;
          option.textContent = cat.display;
          option.dataset.limit = cat.limit;
          select.appendChild(option);
        });
      })
      .withFailureHandler(function(error) {
        alert('ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
      })
      .getShippingPolicyCategories();
    
    // ä¸Šé™è­¦å‘Šã®è¡¨ç¤ºåˆ¶å¾¡
    function updateLimitWarning() {
      var select = document.getElementById('categorySelect');
      var warning = document.getElementById('limitWarning');
      var selectedOption = select.options[select.selectedIndex];
      
      if (selectedOption && selectedOption.dataset.limit && selectedOption.dataset.limit !== 'null') {
        var limit = selectedOption.dataset.limit;
        warning.textContent = 'âš ï¸ ã“ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã¯é€æ–™ä¸Šé™ $' + limit + ' ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™';
        warning.style.display = 'block';
      } else {
        warning.style.display = 'none';
      }
    }
    
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é©ç”¨
    function applyCategory() {
      var select = document.getElementById('categorySelect');
      var selectedValue = select.value;
      
      if (!selectedValue) {
        alert('ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }
      
      // ã‚µãƒ¼ãƒãƒ¼å´ã®å‡¦ç†ã‚’å‘¼ã³å‡ºã—
      google.script.run
        .withSuccessHandler(function() {
          google.script.host.close();
        })
        .withFailureHandler(function(error) {
          alert('è¨­å®šã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .applyShippingPolicyWithCategory(selectedValue);
    }
  </script>
</body>
</html>