<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8f9fa;
      font-size: 13px;
    }

    /* „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ */
    .tab-nav {
      display: flex;
      background: #fff;
      border-bottom: 1px solid #dadce0;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .tab-btn {
      flex: 1;
      padding: 12px 8px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      color: #5f6368;
      transition: all 0.2s;
      border-bottom: 2px solid transparent;
    }
    .tab-btn:hover {
      background: #f1f3f4;
    }
    .tab-btn.active {
      color: #1a73e8;
      border-bottom-color: #1a73e8;
    }

    /* „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ */
    .tab-content {
      display: none;
      padding: 12px;
    }
    .tab-content.active {
      display: block;
    }

    /* ÂÖ±ÈÄö„Çπ„Çø„Ç§„É´ */
    h3 {
      color: #1a73e8;
      margin: 0 0 12px 0;
      font-size: 15px;
    }
    label {
      display: block;
      margin-bottom: 4px;
      font-weight: 500;
      color: #3c4043;
    }
    textarea {
      width: 100%;
      height: 200px;
      margin-bottom: 12px;
      padding: 10px;
      font-size: 13px;
      border: 1px solid #dadce0;
      border-radius: 4px;
      resize: vertical;
    }
    select {
      width: 100%;
      margin-bottom: 12px;
      padding: 8px;
      font-size: 13px;
      border: 1px solid #dadce0;
      border-radius: 4px;
      background-color: #fff;
    }
    button {
      padding: 8px 16px;
      font-size: 13px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 8px;
      margin-bottom: 8px;
      transition: all 0.2s;
    }
    button.primary {
      background-color: #1a73e8;
      color: white;
    }
    button.primary:hover {
      background-color: #1557b0;
    }
    button.secondary {
      background-color: #e8eaed;
      color: #3c4043;
    }
    button.secondary:hover {
      background-color: #dadce0;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* „É°„ÉÉ„Çª„Éº„Ç∏„Éú„ÉÉ„ÇØ„Çπ */
    .message {
      margin-top: 12px;
      padding: 10px;
      border-radius: 4px;
      font-weight: 500;
      display: none;
    }
    .message.success {
      background-color: #e6ffe6;
      color: #188038;
      border: 1px solid #188038;
    }
    .message.error {
      background-color: #ffe6e6;
      color: #d93025;
      border: 1px solid #d93025;
    }
    .message.info {
      background-color: #e8f0fe;
      color: #1a73e8;
      border: 1px solid #1a73e8;
    }

    /* „Ç¢„Ç∑„Çπ„Çø„É≥„Éà: „Çª„É´ÊÉÖÂ†±„Ç´„Éº„Éâ */
    .cell-info-card {
      background: #fff;
      border: 1px solid #dadce0;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
    }
    .cell-info-card h4 {
      margin: 0 0 8px 0;
      font-size: 13px;
      color: #5f6368;
    }
    .cell-info-row {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
      border-bottom: 1px solid #f1f3f4;
    }
    .cell-info-row:last-child {
      border-bottom: none;
    }
    .cell-info-label {
      color: #5f6368;
    }
    .cell-info-value {
      font-weight: 500;
      color: #202124;
      max-width: 60%;
      word-break: break-all;
    }
    .cell-info-value.error {
      color: #d93025;
    }

    /* „Ç¢„Ç∑„Çπ„Çø„É≥„Éà: „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ */
    .action-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }
    .action-btn {
      flex: 1;
      min-width: 100px;
      padding: 10px;
      background: #fff;
      border: 1px solid #dadce0;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
    }
    .action-btn:hover {
      background: #f1f3f4;
      border-color: #1a73e8;
    }
    .action-btn-icon {
      font-size: 20px;
      margin-bottom: 4px;
    }
    .action-btn-label {
      font-size: 12px;
      color: #3c4043;
    }

    /* „Ç¢„Ç∑„Çπ„Çø„É≥„Éà: ÁµêÊûúË°®Á§∫ */
    .result-box {
      background: #fff;
      border: 1px solid #dadce0;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      white-space: pre-wrap;
      line-height: 1.5;
    }
    .result-box.loading {
      color: #5f6368;
      text-align: center;
    }

    /* „Ç¢„Ç∑„Çπ„Çø„É≥„Éà: FAQ „Ç´„ÉÜ„Ç¥„É™„Éò„ÉÉ„ÉÄ„Éº */
    .faq-category {
      margin-bottom: 12px;
    }
    .faq-category-header {
      background: linear-gradient(135deg, #1a73e8, #4285f4);
      color: #fff;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s;
      user-select: none;
    }
    .faq-category-header:hover {
      background: linear-gradient(135deg, #1557b0, #1a73e8);
    }
    .faq-category-header .category-icon {
      font-size: 16px;
      margin-right: 8px;
    }
    .faq-category-header .category-toggle {
      font-size: 18px;
      font-weight: 300;
      transition: transform 0.2s;
    }
    .faq-category-header.open .category-toggle {
      transform: rotate(45deg);
    }
    .faq-category-items {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }
    .faq-category-items.open {
      max-height: 2000px;
    }

    /* „Ç¢„Ç∑„Çπ„Çø„É≥„Éà: FAQ „Ç¢„Ç§„ÉÜ„É† */
    .faq-item {
      background: #fff;
      border: 1px solid #dadce0;
      border-top: none;
      margin: 0;
      overflow: hidden;
    }
    .faq-item:first-child {
      border-top: 1px solid #dadce0;
      margin-top: 4px;
      border-radius: 8px 8px 0 0;
    }
    .faq-item:last-child {
      border-radius: 0 0 8px 8px;
    }
    .faq-item:only-child {
      border-radius: 8px;
    }
    .faq-question {
      padding: 10px 12px;
      cursor: pointer;
      font-weight: 500;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
    }
    .faq-question:hover {
      background: #f1f3f4;
    }
    .faq-question .q-icon {
      color: #1a73e8;
      font-weight: 600;
      margin-right: 6px;
    }
    .faq-question .toggle-icon {
      color: #5f6368;
      font-size: 14px;
      transition: transform 0.2s;
    }
    .faq-question.open .toggle-icon {
      transform: rotate(90deg);
    }
    .faq-answer {
      padding: 0 12px;
      max-height: 0;
      overflow: hidden;
      transition: all 0.2s;
      border-top: 1px solid #e8eaed;
      background: #f8f9fa;
      font-size: 12px;
      line-height: 1.6;
      white-space: pre-wrap;
    }
    .faq-answer.open {
      padding: 12px;
      max-height: 500px;
      overflow-y: auto;
    }

    /* „Ç¢„Ç∑„Çπ„Çø„É≥„Éà: „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ */
    .feedback-form {
      background: #fff;
      border: 1px solid #dadce0;
      border-radius: 8px;
      padding: 12px;
    }
  </style>
</head>
<body>

  <!-- „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
  <div class="tab-nav">
    <button class="tab-btn active" onclick="switchTab('prompt')">„Éó„É≠„É≥„Éó„Éà</button>
    <button class="tab-btn" onclick="switchTab('assistant')">„Ç¢„Ç∑„Çπ„Çø„É≥„Éà</button>
  </div>

  <!-- „Éó„É≠„É≥„Éó„Éà„Çø„Éñ -->
  <div id="tab-prompt" class="tab-content active">
    <h3>„Éó„É≠„É≥„Éó„ÉàÁ∑®ÈõÜ</h3>
    <label for="promptSelect">„Éó„É≠„É≥„Éó„ÉàID:</label>
    <select id="promptSelect" onchange="loadPrompt()">
    </select>
    <label for="promptContent">„Éó„É≠„É≥„Éó„ÉàÂÜÖÂÆπ:</label>
    <textarea id="promptContent"></textarea>
    <button class="primary" onclick="savePrompt()">‰øùÂ≠ò</button>
    <button class="secondary" onclick="google.script.host.close()">Èñâ„Åò„Çã</button>
    <div id="promptMessageBox" class="message"></div>
  </div>

  <!-- „Ç¢„Ç∑„Çπ„Çø„É≥„Éà„Çø„Éñ -->
  <div id="tab-assistant" class="tab-content">
    <h3>„Ç¢„Ç∑„Çπ„Çø„É≥„Éà</h3>

    <!-- „Çª„É´ÊÉÖÂ†±„Ç´„Éº„Éâ -->
    <div class="cell-info-card" id="cellInfoCard">
      <h4>ÈÅ∏Êäû‰∏≠„ÅÆ„Çª„É´</h4>
      <div id="cellInfoContent">
        <p style="color: #5f6368; text-align: center;">„Çª„É´„ÇíÈÅ∏Êäû„Åó„Å¶„ÄåÊõ¥Êñ∞„Äç„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
      </div>
      <button class="secondary" onclick="refreshCellInfo()" style="width: 100%; margin-top: 8px;">
        „Çª„É´ÊÉÖÂ†±„ÇíÊõ¥Êñ∞
      </button>
    </div>

    <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
    <div class="action-buttons">
      <div class="action-btn" onclick="analyzeCell()">
        <div class="action-btn-icon">üîç</div>
        <div class="action-btn-label">Ë®∫Êñ≠„Åô„Çã</div>
      </div>
      <div class="action-btn" onclick="getColumnInfo()">
        <div class="action-btn-icon">üìñ</div>
        <div class="action-btn-label">Ë©≥Á¥∞„ÇíË°®Á§∫</div>
      </div>
    </div>

    <!-- ÁµêÊûúË°®Á§∫ -->
    <div class="result-box" id="resultBox" style="display: none;"></div>

    <!-- FAQ -->
    <h4 style="margin: 16px 0 8px 0; color: #5f6368;">„Çà„Åè„ÅÇ„ÇãË≥™Âïè</h4>
    <div id="faqList"></div>

    <!-- „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ -->
    <h4 style="margin: 16px 0 8px 0; color: #5f6368;">„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ</h4>
    <div class="feedback-form" style="text-align: center;">
      <p style="color: #5f6368; margin-bottom: 12px;">„Éê„Ç∞Â†±Âëä„ÉªÊ©üËÉΩË¶ÅÊúõ„Éª„ÅîË≥™Âïè„ÅØ„Åì„Å°„Çâ„Åã„Çâ</p>
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSdhsa_rx3HXRSkSgkp0IVLpcVSqjCa1ksYy2_TT_B6tuJMO2A/viewform" target="_blank" class="primary" style="display: inline-block; text-decoration: none; padding: 10px 20px;">„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„ÇíÈÄÅ„Çã</a>
      <p style="color: #9aa0a6; font-size: 11px; margin-top: 8px;">‚Äª„Äå‰∏ÄÊã¨„Ç∑„Éº„ÉàV3„Äç„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
    </div>
    <div id="assistantMessageBox" class="message"></div>
  </div>

  <script>
    // ÁèæÂú®„ÅÆ„Çø„Éñ
    let currentTab = 'prompt';
    // ÁèæÂú®„ÅÆ„Çª„É´ÊÉÖÂ†±
    let currentCellInfo = null;

    // ========== „Çø„ÉñÂàá„ÇäÊõø„Åà ==========
    function switchTab(tabName) {
      currentTab = tabName;

      // „Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');

      // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆË°®Á§∫„ÇíÂàá„ÇäÊõø„Åà
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.getElementById('tab-' + tabName).classList.add('active');

      // „Ç¢„Ç∑„Çπ„Çø„É≥„Éà„Çø„Éñ„Å´Âàá„ÇäÊõø„Åà„ÅüÊôÇ„ÄÅ„Çª„É´ÊÉÖÂ†±„ÇíÂèñÂæó
      if (tabName === 'assistant' && !currentCellInfo) {
        refreshCellInfo();
        loadFaqList();
      }
    }

    // ========== „Éó„É≠„É≥„Éó„ÉàÁ∑®ÈõÜÊ©üËÉΩ ==========
    function showPromptMessage(msg, type) {
      const msgBox = document.getElementById('promptMessageBox');
      msgBox.textContent = msg;
      msgBox.className = 'message ' + type;
      msgBox.style.display = 'block';
      setTimeout(() => { msgBox.style.display = 'none'; }, 3000);
    }

    function populatePromptSelect(promptIds) {
      const select = document.getElementById('promptSelect');
      select.innerHTML = '<option value="">--ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ--</option>';
      promptIds.forEach(id => {
        const option = document.createElement('option');
        option.value = id;
        option.textContent = id;
        select.appendChild(option);
      });
    }

    function loadPrompt() {
      const promptId = document.getElementById('promptSelect').value;
      if (promptId) {
        google.script.run
          .withSuccessHandler(function(content) {
            document.getElementById('promptContent').value = content;
          })
          .withFailureHandler(function(error) {
            showPromptMessage('„Éó„É≠„É≥„Éó„Éà„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
            document.getElementById('promptContent').value = '';
          })
          .getPromptContent(promptId);
      } else {
        document.getElementById('promptContent').value = '';
      }
    }

    function savePrompt() {
      const promptId = document.getElementById('promptSelect').value;
      const promptContent = document.getElementById('promptContent').value;
      if (!promptId) {
        showPromptMessage('„Éó„É≠„É≥„Éó„ÉàID„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'error');
        return;
      }
      if (!promptContent.trim()) {
        showPromptMessage('„Éó„É≠„É≥„Éó„ÉàÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'error');
        return;
      }

      google.script.run
        .withSuccessHandler(function() {
          showPromptMessage('„Éó„É≠„É≥„Éó„Éà„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ', 'success');
        })
        .withFailureHandler(function(error) {
          showPromptMessage('„Éó„É≠„É≥„Éó„Éà„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
        })
        .savePromptContent(promptId, promptContent);
    }

    // ========== „Ç¢„Ç∑„Çπ„Çø„É≥„ÉàÊ©üËÉΩ ==========
    function showAssistantMessage(msg, type) {
      const msgBox = document.getElementById('assistantMessageBox');
      msgBox.textContent = msg;
      msgBox.className = 'message ' + type;
      msgBox.style.display = 'block';
      setTimeout(() => { msgBox.style.display = 'none'; }, 3000);
    }

    function callAssistant(action, data, callback) {
      const request = JSON.stringify({ action: action, data: data || {} });
      google.script.run
        .withSuccessHandler(function(response) {
          if (typeof response === 'string') {
            try { response = JSON.parse(response); } catch (e) {}
          }
          callback(response);
        })
        .withFailureHandler(function(error) {
          callback({ success: false, error: error.message });
        })
        .savePromptContent('__ASSISTANT__', request);
    }

    function refreshCellInfo() {
      const contentDiv = document.getElementById('cellInfoContent');
      contentDiv.innerHTML = '<p style="color: #5f6368; text-align: center;">Ë™≠„ÅøËæº„Åø‰∏≠...</p>';

      callAssistant('GET_SELECTED_CELL_INFO', {}, function(response) {
        if (response.success) {
          currentCellInfo = response.data;
          renderCellInfo(response.data);
        } else {
          contentDiv.innerHTML = '<p style="color: #d93025;">„Ç®„É©„Éº: ' + response.error + '</p>';
        }
      });
    }

    function renderCellInfo(info) {
      const contentDiv = document.getElementById('cellInfoContent');
      let html = '';
      html += '<div class="cell-info-row"><span class="cell-info-label">‰ΩçÁΩÆ</span><span class="cell-info-value">' + info.colLetter + info.row + '</span></div>';
      html += '<div class="cell-info-row"><span class="cell-info-label">„Ç∑„Éº„Éà</span><span class="cell-info-value">' + info.sheetName + '</span></div>';
      html += '<div class="cell-info-row"><span class="cell-info-label">ÂàóÂêç</span><span class="cell-info-value">' + (info.headerName || '(„Å™„Åó)') + '</span></div>';
      html += '<div class="cell-info-row"><span class="cell-info-label">ÂÄ§</span><span class="cell-info-value">' + (info.displayValue || '(Á©∫)') + '</span></div>';
      if (info.hasError) {
        html += '<div class="cell-info-row"><span class="cell-info-label">„Ç®„É©„Éº</span><span class="cell-info-value error">' + info.errorType + '</span></div>';
      }
      contentDiv.innerHTML = html;
    }

    function analyzeCell() {
      const resultBox = document.getElementById('resultBox');
      resultBox.style.display = 'block';
      resultBox.className = 'result-box loading';
      resultBox.textContent = 'Ë®∫Êñ≠‰∏≠...';

      callAssistant('ANALYZE_CELL', {}, function(response) {
        resultBox.className = 'result-box';
        if (response.success) {
          resultBox.textContent = response.data.diagnosis;
        } else {
          resultBox.textContent = '„Ç®„É©„Éº: ' + response.error;
        }
      });
    }

    function getColumnInfo() {
      const resultBox = document.getElementById('resultBox');
      resultBox.style.display = 'block';
      resultBox.className = 'result-box loading';
      resultBox.textContent = 'ÂèñÂæó‰∏≠...';

      callAssistant('GET_COLUMN_INFO', {}, function(response) {
        resultBox.className = 'result-box';
        if (response.success) {
          const data = response.data;
          let sections = [];

          // 1. Âõ∫ÂÆö„Çª„É´Ë™¨ÊòéÔºà1Ë°åÁõÆÔºöË™¨Êòé„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøË°®Á§∫Ôºâ
          if (data.cell1Description) {
            sections.push('üìç „Çª„É´„Äå' + data.cell1Address + '„Äç\n' + data.cell1Description);
          }

          // 2. Âõ∫ÂÆö„Çª„É´Ë™¨ÊòéÔºà2Ë°åÁõÆÔºöË™¨Êòé„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøË°®Á§∫Ôºâ
          if (data.cell2Description) {
            sections.push('üìç „Çª„É´„Äå' + data.cell2Address + '„Äç\n' + data.cell2Description);
          }

          // 3. Âõ∫ÂÆö„Çª„É´Ë™¨ÊòéÔºà3Ë°åÁõÆÔºöË™¨Êòé„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøË°®Á§∫Ôºâ
          if (data.cell3Description) {
            sections.push('üìç „Çª„É´„Äå' + data.cell3Address + '„Äç\n' + data.cell3Description);
          }

          // 4. ÂàóË™¨ÊòéÔºàÂ∏∏„Å´Ë°®Á§∫Ôºâ
          if (data.columnDescription) {
            sections.push('üìä Âàó„Äå' + (data.headerName || 'ÂêçÁß∞Êú™Ë®≠ÂÆö') + '„ÄçÔºà' + data.colLetter + 'ÂàóÔºâ\n' + data.columnDescription);
          } else {
            sections.push('üìä Âàó„Äå' + (data.headerName || 'ÂêçÁß∞Êú™Ë®≠ÂÆö') + '„ÄçÔºà' + data.colLetter + 'ÂàóÔºâ\nË™¨Êòé„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ');
          }

          // 5. „Ç∑„Éº„ÉàË™¨ÊòéÔºàË™¨Êòé„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøË°®Á§∫Ôºâ
          if (data.sheetDescription) {
            sections.push('üìã „Ç∑„Éº„Éà„Äå' + data.sheetName + '„Äç\n' + data.sheetDescription);
          }

          // Âå∫Âàá„ÇäÁ∑ö„ÅßÁµêÂêà„Åó„Å¶Ë°®Á§∫
          resultBox.textContent = sections.join('\n\n----------------\n');

        } else {
          resultBox.textContent = '„Ç®„É©„Éº: ' + response.error;
        }
      });
    }

    // „Ç´„ÉÜ„Ç¥„É™„Ç¢„Ç§„Ç≥„É≥„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞
    const categoryIcons = {
      'ÁøªË®≥„ÉªAI': 'ü§ñ',
      'UI„ÉªË°®Á§∫': 'üñ•Ô∏è',
      '‰æ°Ê†ºË®àÁÆó': 'üí∞',
      'EAGLEÈÄ£Êê∫': 'ü¶Ö',
      '„Éá„Éº„Çø„ÉªÂºè': 'üìä'
    };

    function loadFaqList() {
      callAssistant('GET_FAQ_LIST', {}, function(response) {
        if (response.success) {
          renderFaqList(response.data);
        }
      });
    }

    function renderFaqList(faqList) {
      const container = document.getElementById('faqList');

      // „Ç´„ÉÜ„Ç¥„É™„Åî„Å®„Å´„Ç∞„É´„Éº„ÉóÂåñ
      const categories = {};
      faqList.forEach((faq, index) => {
        const cat = faq.category || '„Åù„ÅÆ‰ªñ';
        if (!categories[cat]) {
          categories[cat] = [];
        }
        categories[cat].push({ ...faq, originalIndex: index });
      });

      let html = '';
      let catIndex = 0;

      for (const catName in categories) {
        const items = categories[catName];
        const icon = categoryIcons[catName] || '‚ùì';

        html += '<div class="faq-category">';
        html += '<div class="faq-category-header" onclick="toggleCategory(' + catIndex + ')">';
        html += '<span><span class="category-icon">' + icon + '</span>' + catName + ' (' + items.length + ')</span>';
        html += '<span class="category-toggle">+</span>';
        html += '</div>';
        html += '<div class="faq-category-items" id="faq-category-' + catIndex + '">';

        items.forEach((faq, itemIndex) => {
          const uniqueId = catIndex + '-' + itemIndex;
          html += '<div class="faq-item">';
          html += '<div class="faq-question" id="faq-q-' + uniqueId + '" onclick="toggleFaq(\'' + uniqueId + '\')">';
          html += '<span><span class="q-icon">Q.</span>' + faq.question + '</span>';
          html += '<span class="toggle-icon">‚ñ∂</span>';
          html += '</div>';
          html += '<div class="faq-answer" id="faq-answer-' + uniqueId + '">' + faq.answer + '</div>';
          html += '</div>';
        });

        html += '</div>';
        html += '</div>';
        catIndex++;
      }

      container.innerHTML = html;
    }

    function toggleCategory(catIndex) {
      const items = document.getElementById('faq-category-' + catIndex);
      const header = items.previousElementSibling;

      if (items.classList.contains('open')) {
        items.classList.remove('open');
        header.classList.remove('open');
      } else {
        items.classList.add('open');
        header.classList.add('open');
      }
    }

    function toggleFaq(uniqueId) {
      const answer = document.getElementById('faq-answer-' + uniqueId);
      const question = document.getElementById('faq-q-' + uniqueId);

      if (answer.classList.contains('open')) {
        answer.classList.remove('open');
        question.classList.remove('open');
      } else {
        answer.classList.add('open');
        question.classList.add('open');
      }
    }

    // ========== ÂàùÊúüÂåñ ==========
    google.script.run.withSuccessHandler(populatePromptSelect).getAllPromptIds();
  </script>
</body>
</html>
